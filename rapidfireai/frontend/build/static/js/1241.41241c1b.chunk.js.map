{"version":3,"file":"static/js/1241.41241c1b.chunk.js","mappings":"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","sources":["shared/web-shared/model-trace-explorer/timeline-tree/TimelineTree.utils.ts","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerChatMessageHeader.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerChatRenderer.utils.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerToolCallMessage.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerChatMessage.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerConversation.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentPaneToggle.tsx","shared/web-shared/model-trace-explorer/hooks/useGetModelTraceInfoV3.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerSkeleton.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentsPane.utils.tsx","shared/web-shared/model-trace-explorer/field-renderers/ModelTraceExplorerChatToolsRenderer.tsx","shared/web-shared/model-trace-explorer/field-renderers/ModelTraceExplorerRetrieverFieldRenderer.tsx","shared/web-shared/model-trace-explorer/field-renderers/ModelTraceExplorerTextFieldRenderer.tsx","shared/web-shared/model-trace-explorer/field-renderers/ModelTraceExplorerFieldRenderer.tsx","shared/web-shared/model-trace-explorer/summary-view/ModelTraceExplorerSummaryViewExceptionsSection.tsx","shared/web-shared/model-trace-explorer/summary-view/ModelTraceExplorerSummaryIntermediateNode.tsx","shared/web-shared/model-trace-explorer/summary-view/ModelTraceExplorerSummarySpans.tsx","shared/web-shared/model-trace-explorer/summary-view/ModelTraceExplorerSummaryView.tsx","shared/web-shared/model-trace-explorer/constants.ts","shared/web-shared/model-trace-explorer/ModelTraceExplorerHighlightedSnippetTitle.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerCodeSnippet.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerCollapsibleSection.tsx","shared/web-shared/model-trace-explorer/chat-utils/anthropic.ts","shared/web-shared/model-trace-explorer/chat-utils/gemini.ts","shared/web-shared/model-trace-explorer/chat-utils/openai.ts","shared/web-shared/model-trace-explorer/chat-utils/langchain.ts","shared/web-shared/model-trace-explorer/chat-utils/llamaindex.ts","shared/web-shared/model-trace-explorer/chat-utils/autogen.ts","shared/web-shared/model-trace-explorer/chat-utils/bedrock.ts","shared/web-shared/model-trace-explorer/ModelTraceExplorer.utils.tsx","shared/web-shared/model-trace-explorer/chat-utils/dspy.ts","shared/web-shared/model-trace-explorer/assessments-pane/SpanNameDetailViewLink.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerIcon.tsx","shared/web-shared/model-trace-explorer/key-value-tag/KeyValueTag.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerRetrieverDocumentFull.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerRetrieverDocumentPreview.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerRetrieverDocument.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerErrorState.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerSearchBox.tsx","shared/web-shared/model-trace-explorer/hooks/useModelTraceSearch.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerAttributesTab.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerChatTab.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerDefaultSpanView.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerRenderModeToggle.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerRetrieverSpanView.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerContentTab.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerEventsTab.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerBadge.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerRightPaneTabs.tsx","shared/web-shared/model-trace-explorer/timeline-tree/TimelineTreeFilterButton.tsx","shared/web-shared/model-trace-explorer/timeline-tree/TimelineTreeHeader.tsx","shared/web-shared/model-trace-explorer/timeline-tree/TimelineTreeHierarchyBars.tsx","shared/web-shared/model-trace-explorer/timeline-tree/TimelineTreeSpanTooltip.tsx","shared/web-shared/model-trace-explorer/timeline-tree/TimelineTreeNode.tsx","shared/web-shared/model-trace-explorer/timeline-tree/gantt/TimelineTreeGanttNode.tsx","shared/web-shared/model-trace-explorer/timeline-tree/gantt/TimelineTreeGanttBars.tsx","shared/web-shared/model-trace-explorer/timeline-tree/TimelineTree.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerDetailView.tsx","shared/web-shared/global-settings/getUser.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorer.request.utils.tsx","shared/web-shared/model-trace-explorer/api.ts","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerChatToolParam.tsx","shared/web-shared/model-trace-explorer/right-pane/ModelTraceExplorerChatTool.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerViewStateContext.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerResizablePane.tsx","shared/web-shared/model-trace-explorer/ModelTraceHeaderDetails.tsx","shared/web-shared/model-trace-explorer/TagUtils.ts","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentCreateForm.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentCreateButton.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentActionsOverflowMenu.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentDeleteModal.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentEditForm.tsx","shared/web-shared/model-trace-explorer/hooks/useUpdateAssessment.tsx","shared/web-shared/model-trace-explorer/hooks/useOverrideAssessment.tsx","shared/web-shared/model-trace-explorer/assessments-pane/ExpectationValuePreview.tsx","shared/web-shared/model-trace-explorer/assessments-pane/ExpectationItem.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentDisplayValue.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentSourceName.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentItemHeader.tsx","shared/web-shared/model-trace-explorer/assessments-pane/FeedbackErrorItem.tsx","shared/web-shared/model-trace-explorer/assessments-pane/FeedbackHistoryItem.tsx","shared/web-shared/model-trace-explorer/assessments-pane/FeedbackHistoryModal.tsx","shared/web-shared/model-trace-explorer/assessments-pane/FeedbackItemContent.tsx","shared/web-shared/model-trace-explorer/assessments-pane/FeedbackItem.tsx","shared/web-shared/model-trace-explorer/assessments-pane/FeedbackValueGroupSourceCounts.tsx","shared/web-shared/model-trace-explorer/assessments-pane/FeedbackValueGroup.tsx","shared/web-shared/model-trace-explorer/assessments-pane/FeedbackGroup.tsx","shared/web-shared/model-trace-explorer/assessments-pane/AssessmentsPane.tsx","shared/web-shared/model-trace-explorer/FeatureUtils.ts","shared/web-shared/model-trace-explorer/ModelTraceExplorerHighlightedCodeSnippet.tsx","shared/web-shared/model-trace-explorer/ModelTraceExplorerCodeSnippetBody.tsx","shared/web-shared/genai-markdown-renderer/TableRenderer.tsx","shared/web-shared/genai-markdown-renderer/GenAIMarkdownRenderer.tsx"],"sourcesContent":["import { values } from 'lodash';\nimport { useState } from 'react';\n\nimport type { TimelineTreeNode } from './TimelineTree.types';\nimport type { ModelTraceSpanNode } from '../ModelTrace.types';\n\n// expand all nodes by default\nexport const DEFAULT_EXPAND_DEPTH = Infinity;\nexport const SPAN_INDENT_WIDTH = 16;\nexport const SPAN_ROW_HEIGHT = 32;\nexport const TimelineTreeZIndex = {\n  HIGH: 5,\n  NORMAL: 3,\n  LOW: 1,\n};\n\n// Gets the min and max start and end times of the tree\nexport const getTimelineTreeSpanConstraints = (\n  nodes: TimelineTreeNode[],\n  constraints = { min: Number.MAX_SAFE_INTEGER, max: 0 },\n) => {\n  nodes.forEach((node) => {\n    const { start, end, children } = node;\n    if (start < constraints.min) {\n      constraints.min = start;\n    }\n    if (end > constraints.max) {\n      constraints.max = end;\n    }\n    getTimelineTreeSpanConstraints(children ?? [], constraints);\n  });\n\n  return constraints;\n};\n\n// Gets a flat list of all expanded nodes in the tree\nexport const getTimelineTreeExpandedNodesList = <T extends TimelineTreeNode & { children?: T[] }>(\n  nodes: T[],\n  expandedKeys: Set<string | number>,\n) => {\n  const expandedNodesFlat: T[] = [];\n  const traverseExpanded = (traversedNode: T | undefined) => {\n    if (!traversedNode) {\n      return;\n    }\n    expandedNodesFlat.push(traversedNode);\n    if (expandedKeys.has(traversedNode.key)) {\n      traversedNode.children?.forEach(traverseExpanded);\n    }\n  };\n\n  nodes.forEach(traverseExpanded);\n  return expandedNodesFlat;\n};\n\n// Gets a flat list of all nodes in the tree (regardless of expansion status)\nexport const getTimelineTreeNodesList = <T extends TimelineTreeNode & { children?: T[] }>(nodes: T[]) => {\n  const expandedNodesFlat: T[] = [];\n  const traverseExpanded = (traversedNode: T | undefined) => {\n    if (!traversedNode) {\n      return;\n    }\n    expandedNodesFlat.push(traversedNode);\n    traversedNode.children?.forEach(traverseExpanded);\n  };\n\n  nodes.forEach(traverseExpanded);\n  return expandedNodesFlat;\n};\n\nexport const getTimelineTreeNodesMap = <T extends TimelineTreeNode & { children?: T[] }>(\n  nodes: T[],\n  expandDepth = Infinity,\n) => {\n  const nodesMap: { [nodeId: string]: T } = {};\n\n  const traverse = (traversedNode: T | undefined, depth: number) => {\n    if (!traversedNode || depth > expandDepth) {\n      return;\n    }\n    nodesMap[traversedNode.key] = traversedNode;\n    traversedNode.children?.forEach((child: T) => traverse(child, depth + 1));\n  };\n\n  nodes.forEach(traverse, 0);\n  return nodesMap;\n};\n\nexport const useTimelineTreeExpandedNodes = <T extends ModelTraceSpanNode & { children?: T[] }>(\n  params: {\n    rootNodes?: T[];\n    // nodes beyond this depth will be collapsed\n    initialExpandDepth?: number;\n  } = {},\n) => {\n  const [expandedKeys, setExpandedKeys] = useState<Set<string | number>>(() => {\n    if (params.rootNodes) {\n      const list = values(getTimelineTreeNodesMap(params.rootNodes, params.initialExpandDepth)).map((node) => node.key);\n      return new Set(list);\n    }\n    return new Set();\n  });\n\n  return {\n    expandedKeys,\n    setExpandedKeys,\n  };\n};\n\nexport const useTimelineTreeSelectedNode = () => {\n  const [selectedNode, setSelectedNode] = useState<ModelTraceSpanNode | undefined>(undefined);\n\n  return {\n    selectedNode,\n    setSelectedNode,\n  };\n};\n\nexport const spanTimeFormatter = (executionTimeUs: number) => {\n  // Convert to different units based on the time scale\n  if (executionTimeUs === 0) {\n    return '0s';\n  } else if (executionTimeUs >= 60 * 1e6) {\n    // More than or equal to 1 minute\n    const executionTimeMin = executionTimeUs / 1e6 / 60;\n    return `${executionTimeMin.toFixed(2)}m`;\n  } else if (executionTimeUs >= 1e5) {\n    // More than or equal to 0.1 second. this\n    // is to avoid showing 3-digit ms numbers\n    const executionTimeSec = executionTimeUs / 1e6;\n    return `${executionTimeSec.toFixed(2)}s`;\n  } else {\n    // Less than 0.1 second (milliseconds)\n    const executionTimeMs = executionTimeUs / 1e3;\n    return `${executionTimeMs.toFixed(2)}ms`;\n  }\n};\n\nexport const getActiveChildIndex = (node: ModelTraceSpanNode, activeNodeId: string): number => {\n  if (node.key === activeNodeId) {\n    return 0;\n  }\n\n  return (node.children ?? []).findIndex((child) => getActiveChildIndex(child, activeNodeId) > -1);\n};\n\nexport const getModelTraceSpanNodeDepth = (node: ModelTraceSpanNode): number => {\n  if (!node.children || node.children?.length === 0) {\n    return 0;\n  }\n\n  const childDepths = node.children.map(getModelTraceSpanNodeDepth);\n  return Math.max(...childDepths) + 1;\n};\n\nexport const getSpanNodeParentIds = (node: ModelTraceSpanNode, nodeMap: { [nodeId: string]: ModelTraceSpanNode }) => {\n  const parents = new Set<string | number>();\n\n  let currentNode = node;\n  while (currentNode && currentNode.parentId) {\n    parents.add(currentNode.parentId);\n    currentNode = nodeMap[currentNode.parentId];\n  }\n\n  return parents;\n};\n","import {\n  ChevronRightIcon,\n  ChevronDownIcon,\n  Typography,\n  useDesignSystemTheme,\n  Tooltip,\n} from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport type { ModelTraceChatMessage } from '../ModelTrace.types';\nimport { ModelIconType } from '../ModelTrace.types';\nimport { ModelTraceExplorerIcon } from '../ModelTraceExplorerIcon';\n\nconst getRoleIcon = (role: string) => {\n  switch (role) {\n    case 'system':\n      return <ModelTraceExplorerIcon type={ModelIconType.SYSTEM} />;\n    case 'user':\n      return <ModelTraceExplorerIcon type={ModelIconType.USER} />;\n    case 'tool':\n    case 'function':\n      return <ModelTraceExplorerIcon type={ModelIconType.WRENCH} />;\n    default:\n      return <ModelTraceExplorerIcon type={ModelIconType.MODELS} />;\n  }\n};\n\nconst getRoleDisplayText = (message: ModelTraceChatMessage) => {\n  switch (message.role) {\n    case 'system':\n      return (\n        <FormattedMessage\n          defaultMessage=\"System\"\n          description=\"Display text for the 'system' role in a GenAI chat message.\"\n        />\n      );\n    case 'user':\n      return (\n        <FormattedMessage\n          defaultMessage=\"User\"\n          description=\"Display text for the 'user' role in a GenAI chat message.\"\n        />\n      );\n    case 'assistant':\n      return (\n        <FormattedMessage\n          defaultMessage=\"Assistant\"\n          description=\"Display text for the 'assistant' role in a GenAI chat message.\"\n        />\n      );\n    case 'tool':\n      if (message.name) {\n        return message.name;\n      }\n      return (\n        <FormattedMessage\n          defaultMessage=\"Tool\"\n          description=\"Display text for the 'tool' role in a GenAI chat message.\"\n        />\n      );\n    case 'function':\n      return (\n        <FormattedMessage\n          defaultMessage=\"Function\"\n          description=\"Display text for the 'function' role in a GenAI chat message.\"\n        />\n      );\n    default:\n      return message.role;\n  }\n};\n\nexport const ModelTraceExplorerChatMessageHeader = ({\n  isExpandable,\n  expanded,\n  setExpanded,\n  message,\n}: {\n  isExpandable: boolean;\n  expanded: boolean;\n  setExpanded: (expanded: boolean) => void;\n  message: ModelTraceChatMessage;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const hoverStyles = isExpandable\n    ? {\n        ':hover': {\n          backgroundColor: theme.colors.actionIconBackgroundHover,\n          cursor: 'pointer',\n        },\n      }\n    : {};\n\n  return (\n    <div\n      role=\"button\"\n      css={{\n        display: 'flex',\n        flexDirection: 'row',\n        alignItems: 'center',\n        padding: theme.spacing.sm,\n        gap: theme.spacing.sm,\n        ...hoverStyles,\n      }}\n      onClick={() => setExpanded(!expanded)}\n    >\n      {isExpandable && (expanded ? <ChevronDownIcon /> : <ChevronRightIcon />)}\n      {getRoleIcon(message.role)}\n      {message.tool_call_id ? (\n        <Typography.Text\n          color=\"secondary\"\n          css={{\n            whiteSpace: 'nowrap',\n            display: 'inline-flex',\n            alignItems: 'center',\n            flex: 1,\n            minWidth: 0,\n          }}\n        >\n          <FormattedMessage\n            defaultMessage=\"{toolName} was called in {toolCallId}\"\n            description=\"A message that shows the tool call ID of a tool call chat message.\"\n            values={{\n              toolName: (\n                <Typography.Text css={{ marginRight: theme.spacing.xs }} bold>\n                  {getRoleDisplayText(message)}\n                </Typography.Text>\n              ),\n              toolCallId: (\n                <Tooltip componentId=\"test\" content={message.tool_call_id}>\n                  <div\n                    css={{ display: 'inline-flex', flexShrink: 1, overflow: 'hidden', marginLeft: theme.spacing.xs }}\n                  >\n                    <Typography.Text css={{ textOverflow: 'ellipsis', overflow: 'hidden', whiteSpace: 'nowrap' }} code>\n                      {message.tool_call_id}\n                    </Typography.Text>\n                  </div>\n                </Tooltip>\n              ),\n            }}\n          />\n        </Typography.Text>\n      ) : (\n        <Typography.Text bold>{getRoleDisplayText(message)}</Typography.Text>\n      )}\n    </div>\n  );\n};\n","export const CONTENT_TRUNCATION_LIMIT = 300;\n","import { FunctionIcon, Tag, Tooltip, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport type { ModelTraceToolCall } from '../ModelTrace.types';\nimport { ModelTraceExplorerCodeSnippetBody } from '../ModelTraceExplorerCodeSnippetBody';\n\nexport function ModelTraceExplorerToolCallMessage({ toolCall }: { toolCall: ModelTraceToolCall }) {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div key={toolCall.id} css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n      <Typography.Text\n        color=\"secondary\"\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          alignItems: 'center',\n          padding: `0px ${theme.spacing.sm + theme.spacing.xs}px`,\n        }}\n      >\n        <FormattedMessage\n          defaultMessage=\"called {functionName} in {toolCallId}\"\n          description=\"A message that shows the tool calls that an AI assistant made. The full message reads (for example): 'Assistant called get_weather in id_123'.\"\n          values={{\n            functionName: (\n              <Tag\n                color=\"purple\"\n                componentId=\"shared.model-trace-explorer.function-name-tag\"\n                css={{ margin: `0px ${theme.spacing.xs}px` }}\n              >\n                <FunctionIcon />\n                <Typography.Text css={{ whiteSpace: 'nowrap', marginLeft: theme.spacing.xs }}>\n                  {toolCall.function.name}\n                </Typography.Text>\n              </Tag>\n            ),\n            toolCallId: (\n              <Tooltip componentId=\"test\" content={toolCall.id}>\n                <div css={{ display: 'inline-flex', flexShrink: 1, overflow: 'hidden', marginLeft: theme.spacing.xs }}>\n                  <Typography.Text\n                    css={{\n                      textOverflow: 'ellipsis',\n                      overflow: 'hidden',\n                      whiteSpace: 'nowrap',\n                    }}\n                    code\n                    color=\"secondary\"\n                  >\n                    {toolCall.id}\n                  </Typography.Text>\n                </div>\n              </Tooltip>\n            ),\n          }}\n        />\n      </Typography.Text>\n      <ModelTraceExplorerCodeSnippetBody data={toolCall.function.arguments} />\n    </div>\n  );\n}\n","import { isNil } from 'lodash';\nimport { useState } from 'react';\n\nimport { Button, ChevronDownIcon, ChevronUpIcon, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport { GenAIMarkdownRenderer } from '@databricks/web-shared/genai-markdown-renderer';\n\nimport { ModelTraceExplorerChatMessageHeader } from './ModelTraceExplorerChatMessageHeader';\nimport { CONTENT_TRUNCATION_LIMIT } from './ModelTraceExplorerChatRenderer.utils';\nimport { ModelTraceExplorerToolCallMessage } from './ModelTraceExplorerToolCallMessage';\nimport { CodeSnippetRenderMode, type ModelTraceChatMessage } from '../ModelTrace.types';\nimport { ModelTraceExplorerCodeSnippetBody } from '../ModelTraceExplorerCodeSnippetBody';\n\nconst tryGetJsonContent = (content: string) => {\n  try {\n    return {\n      content: JSON.stringify(JSON.parse(content), null, 2),\n      isJson: true,\n    };\n  } catch (error) {\n    return {\n      content,\n      isJson: false,\n    };\n  }\n};\n\nfunction ModelTraceExplorerChatMessageContent({\n  content,\n  shouldDisplayCodeSnippet,\n}: {\n  content: string;\n  shouldDisplayCodeSnippet: boolean;\n}) {\n  const { theme } = useDesignSystemTheme();\n\n  if (!content) {\n    return null;\n  }\n\n  if (shouldDisplayCodeSnippet) {\n    return (\n      <ModelTraceExplorerCodeSnippetBody\n        data={content}\n        searchFilter=\"\"\n        activeMatch={null}\n        containsActiveMatch={false}\n        renderMode={CodeSnippetRenderMode.JSON}\n      />\n    );\n  }\n\n  return (\n    <div\n      css={{\n        padding: theme.spacing.sm,\n        paddingTop: 0,\n        // genai markdown renderer uses default paragraph sizing which has\n        // a bottom margin that we can't get rid of. workaround by setting\n        // negative margin in a wrapper.\n        marginBottom: -theme.typography.fontSizeBase,\n      }}\n    >\n      <GenAIMarkdownRenderer>{content}</GenAIMarkdownRenderer>\n    </div>\n  );\n}\n\nexport function ModelTraceExplorerChatMessage({\n  message,\n  className,\n}: {\n  message: ModelTraceChatMessage;\n  className?: string;\n}) {\n  const { theme } = useDesignSystemTheme();\n  const [expanded, setExpanded] = useState(false);\n  const { content, isJson } = tryGetJsonContent(message.content ?? '');\n\n  // tool call responses can be JSON, and in these cases\n  // it's more helpful to display the message as JSON\n  const shouldDisplayCodeSnippet = isJson && (message.role === 'tool' || message.role === 'function');\n  // if the content is JSON, truncation will be handled by the code\n  // snippet. otherwise, we need to truncate the content manually.\n  const isExpandable = !shouldDisplayCodeSnippet && content.length > CONTENT_TRUNCATION_LIMIT;\n\n  const displayedContent = isExpandable && !expanded ? `${content.slice(0, CONTENT_TRUNCATION_LIMIT)}...` : content;\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        width: '100%',\n        borderRadius: theme.borders.borderRadiusSm,\n        border: `1px solid ${theme.colors.border}`,\n        backgroundColor: theme.colors.backgroundPrimary,\n        overflow: 'hidden',\n      }}\n      className={className}\n    >\n      <ModelTraceExplorerChatMessageHeader\n        isExpandable={isExpandable}\n        expanded={expanded}\n        setExpanded={setExpanded}\n        message={message}\n      />\n      <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n        {!isNil(message.tool_calls) &&\n          message.tool_calls.map((toolCall) => (\n            <ModelTraceExplorerToolCallMessage key={toolCall.id} toolCall={toolCall} />\n          ))}\n        <ModelTraceExplorerChatMessageContent\n          content={displayedContent}\n          shouldDisplayCodeSnippet={shouldDisplayCodeSnippet}\n        />\n      </div>\n      {isExpandable && (\n        <Button\n          componentId={\n            expanded\n              ? 'shared.model-trace-explorer.chat-message-see-less'\n              : 'shared.model-trace-explorer.chat-message-see-more'\n          }\n          icon={expanded ? <ChevronUpIcon /> : <ChevronDownIcon />}\n          type=\"tertiary\"\n          onClick={() => setExpanded(!expanded)}\n          css={{\n            display: 'flex',\n            width: '100%',\n            padding: theme.spacing.md,\n            borderRadius: '0px !important',\n          }}\n        >\n          {expanded ? (\n            <FormattedMessage\n              defaultMessage=\"See less\"\n              description=\"A button label in a message renderer that truncates long content when clicked.\"\n            />\n          ) : (\n            <FormattedMessage\n              defaultMessage=\"See more\"\n              description=\"A button label in a message renderer that expands truncated content when clicked.\"\n            />\n          )}\n        </Button>\n      )}\n    </div>\n  );\n}\n","import { isNil } from 'lodash';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nimport { ModelTraceExplorerChatMessage } from './ModelTraceExplorerChatMessage';\nimport type { ModelTraceChatMessage } from '../ModelTrace.types';\n\nexport function ModelTraceExplorerConversation({ messages }: { messages: ModelTraceChatMessage[] | null }) {\n  const { theme } = useDesignSystemTheme();\n\n  if (isNil(messages)) {\n    return null;\n  }\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.sm,\n      }}\n    >\n      {messages.map((message, index) => (\n        <ModelTraceExplorerChatMessage key={index} message={message} />\n      ))}\n    </div>\n  );\n}\n","import { GavelIcon, SegmentedControlGroup, SegmentedControlButton } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\n\nexport const AssessmentPaneToggle = () => {\n  const { assessmentsPaneExpanded, setAssessmentsPaneExpanded, assessmentsPaneEnabled } =\n    useModelTraceExplorerViewState();\n\n  return (\n    <SegmentedControlGroup\n      css={{ display: 'block' }}\n      name=\"shared.model-trace-explorer.assessments-pane-toggle\"\n      componentId=\"shared.model-trace-explorer.assessments-pane-toggle\"\n      value={assessmentsPaneExpanded}\n      size=\"small\"\n    >\n      <SegmentedControlButton\n        value\n        disabled={!assessmentsPaneEnabled}\n        icon={<GavelIcon />}\n        onClick={() => setAssessmentsPaneExpanded?.(!assessmentsPaneExpanded)}\n        css={{\n          '& > span': {\n            display: 'flex',\n            alignItems: 'center',\n          },\n        }}\n      >\n        {!assessmentsPaneExpanded && (\n          <FormattedMessage\n            defaultMessage=\"Assessments\"\n            description=\"Label for the assessments pane of the model trace explorer.\"\n          />\n        )}\n      </SegmentedControlButton>\n    </SegmentedControlGroup>\n  );\n};\n","import { useQuery } from '@databricks/web-shared/query-client';\n\nimport type { ModelTrace } from '../ModelTrace.types';\nimport { FETCH_TRACE_INFO_QUERY_KEY } from '../ModelTraceExplorer.utils';\nimport { fetchTraceInfoV3 } from '../api';\n\nexport const useGetModelTraceInfoV3 = ({\n  traceId,\n  setModelTrace,\n  setAssessmentsPaneEnabled,\n}: {\n  traceId: string;\n  setModelTrace: React.Dispatch<React.SetStateAction<ModelTrace>>;\n  setAssessmentsPaneEnabled: React.Dispatch<React.SetStateAction<boolean>>;\n}) => {\n  const queryKey = [FETCH_TRACE_INFO_QUERY_KEY, traceId];\n\n  return useQuery({\n    queryKey,\n    queryFn: () => fetchTraceInfoV3({ traceId }),\n    onSuccess: (response) => {\n      setModelTrace((prevModelTrace: ModelTrace) => ({\n        data: prevModelTrace.data,\n        info: response?.trace?.trace_info ?? {},\n      }));\n      setAssessmentsPaneEnabled(true);\n    },\n    onError: () => {\n      setAssessmentsPaneEnabled(false);\n    },\n  });\n};\n","import { TableSkeleton, TitleSkeleton, useDesignSystemTheme } from '@databricks/design-system';\n\nexport const ModelTraceExplorerSkeleton = ({ label }: { label?: React.ReactNode }) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div css={{ display: 'flex', height: '100%' }}>\n      <div css={{ flex: 1 }}>\n        <div css={{ padding: theme.spacing.sm, borderBottom: `1px solid ${theme.colors.border}` }}>\n          <TitleSkeleton label={label} />\n        </div>\n        <div\n          css={{\n            borderRadius: theme.legacyBorders.borderRadiusMd,\n            overflow: 'hidden',\n            display: 'flex',\n          }}\n        >\n          <div css={{ flex: 1, padding: theme.spacing.sm, borderRight: `1px solid ${theme.colors.border}` }}>\n            <TableSkeleton lines={5} />\n          </div>\n          <div css={{ flex: 2, padding: theme.spacing.sm }}>\n            <TableSkeleton lines={5} />\n          </div>\n        </div>\n      </div>\n      <div css={{ padding: theme.spacing.md, overflowY: 'auto', flex: 1 }}>\n        <TableSkeleton lines={12} />\n      </div>\n    </div>\n  );\n};\n","import { FormattedMessage } from '@databricks/i18n';\n\nimport type { Expectation, Feedback } from '../ModelTrace.types';\n\nexport type AssessmentFormInputDataType = 'string' | 'boolean' | 'number' | 'json';\n\nexport const ASSESSMENT_PANE_MIN_WIDTH = 250;\n\n// assessment names from databricks judges can sometimes have several\n// prefixes that function like namespaces. for example:\n//\n// metric/global_guideline_adherence/api_code\n//\n// in this case, we only want to display the last element, as that\n// is the most helpful name to the user (and to save ui space).\n// if there are more slashes beyond that, we assume the user added\n// it themselves, so we retain them.\nexport const getAssessmentDisplayName = (name: string): string => {\n  const split = name.split('/');\n  if (split.length === 1) {\n    return name;\n  } else if (split.length === 2) {\n    return split[1];\n  }\n  return split.slice(2).join('/');\n};\n\n// forked from mlflow/web/js/src/common/utils/Utils.tsx\nexport const timeSinceStr = (date: any, referenceDate = new Date()) => {\n  const seconds = Math.max(0, Math.floor((referenceDate.getTime() - date) / 1000));\n  let interval = Math.floor(seconds / 31536000);\n\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 year} other {# years}} ago\"\n        description=\"Text for time in years since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  interval = Math.floor(seconds / 2592000);\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 month} other {# months}} ago\"\n        description=\"Text for time in months since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  interval = Math.floor(seconds / 86400);\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 day} other {# days}} ago\"\n        description=\"Text for time in days since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  interval = Math.floor(seconds / 3600);\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 hour} other {# hours}} ago\"\n        description=\"Text for time in hours since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  interval = Math.floor(seconds / 60);\n  if (interval >= 1) {\n    return (\n      <FormattedMessage\n        defaultMessage=\"{timeSince, plural, =1 {1 minute} other {# minutes}} ago\"\n        description=\"Text for time in minutes since given date for MLflow views\"\n        values={{ timeSince: interval }}\n      />\n    );\n  }\n  return (\n    <FormattedMessage\n      defaultMessage=\"{timeSince, plural, =1 {1 second} other {# seconds}} ago\"\n      description=\"Text for time in seconds since given date for MLflow views\"\n      values={{ timeSince: seconds }}\n    />\n  );\n};\n\nexport const getParsedExpectationValue = (expectation: Expectation) => {\n  if ('value' in expectation) {\n    return expectation.value;\n  }\n\n  try {\n    // at the moment, \"JSON_FORMAT\" is the only serialization format\n    // that is supported. in the future, we may switch on the\n    // expectation.serialized_value.serialization_format field\n    // to determine how to parse the value.\n    return JSON.parse(expectation.serialized_value.value);\n  } catch (e) {\n    return expectation.serialized_value.value;\n  }\n};\n\nexport const getCreateAssessmentPayloadValue = ({\n  formValue,\n  dataType,\n  isFeedback,\n}: {\n  formValue: string | boolean | number | null;\n  dataType: AssessmentFormInputDataType;\n  isFeedback: boolean;\n}): { feedback: Feedback } | { expectation: Expectation } => {\n  if (isFeedback) {\n    return { feedback: { value: formValue } };\n  }\n\n  if (dataType === 'json') {\n    return { expectation: { serialized_value: { value: String(formValue), serialization_format: 'JSON_FORMAT' } } };\n  }\n\n  return { expectation: { value: formValue } };\n};\n","import { Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { ModelTraceChatTool } from '../ModelTrace.types';\nimport { ModelTraceExplorerChatTool } from '../right-pane/ModelTraceExplorerChatTool';\n\nexport const ModelTraceExplorerChatToolsRenderer = ({\n  title,\n  tools,\n}: {\n  title: string;\n  tools: ModelTraceChatTool[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.sm,\n        padding: theme.spacing.sm,\n        border: `1px solid ${theme.colors.border}`,\n        borderRadius: theme.borders.borderRadiusSm,\n      }}\n    >\n      {title && (\n        <Typography.Text css={{ marginLeft: theme.spacing.xs }} bold>\n          {title}\n        </Typography.Text>\n      )}\n      {tools.map((tool) => (\n        <ModelTraceExplorerChatTool key={tool.function.name} tool={tool} />\n      ))}\n    </div>\n  );\n};\n","import { Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { RetrieverDocument } from '../ModelTrace.types';\nimport { ModelTraceExplorerRetrieverDocument } from '../right-pane/ModelTraceExplorerRetrieverDocument';\n\nexport const ModelTraceExplorerRetrieverFieldRenderer = ({\n  title,\n  documents,\n}: {\n  title: string;\n  documents: RetrieverDocument[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      css={{\n        backgroundColor: theme.colors.backgroundPrimary,\n        borderRadius: theme.borders.borderRadiusSm,\n        border: `1px solid ${theme.colors.border}`,\n      }}\n    >\n      {title && (\n        <div\n          css={{\n            padding: `${theme.spacing.xs}px ${theme.spacing.sm}px`,\n            borderBottom: `1px solid ${theme.colors.border}`,\n          }}\n        >\n          <Typography.Text bold>{title}</Typography.Text>\n        </div>\n      )}\n      {documents.map((document, idx) => (\n        <div key={idx} css={{ borderBottom: idx !== documents.length - 1 ? `1px solid ${theme.colors.border}` : '' }}>\n          <ModelTraceExplorerRetrieverDocument key={idx} text={document.page_content} metadata={document.metadata} />\n        </div>\n      ))}\n    </div>\n  );\n};\n","import { useState } from 'react';\n\nimport { ChevronDownIcon, ChevronRightIcon, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport { GenAIMarkdownRenderer } from '@databricks/web-shared/genai-markdown-renderer';\n\nconst STRING_TRUNCATION_LIMIT = 400;\n\nexport const ModelTraceExplorerTextFieldRenderer = ({ title, value }: { title: string; value: string }) => {\n  const { theme } = useDesignSystemTheme();\n  const [expanded, setExpanded] = useState(false);\n\n  const isExpandable = value.length > STRING_TRUNCATION_LIMIT;\n  const displayValue =\n    !expanded && value.length > STRING_TRUNCATION_LIMIT ? value.slice(0, STRING_TRUNCATION_LIMIT) + '...' : value;\n\n  const hoverStyles = isExpandable\n    ? { ':hover': { backgroundColor: theme.colors.actionIconBackgroundHover, cursor: 'pointer' } }\n    : {};\n\n  return (\n    <div\n      css={{\n        border: `1px solid ${theme.colors.border}`,\n        borderRadius: theme.borders.borderRadiusSm,\n      }}\n    >\n      {title && (\n        <div\n          role=\"button\"\n          css={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            padding: `${theme.spacing.sm}px ${theme.spacing.sm + theme.spacing.xs}px`,\n            ...hoverStyles,\n          }}\n          onClick={() => setExpanded(!expanded)}\n        >\n          <Typography.Text bold>{title}</Typography.Text>\n          {isExpandable && (expanded ? <ChevronDownIcon /> : <ChevronRightIcon />)}\n        </div>\n      )}\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'column',\n          gap: theme.spacing.sm,\n          paddingLeft: theme.spacing.sm + theme.spacing.xs,\n          paddingRight: theme.spacing.sm + theme.spacing.xs,\n          paddingTop: title ? 0 : theme.spacing.sm,\n          paddingBottom: theme.spacing.sm,\n          // get rid of last margin in markdown renderer\n          '& > div:last-of-type': {\n            marginBottom: 0,\n          },\n        }}\n      >\n        <GenAIMarkdownRenderer>{displayValue}</GenAIMarkdownRenderer>\n        {isExpandable && (\n          <Typography.Link\n            onClick={() => setExpanded(!expanded)}\n            componentId=\"shared.model-trace-explorer.text-field-see-more-link\"\n          >\n            {expanded ? (\n              <FormattedMessage\n                defaultMessage=\"See less\"\n                description=\"Button to collapse a long text field in the trace explorer summary field renderer\"\n              />\n            ) : (\n              <FormattedMessage\n                defaultMessage=\"See more\"\n                description=\"Button to expand a long text field in the trace explorer summary field renderer\"\n              />\n            )}\n          </Typography.Link>\n        )}\n      </div>\n    </div>\n  );\n};\n","import { every, isString } from 'lodash';\nimport { useMemo } from 'react';\n\nimport { ModelTraceExplorerChatToolsRenderer } from './ModelTraceExplorerChatToolsRenderer';\nimport { ModelTraceExplorerRetrieverFieldRenderer } from './ModelTraceExplorerRetrieverFieldRenderer';\nimport { ModelTraceExplorerTextFieldRenderer } from './ModelTraceExplorerTextFieldRenderer';\nimport { CodeSnippetRenderMode } from '../ModelTrace.types';\nimport { isModelTraceChatTool, isRetrieverDocument, normalizeConversation } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerCodeSnippet } from '../ModelTraceExplorerCodeSnippet';\nimport { ModelTraceExplorerConversation } from '../right-pane/ModelTraceExplorerConversation';\n\nexport const ModelTraceExplorerFieldRenderer = ({\n  title,\n  data,\n  renderMode,\n}: {\n  title: string;\n  data: string;\n  renderMode: 'default' | 'json' | 'text';\n}) => {\n  const parsedData = useMemo(() => {\n    try {\n      return JSON.parse(data);\n    } catch (e) {\n      return data;\n    }\n  }, [data]);\n\n  const dataIsString = isString(parsedData);\n  const chatMessages = normalizeConversation(parsedData);\n  const isChatTools = Array.isArray(parsedData) && parsedData.length > 0 && every(parsedData, isModelTraceChatTool);\n  const isRetrieverDocuments =\n    Array.isArray(parsedData) && parsedData.length > 0 && every(parsedData, isRetrieverDocument);\n\n  if (renderMode === 'json') {\n    return <ModelTraceExplorerCodeSnippet title={title} data={data} initialRenderMode={CodeSnippetRenderMode.JSON} />;\n  }\n\n  if (renderMode === 'text') {\n    return <ModelTraceExplorerCodeSnippet title={title} data={data} initialRenderMode={CodeSnippetRenderMode.TEXT} />;\n  }\n\n  if (dataIsString) {\n    return <ModelTraceExplorerTextFieldRenderer title={title} value={parsedData} />;\n  }\n\n  if (chatMessages && chatMessages.length > 0) {\n    return <ModelTraceExplorerConversation messages={chatMessages} />;\n  }\n\n  if (isChatTools) {\n    return <ModelTraceExplorerChatToolsRenderer title={title} tools={parsedData} />;\n  }\n\n  if (isRetrieverDocuments) {\n    return <ModelTraceExplorerRetrieverFieldRenderer title={title} documents={parsedData} />;\n  }\n\n  return <ModelTraceExplorerCodeSnippet title={title} data={data} />;\n};\n","import { Typography, XCircleIcon, useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { ModelTraceSpanNode } from '../ModelTrace.types';\nimport { getSpanExceptionEvents } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerCollapsibleSection } from '../ModelTraceExplorerCollapsibleSection';\nimport { ModelTraceExplorerFieldRenderer } from '../field-renderers/ModelTraceExplorerFieldRenderer';\n\nexport const ModelTraceExplorerSummaryViewExceptionsSection = ({ node }: { node: ModelTraceSpanNode }) => {\n  const { theme } = useDesignSystemTheme();\n  const exceptionEvents = getSpanExceptionEvents(node);\n  const isRoot = !node.parentId;\n  // to prevent excessive nesting, we only show the first exception.\n  // it is likely that any given span only has one exception,\n  // since execution usually stops after throwing.\n  const firstException = exceptionEvents[0];\n\n  if (!firstException) {\n    return null;\n  }\n\n  return (\n    <ModelTraceExplorerCollapsibleSection\n      css={{ marginBottom: isRoot ? theme.spacing.sm : 0 }}\n      withBorder={isRoot}\n      key={firstException.name}\n      sectionKey={firstException.name}\n      title={\n        <div css={{ display: 'flex', alignItems: 'center', gap: theme.spacing.sm }}>\n          <XCircleIcon color=\"danger\" />\n          <Typography.Text color=\"error\" bold>\n            Exception\n          </Typography.Text>\n        </div>\n      }\n    >\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'column',\n          gap: theme.spacing.sm,\n          paddingBottom: theme.spacing.sm,\n          paddingLeft: isRoot ? 0 : theme.spacing.lg,\n        }}\n      >\n        {Object.entries(firstException.attributes ?? {}).map(([attribute, value]) => (\n          <ModelTraceExplorerFieldRenderer\n            key={attribute}\n            title={attribute}\n            data={JSON.stringify(value, null, 2)}\n            renderMode=\"text\"\n          />\n        ))}\n      </div>\n    </ModelTraceExplorerCollapsibleSection>\n  );\n};\n","import { useMemo, useState } from 'react';\n\nimport { Button, ChevronRightIcon, ChevronDownIcon, useDesignSystemTheme, Typography } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { ModelTraceExplorerSummaryViewExceptionsSection } from './ModelTraceExplorerSummaryViewExceptionsSection';\nimport { type ModelTraceSpanNode } from '../ModelTrace.types';\nimport { createListFromObject, getSpanExceptionEvents } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerCollapsibleSection } from '../ModelTraceExplorerCollapsibleSection';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\nimport { SpanNameDetailViewLink } from '../assessments-pane/SpanNameDetailViewLink';\nimport { ModelTraceExplorerFieldRenderer } from '../field-renderers/ModelTraceExplorerFieldRenderer';\nimport { spanTimeFormatter } from '../timeline-tree/TimelineTree.utils';\n\nconst CONNECTOR_WIDTH = 12;\nconst ROW_HEIGHT = 48;\n\nexport const ModelTraceExplorerSummaryIntermediateNode = ({\n  node,\n  renderMode,\n}: {\n  node: ModelTraceSpanNode;\n  renderMode: 'default' | 'json';\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const [expanded, setExpanded] = useState(false);\n  const inputList = useMemo(() => createListFromObject(node.inputs), [node]);\n  const outputList = useMemo(() => createListFromObject(node.outputs), [node]);\n  const exceptionEvents = getSpanExceptionEvents(node);\n\n  const hasException = exceptionEvents.length > 0;\n  const containsInputs = inputList.length > 0;\n  const containsOutputs = outputList.length > 0;\n\n  const { setSelectedNode, setActiveView, setShowTimelineTreeGantt } = useModelTraceExplorerViewState();\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'row',\n        minHeight: ROW_HEIGHT,\n        flexShrink: 0,\n      }}\n    >\n      <div css={{ height: ROW_HEIGHT, display: 'flex', alignItems: 'center' }}>\n        <Button\n          size=\"small\"\n          data-testid={`toggle-span-expanded-${node.key}`}\n          css={{ flexShrink: 0, marginRight: theme.spacing.xs }}\n          icon={expanded ? <ChevronDownIcon /> : <ChevronRightIcon />}\n          onClick={() => setExpanded(!expanded)}\n          componentId=\"shared.model-trace-explorer.toggle-span\"\n        />\n      </div>\n      <div\n        css={{\n          position: 'relative',\n          boxSizing: 'border-box',\n          height: '100%',\n          borderLeft: `2px solid ${theme.colors.border}`,\n          width: CONNECTOR_WIDTH,\n        }}\n      >\n        <div\n          css={{\n            position: 'absolute',\n            left: -2,\n            top: 14,\n            height: CONNECTOR_WIDTH,\n            width: CONNECTOR_WIDTH,\n            boxSizing: 'border-box',\n            borderBottomLeftRadius: theme.borders.borderRadiusMd,\n            borderBottom: `2px solid ${theme.colors.border}`,\n            borderLeft: `2px solid ${theme.colors.border}`,\n          }}\n        />\n      </div>\n      <div css={{ display: 'flex', flexDirection: 'column', flex: 1, minWidth: 0 }}>\n        <div css={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n          <Typography.Text color=\"secondary\" css={{ display: 'inline-flex', alignItems: 'center', height: ROW_HEIGHT }}>\n            <FormattedMessage\n              defaultMessage=\"{spanName} was called\"\n              description=\"Label for an intermediate node in the trace explorer summary view, indicating that a span/function was called in the course of execution.\"\n              values={{\n                spanName: <SpanNameDetailViewLink node={node} />,\n              }}\n            />\n          </Typography.Text>\n          <span\n            onClick={() => {\n              setSelectedNode(node);\n              setActiveView('detail');\n              setShowTimelineTreeGantt(true);\n            }}\n          >\n            <Typography.Text\n              css={{\n                '&:hover': {\n                  textDecoration: 'underline',\n                  cursor: 'pointer',\n                },\n              }}\n              color=\"secondary\"\n            >\n              {spanTimeFormatter(node.end - node.start)}\n            </Typography.Text>\n          </span>\n        </div>\n        {expanded && (\n          <div>\n            {hasException && <ModelTraceExplorerSummaryViewExceptionsSection node={node} />}\n            {containsInputs && (\n              <ModelTraceExplorerCollapsibleSection\n                sectionKey=\"input\"\n                title={\n                  <FormattedMessage\n                    defaultMessage=\"Inputs\"\n                    description=\"Model trace explorer > selected span > inputs header\"\n                  />\n                }\n              >\n                <div\n                  css={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: theme.spacing.sm,\n                    paddingLeft: theme.spacing.lg,\n                    marginBottom: containsOutputs ? 0 : theme.spacing.sm,\n                  }}\n                >\n                  {inputList.map(({ key, value }, index) => (\n                    <ModelTraceExplorerFieldRenderer\n                      key={key || index}\n                      title={key}\n                      data={value}\n                      renderMode={renderMode}\n                    />\n                  ))}\n                </div>\n              </ModelTraceExplorerCollapsibleSection>\n            )}\n            {containsOutputs && (\n              <ModelTraceExplorerCollapsibleSection\n                sectionKey=\"output\"\n                title={\n                  <FormattedMessage\n                    defaultMessage=\"Outputs\"\n                    description=\"Model trace explorer > selected span > outputs header\"\n                  />\n                }\n              >\n                <div\n                  css={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: theme.spacing.sm,\n                    paddingLeft: theme.spacing.lg,\n                    marginBottom: theme.spacing.sm,\n                  }}\n                >\n                  {outputList.map(({ key, value }) => (\n                    <ModelTraceExplorerFieldRenderer key={key} title={key} data={value} renderMode={renderMode} />\n                  ))}\n                </div>\n              </ModelTraceExplorerCollapsibleSection>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n","import { useState } from 'react';\n\nimport { SegmentedControlButton, SegmentedControlGroup, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { ModelTraceExplorerSummaryIntermediateNode } from './ModelTraceExplorerSummaryIntermediateNode';\nimport { ModelTraceExplorerSummaryViewExceptionsSection } from './ModelTraceExplorerSummaryViewExceptionsSection';\nimport type { ModelTraceExplorerRenderMode, ModelTraceSpanNode } from '../ModelTrace.types';\nimport { createListFromObject, getSpanExceptionEvents } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerCollapsibleSection } from '../ModelTraceExplorerCollapsibleSection';\nimport { AssessmentPaneToggle } from '../assessments-pane/AssessmentPaneToggle';\nimport { ModelTraceExplorerFieldRenderer } from '../field-renderers/ModelTraceExplorerFieldRenderer';\n\nexport const SUMMARY_SPANS_MIN_WIDTH = 400;\n\nexport const ModelTraceExplorerSummarySpans = ({\n  rootNode,\n  intermediateNodes,\n}: {\n  rootNode: ModelTraceSpanNode;\n  intermediateNodes: ModelTraceSpanNode[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const [renderMode, setRenderMode] = useState<ModelTraceExplorerRenderMode>('default');\n\n  const rootInputs = rootNode.inputs;\n  const rootOutputs = rootNode.outputs;\n  const exceptions = getSpanExceptionEvents(rootNode);\n  const hasIntermediateNodes = intermediateNodes.length > 0;\n  const hasExceptions = exceptions.length > 0;\n\n  const inputList = createListFromObject(rootInputs);\n  const outputList = createListFromObject(rootOutputs);\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        flex: 1,\n        minHeight: 0,\n        padding: theme.spacing.md,\n        paddingTop: theme.spacing.sm,\n        overflow: 'auto',\n        minWidth: SUMMARY_SPANS_MIN_WIDTH,\n      }}\n    >\n      <div css={{ display: 'flex', flexDirection: 'row', justifyContent: 'flex-end', marginBottom: theme.spacing.sm }}>\n        <div css={{ display: 'flex', gap: theme.spacing.sm }}>\n          <SegmentedControlGroup\n            name=\"render-mode\"\n            componentId=\"shared.model-trace-explorer.summary-view.render-mode\"\n            value={renderMode}\n            size=\"small\"\n            onChange={(event) => setRenderMode(event.target.value)}\n          >\n            <SegmentedControlButton value=\"default\">\n              <FormattedMessage\n                defaultMessage=\"Default\"\n                description=\"Label for the default render mode selector in the model trace explorer summary view\"\n              />\n            </SegmentedControlButton>\n            <SegmentedControlButton value=\"json\">\n              <FormattedMessage\n                defaultMessage=\"JSON\"\n                description=\"Label for the JSON render mode selector in the model trace explorer summary view\"\n              />\n            </SegmentedControlButton>\n          </SegmentedControlGroup>\n          <AssessmentPaneToggle />\n        </div>\n      </div>\n      {hasExceptions && <ModelTraceExplorerSummaryViewExceptionsSection node={rootNode} />}\n      <ModelTraceExplorerCollapsibleSection\n        withBorder\n        title={\n          <FormattedMessage\n            defaultMessage=\"Inputs\"\n            description=\"Model trace explorer > selected span > inputs header\"\n          />\n        }\n        css={{ marginBottom: hasIntermediateNodes ? 0 : theme.spacing.md }}\n        sectionKey=\"summary-inputs\"\n      >\n        <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n          {inputList.map(({ key, value }, index) => (\n            <ModelTraceExplorerFieldRenderer key={key || index} title={key} data={value} renderMode={renderMode} />\n          ))}\n        </div>\n      </ModelTraceExplorerCollapsibleSection>\n      {hasIntermediateNodes &&\n        intermediateNodes.map((node) => (\n          <ModelTraceExplorerSummaryIntermediateNode key={node.key} node={node} renderMode={renderMode} />\n        ))}\n      <ModelTraceExplorerCollapsibleSection\n        withBorder\n        title={\n          <FormattedMessage\n            defaultMessage=\"Outputs\"\n            description=\"Model trace explorer > selected span > outputs header\"\n          />\n        }\n        sectionKey=\"summary-outputs\"\n      >\n        <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n          {outputList.map(({ key, value }, index) => (\n            <ModelTraceExplorerFieldRenderer key={key || index} title={key} data={value} renderMode={renderMode} />\n          ))}\n        </div>\n      </ModelTraceExplorerCollapsibleSection>\n    </div>\n  );\n};\n","import { useMemo, useState } from 'react';\n\nimport { Empty, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { ModelTraceExplorerSummarySpans, SUMMARY_SPANS_MIN_WIDTH } from './ModelTraceExplorerSummarySpans';\nimport { ModelSpanType } from '../ModelTrace.types';\nimport type { ModelTraceSpanNode, ModelTrace } from '../ModelTrace.types';\nimport { getSpanExceptionCount } from '../ModelTraceExplorer.utils';\nimport ModelTraceExplorerResizablePane from '../ModelTraceExplorerResizablePane';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\nimport { AssessmentsPane } from '../assessments-pane/AssessmentsPane';\nimport { ASSESSMENT_PANE_MIN_WIDTH } from '../assessments-pane/AssessmentsPane.utils';\nimport { getTimelineTreeNodesList } from '../timeline-tree/TimelineTree.utils';\n\nconst isNodeImportant = (node: ModelTraceSpanNode) => {\n  // root node is shown at top level, so we don't need to\n  // show it in the intermediate nodes list\n  if (!node.parentId) {\n    return false;\n  }\n\n  return (\n    [\n      ModelSpanType.AGENT,\n      ModelSpanType.RETRIEVER,\n      ModelSpanType.CHAT_MODEL,\n      ModelSpanType.TOOL,\n      ModelSpanType.LLM,\n    ].includes(node.type ?? ModelSpanType.UNKNOWN) || getSpanExceptionCount(node) > 0\n  );\n};\n\nexport const ModelTraceExplorerSummaryView = ({ modelTrace }: { modelTrace: ModelTrace }) => {\n  const { theme } = useDesignSystemTheme();\n  const [paneWidth, setPaneWidth] = useState(500);\n  const { rootNode, nodeMap, assessmentsPaneEnabled, assessmentsPaneExpanded } = useModelTraceExplorerViewState();\n\n  const allAssessments = useMemo(() => Object.values(nodeMap).flatMap((node) => node.assessments), [nodeMap]);\n\n  const intermediateNodes = useMemo(() => {\n    if (!rootNode) {\n      return [];\n    }\n\n    // the summary view is meant to be a high-level view of the trace,\n    // so we show \"important\" nodes as a flat list between the inputs\n    // and outputs of the root node.\n    const nodes = getTimelineTreeNodesList([rootNode]);\n    const intermediateNodes = nodes.filter(isNodeImportant);\n\n    return intermediateNodes;\n  }, [rootNode]);\n\n  if (!rootNode) {\n    return (\n      <div css={{ marginTop: theme.spacing.lg }}>\n        <Empty\n          description={\n            <FormattedMessage\n              defaultMessage=\"No span data to display\"\n              description=\"Title for the empty state in the model trace explorer summary view\"\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  return assessmentsPaneEnabled && assessmentsPaneExpanded ? (\n    <ModelTraceExplorerResizablePane\n      initialRatio={0.75}\n      paneWidth={paneWidth}\n      setPaneWidth={setPaneWidth}\n      leftChild={<ModelTraceExplorerSummarySpans rootNode={rootNode} intermediateNodes={intermediateNodes} />}\n      rightChild={<AssessmentsPane assessments={allAssessments} traceId={rootNode.traceId} activeSpanId={undefined} />}\n      leftMinWidth={SUMMARY_SPANS_MIN_WIDTH}\n      rightMinWidth={ASSESSMENT_PANE_MIN_WIDTH}\n    />\n  ) : (\n    <ModelTraceExplorerSummarySpans rootNode={rootNode} intermediateNodes={intermediateNodes} />\n  );\n};\n","export const ACTIVE_HIGHLIGHT_COLOR = 'yellow500';\nexport const INACTIVE_HIGHLIGHT_COLOR = 'yellow200';\n","import React, { useCallback } from 'react';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nimport { ACTIVE_HIGHLIGHT_COLOR, INACTIVE_HIGHLIGHT_COLOR } from './constants';\n\nexport const ModelTraceExplorerHighlightedSnippetTitle = ({\n  title,\n  searchFilter,\n  isActiveMatch,\n}: {\n  title: string;\n  searchFilter: string;\n  isActiveMatch: boolean;\n}): React.ReactElement => {\n  const { theme } = useDesignSystemTheme();\n  const scrollToActiveMatch = useCallback((node: HTMLElement | null) => {\n    node?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n  }, []);\n\n  const titleLower = title.toLowerCase();\n  if (!titleLower.includes(searchFilter)) {\n    return <div>{title}</div>;\n  }\n\n  const startIdx = titleLower.indexOf(searchFilter);\n  const endIdx = startIdx + searchFilter.length;\n  const backgroundColor = isActiveMatch ? theme.colors[ACTIVE_HIGHLIGHT_COLOR] : theme.colors[INACTIVE_HIGHLIGHT_COLOR];\n\n  return (\n    <div>\n      {title.slice(0, startIdx)}\n      <span ref={isActiveMatch ? scrollToActiveMatch : null} css={{ backgroundColor, scrollMarginTop: 50 }}>\n        {title.slice(startIdx, endIdx)}\n      </span>\n      {title.slice(endIdx)}\n    </div>\n  );\n};\n","import { isString } from 'lodash';\nimport { useEffect, useMemo, useState } from 'react';\n\nimport { ChevronDownIcon, DropdownMenu, Tag, Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { SearchMatch } from './ModelTrace.types';\nimport { CodeSnippetRenderMode } from './ModelTrace.types';\nimport { ModelTraceExplorerCodeSnippetBody } from './ModelTraceExplorerCodeSnippetBody';\nimport { ModelTraceExplorerHighlightedSnippetTitle } from './ModelTraceExplorerHighlightedSnippetTitle';\n\n// return the initial render mode if specified, otherwise\n// default to markdown for string data and json for non-string data\nfunction getInitialRenderMode(dataIsString: boolean, initialRenderMode?: CodeSnippetRenderMode) {\n  if (initialRenderMode) {\n    return initialRenderMode;\n  }\n\n  if (dataIsString) {\n    return CodeSnippetRenderMode.MARKDOWN;\n  }\n\n  return CodeSnippetRenderMode.JSON;\n}\n\nfunction getRenderModeDisplayText(renderMode: CodeSnippetRenderMode) {\n  switch (renderMode) {\n    case CodeSnippetRenderMode.JSON:\n      return 'JSON';\n    case CodeSnippetRenderMode.TEXT:\n      return 'Text';\n    case CodeSnippetRenderMode.MARKDOWN:\n      return 'Markdown';\n  }\n}\n\nexport function ModelTraceExplorerCodeSnippet({\n  title,\n  tokens,\n  data,\n  searchFilter = '',\n  activeMatch = null,\n  containsActiveMatch = false,\n  initialRenderMode,\n}: {\n  title: string;\n  tokens?: number;\n  data: string;\n  searchFilter?: string;\n  // the current active search match\n  activeMatch?: SearchMatch | null;\n  // whether the snippet being rendered contains the\n  // current active match (either in the key or value)\n  containsActiveMatch?: boolean;\n  initialRenderMode?: CodeSnippetRenderMode;\n}) {\n  const parsedData = useMemo(() => JSON.parse(data), [data]);\n  const dataIsString = isString(parsedData);\n  const { theme } = useDesignSystemTheme();\n  // string data can be rendered in multiple formats\n  const [renderMode, setRenderMode] = useState<CodeSnippetRenderMode>(\n    getInitialRenderMode(dataIsString, initialRenderMode),\n  );\n  const isTitleMatch = containsActiveMatch && (activeMatch?.isKeyMatch ?? false);\n  const shouldShowRenderModeDropdown = dataIsString && !searchFilter;\n\n  // we need to reset the render mode when the data changes\n  useEffect(() => {\n    setRenderMode(getInitialRenderMode(dataIsString, initialRenderMode));\n  }, [dataIsString, initialRenderMode]);\n\n  return (\n    <div\n      css={{\n        position: 'relative',\n      }}\n    >\n      <div\n        css={{\n          borderRadius: theme.borders.borderRadiusSm,\n          border: `1px solid ${theme.colors.border}`,\n          overflow: 'hidden',\n        }}\n      >\n        {(title || shouldShowRenderModeDropdown) && (\n          <div\n            css={{\n              display: 'flex',\n              flexDirection: 'row',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              padding: theme.spacing.sm,\n            }}\n          >\n            {/* TODO: support other types of formatting, e.g. markdown */}\n            <Typography.Title\n              css={{\n                maxWidth: '100%',\n                overflow: 'hidden',\n                textOverflow: 'ellipsis',\n                whiteSpace: 'nowrap',\n              }}\n              level={4}\n              color=\"secondary\"\n              withoutMargins\n            >\n              <ModelTraceExplorerHighlightedSnippetTitle\n                title={title}\n                searchFilter={searchFilter}\n                isActiveMatch={isTitleMatch}\n              />\n            </Typography.Title>\n            <div css={{ display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n              {shouldShowRenderModeDropdown && (\n                <DropdownMenu.Root>\n                  <DropdownMenu.Trigger asChild>\n                    <Tag\n                      componentId=\"shared.model-trace-explorer.snippet-render-mode-tag\"\n                      css={{\n                        height: 'min-content',\n                        margin: 0,\n                      }}\n                    >\n                      {/* for some reason `cursor: pointer` doesn't work if you set it on the Tag css */}\n                      <div css={{ paddingLeft: theme.spacing.xs, marginRight: theme.spacing.xs, cursor: 'pointer' }}>\n                        <Typography.Text size=\"sm\" color=\"secondary\">\n                          {getRenderModeDisplayText(renderMode)}\n                        </Typography.Text>\n                        <ChevronDownIcon />\n                      </div>\n                    </Tag>\n                  </DropdownMenu.Trigger>\n                  <DropdownMenu.Content>\n                    <DropdownMenu.RadioGroup\n                      componentId=\"shared.model-trace-explorer.snippet-render-mode-radio\"\n                      value={renderMode}\n                      onValueChange={(value) => setRenderMode(value as CodeSnippetRenderMode)}\n                    >\n                      {Object.values(CodeSnippetRenderMode).map((mode) => (\n                        <DropdownMenu.RadioItem key={mode} value={mode}>\n                          <DropdownMenu.ItemIndicator />\n                          {getRenderModeDisplayText(mode)}\n                        </DropdownMenu.RadioItem>\n                      ))}\n                    </DropdownMenu.RadioGroup>\n                    <DropdownMenu.Arrow />\n                  </DropdownMenu.Content>\n                </DropdownMenu.Root>\n              )}\n            </div>\n          </div>\n        )}\n        <ModelTraceExplorerCodeSnippetBody\n          data={data}\n          searchFilter={searchFilter}\n          activeMatch={activeMatch}\n          containsActiveMatch={containsActiveMatch}\n          renderMode={renderMode}\n        />\n      </div>\n    </div>\n  );\n}\n","import { useState } from 'react';\n\nimport { Button, ChevronDownIcon, ChevronRightIcon, Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nexport const ModelTraceExplorerCollapsibleSection = ({\n  sectionKey,\n  title,\n  children,\n  withBorder = false,\n  className,\n}: {\n  sectionKey: string;\n  title: React.ReactNode;\n  children: React.ReactNode;\n  withBorder?: boolean;\n  className?: string;\n}) => {\n  const [expanded, setExpanded] = useState(true);\n  const { theme } = useDesignSystemTheme();\n  return (\n    <div\n      className={className}\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        borderRadius: theme.borders.borderRadiusMd,\n      }}\n    >\n      <div\n        css={{\n          alignItems: 'center',\n          display: 'flex',\n          flexDirection: 'row',\n          gap: theme.spacing.xs,\n          padding: withBorder ? theme.spacing.sm : 0,\n          background: withBorder ? theme.colors.backgroundSecondary : undefined,\n          borderTopLeftRadius: theme.borders.borderRadiusMd,\n          borderTopRightRadius: theme.borders.borderRadiusMd,\n          borderBottomLeftRadius: expanded ? 0 : theme.borders.borderRadiusMd,\n          borderBottomRightRadius: expanded ? 0 : theme.borders.borderRadiusMd,\n          border: withBorder ? `1px solid ${theme.colors.border}` : undefined,\n          marginBottom: withBorder ? 0 : theme.spacing.sm,\n        }}\n      >\n        <Button\n          size=\"small\"\n          componentId={`shared.model-trace-explorer.expand-${sectionKey}`}\n          type=\"tertiary\"\n          icon={expanded ? <ChevronDownIcon /> : <ChevronRightIcon />}\n          onClick={() => setExpanded(!expanded)}\n        />\n        <Typography.Title withoutMargins level={4} css={{ width: '100%' }}>\n          {title}\n        </Typography.Title>\n      </div>\n      {expanded && (\n        <div\n          css={{\n            border: withBorder ? `1px solid ${theme.colors.border}` : undefined,\n            borderTop: 'none',\n            borderBottomLeftRadius: withBorder ? theme.borders.borderRadiusMd : undefined,\n            borderBottomRightRadius: withBorder ? theme.borders.borderRadiusMd : undefined,\n            padding: withBorder ? theme.spacing.sm : 0,\n          }}\n        >\n          {children}\n        </div>\n      )}\n    </div>\n  );\n};\n","import { compact, has, isArray, isNil, isObject, isString } from 'lodash';\n\nimport type { ModelTraceChatMessage, ModelTraceContentParts } from '../ModelTrace.types';\nimport { prettyPrintChatMessage } from '../ModelTraceExplorer.utils';\n\nexport type AnthropicMessagesInput = {\n  messages: AnthropicMessageParam[];\n};\n\nexport type AnthropicMessagesOutput = {\n  id: string;\n  content: AnthropicContentBlock[];\n  role: 'assistant';\n  type: 'message';\n  // model: Model;\n  // stop_reason: StopReason | null;\n  // stop_sequence: string | null;\n  // usage: Usage;\n};\n\ntype AnthropicContentBlock = AnthropicTextBlock | AnthropicToolUseBlock;\n// | ThinkingBlock\n// | RedactedThinkingBlock\n// | ServerToolUseBlock\n// | WebSearchToolResultBlock;\n\ntype AnthropicMessageParam = {\n  content: string | AnthropicContentBlockParam[];\n  role: 'user' | 'assistant';\n};\n\ntype AnthropicContentBlockParam =\n  | AnthropicTextBlockParam\n  | AnthropicImageBlockParam\n  | AnthropicToolUseBlockParam\n  | AnthropicToolResultBlockParam;\n// | DocumentBlockParam\n// | ThinkingBlockParam\n// | RedactedThinkingBlockParam\n// | ServerToolUseBlockParam\n// | WebSearchToolResultBlockParam;\n\ntype AnthropicTextBlockParam = {\n  text: string;\n  type: 'text';\n};\n\ntype AnthropicTextBlock = {\n  text: string;\n  type: 'text';\n};\n\ntype AnthropicImageBlockParam = {\n  source: AnthropicBase64ImageSource | AnthropicURLImageSource;\n  type: 'image';\n};\n\ntype AnthropicBase64ImageSource = {\n  type: 'base64';\n  data: string;\n  media_type: 'image/jpeg' | 'image/png' | 'image/gif' | 'image/webp';\n};\n\ntype AnthropicURLImageSource = {\n  type: 'url';\n  url: string;\n};\n\ntype AnthropicToolUseBlockParam = {\n  id: string;\n  input: Record<string, any>;\n  name: string;\n  type: 'tool_use';\n};\n\ntype AnthropicToolUseBlock = {\n  id: string;\n  input: Record<string, any>;\n  name: string;\n  type: 'tool_use';\n};\n\ntype AnthropicToolResultBlockParam = {\n  content: string;\n  tool_use_id: string;\n  type: 'tool_result';\n};\n\nconst isAnthropicContentBlockParam = (obj: unknown): obj is AnthropicContentBlockParam => {\n  if (isNil(obj)) {\n    return false;\n  }\n\n  if (has(obj, 'type')) {\n    if (obj.type === 'text' && has(obj, 'text') && isString(obj.text)) {\n      return true;\n    }\n\n    if (obj.type === 'image' && has(obj, 'source') && has(obj.source, 'type')) {\n      if (\n        obj.source.type === 'base64' &&\n        has(obj.source, 'media_type') &&\n        isString(obj.source.media_type) &&\n        ['image/jpeg', 'image/png', 'image/gif', 'image/webp'].includes(obj.source.media_type) &&\n        has(obj.source, 'data') &&\n        isString(obj.source.data)\n      ) {\n        return true;\n      }\n\n      if (obj.source.type === 'url' && has(obj.source, 'url') && isString(obj.source.url)) {\n        return true;\n      }\n    }\n\n    if (obj.type === 'tool_use' && has(obj, 'id') && has(obj, 'name') && has(obj, 'input')) {\n      return isString(obj.id) && isString(obj.name) && isObject(obj.input);\n    }\n\n    if (obj.type === 'tool_result' && has(obj, 'tool_use_id') && has(obj, 'content')) {\n      return isString(obj.tool_use_id) && isString(obj.content);\n    }\n  }\n  return false;\n};\n\nconst isAnthropicMessageParam = (obj: unknown): obj is AnthropicMessageParam => {\n  if (!isObject(obj)) {\n    return false;\n  }\n\n  const hasRole = has(obj, 'role') && isString(obj.role) && ['user', 'assistant'].includes(obj.role);\n  const hasContent =\n    'content' in obj &&\n    (isString(obj.content) || (isArray(obj.content) && obj.content.every(isAnthropicContentBlockParam)));\n\n  return hasRole && hasContent;\n};\n\nconst normalizeAnthropicContentBlockParam = (item: AnthropicContentBlockParam): ModelTraceContentParts => {\n  switch (item.type) {\n    case 'text': {\n      return { type: 'text', text: item.text };\n    }\n    case 'image': {\n      switch (item.source.type) {\n        case 'base64': {\n          return {\n            type: 'image_url',\n            image_url: { url: `data:${item.source.media_type};base64,${item.source.data}` },\n          };\n        }\n        case 'url': {\n          return { type: 'image_url', image_url: { url: item.source.url } };\n        }\n      }\n    }\n  }\n  throw new Error(`Unsupported content block type: ${(item as any).type}`);\n};\n\nconst processAnthropicMessageContent = (\n  content: AnthropicContentBlockParam[],\n): {\n  messages: ModelTraceChatMessage[];\n  textParts: ModelTraceContentParts[];\n  toolCalls: any[];\n} => {\n  const messages: ModelTraceChatMessage[] = [];\n  const textParts: ModelTraceContentParts[] = [];\n  const toolCalls: any[] = [];\n\n  for (const item of content) {\n    if (item.type === 'text' || item.type === 'image') {\n      textParts.push(normalizeAnthropicContentBlockParam(item));\n    } else if (item.type === 'tool_use') {\n      toolCalls.push({\n        id: item.id,\n        function: {\n          name: item.name,\n          arguments: JSON.stringify(item.input),\n        },\n      });\n    } else if (item.type === 'tool_result') {\n      messages.push({\n        role: 'tool',\n        tool_call_id: item.tool_use_id,\n        content: item.content,\n      });\n    }\n  }\n\n  return { messages, textParts, toolCalls };\n};\n\nconst processAnthropicMessage = (message: AnthropicMessageParam): ModelTraceChatMessage[] => {\n  const messages: ModelTraceChatMessage[] = [];\n\n  if (typeof message.content === 'string') {\n    const chatMessage = prettyPrintChatMessage({\n      type: 'message',\n      content: message.content,\n      role: message.role,\n    });\n    if (chatMessage) messages.push(chatMessage);\n  } else {\n    const { messages: toolMessages, textParts, toolCalls } = processAnthropicMessageContent(message.content);\n    messages.push(...toolMessages);\n\n    if (textParts.length > 0 || toolCalls.length > 0) {\n      const chatMessage = prettyPrintChatMessage({\n        type: 'message',\n        content: textParts.length > 0 ? textParts : undefined,\n        role: message.role,\n        ...(toolCalls.length > 0 && { tool_calls: toolCalls }),\n      });\n      if (chatMessage) messages.push(chatMessage);\n    }\n  }\n\n  return messages;\n};\n\nexport const normalizeAnthropicChatInput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (!isObject(obj)) {\n    return null;\n  }\n\n  if ('messages' in obj && isArray(obj.messages) && obj.messages.every(isAnthropicMessageParam)) {\n    const messages: ModelTraceChatMessage[] = [];\n\n    for (const message of obj.messages) {\n      messages.push(...processAnthropicMessage(message));\n    }\n\n    return messages;\n  }\n\n  return null;\n};\n\nexport const normalizeAnthropicChatOutput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (!isObject(obj)) {\n    return null;\n  }\n\n  if (has(obj, 'type') && obj.type === 'message' && isAnthropicMessageParam(obj)) {\n    return processAnthropicMessage(obj);\n  }\n\n  return null;\n};\n","import { compact, has, isArray, isObject, isString } from 'lodash';\n\nimport type { ModelTraceChatMessage } from '../ModelTrace.types';\nimport { prettyPrintChatMessage } from '../ModelTraceExplorer.utils';\n\nexport type GeminiChatInput = {\n  contents: string | GeminiContent[];\n};\n\nexport type GeminiChatOutput = {\n  candidates: GeminiCandidate[];\n  // propmtFeedback: GeminiPropmptFeedback;\n  // usageMetadata: GeminiUsageMetadata;\n  modelVersion: string;\n  responseId: string;\n};\n\ntype GeminiCandidate = {\n  content: GeminiContent;\n  finishReason:\n    | 'FINISH_REASON_UNSPECIFIED'\n    | 'STOP'\n    | 'MAX_TOKENS'\n    | 'SAFETY'\n    | 'RECITATION'\n    | 'LANGUAGE'\n    | 'OTHER'\n    | 'BLOCKLIST'\n    | 'PROHIBITED_CONTENT'\n    | 'SPII'\n    | 'MALFORMED_FUNCTION_CAL'\n    | 'IMAGE_SAFETY'\n    | 'UNEXPECTED_TOOL_CAL';\n  // safetyRatings: GeminiSafetyRating[]\n  // citationMetadata: GeminiCitationMetadata\n  // tokenCount: number\n  // groundingAttributions: GeminiGroundingAttribution[]\n  // groundingMetadata: GeminiGroundingMetadata\n  // avgLogprobs: number\n  // logprobsResult: GeminiLogprobsResult\n  // urlContextMetadata: GeminiUrlContextMetadata\n  // index: number\n};\n\ntype GeminiContent = {\n  role: 'user' | 'model';\n  parts: GeminiContentPart[];\n};\n\ntype GeminiContentPart = { text: string };\n// | { inlineData: GeminiBlob }\n// | { functionCall: GeminiFunctionCall }\n// | { functionResponse: GeminiFunctionResponse }\n// | { fileData: GeminiFileData }\n// | { executableCode: GeminiExecutableCode }\n// | { codeExecutionResult: GeminiCodeExecutionResult };\n\n// type GeminiBlob = {\n//   mimeType: string;\n//   data: string;\n// };\n\n// type GeminiFunctionCall = {\n//   id: string;\n//   name: string;\n//   args: Record<string, string>;\n// };\n\n// type GeminiFunctionResponse = {\n//   id: string;\n//   name: string;\n//   response: Record<string, string>;\n//   willContinue: boolean;\n//   scheduling: 'SCHEDULING_UNSPECIFIED' | 'SILENT' | 'WHEN_IDLE' | 'INTERRUPT';\n// };\n\n// type GeminiFileData = {\n//   mimeType: string;\n//   fileUri: string;\n// };\n\n// type GeminiExecutableCode = {\n//   language: 'LANGUAGE_UNSPECIFIED' | 'PYTHON';\n//   code: string;\n// };\n\n// type GeminiCodeExecutionResult = {\n//   outcome: 'OUTCOME_UNSPECIFIED' | 'OUTCOME_OK' | 'OUTCOME_FAILED' | 'OUTCOME_DEADLINE_EXCEEDED';\n//   output: string;\n// };\n\nconst isGeminiContentPart = (obj: unknown): obj is GeminiContentPart => {\n  return isObject(obj) && 'text' in obj && isString(obj.text);\n};\n\nconst isGeminiContent = (obj: unknown): obj is GeminiContent => {\n  return (\n    isObject(obj) &&\n    'role' in obj &&\n    isString(obj.role) &&\n    ['user', 'model'].includes(obj.role) &&\n    has(obj, 'parts') &&\n    Array.isArray(obj.parts) &&\n    obj.parts.every(isGeminiContentPart)\n  );\n};\n\nconst isGeminiCandidate = (obj: unknown): obj is GeminiCandidate => {\n  return isObject(obj) && 'content' in obj && isGeminiContent(obj.content);\n};\n\nexport const normalizeGeminiChatInput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (!isObject(obj)) {\n    return null;\n  }\n\n  if ('contents' in obj) {\n    if (isString(obj.contents)) {\n      const message = prettyPrintChatMessage({ type: 'message', content: obj.contents, role: 'user' });\n      return message && [message];\n    }\n\n    if (isArray(obj.contents) && obj.contents.every(isGeminiContent)) {\n      return compact(\n        obj.contents.map((item) => {\n          const role = item.role === 'model' ? 'assistant' : item.role;\n          return prettyPrintChatMessage({\n            type: 'message',\n            content: item.parts.map((part) => ({ type: 'text', text: part.text })),\n            role,\n          });\n        }),\n      );\n    }\n  }\n\n  return null;\n};\n\nexport const normalizeGeminiChatOutput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (!isObject(obj)) {\n    return null;\n  }\n\n  if ('candidates' in obj && isArray(obj.candidates) && obj.candidates.every(isGeminiCandidate)) {\n    return compact(\n      obj.candidates\n        .flatMap((item) => item.content)\n        .map((item) => {\n          const role = item.role === 'model' ? 'assistant' : item.role;\n          return prettyPrintChatMessage({\n            type: 'message',\n            content: item.parts.map((part) => ({ type: 'text', text: part.text })),\n            role,\n          });\n        }),\n    );\n  }\n\n  return null;\n};\n","import { compact, get, has, isArray, isNil, isObject, isString } from 'lodash';\nimport { ModelTraceChatMessage } from '../ModelTrace.types';\nimport {\n  isModelTraceChatResponse,\n  isModelTraceChoices,\n  isRawModelTraceChatMessage,\n  prettyPrintChatMessage,\n  prettyPrintToolCall,\n} from '../ModelTraceExplorer.utils';\nimport {\n  OpenAIResponsesInput,\n  OpenAIResponsesInputFile,\n  OpenAIResponsesInputImage,\n  OpenAIResponsesInputMessage,\n  OpenAIResponsesInputMessageRole,\n  OpenAIResponsesInputText,\n  OpenAIResponsesOutputItem,\n} from '../chat-utils/openai.types';\n\n// normalize the OpenAI chat input format (object with 'messages' or 'input' key)\nexport const normalizeOpenAIChatInput = (obj: any): ModelTraceChatMessage[] | null => {\n  if (!obj) {\n    return null;\n  }\n\n  const messages = obj.messages ?? obj.input;\n  if (!Array.isArray(messages) || messages.length === 0 || !messages.every(isRawModelTraceChatMessage)) {\n    return null;\n  }\n\n  return compact(messages.map(prettyPrintChatMessage));\n};\n\n// normalize the OpenAI chat response format (object with 'choices' key)\nexport const normalizeOpenAIChatResponse = (obj: any): ModelTraceChatMessage[] | null => {\n  if (isModelTraceChoices(obj)) {\n    return obj.map((choice) => ({\n      ...choice.message,\n      tool_calls: choice.message.tool_calls?.map(prettyPrintToolCall),\n    }));\n  }\n\n  if (!isModelTraceChatResponse(obj)) {\n    return null;\n  }\n\n  return obj.choices.map((choice) => ({\n    ...choice.message,\n    tool_calls: choice.message.tool_calls?.map(prettyPrintToolCall),\n  }));\n};\n\nconst isOpenAIResponsesInputMessage = (obj: unknown): obj is OpenAIResponsesInputMessage => {\n  if (has(obj, 'role') && has(obj, 'content') && ['user', 'assistant', 'system', 'developer'].includes(obj.role)) {\n    return (\n      isString(obj.content) ||\n      (isArray(obj.content) &&\n        obj.content.every(\n          (item: unknown) => has(item, 'type') && ['input_text', 'input_image', 'input_file'].includes(item.type),\n        ))\n    );\n  }\n\n  return false;\n};\n\nexport const isOpenAIResponsesInput = (obj: unknown): obj is OpenAIResponsesInput => {\n  return isString(obj) || isOpenAIResponsesInputMessage(obj);\n};\n\nexport const isOpenAIResponsesOutputItem = (obj: unknown): obj is OpenAIResponsesOutputItem => {\n  if (!isObject(obj)) {\n    return false;\n  }\n\n  if (get(obj, 'type') === 'message') {\n    return isRawModelTraceChatMessage(obj);\n  }\n\n  if (get(obj, 'type') === 'function_call') {\n    return isString(get(obj, 'call_id')) && isString(get(obj, 'name')) && isString(get(obj, 'arguments'));\n  }\n\n  if (get(obj, 'type') === 'function_call_output') {\n    return isString(get(obj, 'call_id')) && isString(get(obj, 'output'));\n  }\n\n  if (get(obj, 'type') === 'image_generation_call') {\n    const outputFormat = get(obj, 'output_format');\n    return isString(get(obj, 'result')) && isString(outputFormat) && ['png', 'jpeg', 'webp'].includes(outputFormat);\n  }\n\n  if (get(obj, 'type') === 'reasoning') {\n    return has(obj, 'id') && isArray(get(obj, 'summary'));\n  }\n\n  return false;\n};\n\nconst normalizeOpenAIResponsesInputItem = (\n  obj: OpenAIResponsesInputText | OpenAIResponsesInputFile | OpenAIResponsesInputImage,\n  role: OpenAIResponsesInputMessageRole,\n): ModelTraceChatMessage | null => {\n  const text = get(obj, 'text');\n  if (get(obj, 'type') === 'input_text' && isString(text)) {\n    return prettyPrintChatMessage({\n      type: 'message',\n      content: [{ type: 'text', text }],\n      role: role,\n    });\n  }\n\n  const imageUrl = get(obj, 'image_url');\n  if (get(obj, 'type') === 'input_image' && isString(imageUrl)) {\n    return prettyPrintChatMessage({\n      type: 'message',\n      content: [{ type: 'image_url', image_url: { url: imageUrl } }],\n      role: role,\n    });\n  }\n\n  // TODO: file input not supported yet\n  // if ('type' in obj && obj.type === 'input_file') {\n  //   return prettyPrintChatMessage({ type: 'message', content: obj.file_url, role: role });\n  // }\n\n  return null;\n};\n\nconst normalizeOpenAIResponsesInputMessage = (obj: OpenAIResponsesInputMessage): ModelTraceChatMessage[] | null => {\n  if (isString(obj.content)) {\n    const message = prettyPrintChatMessage({ type: 'message', content: obj.content, role: obj.role });\n    return message && [message];\n  } else {\n    return obj.content.map((item) => normalizeOpenAIResponsesInputItem(item, obj.role)).filter((item) => item !== null);\n  }\n};\n\nexport const normalizeOpenAIResponsesInput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  const input: unknown = get(obj, 'input');\n\n  if (isString(input)) {\n    const message = prettyPrintChatMessage({ type: 'message', content: input, role: 'user' });\n    return message && [message];\n  }\n\n  if (isArray(input) && input.every(isOpenAIResponsesInputMessage)) {\n    return compact(input.flatMap(normalizeOpenAIResponsesInputMessage));\n  }\n\n  return null;\n};\n\nexport const normalizeOpenAIResponsesOutputItem = (obj: OpenAIResponsesOutputItem): ModelTraceChatMessage | null => {\n  if (obj.type === 'message') {\n    return prettyPrintChatMessage(obj);\n  }\n\n  if (obj.type === 'function_call') {\n    return {\n      role: 'assistant',\n      tool_calls: [\n        prettyPrintToolCall({\n          id: obj.call_id,\n          function: {\n            arguments: obj.arguments,\n            name: obj.name,\n          },\n        }),\n      ],\n    };\n  }\n\n  if (obj.type === 'function_call_output') {\n    return {\n      role: 'tool',\n      tool_call_id: obj.call_id,\n      content: obj.output,\n    };\n  }\n\n  if (obj.type === 'image_generation_call') {\n    return prettyPrintChatMessage({\n      type: 'message',\n      content: [{ type: 'image_url', image_url: { url: `data:image/${obj.output_format};base64,${obj.result}` } }],\n      role: 'tool',\n    });\n  }\n\n  if (obj.type === 'reasoning') {\n    // Skip reasoning entries as they don't translate to chat messages\n    return null;\n  }\n\n  return null;\n};\n\nexport const normalizeOpenAIResponsesOutput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (isNil(obj)) {\n    return null;\n  }\n\n  const output: unknown = get(obj, 'output');\n\n  // list of output items\n  if (isArray(output) && output.length > 0 && output.every(isOpenAIResponsesOutputItem)) {\n    return compact(output.map(normalizeOpenAIResponsesOutputItem).filter(Boolean));\n  }\n\n  // list of output chunks\n  if (\n    isArray(output) &&\n    output.length > 0 &&\n    output.every((chunk) => chunk.type === 'response.output_item.done' && isOpenAIResponsesOutputItem(chunk.item))\n  ) {\n    return compact(output.map((chunk) => normalizeOpenAIResponsesOutputItem(chunk.item)));\n  }\n\n  return null;\n};\n\n// New functions for OpenAI agent chat pattern\n\nconst isOpenAIAgentMessage = (obj: unknown): boolean => {\n  if (!isObject(obj)) {\n    return false;\n  }\n\n  // Check for regular message format (with optional id, status, type fields)\n  if (has(obj, 'role') && has(obj, 'content') && ['user', 'assistant', 'system', 'tool'].includes(obj.role)) {\n    return true;\n  }\n\n  // Check for function call format (with optional id, status fields)\n  if (get(obj, 'type') === 'function_call') {\n    return isString(get(obj, 'call_id')) && isString(get(obj, 'name')) && isString(get(obj, 'arguments'));\n  }\n\n  // Check for function call output format\n  if (get(obj, 'type') === 'function_call_output') {\n    return isString(get(obj, 'call_id')) && isString(get(obj, 'output'));\n  }\n\n  return false;\n};\n\nconst normalizeOpenAIAgentMessage = (obj: any): ModelTraceChatMessage | null => {\n  // Handle regular message format\n  if (has(obj, 'role') && has(obj, 'content')) {\n    // Handle content that might be an array with output_text objects\n    if (isArray(obj.content)) {\n      const textContent = obj.content\n        .filter((item: any) => item.type === 'output_text' && isString(item.text))\n        .map((item: any) => item.text)\n        .join(' ');\n\n      if (textContent) {\n        return prettyPrintChatMessage({\n          ...obj,\n          content: textContent,\n        });\n      }\n    }\n\n    // Fall back to regular prettyPrintChatMessage for string content\n    return prettyPrintChatMessage(obj);\n  }\n\n  // Handle function call format\n  if (get(obj, 'type') === 'function_call') {\n    const callId = get(obj, 'call_id');\n    const arguments_ = get(obj, 'arguments');\n    const name = get(obj, 'name');\n\n    if (isString(callId) && isString(arguments_) && isString(name)) {\n      return {\n        role: 'assistant',\n        tool_calls: [\n          prettyPrintToolCall({\n            id: callId,\n            function: {\n              arguments: arguments_,\n              name: name,\n            },\n          }),\n        ],\n      };\n    }\n  }\n\n  // Handle function call output format\n  if (get(obj, 'type') === 'function_call_output') {\n    const callId = get(obj, 'call_id');\n    const output = get(obj, 'output');\n\n    if (isString(callId) && isString(output)) {\n      return {\n        role: 'tool',\n        tool_call_id: callId,\n        content: output,\n      };\n    }\n  }\n\n  return null;\n};\n\nexport const normalizeOpenAIAgentInput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (isNil(obj)) {\n    return null;\n  }\n\n  // Handle array of messages directly\n  if (isArray(obj) && obj.length > 0 && obj.every(isOpenAIAgentMessage)) {\n    return compact(obj.map(normalizeOpenAIAgentMessage));\n  }\n\n  return null;\n};\n\nexport const normalizeOpenAIAgentOutput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (isNil(obj)) {\n    return null;\n  }\n\n  // Handle array of messages directly\n  if (isArray(obj) && obj.length > 0 && obj.every(isOpenAIAgentMessage)) {\n    return compact(obj.map(normalizeOpenAIAgentMessage));\n  }\n\n  return null;\n};\n","import { compact, has, isNil, isString } from 'lodash';\n\nimport type { ModelTraceChatMessage, ModelTraceToolCall } from '../ModelTrace.types';\nimport { isModelTraceToolCall, prettyPrintToolCall } from '../ModelTraceExplorer.utils';\n\ntype LangchainContentPart = {\n  type: 'text' | 'image_url';\n  text?: string;\n  image_url?: {\n    url: string;\n  };\n};\n\n// it has other fields, but we only care about these for now\nexport type LangchainBaseMessage = {\n  content?: string | LangchainContentPart[];\n  type: 'human' | 'user' | 'assistant' | 'ai' | 'system' | 'tool' | 'function';\n  tool_calls?: LangchainToolCallMessage[];\n  tool_call_id?: string;\n  additional_kwargs?: {\n    // some langchain models have tool_calls specified in additional_kwargs in\n    // OpenAI format. this appears to be a bug, but we should still try to handle it\n    tool_calls?: ModelTraceToolCall[];\n  };\n};\n\nexport type LangchainToolCallMessage = {\n  name: string;\n  // an object with the arguments to the tool call.\n  // should be stringified before display.\n  args: any;\n  id: string;\n};\n\nexport type LangchainChatGeneration = {\n  message: LangchainBaseMessage;\n};\n\nexport const langchainMessageToModelTraceMessage = (message: LangchainBaseMessage): ModelTraceChatMessage | null => {\n  let role: ModelTraceChatMessage['role'];\n  switch (message.type) {\n    case 'user':\n    case 'human':\n      role = 'user';\n      break;\n    case 'assistant':\n    case 'ai':\n      role = 'assistant';\n      break;\n    case 'system':\n      role = 'system';\n      break;\n    case 'tool':\n      role = 'tool';\n      break;\n    case 'function':\n      role = 'function';\n      break;\n    default:\n      return null;\n  }\n\n  // Handle content that could be a string or an array of content parts\n  let content: string | undefined;\n  if (isString(message.content)) {\n    content = message.content;\n  } else if (Array.isArray(message.content)) {\n    // Convert array of content parts to string representation\n    const contentParts = message.content\n      .map((part: any) => {\n        if (isString(part)) {\n          return part;\n        } else if (part.type === 'text' && part.text) {\n          return part.text;\n        } else if (part.type === 'image_url' && part.image_url?.url) {\n          // Convert to markdown image format with spacing\n          return `![](${part.image_url.url})`;\n        }\n        return '';\n      })\n      .filter(Boolean);\n\n    // Join with double line breaks for better visual separation\n    content = contentParts.join('\\n\\n');\n  } else {\n    content = undefined;\n  }\n\n  const normalizedMessage: ModelTraceChatMessage = {\n    content,\n    role,\n  };\n\n  const toolCalls = message.tool_calls;\n  const toolCallsFromKwargs = message.additional_kwargs?.tool_calls;\n\n  // attempt to parse tool calls from the top-level field,\n  // otherwise fall back to the additional_kwargs field if it exists\n  if (\n    !isNil(toolCalls) &&\n    Array.isArray(toolCalls) &&\n    toolCalls.length > 0 &&\n    toolCalls.every(isLangchainToolCallMessage)\n  ) {\n    // compact for typing. the coercion should not fail since we\n    // check that the type is correct in the if condition above\n    normalizedMessage.tool_calls = compact(toolCalls.map(normalizeLangchainToolCall));\n  } else if (\n    !isNil(toolCallsFromKwargs) &&\n    Array.isArray(toolCallsFromKwargs) &&\n    toolCallsFromKwargs.length > 0 &&\n    toolCallsFromKwargs.every(isModelTraceToolCall)\n  ) {\n    normalizedMessage.tool_calls = toolCallsFromKwargs.map(prettyPrintToolCall);\n  }\n\n  if (!isNil(message.tool_call_id)) {\n    normalizedMessage.tool_call_id = message.tool_call_id;\n  }\n\n  return normalizedMessage;\n};\n\nexport const normalizeLangchainToolCall = (toolCall: LangchainToolCallMessage): ModelTraceToolCall | null => {\n  return {\n    id: toolCall.id,\n    function: {\n      arguments: JSON.stringify(toolCall.args, null, 2),\n      name: toolCall.name,\n    },\n  };\n};\n\nexport const isLangchainBaseMessage = (obj: any): obj is LangchainBaseMessage => {\n  if (!obj) {\n    return false;\n  }\n\n  // content can be undefined/null, string, or array of content parts\n  if (!isNil(obj.content) && !isString(obj.content) && !Array.isArray(obj.content)) {\n    return false;\n  }\n\n  // tool call validation is handled by the normalization function\n  return ['human', 'user', 'assistant', 'ai', 'system', 'tool', 'function'].includes(obj.type);\n};\n\nexport const isLangchainToolCallMessage = (obj: any): obj is LangchainToolCallMessage => {\n  return obj && isString(obj.name) && has(obj, 'args') && isString(obj.id);\n};\n\nexport const isLangchainChatGeneration = (obj: any): obj is LangchainChatGeneration => {\n  return obj && isLangchainBaseMessage(obj.message);\n};\n\n// normalize langchain chat input format\nexport const normalizeLangchainChatInput = (obj: any): ModelTraceChatMessage[] | null => {\n  // it could be a list of list of messages\n  if (\n    Array.isArray(obj) &&\n    obj.length === 1 &&\n    Array.isArray(obj[0]) &&\n    obj[0].length > 0 &&\n    obj[0].every(isLangchainBaseMessage)\n  ) {\n    const messages = obj[0].map(langchainMessageToModelTraceMessage);\n    // if we couldn't convert all the messages, then consider the input invalid\n    if (messages.some((message) => message === null)) {\n      return null;\n    }\n\n    return messages as ModelTraceChatMessage[];\n  }\n\n  // it could also be an object with the `messages` key\n  if (Array.isArray(obj?.messages) && obj.messages.length > 0 && obj.messages.every(isLangchainBaseMessage)) {\n    const messages = obj.messages.map(langchainMessageToModelTraceMessage);\n\n    if (messages.some((message: ModelTraceChatMessage[] | null) => message === null)) {\n      return null;\n    }\n\n    return messages as ModelTraceChatMessage[];\n  }\n\n  // it could also just be a plain array that is in the correct format\n  if (Array.isArray(obj) && obj.length > 0 && obj.every(isLangchainBaseMessage)) {\n    const messages = obj.map(langchainMessageToModelTraceMessage);\n\n    if (messages.some((message) => message === null)) {\n      return null;\n    }\n\n    return messages as ModelTraceChatMessage[];\n  }\n\n  return null;\n};\n\nconst isLangchainChatGenerations = (obj: any): obj is LangchainChatGeneration[][] => {\n  if (!Array.isArray(obj) || obj.length < 1) {\n    return false;\n  }\n\n  if (!Array.isArray(obj[0]) || obj[0].length < 1) {\n    return false;\n  }\n\n  // langchain chat generations are a list of lists of messages\n  return obj[0].every(isLangchainChatGeneration);\n};\n\nconst getMessagesFromLangchainChatGenerations = (\n  generations: LangchainChatGeneration[],\n): ModelTraceChatMessage[] | null => {\n  const messages = generations.map((generation: LangchainChatGeneration) =>\n    langchainMessageToModelTraceMessage(generation.message),\n  );\n\n  if (messages.some((message) => message === null)) {\n    return null;\n  }\n\n  return messages as ModelTraceChatMessage[];\n};\n\n// detect if an object is a langchain ChatResult, and normalize it to a list of messages\nexport const normalizeLangchainChatResult = (obj: any): ModelTraceChatMessage[] | null => {\n  if (isLangchainChatGenerations(obj)) {\n    return getMessagesFromLangchainChatGenerations(obj[0]);\n  }\n\n  if (\n    !Array.isArray(obj?.generations) ||\n    !(obj.generations.length > 0) ||\n    !obj.generations[0].every(isLangchainChatGeneration)\n  ) {\n    return null;\n  }\n\n  return getMessagesFromLangchainChatGenerations(obj.generations[0]);\n};\n","import { compact, get, isArray, isString } from 'lodash';\n\nimport type { ModelTraceChatMessage } from '../ModelTrace.types';\nimport { prettyPrintChatMessage } from '../ModelTraceExplorer.utils';\n\nexport type LlamaIndexChatResponse = {\n  message: LlamaIndexChatMessage;\n};\n\ntype LlamaIndexChatMessage = {\n  role: 'assistant' | 'system' | 'user';\n  blocks: LlamaIndexChatMessageBlock[];\n};\n\ntype LlamaIndexChatMessageBlock = {\n  block_type: 'text';\n  text: 'string';\n};\n\nexport type LlamaIndexChatInput = {\n  messages: LlamaIndexChatMessage[];\n};\n\nconst isLlamaIndexChatMessageBlock = (obj: unknown): obj is LlamaIndexChatMessageBlock => {\n  const text = get(obj, 'text');\n  return get(obj, 'block_type') === 'text' && isString(text);\n};\n\nconst isLlamaIndexChatMessage = (message: unknown): message is LlamaIndexChatMessage => {\n  const blocks: unknown = get(message, 'blocks');\n  const role: unknown = get(message, 'role');\n  return (\n    isString(role) &&\n    ['assistant', 'system', 'user'].includes(role) &&\n    isArray(blocks) &&\n    blocks.every(isLlamaIndexChatMessageBlock)\n  );\n};\n\nconst isLlamaIndexChatResponse = (obj: unknown): obj is LlamaIndexChatResponse => {\n  return isLlamaIndexChatMessage(get(obj, 'message'));\n};\n\nconst isLlamaIndexChatInput = (obj: unknown): obj is LlamaIndexChatInput => {\n  const messages: unknown = get(obj, 'messages');\n  return isArray(messages) && messages.every(isLlamaIndexChatMessage);\n};\n\nconst prettyPrintMessage = (message: LlamaIndexChatMessage) => {\n  return prettyPrintChatMessage({\n    role: message.role,\n    content: message.blocks.map((block) => ({ type: 'text', text: block.text })),\n  });\n};\n\nexport const normalizeLlamaIndexChatResponse = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (!isLlamaIndexChatResponse(obj)) {\n    return null;\n  }\n\n  const message = prettyPrintMessage(obj.message);\n  return message && [message];\n};\n\nexport const normalizeLlamaIndexChatInput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (!isLlamaIndexChatInput(obj)) {\n    return null;\n  }\n\n  return compact(obj.messages.map(prettyPrintMessage));\n};\n","import { compact, get, has, isArray, isNil, isObject, isString } from 'lodash';\nimport { ModelTraceChatMessage } from '../ModelTrace.types';\nimport { prettyPrintChatMessage, prettyPrintToolCall } from '../ModelTraceExplorer.utils';\n\n// Type definitions for autogen messages\ninterface AutogenFunctionCall {\n  id: string;\n  name: string;\n  arguments: string;\n}\n\ninterface AutogenSystemMessage {\n  source: 'system';\n  content: string;\n}\n\ninterface AutogenUserMessage {\n  source: 'user';\n  content: string | any[];\n}\n\ninterface AutogenAssistantMessage {\n  source: 'assistant';\n  content: string | AutogenFunctionCall[];\n}\n\ninterface AutogenFunctionExecutionResultMessage {\n  source: 'function';\n  content: any;\n}\n\ntype AutogenMessage =\n  | AutogenSystemMessage\n  | AutogenUserMessage\n  | AutogenAssistantMessage\n  | AutogenFunctionExecutionResultMessage;\n\nconst isAutogenFunctionCall = (obj: unknown): obj is AutogenFunctionCall => {\n  return isObject(obj) && isString(get(obj, 'id')) && isString(get(obj, 'name')) && isString(get(obj, 'arguments'));\n};\n\nconst isAutogenMessage = (obj: unknown): obj is AutogenMessage => {\n  if (!isObject(obj)) {\n    return false;\n  }\n\n  // Handle messages with 'type' field (new format)\n  const messageType = get(obj, 'type');\n  if (messageType) {\n    if (messageType === 'SystemMessage') {\n      return isString(get(obj, 'content'));\n    }\n    if (messageType === 'UserMessage') {\n      return has(obj, 'content') && has(obj, 'source');\n    }\n    if (messageType === 'AssistantMessage') {\n      return has(obj, 'content') && has(obj, 'source');\n    }\n    if (messageType === 'FunctionMessage') {\n      return has(obj, 'content') && has(obj, 'source');\n    }\n  }\n\n  // Handle messages with 'source' field (old format)\n  if (has(obj, 'source') && ['system', 'user', 'assistant', 'function'].includes(get(obj, 'source'))) {\n    return has(obj, 'content');\n  }\n\n  return false;\n};\n\nconst convertAssistantMessageToChatMessage = (\n  content: string | AutogenFunctionCall[],\n): ModelTraceChatMessage | null => {\n  if (isString(content)) {\n    return prettyPrintChatMessage({ type: 'message', content, role: 'assistant' });\n  }\n\n  if (isArray(content) && content.every(isAutogenFunctionCall)) {\n    return {\n      role: 'assistant',\n      tool_calls: content.map((f) =>\n        prettyPrintToolCall({\n          id: f.id,\n          function: {\n            name: f.name,\n            arguments: f.arguments,\n          },\n        }),\n      ),\n    };\n  }\n\n  return null;\n};\n\nconst normalizeAutogenMessage = (message: any): ModelTraceChatMessage | null => {\n  // Handle messages with 'type' field (new format)\n  if (message.type === 'SystemMessage') {\n    return prettyPrintChatMessage({ type: 'message', content: message.content, role: 'system' });\n  }\n\n  if (message.type === 'UserMessage') {\n    if (isString(message.content)) {\n      return prettyPrintChatMessage({ type: 'message', content: message.content, role: 'user' });\n    }\n\n    if (isArray(message.content)) {\n      // Handle content that might be an array of text/image parts\n      const textParts = message.content\n        .filter((part: any) => isString(part) || (isObject(part) && (part as any).type === 'text'))\n        .map((part: any) => (isString(part) ? { type: 'text' as const, text: part } : part));\n\n      if (textParts.length > 0) {\n        return prettyPrintChatMessage({ type: 'message', content: textParts, role: 'user' });\n      }\n    }\n  }\n\n  if (message.type === 'AssistantMessage') {\n    return convertAssistantMessageToChatMessage(message.content);\n  }\n\n  if (message.type === 'FunctionMessage') {\n    // Function execution result messages are typically logged as user messages\n    return prettyPrintChatMessage({ type: 'message', content: JSON.stringify(message.content), role: 'user' });\n  }\n\n  // Handle messages with 'source' field (old format)\n  if (message.source === 'system') {\n    return prettyPrintChatMessage({ type: 'message', content: message.content, role: 'system' });\n  }\n\n  if (message.source === 'user') {\n    if (isString(message.content)) {\n      return prettyPrintChatMessage({ type: 'message', content: message.content, role: 'user' });\n    }\n\n    if (isArray(message.content)) {\n      // Handle content that might be an array of text/image parts\n      const textParts = message.content\n        .filter((part: any) => isString(part))\n        .map((part: any) => ({ type: 'text' as const, text: part }));\n\n      if (textParts.length > 0) {\n        return prettyPrintChatMessage({ type: 'message', content: textParts, role: 'user' });\n      }\n    }\n  }\n\n  if (message.source === 'assistant') {\n    return convertAssistantMessageToChatMessage(message.content);\n  }\n\n  if (message.source === 'function') {\n    // Function execution result messages are typically logged as user messages\n    return prettyPrintChatMessage({ type: 'message', content: JSON.stringify(message.content), role: 'user' });\n  }\n\n  return null;\n};\n\nexport const normalizeAutogenChatInput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (isNil(obj)) {\n    return null;\n  }\n\n  // Handle case where input is directly an array of messages\n  if (isArray(obj) && obj.length > 0 && obj.every(isAutogenMessage)) {\n    return compact(obj.map(normalizeAutogenMessage));\n  }\n\n  // Handle case where input is wrapped in an object with 'messages' key\n  if (isObject(obj) && 'messages' in obj) {\n    const messages = (obj as any).messages;\n    if (isArray(messages) && messages.length > 0 && messages.every(isAutogenMessage)) {\n      return compact(messages.map(normalizeAutogenMessage));\n    }\n  }\n\n  return null;\n};\n\nexport const normalizeAutogenChatOutput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (isNil(obj)) {\n    return null;\n  }\n\n  // Handle case where output is directly an array of messages\n  if (isArray(obj) && obj.length > 0 && obj.every(isAutogenMessage)) {\n    return compact(obj.map(normalizeAutogenMessage));\n  }\n\n  // Handle case where output is wrapped in an object with 'messages' key\n  if (isObject(obj) && 'content' in obj) {\n    const message = prettyPrintChatMessage({ role: 'assistant', content: obj.content as string, type: 'message' });\n    return message ? [message] : null;\n  }\n\n  return null;\n};\n","import { compact, get, has, isArray, isNil, isObject, isString } from 'lodash';\nimport { ModelTraceChatMessage, ModelTraceContentParts } from '../ModelTrace.types';\nimport { prettyPrintChatMessage, prettyPrintToolCall } from '../ModelTraceExplorer.utils';\n\n// Type definitions for Bedrock messages\ninterface BedrockToolUse {\n  toolUseId: string;\n  name: string;\n  input: string | Record<string, any>;\n}\n\ninterface BedrockToolResult {\n  toolUseId: string;\n  content: BedrockContentBlock[];\n}\n\ninterface BedrockContentBlock {\n  text?: string;\n  json?: any;\n  image?: {\n    source: {\n      bytes: string | Uint8Array;\n    };\n    format: string;\n  };\n  toolUse?: BedrockToolUse;\n  toolResult?: BedrockToolResult;\n}\n\ninterface BedrockMessage {\n  role: 'user' | 'assistant' | 'system';\n  content: BedrockContentBlock[];\n}\n\nconst parseBedrockContent = (content: BedrockContentBlock): ModelTraceContentParts | null => {\n  if (content.text) {\n    return { type: 'text', text: content.text };\n  }\n\n  if (content.json) {\n    return { type: 'text', text: JSON.stringify(content.json) };\n  }\n\n  if (content.image) {\n    const bytes = content.image.source.bytes;\n    const format = content.image.format;\n    let data: string;\n\n    if (typeof bytes === 'string') {\n      data = bytes;\n    } else {\n      // Convert Uint8Array to base64 string\n      const buffer = Buffer.from(bytes);\n      data = buffer.toString('base64');\n    }\n\n    const imageFormat = `image/${format}`;\n    return {\n      type: 'image_url',\n      image_url: { url: `data:${imageFormat};base64,${data}` },\n    };\n  }\n\n  // Unsupported content types (video, document) are ignored\n  return null;\n};\n\nconst convertBedrockMessageToChatMessage = (message: BedrockMessage): ModelTraceChatMessage => {\n  let role: 'user' | 'assistant' | 'system' | 'tool' = message.role;\n  const contents: ModelTraceContentParts[] = [];\n  const toolCalls: any[] = [];\n  let toolCallId: string | undefined;\n\n  for (const content of message.content) {\n    if (content.toolUse) {\n      const toolCall = content.toolUse;\n      const input = typeof toolCall.input === 'string' ? toolCall.input : JSON.stringify(toolCall.input);\n\n      toolCalls.push(\n        prettyPrintToolCall({\n          id: toolCall.toolUseId,\n          function: {\n            name: toolCall.name,\n            arguments: input,\n          },\n        }),\n      );\n    } else if (content.toolResult) {\n      toolCallId = content.toolResult.toolUseId;\n      role = 'tool';\n\n      for (const resultContent of content.toolResult.content) {\n        const parsedContent = parseBedrockContent(resultContent);\n        if (parsedContent) {\n          contents.push(parsedContent);\n        }\n      }\n    } else {\n      const parsedContent = parseBedrockContent(content);\n      if (parsedContent) {\n        contents.push(parsedContent);\n      }\n    }\n  }\n\n  // Convert content parts to string\n  let contentString = '';\n  if (contents.length > 0) {\n    contentString = contents\n      .map((part) => {\n        if (part.type === 'text') {\n          return part.text;\n        } else if (part.type === 'image_url') {\n          return `[Image: ${part.image_url.url}]`;\n        }\n        return '';\n      })\n      .filter((text) => text.length > 0)\n      .join(' ');\n  }\n\n  const chatMessage: ModelTraceChatMessage = {\n    role: role,\n    content: contentString,\n  };\n\n  if (toolCalls.length > 0) {\n    chatMessage.tool_calls = toolCalls;\n  }\n\n  if (toolCallId) {\n    chatMessage.tool_call_id = toolCallId;\n  }\n\n  return chatMessage;\n};\n\nconst isBedrockMessage = (obj: unknown): obj is BedrockMessage => {\n  if (!isObject(obj)) {\n    return false;\n  }\n\n  const hasRole = has(obj, 'role') && isString(obj.role) && ['user', 'assistant', 'system'].includes(obj.role);\n  const hasContent = has(obj, 'content') && isArray(obj.content);\n\n  return hasRole && hasContent;\n};\n\nexport const normalizeBedrockChatInput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (isNil(obj)) {\n    return null;\n  }\n\n  // Handle case where input has 'messages' key\n  if (isObject(obj) && 'messages' in obj) {\n    const messages = (obj as any).messages;\n    if (isArray(messages) && messages.length > 0 && messages.every(isBedrockMessage)) {\n      return compact(messages.map(convertBedrockMessageToChatMessage));\n    }\n  }\n\n  return null;\n};\n\nexport const normalizeBedrockChatOutput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  if (isNil(obj)) {\n    return null;\n  }\n\n  // Handle case where output has 'output' -> 'message' structure\n  if (isObject(obj) && 'output' in obj) {\n    const output = (obj as any).output;\n    if (isObject(output) && 'message' in output) {\n      const message = output.message;\n      if (isBedrockMessage(message)) {\n        return [convertBedrockMessageToChatMessage(message)];\n      }\n    }\n  }\n\n  return null;\n};\n","import {\n  isNil,\n  omitBy,\n  mapValues,\n  isArray,\n  isString,\n  isNumber,\n  isBoolean,\n  escapeRegExp,\n  map,\n  every,\n  has,\n  compact,\n  keyBy,\n} from 'lodash';\n\nimport { ModelSpanType, ModelIconType, MLFLOW_TRACE_SCHEMA_VERSION_KEY } from './ModelTrace.types';\nimport type {\n  SearchMatch,\n  ModelTrace,\n  ModelTraceSpan,\n  ModelTraceSpanNode,\n  ModelTraceChatMessage,\n  ModelTraceChatResponse,\n  ModelTraceChatInput,\n  ModelTraceToolCall,\n  ModelTraceChatTool,\n  ModelTraceChatToolParamProperty,\n  RawModelTraceChatMessage,\n  ModelTraceContentType,\n  SpanFilterState,\n  ModelTraceSpanV3,\n  ModelTraceSpanV2,\n  ModelTraceInfoV3,\n  Assessment,\n  RetrieverDocument,\n  ModelTraceEvent,\n} from './ModelTrace.types';\nimport { ModelTraceExplorerIcon } from './ModelTraceExplorerIcon';\nimport {\n  normalizeAnthropicChatInput,\n  normalizeAnthropicChatOutput,\n  normalizeGeminiChatInput,\n  normalizeGeminiChatOutput,\n  normalizeOpenAIChatInput,\n  normalizeOpenAIChatResponse,\n  normalizeOpenAIResponsesInput,\n  normalizeOpenAIResponsesOutput,\n  normalizeLangchainChatInput,\n  normalizeLangchainChatResult,\n  normalizeLlamaIndexChatResponse,\n  normalizeDspyChatInput,\n  normalizeDspyChatOutput,\n} from './chat-utils';\nimport { normalizeLlamaIndexChatInput } from './chat-utils/llamaindex';\nimport { normalizeOpenAIAgentInput, normalizeOpenAIAgentOutput } from './chat-utils/openai';\nimport { normalizeAutogenChatInput, normalizeAutogenChatOutput } from './chat-utils/autogen';\nimport { normalizeBedrockChatInput, normalizeBedrockChatOutput } from './chat-utils/bedrock';\n\nexport const FETCH_TRACE_INFO_QUERY_KEY = 'model-trace-info-v3';\n\nexport const displayErrorNotification = (errorMessage: string) => {\n  // TODO: display error notification in OSS\n  return;\n};\n\nexport function getIconTypeForSpan(spanType: ModelSpanType | string): ModelIconType {\n  switch (spanType) {\n    case ModelSpanType.LLM:\n      return ModelIconType.MODELS;\n    case ModelSpanType.CHAIN:\n      return ModelIconType.CHAIN;\n    case ModelSpanType.AGENT:\n      return ModelIconType.AGENT;\n    case ModelSpanType.TOOL:\n      return ModelIconType.WRENCH;\n    case ModelSpanType.CHAT_MODEL:\n      return ModelIconType.MODELS;\n    case ModelSpanType.RETRIEVER:\n      return ModelIconType.SEARCH;\n    case ModelSpanType.PARSER:\n      return ModelIconType.CODE;\n    case ModelSpanType.EMBEDDING:\n      return ModelIconType.NUMBERS;\n    case ModelSpanType.RERANKER:\n      return ModelIconType.SORT;\n    case ModelSpanType.MEMORY:\n      return ModelIconType.SAVE;\n    case ModelSpanType.FUNCTION:\n      return ModelIconType.FUNCTION;\n    case ModelSpanType.UNKNOWN:\n      return ModelIconType.UNKNOWN;\n    default:\n      return ModelIconType.FUNCTION;\n  }\n}\n\nexport function getDisplayNameForSpanType(spanType: ModelSpanType | string): string {\n  switch (spanType) {\n    case ModelSpanType.LLM:\n      return 'LLM';\n    case ModelSpanType.CHAIN:\n      return 'Chain';\n    case ModelSpanType.AGENT:\n      return 'Agent';\n    case ModelSpanType.TOOL:\n      return 'Tool';\n    case ModelSpanType.CHAT_MODEL:\n      return 'Chat model';\n    case ModelSpanType.RETRIEVER:\n      return 'Retriever';\n    case ModelSpanType.PARSER:\n      return 'Parser';\n    case ModelSpanType.EMBEDDING:\n      return 'Embedding';\n    case ModelSpanType.RERANKER:\n      return 'Reranker';\n    case ModelSpanType.MEMORY:\n      return 'Memory';\n    case ModelSpanType.FUNCTION:\n      return 'Function';\n    case ModelSpanType.UNKNOWN:\n      return 'Unknown';\n    default:\n      return spanType;\n  }\n}\n\nexport function tryDeserializeAttribute(value: string): any {\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    return value;\n  }\n}\n\nexport const getMatchesFromEvent = (span: ModelTraceSpanNode, searchFilter: string): SearchMatch[] => {\n  const events = span.events;\n  if (!events) {\n    return [];\n  }\n\n  const matches: SearchMatch[] = [];\n  events.forEach((event, index) => {\n    const attributes = event.attributes;\n\n    if (!attributes) {\n      return;\n    }\n\n    Object.keys(attributes).forEach((attribute) => {\n      const isKeyMatch = attribute.toLowerCase().includes(searchFilter);\n      const key = getEventAttributeKey(event.name, index, attribute);\n\n      if (isKeyMatch) {\n        matches.push({\n          span,\n          section: 'events',\n          key,\n          isKeyMatch: true,\n          matchIndex: 0,\n        });\n      }\n\n      // event values can be arbitrary JSON\n      const value = JSON.stringify(attributes[attribute]).toLowerCase();\n      const numValueMatches = value.split(searchFilter).length - 1;\n      for (let i = 0; i < numValueMatches; i++) {\n        matches.push({\n          span,\n          section: 'events',\n          key,\n          isKeyMatch: false,\n          matchIndex: i,\n        });\n      }\n    });\n  });\n\n  return matches;\n};\n\n/**\n * This function extracts all the matches from a span based on the search filter,\n * and appends some necessary metadata that is necessary for the jump-to-search\n * function.\n */\nexport const getMatchesFromSpan = (span: ModelTraceSpanNode, searchFilter: string): SearchMatch[] => {\n  // if search filter is empty, don't generate matches\n  // because there will be nothing to highlight anyway\n  if (!searchFilter) {\n    return [];\n  }\n\n  const matches: SearchMatch[] = [];\n\n  const sections = {\n    inputs: span?.inputs,\n    outputs: span?.outputs,\n    attributes: span?.attributes,\n    events: span?.events,\n  };\n\n  map(sections, (section: any, label: 'inputs' | 'outputs' | 'attributes' | 'events') => {\n    if (label === 'events') {\n      matches.push(...getMatchesFromEvent(span, searchFilter));\n      return;\n    }\n\n    const sectionList = createListFromObject(section);\n    sectionList.forEach((item) => {\n      // NOTE: this ignores the fact that there might be multiple matches in a key\n      // for example, if the key is \"aaaaa\", and the search filter is \"a\". However,\n      // implementing support for this case would make the code needlessly complex.\n      // If we receive feedback that this is a problem, we can revisit this.\n      const isKeyMatch = item.key.toLowerCase().includes(searchFilter);\n      if (isKeyMatch) {\n        matches.push({\n          span: span,\n          section: label,\n          key: item.key,\n          isKeyMatch: true,\n          matchIndex: 0,\n        });\n      }\n\n      const numValueMatches = item.value.toLowerCase().split(searchFilter).length - 1;\n      for (let i = 0; i < numValueMatches; i++) {\n        matches.push({\n          span: span,\n          section: label,\n          key: item.key,\n          isKeyMatch: false,\n          matchIndex: i,\n        });\n      }\n    });\n  });\n  return matches;\n};\n\nexport function searchTree(\n  rootNode: ModelTraceSpanNode,\n  searchFilter: string,\n  spanFilterState: SpanFilterState,\n): {\n  filteredTreeNodes: ModelTraceSpanNode[];\n  matches: SearchMatch[];\n} {\n  const searchFilterLowercased = searchFilter.toLowerCase().trim();\n  const allSpanTypesSelected = Object.values(spanFilterState.spanTypeDisplayState).every(\n    (shouldDisplay) => shouldDisplay,\n  );\n  // if there is no search filter and all span types\n  // are selected, then we don't have to do any filtering.\n  if (searchFilterLowercased === '' && allSpanTypesSelected) {\n    return {\n      filteredTreeNodes: [rootNode],\n      matches: [],\n    };\n  }\n\n  const children = rootNode.children ?? [];\n  const filteredChildren: ModelTraceSpanNode[] = [];\n  const matches: SearchMatch[] = [];\n  children.forEach((child) => {\n    const { filteredTreeNodes: childNodes, matches: childMatches } = searchTree(\n      child,\n      searchFilterLowercased,\n      spanFilterState,\n    );\n\n    filteredChildren.push(...childNodes);\n    matches.push(...childMatches);\n  });\n\n  const spanName = ((rootNode.title as string) ?? '').toLowerCase();\n  const spanMatches = getMatchesFromSpan(rootNode, searchFilterLowercased);\n\n  // check if the span passes the text and type filters\n  const nodeMatchesSearch = spanMatches.length > 0 || spanName.includes(searchFilterLowercased);\n  const spanTypeIsDisplayed = rootNode.type ? spanFilterState.spanTypeDisplayState[rootNode.type] : true;\n  const nodePassesSpanFilters = nodeMatchesSearch && spanTypeIsDisplayed;\n\n  const hasMatchingChild = filteredChildren.length > 0;\n  const hasException = getSpanExceptionCount(rootNode) > 0;\n\n  const nodeShouldBeDisplayed =\n    nodePassesSpanFilters ||\n    // the `showParents` and `showExceptions` flags override the\n    // search filters, so we always show the node if they pass\n    (spanFilterState.showParents && hasMatchingChild) ||\n    (spanFilterState.showExceptions && hasException);\n\n  if (nodeShouldBeDisplayed) {\n    return {\n      filteredTreeNodes: [{ ...rootNode, children: filteredChildren }],\n      matches: spanMatches.concat(matches),\n    };\n  }\n\n  // otherwise cut the span out of the tree by returning the children directly\n  return {\n    filteredTreeNodes: filteredChildren,\n    matches,\n  };\n}\n\nexport function searchTreeBySpanId(\n  rootNode: ModelTraceSpanNode | null,\n  selectedSpanId?: string,\n): ModelTraceSpanNode | undefined {\n  if (isNil(selectedSpanId) || isNil(rootNode)) {\n    return undefined;\n  }\n\n  if (rootNode.key === selectedSpanId) {\n    return rootNode;\n  }\n\n  const children = rootNode.children ?? [];\n  for (const child of children) {\n    const matchedNode = searchTreeBySpanId(child, selectedSpanId);\n    if (matchedNode) {\n      return matchedNode;\n    }\n  }\n\n  return undefined;\n}\n\nconst getChatMessagesFromSpan = (\n  messagesAttributeValue: any,\n  inputs: any,\n  outputs: any,\n  spanAttributes?: Record<string, any>,\n): ModelTraceChatMessage[] | undefined => {\n  // if the `mlflow.chat.messages` attribute is provided\n  // and in the correct format, return it as-is\n  // we allow content type to be content part list for the `mlflow.chat.messages` attribute\n  if (Array.isArray(messagesAttributeValue) && messagesAttributeValue.every(isRawModelTraceChatMessage)) {\n    return compact(messagesAttributeValue.map(prettyPrintChatMessage));\n  }\n\n  // otherwise, attempt to parse messages from inputs and outputs\n  // this is to support rich rendering for older versions of MLflow\n  // before the `mlflow.chat.messages` attribute was introduced\n  const messagesFromInputs = normalizeConversation(inputs, spanAttributes?.['mlflow.message.format']) ?? [];\n  const messagesFromOutputs = normalizeConversation(outputs, spanAttributes?.['mlflow.message.format']) ?? [];\n\n  // when either input or output is not chat messages, we do not set the chat message fiels.\n  if (messagesFromInputs.length === 0 || messagesFromOutputs.length === 0) {\n    return undefined;\n  }\n\n  return messagesFromInputs.concat(messagesFromOutputs);\n};\n\nconst getChatToolsFromSpan = (toolsAttributeValue: any, inputs: any): ModelTraceChatTool[] | undefined => {\n  // if the `mlflow.chat.tools` attribute is provided\n  // and in the correct format, return it as-is\n  if (Array.isArray(toolsAttributeValue) && toolsAttributeValue.every(isModelTraceChatTool)) {\n    return toolsAttributeValue;\n  }\n\n  // otherwise, attempt to parse tools from inputs\n  // TODO: support langchain format for tool inputs\n  if (Array.isArray(inputs?.tools) && inputs?.tools?.every(isModelTraceChatTool)) {\n    return inputs.tools;\n  }\n\n  return undefined;\n};\n\nexport const normalizeNewSpanData = (\n  span: ModelTraceSpan,\n  rootStartTime: number,\n  rootEndTime: number,\n  children: ModelTraceSpanNode[],\n  assessmentMap: Record<string, Assessment[]>,\n  traceId: string,\n): ModelTraceSpanNode => {\n  const spanType = tryDeserializeAttribute(span.attributes?.['mlflow.spanType']);\n  const inputs = tryDeserializeAttribute(span.attributes?.['mlflow.spanInputs']);\n  const outputs = tryDeserializeAttribute(span.attributes?.['mlflow.spanOutputs']);\n  const parentId = getModelTraceSpanParentId(span);\n  const spanId = getModelTraceSpanId(span);\n\n  const assessments = assessmentMap[spanId] ?? [];\n  if (!parentId) {\n    // assessments that are not associated with a specific\n    // span should be displayed at the root.\n    assessments.push(...(assessmentMap[''] ?? []));\n  }\n\n  // data that powers the \"chat\" tab\n  const messagesAttributeValue = tryDeserializeAttribute(span.attributes?.['mlflow.chat.messages']);\n  const messageFormat = tryDeserializeAttribute(span.attributes?.['mlflow.message.format']);\n  const spanAttributesForChat = messageFormat ? { 'mlflow.message.format': messageFormat } : undefined;\n  const chatMessages = getChatMessagesFromSpan(messagesAttributeValue, inputs, outputs, spanAttributesForChat);\n  const chatTools = getChatToolsFromSpan(tryDeserializeAttribute(span.attributes?.['mlflow.chat.tools']), inputs);\n\n  // remove other private mlflow attributes\n  const attributes = mapValues(\n    omitBy(span.attributes, (_, key) => key.startsWith('mlflow.')),\n    (value) => tryDeserializeAttribute(value),\n  );\n  const events = span.events;\n  const start = (Number(getModelTraceSpanStartTime(span)) - rootStartTime) / 1000;\n  const end = (Number(getModelTraceSpanEndTime(span) ?? rootEndTime) - rootStartTime) / 1000;\n\n  return {\n    title: span.name,\n    icon: (\n      <ModelTraceExplorerIcon\n        type={getIconTypeForSpan(spanType)}\n        hasException={getSpanExceptionCount(span) > 0}\n        isRootSpan={!parentId}\n      />\n    ),\n    type: spanType,\n    key: spanId,\n    start,\n    end,\n    children,\n    inputs,\n    outputs,\n    attributes,\n    events,\n    chatMessages,\n    chatTools,\n    parentId,\n    assessments,\n    traceId,\n  };\n};\n\nconst base64ToHex = (base64: string): string => {\n  const binaryString = atob(base64);\n  const binaryLen = binaryString.length;\n  let hex = '';\n  for (let i = 0; i < binaryLen; i++) {\n    const charCode = binaryString.charCodeAt(i);\n    hex += charCode.toString(16).padStart(2, '0');\n  }\n  return hex;\n};\n\n// mlflow span ids are meant to be interpreted as hex strings\nexport const decodeSpanId = (spanId: string, isV3Span: boolean): string => {\n  if (isV3Span) {\n    // v3 span ids are base64 encoded\n    try {\n      return base64ToHex(spanId);\n    } catch (e) {\n      // if base64 decoding fails, just return the original spanId\n      return spanId;\n    }\n  }\n\n  // old V2 span ids (pre-March 2025) are in hex with a 0x prefix\n  if (spanId.startsWith('0x')) {\n    return spanId.slice(2);\n  }\n\n  // new V2 span ids have the prefix stripped\n  return spanId;\n};\n\nexport function isV3ModelTraceInfo(info: ModelTrace['info']): info is ModelTraceInfoV3 {\n  return 'trace_metadata' in info;\n}\n\nexport function isV3ModelTraceSpan(span: ModelTraceSpan): span is ModelTraceSpanV3 {\n  return 'start_time_unix_nano' in span;\n}\n\nexport function isV2ModelTraceSpan(span: ModelTraceSpan): span is ModelTraceSpanV2 {\n  return 'parent_id' in span;\n}\n\nexport function getModelTraceSpanId(span: ModelTraceSpan): string {\n  return isV3ModelTraceSpan(span) ? decodeSpanId(span.span_id, true) : decodeSpanId(span.context?.span_id ?? '', false);\n}\n\nexport function getModelTraceSpanParentId(span: ModelTraceSpan): string {\n  return isV3ModelTraceSpan(span)\n    ? decodeSpanId(span.parent_span_id ?? '', true)\n    : decodeSpanId(span.parent_id ?? '', false);\n}\n\nexport function getModelTraceSpanStartTime(span: ModelTraceSpan): number {\n  return isV3ModelTraceSpan(span) ? Number(span.start_time_unix_nano) : Number(span.start_time);\n}\n\nexport function getModelTraceSpanEndTime(span: ModelTraceSpan): number {\n  return isV3ModelTraceSpan(span) ? Number(span.end_time_unix_nano) : Number(span.end_time);\n}\n\nexport function getModelTraceId(trace: ModelTrace): string {\n  return isV3ModelTraceInfo(trace.info) ? trace.info.trace_id : trace.info.request_id ?? '';\n}\n\nexport function parseModelTraceToTree(trace: ModelTrace): ModelTraceSpanNode | null {\n  const traceId = getModelTraceId(trace);\n  const spans = trace.trace_data?.spans ?? trace.data.spans;\n  const spanMap: { [span_id: string]: ModelTraceSpan } = {};\n  const relationMap: { [span_id: string]: string[] } = {};\n\n  spans.forEach((span) => {\n    const spanId = getModelTraceSpanId(span);\n    spanMap[spanId] = span;\n    relationMap[spanId] = [];\n  });\n\n  spans.forEach((span) => {\n    const spanId = getModelTraceSpanId(span);\n    const parentId = getModelTraceSpanParentId(span);\n    if (parentId) {\n      if (!relationMap[parentId]) {\n        throw new Error('Tree structure is malformed!');\n      }\n      relationMap[parentId].push(spanId);\n    }\n  });\n\n  const rootSpan = spans.find((span) => !getModelTraceSpanParentId(span));\n  if (isNil(rootSpan)) {\n    return null;\n  }\n\n  const rootSpanId = getModelTraceSpanId(rootSpan);\n  function getSpanNodeFromData(span_id: string): ModelTraceSpanNode {\n    const span = spanMap[span_id];\n    // above we return if rootSpan is null, but for some\n    // reason typescript thinks it's still nullable here.\n    const rootStart = Number(getModelTraceSpanStartTime(rootSpan as ModelTraceSpan));\n    const rootEnd = Number(getModelTraceSpanEndTime(rootSpan as ModelTraceSpan));\n    const children = relationMap[span_id].map(getSpanNodeFromData);\n    const assessmentMap = getAssessmentMap(trace.info);\n\n    // not using `isV2Span` here because for legacy reasons,\n    // V1 and V2 are rolled into in the same type. \"parent_id\" is\n    // the way we distinguish between the two.\n    if (isV3ModelTraceSpan(span) || 'parent_id' in span) {\n      // reusing the same function for v2 and v3 as the changes are small\n      return normalizeNewSpanData(span, rootStart, rootEnd, children, assessmentMap, traceId);\n    }\n\n    // v1 spans\n    const spanType = span.span_type ?? ModelSpanType.UNKNOWN;\n    return {\n      title: span.name,\n      icon: <ModelTraceExplorerIcon type={getIconTypeForSpan(spanType)} />,\n      type: spanType as ModelSpanType,\n      key: span.context.span_id,\n      start: Number(span.start_time) - rootStart,\n      // default to the end of the root span if the span has no end time.\n      // this can happen if an exception was thrown in the span.\n      end: Number(span.end_time ?? rootEnd) - rootStart,\n      children: children,\n      inputs: span.inputs,\n      outputs: span.outputs,\n      attributes: span.attributes,\n      events: span.events,\n      parentId: span.parent_id ?? span.parent_span_id,\n      assessments: [],\n      traceId,\n    };\n  }\n\n  return getSpanNodeFromData(rootSpanId);\n}\n\n// returns a map of { [span_id: string] : Assessment[] }\nexport const getAssessmentMap = (traceInfo: ModelTrace['info']): Record<string, Assessment[]> => {\n  let assessments: Assessment[] = [];\n  if (isV3ModelTraceInfo(traceInfo)) {\n    assessments = traceInfo.assessments ?? [];\n  } else {\n    assessments = getAssessmentsFromTags(traceInfo.tags);\n  }\n\n  // hydrate the assessments with the overridden assessment objects\n  const assessmentsById = keyBy(assessments, 'assessment_id');\n  Object.values(assessmentsById).forEach((assessment) => {\n    if (assessment.overrides) {\n      const overriddenAssessment = assessmentsById[assessment.overrides];\n      assessment.overriddenAssessment = overriddenAssessment;\n    }\n  });\n\n  assessments = Object.values(assessmentsById);\n\n  // construct the map by reducing over the assessments\n  const assessmentMap = assessments.reduce((acc: Record<string, Assessment[]>, assessment: Assessment) => {\n    const spanId = assessment.span_id ?? '';\n    if (!acc[spanId]) {\n      acc[spanId] = [];\n    }\n    acc[spanId].push(assessment);\n    return acc;\n  }, {});\n\n  // sort the assessments by last_update_time\n  Object.keys(assessmentMap).forEach((spanId) => {\n    assessmentMap[spanId].sort(\n      (a, b) => new Date(b.last_update_time).getTime() - new Date(a.last_update_time).getTime(),\n    );\n  });\n\n  return assessmentMap;\n};\n\n// parses assessments out from the trace tags\nconst getAssessmentsFromTags = (tags: ModelTrace['info']['tags']): Assessment[] => {\n  if (!tags) {\n    return [];\n  }\n\n  const tagList = Array.isArray(tags) ? tags : Object.entries(tags).map(([key, value]) => ({ key, value }));\n\n  return tagList.filter(({ key }) => key.startsWith('mlflow.assessment.')).map(({ value }) => JSON.parse(value));\n};\n\n// this function attempts to extract the trace version from\n// a given source (either request_metadata or tags)\nexport function findTraceVersionByKey(\n  source: { [key: string]: string } | { key: string; value: string }[] | undefined,\n): string | undefined {\n  if (!source) {\n    return undefined;\n  }\n\n  if (isArray(source)) {\n    return source.find((tag) => tag.key === MLFLOW_TRACE_SCHEMA_VERSION_KEY)?.value;\n  }\n\n  return source[MLFLOW_TRACE_SCHEMA_VERSION_KEY];\n}\n\n// this function determines whether an object is a ModelTrace by asserting\n// that the object has the `data` and `info` fields, and that the\n// trace info contains the `mlflow.trace_schema.version` key\nexport const isModelTrace = (trace: any): trace is ModelTrace => {\n  const traceInfo = trace?.info;\n  const traceData = trace?.data;\n  if (!traceInfo || !traceData || !traceData?.spans) {\n    return false;\n  }\n\n  // request_metadata is for V2 traces, trace_metadata is for V3 traces\n  const metadata = traceInfo?.request_metadata ?? traceInfo?.trace_metadata;\n  if (metadata && findTraceVersionByKey(metadata)) {\n    return true;\n  }\n\n  const tags = traceInfo?.tags;\n  if (tags && findTraceVersionByKey(tags)) {\n    return true;\n  }\n\n  return false;\n};\n\nexport const createListFromObject = (\n  obj: { [key: string]: any } | string[] | string | boolean | number | undefined,\n) => {\n  if (isNil(obj)) {\n    return [];\n  }\n\n  if (Array.isArray(obj) || isString(obj) || isNumber(obj) || isBoolean(obj)) {\n    return [{ key: '', value: JSON.stringify(obj, null, 2) }];\n  }\n\n  return Object.entries(obj).map(([key, value]) => {\n    return { key, value: JSON.stringify(value, null, 2) };\n  });\n};\n\nexport const getHighlightedSpanComponents = ({\n  searchFilter,\n  data,\n  activeMatchBackgroundColor,\n  inactiveMatchBackgroundColor,\n  containsActiveMatch,\n  activeMatch,\n  scrollToActiveMatch,\n}: {\n  searchFilter: string;\n  data: string;\n  activeMatchBackgroundColor: string;\n  inactiveMatchBackgroundColor: string;\n  containsActiveMatch: boolean;\n  activeMatch: SearchMatch;\n  scrollToActiveMatch: (node: HTMLSpanElement) => void;\n}) => {\n  // splitting by regex retains the matches in the array,\n  // which makes it easier to handle stuff like preserving\n  // the original case of the match.\n  const regex = new RegExp(`(${escapeRegExp(searchFilter.trim())})`, 'gi');\n  const parts = data.split(regex);\n  const spans: React.ReactNode[] = [];\n  let matchIndex = 0;\n\n  for (let i = 0; i < parts.length; i++) {\n    if (parts[i].toLowerCase().includes(searchFilter.toLowerCase().trim())) {\n      const isActiveMatch = containsActiveMatch && activeMatch.matchIndex === matchIndex;\n      const backgroundColor = isActiveMatch ? activeMatchBackgroundColor : inactiveMatchBackgroundColor;\n      const span = (\n        <span ref={isActiveMatch ? scrollToActiveMatch : null} key={i} css={{ backgroundColor, scrollMarginTop: 50 }}>\n          {parts[i]}\n        </span>\n      );\n      matchIndex++;\n      spans.push(span);\n    } else {\n      spans.push(parts[i]);\n    }\n  }\n\n  return spans;\n};\n\nexport const isRetrieverDocument = (document: any): document is RetrieverDocument => {\n  return has(document, 'page_content');\n};\n\nexport const isRenderableRetrieverSpan = (span: ModelTraceSpanNode): boolean => {\n  return (\n    span.type === ModelSpanType.RETRIEVER &&\n    Array.isArray(span.outputs) &&\n    span.outputs.length > 0 &&\n    every(span.outputs, isRetrieverDocument)\n  );\n};\n\nexport const getEventAttributeKey = (name: string, index: number, attribute: string): string => {\n  return `${name}-${index}-${attribute}`;\n};\n\nexport const getSpanExceptionEvents = (span: ModelTraceSpanNode | ModelTraceSpan): ModelTraceEvent[] => {\n  return (span.events ?? []).filter((event) => event.name === 'exception');\n};\n\nexport const getSpanExceptionCount = (span: ModelTraceSpanNode | ModelTraceSpan): number => {\n  return getSpanExceptionEvents(span).length;\n};\n\nexport const isModelTraceChatToolParamProperty = (obj: any): obj is ModelTraceChatToolParamProperty => {\n  if (isNil(obj)) {\n    return false;\n  }\n\n  if (!isNil(obj.type) && !isString(obj.type)) {\n    return false;\n  }\n\n  if (!isNil(obj.description) && !isString(obj.description)) {\n    return false;\n  }\n\n  if (!isNil(obj.enum) && !Array.isArray(obj.enum)) {\n    return false;\n  }\n\n  return true;\n};\n\nexport const isModelTraceChatTool = (obj: any): obj is ModelTraceChatTool => {\n  if (isNil(obj) || obj.type !== 'function' || !has(obj, 'function.name')) {\n    return false;\n  }\n\n  // conditional validation for the `parameters` field\n  const parameters = obj.function?.parameters;\n  if (!isNil(parameters)) {\n    // if `required` is present, it must be a list of strings\n    const required = parameters.required;\n    if (!isNil(required) && (!Array.isArray(required) || !required.every(isString))) {\n      return false;\n    }\n\n    const properties = parameters.properties;\n    if (!isNil(properties) && !Object.values(properties).every(isModelTraceChatToolParamProperty)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nexport const isModelTraceToolCall = (obj: any): obj is ModelTraceToolCall => {\n  return obj && isString(obj.id) && isString(obj.function?.arguments) && isString(obj.function?.name);\n};\n\nconst isContentPart = (part: any) => {\n  switch (part.type) {\n    case 'text':\n    case 'input_text':\n    case 'output_text':\n      return isString(part.text);\n    case 'image_url':\n      const { image_url } = part;\n      if (isNil(image_url)) {\n        return false;\n      }\n      return isString(image_url.url) && (isNil(image_url.detail) || ['auto', 'low', 'high'].includes(image_url.detail));\n    case 'input_audio':\n      const { input_audio } = part;\n      if (isNil(input_audio)) {\n        return false;\n      }\n      return isString(input_audio.data) && (isNil(input_audio.format) || ['wav', 'mp3'].includes(input_audio.format));\n    default:\n      return false;\n  }\n};\n\nconst isContentType = (content: any) => {\n  if (isNil(content) || isString(content)) {\n    return true;\n  }\n\n  if (isArray(content)) {\n    return content.every((part) => isContentPart(part));\n  }\n\n  return false;\n};\n\nexport const isModelTraceChatMessage = (message: any): message is ModelTraceChatMessage => {\n  if (!isRawModelTraceChatMessage(message)) {\n    return false;\n  }\n\n  return isNil(message.content) || isString(message.content);\n};\n\nexport const isRawModelTraceChatMessage = (message: any): message is RawModelTraceChatMessage => {\n  if (!message) {\n    return false;\n  }\n\n  if (message.tool_calls) {\n    if (!Array.isArray(message.tool_calls)) {\n      return false;\n    }\n\n    if (!message.tool_calls.every(isModelTraceToolCall)) {\n      return false;\n    }\n  }\n\n  if (message.type === 'reasoning') {\n    return true;\n  }\n\n  // verify if the message content is a valid content type or not\n  if (!isContentType(message.content)) {\n    return false;\n  }\n\n  return (\n    message.role === 'user' || message.role === 'assistant' || message.role === 'system' || message.role === 'tool'\n  );\n};\n\nexport const isModelTraceChatInput = (obj: any): obj is ModelTraceChatInput => {\n  return (\n    obj && Array.isArray(obj.messages) && obj.messages.length > 0 && obj.messages.every(isRawModelTraceChatMessage)\n  );\n};\n\nexport const isModelTraceChoices = (obj: any): obj is ModelTraceChatResponse['choices'] => {\n  return (\n    Array.isArray(obj) &&\n    obj.length > 0 &&\n    obj.every((choice: any) => has(choice, 'message') && isModelTraceChatMessage(choice.message))\n  );\n};\n\nexport const isModelTraceChatResponse = (obj: any): obj is ModelTraceChatResponse => {\n  return obj && isModelTraceChoices(obj.choices);\n};\n\n/**\n * Attempt to normalize a conversation, return null in case the format is unrecognized\n * TODO: move all chat parsing logic to the chat-utils folder to avoid cluttering this\n * utils file.\n *\n * Supported formats:\n *   1. Langchain chat inputs\n *   2. Langchain chat results\n *   3. OpenAI ChatCompletions inputs\n *   4. OpenAI ChatCompletions responses\n *   5. OpenAI Responses inputs\n *   6. OpenAI Responses output\n *   7. LlamaIndex chat responses\n *   8. DSPy chat inputs\n *   8. DSPy chat outputs\n *   9. Gemini inputs\n *  10. Gemini outputs\n *  11. Anthropic inputs\n *  12. Anthropic outputs\n */\nexport const normalizeConversation = (input: any, messageFormat?: string): ModelTraceChatMessage[] | null => {\n  // wrap in try/catch to avoid crashing the UI. we're doing a lot of type coercion\n  // and formatting, and it's possible that we miss some edge cases. in case of an error,\n  // simply return null to signify that the input is not a chat input.\n  try {\n    // if the input is already in the correct format, return it\n    if (Array.isArray(input) && input.length > 0 && input.every(isRawModelTraceChatMessage)) {\n      return compact(input.map(prettyPrintChatMessage));\n    }\n\n    switch (messageFormat) {\n      case 'langchain':\n        const langchainMessages = normalizeLangchainChatInput(input) ?? normalizeLangchainChatResult(input);\n        if (langchainMessages) return langchainMessages;\n        break;\n      case 'llamaindex':\n        const llamaIndexMessages = normalizeLlamaIndexChatInput(input) ?? normalizeLlamaIndexChatResponse(input);\n        if (llamaIndexMessages) return llamaIndexMessages;\n        break;\n      case 'openai':\n        const openAIMessages =\n          normalizeOpenAIChatInput(input) ??\n          normalizeOpenAIChatResponse(input) ??\n          normalizeOpenAIResponsesOutput(input) ??\n          normalizeOpenAIResponsesInput(input);\n        if (openAIMessages) return openAIMessages;\n        break;\n      case 'dspy':\n        const dspyMessages = normalizeDspyChatInput(input) ?? normalizeDspyChatOutput(input);\n        if (dspyMessages) return dspyMessages;\n        break;\n      case 'gemini':\n        const geminiMessages = normalizeGeminiChatInput(input) ?? normalizeGeminiChatOutput(input);\n        if (geminiMessages) return geminiMessages;\n        break;\n      case 'anthropic':\n        const anthropicMessages = normalizeAnthropicChatInput(input) ?? normalizeAnthropicChatOutput(input);\n        if (anthropicMessages) return anthropicMessages;\n        break;\n      case 'openai-agent':\n        const openAIAgentMessages = normalizeOpenAIAgentInput(input) ?? normalizeOpenAIAgentOutput(input);\n        if (openAIAgentMessages) return openAIAgentMessages;\n        break;\n      case 'autogen':\n        const autogenMessages = normalizeAutogenChatInput(input) ?? normalizeAutogenChatOutput(input);\n        if (autogenMessages) return autogenMessages;\n        break;\n      case 'bedrock':\n        const bedrockMessages = normalizeBedrockChatInput(input) ?? normalizeBedrockChatOutput(input);\n        if (bedrockMessages) return bedrockMessages;\n        break;\n      default:\n        // Fallback to OpenAI chat format\n        const chatMessages = normalizeOpenAIChatInput(input) ?? normalizeOpenAIChatResponse(input);\n        if (chatMessages) return chatMessages;\n        break;\n    }\n\n    return null;\n  } catch (e) {\n    return null;\n  }\n};\n\nexport const prettyPrintToolCall = (toolCall: ModelTraceToolCall): ModelTraceToolCall => {\n  // add some spacing to the arguments for better readability\n  let args = toolCall.function?.arguments;\n  try {\n    args = JSON.stringify(JSON.parse(args), null, 2);\n  } catch (e) {\n    // use original args\n  }\n  return {\n    id: toolCall.id,\n    function: {\n      arguments: args,\n      name: toolCall.function.name,\n    },\n  };\n};\n\nconst formatChatContent = (content?: ModelTraceContentType | null): string | undefined | null => {\n  if (isNil(content) || isString(content)) {\n    return content;\n  }\n\n  const contentParts = content\n    // eslint-disable-next-line array-callback-return\n    .map((part) => {\n      switch (part.type) {\n        case 'text':\n        case 'input_text':\n        case 'output_text':\n          return part.text;\n        case 'image_url':\n          const url = part?.image_url?.url;\n          return url ? `![](${url})` : '[image]';\n        case 'input_audio':\n          // raw encoded audio content is not displayed in the UI\n          return '[audio]';\n      }\n    })\n    .filter((part) => part !== undefined);\n\n  // Join with double line breaks for better visual separation\n  return contentParts.join('\\n\\n');\n};\n\nexport const prettyPrintChatMessage = (message: RawModelTraceChatMessage): ModelTraceChatMessage | null => {\n  // TODO: support rich rendering of reasoning messages\n  // for now, just return null and compact it away in the caller\n  // this is because we want to still render the rest of the message\n  // outputs.\n  if (message.type === 'reasoning') {\n    return null;\n  }\n\n  return {\n    ...message,\n    content: formatChatContent(message.content),\n    tool_calls: message.tool_calls?.map(prettyPrintToolCall),\n  };\n};\n","import { has, isArray, isString } from 'lodash';\nimport { ModelTraceChatMessage } from '../ModelTrace.types';\nimport { prettyPrintChatMessage } from '../ModelTraceExplorer.utils';\n\nexport const normalizeDspyChatInput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  // Handle DSPy format with messages array\n  if (has(obj, 'messages') && isArray((obj as any).messages)) {\n    const messages = (obj as any).messages;\n    return messages\n      .map((msg: any) => prettyPrintChatMessage({ type: 'message', content: msg.content, role: msg.role }))\n      .filter(Boolean);\n  }\n\n  return null;\n};\n\nexport const normalizeDspyChatOutput = (obj: unknown): ModelTraceChatMessage[] | null => {\n  // Handle DSPy format with array output\n  if (isArray(obj) && obj.length > 0 && obj.every(isString)) {\n    // Join all output strings into one assistant message\n    const content = obj.join('\\n');\n    const message = prettyPrintChatMessage({ type: 'message', content, role: 'assistant' });\n    return message && [message];\n  }\n\n  return null;\n};\n","import { Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { ModelTraceSpanNode } from '../ModelTrace.types';\nimport { ModelSpanType } from '../ModelTrace.types';\nimport { getIconTypeForSpan, getSpanExceptionCount } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerIcon } from '../ModelTraceExplorerIcon';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\n\nexport const SpanNameDetailViewLink = ({ node }: { node: ModelTraceSpanNode }) => {\n  const { theme } = useDesignSystemTheme();\n  const { setSelectedNode, setActiveView, setShowTimelineTreeGantt } = useModelTraceExplorerViewState();\n  const hasException = getSpanExceptionCount(node) > 0;\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n        marginRight: theme.spacing.xs,\n        gap: theme.spacing.xs,\n        '&:hover': {\n          textDecoration: 'underline',\n          textDecorationColor: hasException\n            ? theme.colors.actionDangerDefaultTextDefault\n            : theme.colors.actionDefaultTextDefault,\n          cursor: 'pointer',\n        },\n      }}\n      onClick={() => {\n        setSelectedNode(node);\n        setActiveView('detail');\n        setShowTimelineTreeGantt(false);\n      }}\n    >\n      <ModelTraceExplorerIcon\n        hasException={hasException}\n        type={getIconTypeForSpan(node.type ?? ModelSpanType.UNKNOWN)}\n      />\n      <Typography.Text\n        color={hasException ? 'error' : 'primary'}\n        css={{ marginLeft: theme.spacing.xs, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}\n      >\n        {node.title}\n      </Typography.Text>\n    </div>\n  );\n};\n","import {\n  ModelsIcon,\n  ConnectIcon,\n  FileDocumentIcon,\n  useDesignSystemTheme,\n  SortUnsortedIcon,\n  QuestionMarkIcon,\n  CodeIcon,\n  FunctionIcon,\n  NumbersIcon,\n  SearchIcon,\n  WrenchIcon,\n  UserSparkleIcon,\n  ChainIcon,\n  UserIcon,\n  GearIcon,\n  SaveIcon,\n} from '@databricks/design-system';\n\nimport { ModelIconType } from './ModelTrace.types';\n\nexport const ModelTraceExplorerIcon = ({\n  type = ModelIconType.CONNECT,\n  // tooltips have inverted colors so the icon should match it\n  isInTooltip = false,\n  hasException = false,\n  isRootSpan = false,\n}: {\n  type?: ModelIconType;\n  isInTooltip?: boolean;\n  hasException?: boolean;\n  isRootSpan?: boolean;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  // base icon colors depending on span attributes\n  let iconColor: 'ai' | 'danger' | undefined;\n  if (isRootSpan) {\n    iconColor = 'ai';\n  } else if (hasException) {\n    iconColor = 'danger';\n  }\n\n  const iconMap = {\n    [ModelIconType.MODELS]: <ModelsIcon color={iconColor} />,\n    [ModelIconType.DOCUMENT]: <FileDocumentIcon color={iconColor} />,\n    [ModelIconType.CONNECT]: <ConnectIcon color={iconColor} />,\n    [ModelIconType.CODE]: <CodeIcon color={iconColor} />,\n    [ModelIconType.FUNCTION]: <FunctionIcon color={iconColor} />,\n    [ModelIconType.NUMBERS]: <NumbersIcon color={iconColor} />,\n    [ModelIconType.SEARCH]: <SearchIcon color={iconColor} />,\n    [ModelIconType.SORT]: <SortUnsortedIcon color={iconColor} />,\n    [ModelIconType.UNKNOWN]: <QuestionMarkIcon color={iconColor} />,\n    [ModelIconType.WRENCH]: <WrenchIcon color={iconColor} />,\n    [ModelIconType.AGENT]: <UserSparkleIcon color={iconColor} />,\n    [ModelIconType.CHAIN]: <ChainIcon color={iconColor} />,\n    [ModelIconType.USER]: <UserIcon color={iconColor} />,\n    [ModelIconType.SYSTEM]: <GearIcon color={iconColor} />,\n    [ModelIconType.SAVE]: <SaveIcon color={iconColor} />,\n  };\n\n  // custom colors depending on span type\n  // these are not official props on the\n  // icon components, so they must be set\n  // via the `css` prop on the parent\n  let color: string = theme.colors.actionDefaultIconDefault;\n  let tooltipColor: string = theme.colors.actionPrimaryIcon;\n  let backgroundColor: string = theme.colors.backgroundSecondary;\n  switch (type) {\n    case ModelIconType.SEARCH:\n      color = theme.colors.textValidationSuccess;\n      tooltipColor = theme.colors.green500;\n      backgroundColor = theme.isDarkMode ? theme.colors.green800 : theme.colors.green100;\n      break;\n    case ModelIconType.MODELS:\n      color = theme.isDarkMode ? theme.colors.blue500 : theme.colors.turquoise;\n      tooltipColor = theme.isDarkMode ? theme.colors.turquoise : theme.colors.blue500;\n      backgroundColor = theme.isDarkMode ? theme.colors.blue800 : theme.colors.blue100;\n      break;\n    case ModelIconType.WRENCH:\n      color = theme.isDarkMode ? theme.colors.red500 : theme.colors.red700;\n      tooltipColor = theme.isDarkMode ? theme.colors.red700 : theme.colors.red500;\n      backgroundColor = theme.isDarkMode ? theme.colors.red800 : theme.colors.red100;\n      break;\n  }\n\n  return (\n    <div\n      css={{\n        position: 'relative',\n        width: theme.general.iconSize,\n        height: theme.general.iconSize,\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        borderRadius: theme.borders.borderRadiusSm,\n        background: isInTooltip ? theme.colors.tooltipBackgroundTooltip : backgroundColor,\n        color: isInTooltip ? tooltipColor : color,\n        svg: { width: theme.general.iconFontSize, height: theme.general.iconFontSize },\n        flexShrink: 0,\n      }}\n    >\n      {hasException && (\n        <div\n          css={{\n            position: 'absolute',\n            top: -theme.spacing.xs,\n            right: -theme.spacing.xs,\n            height: theme.spacing.sm,\n            width: theme.spacing.sm,\n            borderRadius: theme.borders.borderRadiusSm,\n            backgroundColor: theme.colors.actionDangerPrimaryBackgroundDefault,\n            zIndex: 5,\n          }}\n        />\n      )}\n      {iconMap[type]}\n    </div>\n  );\n};\n","import type { Interpolation, Theme } from '@emotion/react';\n\nimport { Tag, Tooltip, Typography } from '@databricks/design-system';\n\n// max characters for key + value before truncation\nconst MAX_CHARS_LENGTH = 18;\n\nconst getTruncatedStyles = (shouldTruncate: boolean): Interpolation<Theme> =>\n  shouldTruncate\n    ? {\n        overflow: 'hidden',\n        textOverflow: 'ellipsis',\n        whiteSpace: 'nowrap',\n      }\n    : { whiteSpace: 'nowrap' };\n\n/**\n * A <Tag /> wrapper used for displaying key-value entity\n */\nexport const KeyValueTag = ({\n  itemKey,\n  itemValue,\n  charLimit = MAX_CHARS_LENGTH,\n  maxWidth = 150,\n  className,\n}: {\n  itemKey: string;\n  itemValue: string;\n  charLimit?: number;\n  maxWidth?: number;\n  className?: string;\n}) => {\n  const { shouldTruncateKey, shouldTruncateValue } = getKeyAndValueComplexTruncation(itemKey, itemValue, charLimit);\n\n  return (\n    <Tooltip componentId=\"shared.model-trace-explorer.key-value-tag.hover-tooltip\" content={`${itemKey}: ${itemValue}`}>\n      <Tag componentId=\"shared.model-trace-explorer.key-value-tag\" className={className}>\n        <span css={{ maxWidth, display: 'inline-flex' }}>\n          <Typography.Text bold css={getTruncatedStyles(shouldTruncateKey)} size=\"sm\">\n            {itemKey}\n          </Typography.Text>\n          :&nbsp;\n          <Typography.Text css={getTruncatedStyles(shouldTruncateValue)} size=\"sm\">\n            {itemValue}\n          </Typography.Text>\n        </span>\n      </Tag>\n    </Tooltip>\n  );\n};\n\nexport function getKeyAndValueComplexTruncation(\n  key: string,\n  value: string,\n  charLimit: number,\n): { shouldTruncateKey: boolean; shouldTruncateValue: boolean } {\n  const fullLength = key.length + value.length;\n  const isKeyLonger = key.length > value.length;\n  const shorterLength = isKeyLonger ? value.length : key.length;\n\n  // No need to truncate if tag is short enough\n  if (fullLength <= charLimit) return { shouldTruncateKey: false, shouldTruncateValue: false };\n  // If the shorter string is too long, truncate both key and value.\n  if (shorterLength > charLimit / 2) return { shouldTruncateKey: true, shouldTruncateValue: true };\n\n  // Otherwise truncate the longer string\n  return {\n    shouldTruncateKey: isKeyLonger,\n    shouldTruncateValue: !isKeyLonger,\n  };\n}\n","import { Button, ChevronUpIcon, FileDocumentIcon, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { GenAIMarkdownRenderer } from '../../genai-markdown-renderer';\nimport { KeyValueTag } from '../key-value-tag/KeyValueTag';\n\nexport function ModelTraceExplorerRetrieverDocumentFull({\n  text,\n  metadataTags,\n  setExpanded,\n  logDocumentClick,\n}: {\n  text: string;\n  metadataTags: { key: string; value: string }[];\n  setExpanded: (expanded: boolean) => void;\n  logDocumentClick?: (action: string) => void;\n}) {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div css={{ display: 'flex', flexDirection: 'column' }}>\n      <div\n        role=\"button\"\n        onClick={() => {\n          setExpanded(false);\n          logDocumentClick?.('collapse');\n        }}\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          alignItems: 'center',\n          cursor: 'pointer',\n          padding: `${theme.spacing.sm}px ${theme.spacing.md}px`,\n          height: theme.typography.lineHeightBase,\n          boxSizing: 'content-box',\n          '&:hover': {\n            backgroundColor: theme.colors.backgroundSecondary,\n          },\n        }}\n      >\n        <FileDocumentIcon />\n      </div>\n      <div css={{ padding: theme.spacing.md, paddingBottom: 0 }}>\n        <GenAIMarkdownRenderer>{text}</GenAIMarkdownRenderer>\n      </div>\n      <div css={{ padding: theme.spacing.md, paddingTop: 0 }}>\n        {metadataTags.map(({ key, value }) => (\n          <KeyValueTag key={key} itemKey={key} itemValue={value} />\n        ))}\n      </div>\n      <Button\n        css={{ width: '100%', padding: theme.spacing.sm }}\n        componentId=\"shared.model-trace-explorer.retriever-document-collapse\"\n        icon={<ChevronUpIcon />}\n        type=\"tertiary\"\n        onClick={() => setExpanded(false)}\n      >\n        <FormattedMessage\n          defaultMessage=\"See less\"\n          description=\"Model trace explorer > selected span > code snippet > see less button\"\n        />\n      </Button>\n    </div>\n  );\n}\n","import { FileDocumentIcon, Tag, Tooltip, Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nimport { KeyValueTag } from '../key-value-tag/KeyValueTag';\n\nexport function ModelTraceExplorerRetrieverDocumentPreview({\n  text,\n  metadataTags,\n  setExpanded,\n  logDocumentClick,\n}: {\n  text: string;\n  metadataTags: { key: string; value: string }[];\n  setExpanded: (expanded: boolean) => void;\n  logDocumentClick?: (action: string) => void;\n}) {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div\n      role=\"button\"\n      onClick={() => {\n        setExpanded(true);\n        logDocumentClick?.('expand');\n      }}\n      css={{\n        display: 'flex',\n        flexDirection: 'row',\n        padding: `${theme.spacing.sm}px ${theme.spacing.md}px`,\n        gap: theme.spacing.sm,\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        cursor: 'pointer',\n        '&:hover': {\n          backgroundColor: theme.colors.backgroundSecondary,\n        },\n      }}\n    >\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          gap: theme.spacing.sm,\n          alignItems: 'center',\n          minWidth: 0,\n          flexShrink: 1,\n        }}\n      >\n        <FileDocumentIcon />\n        <Typography.Text ellipsis size=\"md\">\n          {text}\n        </Typography.Text>\n      </div>\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          gap: theme.spacing.sm,\n        }}\n      >\n        {metadataTags.length > 0 ? (\n          <KeyValueTag css={{ margin: 0 }} itemKey={metadataTags[0].key} itemValue={metadataTags[0].value} />\n        ) : null}\n        {metadataTags.length > 1 ? (\n          <Tooltip\n            componentId=\"shared.model-trace-explorer.tag-count.hover-tooltip\"\n            content={metadataTags.slice(1).map(({ key, value }) => (\n              <span key={key} css={{ display: 'inline-block' }}>\n                {`${key}: ${value}`}\n              </span>\n            ))}\n          >\n            <Tag componentId=\"shared.model-trace-explorer.tag-count\" css={{ whiteSpace: 'nowrap', margin: 0 }}>\n              +{metadataTags.length - 1}\n            </Tag>\n          </Tooltip>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n","import { useCallback, useState } from 'react';\n\nimport { ModelTraceExplorerRetrieverDocumentFull } from './ModelTraceExplorerRetrieverDocumentFull';\nimport { ModelTraceExplorerRetrieverDocumentPreview } from './ModelTraceExplorerRetrieverDocumentPreview';\nimport { createListFromObject } from '../ModelTraceExplorer.utils';\n\nexport function ModelTraceExplorerRetrieverDocument({\n  text,\n  metadata,\n}: {\n  text: string;\n  metadata: { [key: string]: any };\n}) {\n  const [expanded, setExpanded] = useState(false);\n  const metadataTags = createListFromObject(metadata);\n\n  return expanded ? (\n    <ModelTraceExplorerRetrieverDocumentFull\n      // comment to prevent copybara formatting\n      text={text}\n      metadataTags={metadataTags}\n      setExpanded={setExpanded}\n    />\n  ) : (\n    <ModelTraceExplorerRetrieverDocumentPreview\n      // comment to prevent copybara formatting\n      text={text}\n      metadataTags={metadataTags}\n      setExpanded={setExpanded}\n    />\n  );\n}\n","import { DangerIcon, Empty } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nexport const ModelTraceExplorerErrorState = () => {\n  return (\n    <Empty\n      title={\n        <FormattedMessage\n          defaultMessage=\"Trace failed to render\"\n          description=\"Title for the error state in the model trace explorer\"\n        />\n      }\n      description={\n        <FormattedMessage\n          defaultMessage=\"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support.\"\n          description=\"Description for the error state in the model trace explorer\"\n        />\n      }\n      image={<DangerIcon />}\n    />\n  );\n};\n","import React, { useState } from 'react';\nimport { useDebouncedCallback } from 'use-debounce';\n\nimport {\n  Button,\n  ChevronDownIcon,\n  ChevronUpIcon,\n  Input,\n  SearchIcon,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\n\nimport type { SearchMatch } from './ModelTrace.types';\n\nconst ModelTraceExplorerSearchBox = ({\n  searchFilter,\n  setSearchFilter,\n  matchData,\n  handleNextSearchMatch,\n  handlePreviousSearchMatch,\n}: {\n  searchFilter: string;\n  setSearchFilter: (searchFilter: string) => void;\n  matchData: {\n    match: SearchMatch | null;\n    totalMatches: number;\n    currentMatchIndex: number;\n  };\n  handleNextSearchMatch: () => void;\n  handlePreviousSearchMatch: () => void;\n}) => {\n  const [searchValue, setSearchValue] = useState(searchFilter);\n  const debouncedSetSearchFilter = useDebouncedCallback(setSearchFilter, 350);\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'row',\n        justifyContent: 'space-between',\n        gap: theme.spacing.sm,\n      }}\n    >\n      <Input\n        componentId=\"shared.model-trace-explorer.search-input\"\n        allowClear\n        placeholder=\"Search\"\n        value={searchValue}\n        onClear={() => {\n          setSearchFilter('');\n          setSearchValue('');\n        }}\n        onChange={(e) => {\n          setSearchValue(e.target.value);\n          debouncedSetSearchFilter(e.target.value.toLowerCase());\n        }}\n        prefix={<SearchIcon />}\n        css={{\n          width: '100%',\n          boxSizing: 'border-box',\n        }}\n      />\n      {matchData.match && (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'row',\n            marginLeft: theme.spacing.xs,\n            marginRight: theme.spacing.sm,\n            alignItems: 'center',\n          }}\n        >\n          <Typography.Text css={{ whiteSpace: 'nowrap', marginRight: theme.spacing.sm }}>\n            {matchData.currentMatchIndex + 1} / {matchData.totalMatches}\n          </Typography.Text>\n          <Button\n            data-testid=\"prev-search-match\"\n            icon={<ChevronUpIcon />}\n            onClick={handlePreviousSearchMatch}\n            componentId=\"shared.model-trace-explorer.prev-search-match\"\n          />\n          <Button\n            data-testid=\"next-search-match\"\n            icon={<ChevronDownIcon />}\n            onClick={handleNextSearchMatch}\n            componentId=\"shared.model-trace-explorer.next-search-match\"\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default ModelTraceExplorerSearchBox;\n","import { compact, isNil } from 'lodash';\nimport { useCallback, useLayoutEffect, useMemo, useState } from 'react';\n\nimport type {\n  ModelTraceExplorerTab,\n  ModelTraceSpanNode,\n  SearchMatch,\n  SpanFilterState,\n  ModelTrace,\n} from '../ModelTrace.types';\nimport { searchTree } from '../ModelTraceExplorer.utils';\nimport {\n  getSpanNodeParentIds,\n  getTimelineTreeNodesList,\n  getTimelineTreeNodesMap,\n} from '../timeline-tree/TimelineTree.utils';\n\nconst getDefaultSpanFilterState = (treeNode: ModelTraceSpanNode | null): SpanFilterState => {\n  const spanTypeDisplayState: Record<string, boolean> = {};\n\n  // populate the spanTypeDisplayState with\n  // all span types that exist on the trace\n  if (treeNode) {\n    const allSpanTypes = compact(getTimelineTreeNodesList<ModelTraceSpanNode>([treeNode]).map((node) => node.type));\n    allSpanTypes.forEach((spanType) => {\n      spanTypeDisplayState[spanType] = true;\n    });\n  }\n\n  return {\n    showParents: true,\n    showExceptions: true,\n    spanTypeDisplayState,\n  };\n};\n\nconst getTabForMatch = (match: SearchMatch): ModelTraceExplorerTab => {\n  switch (match.section) {\n    case 'inputs':\n    case 'outputs':\n      return 'content';\n    case 'attributes':\n      return 'attributes';\n    case 'events':\n      return 'events';\n    default:\n      // shouldn't happen\n      return 'content';\n  }\n};\n\nexport const useModelTraceSearch = ({\n  treeNode,\n  selectedNode,\n  setSelectedNode,\n  setActiveTab,\n  setExpandedKeys,\n  modelTraceInfo,\n}: {\n  treeNode: ModelTraceSpanNode | null;\n  selectedNode: ModelTraceSpanNode | undefined;\n  setSelectedNode: (node: ModelTraceSpanNode) => void;\n  setActiveTab: (tab: ModelTraceExplorerTab) => void;\n  setExpandedKeys: React.Dispatch<React.SetStateAction<Set<string | number>>>;\n  modelTraceInfo: ModelTrace['info'] | null;\n}): {\n  searchFilter: string;\n  setSearchFilter: (filter: string) => void;\n  spanFilterState: SpanFilterState;\n  setSpanFilterState: (state: SpanFilterState) => void;\n  filteredTreeNodes: ModelTraceSpanNode[];\n  matchData: {\n    match: SearchMatch | null;\n    totalMatches: number;\n    currentMatchIndex: number;\n  };\n  handleNextSearchMatch: () => void;\n  handlePreviousSearchMatch: () => void;\n} => {\n  const [searchFilter, setSearchFilter] = useState<string>('');\n  const [spanFilterState, setSpanFilterState] = useState<SpanFilterState>(() => getDefaultSpanFilterState(treeNode));\n  const [activeMatchIndex, setActiveMatchIndex] = useState(0);\n  const { filteredTreeNodes, matches } = useMemo(() => {\n    if (isNil(treeNode)) {\n      return {\n        filteredTreeNodes: [],\n        matches: [],\n      };\n    }\n\n    return searchTree(treeNode, searchFilter, spanFilterState);\n    // use the span ID to determine whether the state should be recomputed.\n    // using the whole object seems to cause the state to be reset at\n    // unexpected times.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [treeNode?.key, searchFilter, spanFilterState, modelTraceInfo]);\n\n  const nodeMap = useMemo(() => {\n    return getTimelineTreeNodesMap(filteredTreeNodes);\n  }, [filteredTreeNodes]);\n\n  const selectMatch = useCallback(\n    (newMatchIndex: number) => {\n      if (newMatchIndex >= matches.length || newMatchIndex < 0) {\n        return;\n      }\n      setActiveMatchIndex(newMatchIndex);\n      const match = matches[newMatchIndex];\n      setSelectedNode(match.span);\n      setActiveTab(getTabForMatch(match));\n      // Make sure parents are expanded\n      const parents = getSpanNodeParentIds(match.span, nodeMap);\n      setExpandedKeys((expandedKeys) => {\n        // set.union seems to not be available in all environments\n        return new Set([...expandedKeys, ...parents]);\n      });\n    },\n    [matches, setSelectedNode, setActiveTab, nodeMap, setExpandedKeys],\n  );\n\n  const handleNextSearchMatch = useCallback(() => {\n    selectMatch(activeMatchIndex + 1);\n  }, [activeMatchIndex, selectMatch]);\n\n  const handlePreviousSearchMatch = useCallback(() => {\n    selectMatch(activeMatchIndex - 1);\n  }, [activeMatchIndex, selectMatch]);\n\n  useLayoutEffect(() => {\n    if (filteredTreeNodes.length === 0) {\n      return;\n    }\n\n    // this case can trigger on two conditions:\n    // 1. the search term is cleared, therefore there are no matches\n    // 2. the search term only matches on span names, which don't count\n    //    as matches since we don't support jumping to them.\n    if (matches.length === 0) {\n      // if the selected node is no longer in the tree, then select\n      // the first node. this can occur from condition #2 above\n      const selectedNodeKey = selectedNode?.key ?? '';\n      if (!(selectedNodeKey in nodeMap)) {\n        const newSpan = filteredTreeNodes[0];\n        setSelectedNode(newSpan);\n        setActiveTab(newSpan?.chatMessages ? 'chat' : 'content');\n      } else {\n        // another reason the tree can change is if modelTraceInfo changes.\n        // (e.g. tags/assessments were updated). if this happens, we need\n        // to reselect the updated node from the node map, otherwise the\n        // updates will not be reflected in the UI.\n        setSelectedNode(nodeMap[selectedNodeKey]);\n      }\n\n      // otherwise, if search was cleared, then we don't want to\n      // do anything. this is to preserve the user's context\n      // (e.g. they've jumped to a span and now want to dive deeper)\n      return;\n    }\n\n    // when matches update, select the first match\n    setActiveMatchIndex(0);\n    setSelectedNode(matches[0].span);\n    setActiveTab(getTabForMatch(matches[0]));\n    // don't subscribe to selectedNode to prevent infinite loop\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [filteredTreeNodes, matches, setSelectedNode]);\n\n  return {\n    matchData: {\n      match: matches[activeMatchIndex] ?? null,\n      totalMatches: matches.length,\n      currentMatchIndex: activeMatchIndex,\n    },\n    searchFilter: searchFilter.toLowerCase().trim(),\n    setSearchFilter,\n    spanFilterState,\n    setSpanFilterState,\n    filteredTreeNodes,\n    handleNextSearchMatch,\n    handlePreviousSearchMatch,\n  };\n};\n","import { isNil, keys } from 'lodash';\n\nimport { Empty, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport type { ModelTraceSpanNode, SearchMatch } from '../ModelTrace.types';\nimport { ModelTraceExplorerCodeSnippet } from '../ModelTraceExplorerCodeSnippet';\n\nexport function ModelTraceExplorerAttributesTab({\n  activeSpan,\n  searchFilter,\n  activeMatch,\n}: {\n  activeSpan: ModelTraceSpanNode;\n  searchFilter: string;\n  activeMatch: SearchMatch | null;\n}) {\n  const { theme } = useDesignSystemTheme();\n  const { attributes } = activeSpan;\n  const containsAttributes = keys(attributes).length > 0;\n  const isActiveMatchSpan = !isNil(activeMatch) && activeMatch.span.key === activeSpan.key;\n\n  if (!containsAttributes || isNil(attributes)) {\n    return (\n      <div css={{ marginTop: theme.spacing.md }}>\n        <Empty\n          description={\n            <FormattedMessage\n              defaultMessage=\"No attributes found\"\n              description=\"Empty state for the attributes tab in the model trace explorer. Attributes are properties of a span that the user defines.\"\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.sm,\n        padding: theme.spacing.md,\n      }}\n    >\n      {Object.entries(attributes).map(([key, value]) => (\n        <ModelTraceExplorerCodeSnippet\n          key={key}\n          title={key}\n          data={JSON.stringify(value, null, 2)}\n          searchFilter={searchFilter}\n          activeMatch={activeMatch}\n          containsActiveMatch={isActiveMatchSpan && activeMatch.section === 'attributes' && activeMatch.key === key}\n        />\n      ))}\n    </div>\n  );\n}\n","import { useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { ModelTraceExplorerChatTool } from './ModelTraceExplorerChatTool';\nimport { ModelTraceExplorerConversation } from './ModelTraceExplorerConversation';\nimport type { ModelTraceChatMessage, ModelTraceChatTool } from '../ModelTrace.types';\nimport { ModelTraceExplorerCollapsibleSection } from '../ModelTraceExplorerCollapsibleSection';\n\nexport function ModelTraceExplorerChatTab({\n  chatMessages,\n  chatTools,\n}: {\n  chatMessages: ModelTraceChatMessage[];\n  chatTools?: ModelTraceChatTool[];\n}) {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div\n      css={{\n        overflowY: 'auto',\n        padding: theme.spacing.md,\n      }}\n      data-testid=\"model-trace-explorer-chat-tab\"\n    >\n      {chatTools && (\n        <ModelTraceExplorerCollapsibleSection\n          css={{ marginBottom: theme.spacing.sm }}\n          title={\n            <FormattedMessage\n              defaultMessage=\"Tools\"\n              description=\"Section header in the chat tab that displays all tools that were available for the chat model to call during execution\"\n            />\n          }\n          sectionKey=\"messages\"\n        >\n          <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n            {chatTools.map((tool) => (\n              <ModelTraceExplorerChatTool key={tool.function.name} tool={tool} />\n            ))}\n          </div>\n        </ModelTraceExplorerCollapsibleSection>\n      )}\n\n      <ModelTraceExplorerCollapsibleSection\n        title={\n          <FormattedMessage\n            defaultMessage=\"Messages\"\n            description=\"Section header in the chat tab that displays the message history between the user and the chat model\"\n          />\n        }\n        sectionKey=\"messages\"\n      >\n        <ModelTraceExplorerConversation messages={chatMessages} />\n      </ModelTraceExplorerCollapsibleSection>\n    </div>\n  );\n}\n","import { isNil } from 'lodash';\nimport { useMemo } from 'react';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport type { ModelTraceSpanNode, SearchMatch } from '../ModelTrace.types';\nimport { createListFromObject } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerCodeSnippet } from '../ModelTraceExplorerCodeSnippet';\nimport { ModelTraceExplorerCollapsibleSection } from '../ModelTraceExplorerCollapsibleSection';\n\nexport function ModelTraceExplorerDefaultSpanView({\n  activeSpan,\n  className,\n  searchFilter,\n  activeMatch,\n}: {\n  activeSpan: ModelTraceSpanNode | undefined;\n  className?: string;\n  searchFilter: string;\n  activeMatch: SearchMatch | null;\n}) {\n  const { theme } = useDesignSystemTheme();\n  const inputList = useMemo(() => createListFromObject(activeSpan?.inputs), [activeSpan]);\n  const outputList = useMemo(() => createListFromObject(activeSpan?.outputs), [activeSpan]);\n\n  if (isNil(activeSpan)) {\n    return null;\n  }\n\n  const containsInputs = inputList.length > 0;\n  const containsOutputs = outputList.length > 0;\n\n  const isActiveMatchSpan = !isNil(activeMatch) && activeMatch.span.key === activeSpan.key;\n\n  return (\n    <div data-testid=\"model-trace-explorer-default-span-view\">\n      {containsInputs && (\n        <ModelTraceExplorerCollapsibleSection\n          withBorder\n          css={{ marginBottom: theme.spacing.sm }}\n          sectionKey=\"input\"\n          title={\n            <div\n              css={{\n                display: 'flex',\n                flexDirection: 'row',\n                alignItems: 'center',\n                justifyContent: 'space-between',\n                width: '100%',\n              }}\n            >\n              <FormattedMessage\n                defaultMessage=\"Inputs\"\n                description=\"Model trace explorer > selected span > inputs header\"\n              />\n            </div>\n          }\n        >\n          <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n            {inputList.map(({ key, value }, index) => (\n              <ModelTraceExplorerCodeSnippet\n                key={key || index}\n                title={key}\n                data={value}\n                searchFilter={searchFilter}\n                activeMatch={activeMatch}\n                containsActiveMatch={isActiveMatchSpan && activeMatch.section === 'inputs' && activeMatch.key === key}\n              />\n            ))}\n          </div>\n        </ModelTraceExplorerCollapsibleSection>\n      )}\n      {containsOutputs && (\n        <ModelTraceExplorerCollapsibleSection\n          withBorder\n          sectionKey=\"output\"\n          title={\n            <div css={{ display: 'flex', flexDirection: 'row', justifyContent: 'space-between', width: '100%' }}>\n              <FormattedMessage\n                defaultMessage=\"Outputs\"\n                description=\"Model trace explorer > selected span > outputs header\"\n              />\n            </div>\n          }\n        >\n          <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n            {outputList.map(({ key, value }) => (\n              <ModelTraceExplorerCodeSnippet\n                key={key}\n                title={key}\n                data={value}\n                searchFilter={searchFilter}\n                activeMatch={activeMatch}\n                containsActiveMatch={isActiveMatchSpan && activeMatch.section === 'outputs' && activeMatch.key === key}\n              />\n            ))}\n          </div>\n        </ModelTraceExplorerCollapsibleSection>\n      )}\n    </div>\n  );\n}\n","import {\n  MIcon,\n  SegmentedControlButton,\n  SegmentedControlGroup,\n  TextBoxIcon,\n  Tooltip,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nexport function ModelTraceExplorerRenderModeToggle({\n  shouldRenderMarkdown,\n  setShouldRenderMarkdown,\n}: {\n  shouldRenderMarkdown: boolean;\n  setShouldRenderMarkdown: (value: boolean) => void;\n}) {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <SegmentedControlGroup\n      data-testid=\"model-trace-explorer-render-mode-toggle\"\n      name=\"render-mode\"\n      size=\"small\"\n      componentId={`shared.model-trace-explorer.toggle-markdown-rendering-${!shouldRenderMarkdown}`}\n      value={shouldRenderMarkdown}\n      onChange={(event) => {\n        setShouldRenderMarkdown(event.target.value);\n      }}\n    >\n      <SegmentedControlButton data-testid=\"model-trace-explorer-render-raw-input-button\" value={false}>\n        <Tooltip\n          componentId=\"shared.model-trace-explorer.raw-input-rendering-tooltip\"\n          content={\n            <FormattedMessage\n              defaultMessage=\"Raw input\"\n              description=\"Tooltip content for a button that changes the render mode of the data to raw input (JSON)\"\n            />\n          }\n        >\n          <div css={{ display: 'flex', alignItems: 'center' }}>\n            <TextBoxIcon css={{ fontSize: theme.typography.fontSizeLg }} />\n          </div>\n        </Tooltip>\n      </SegmentedControlButton>\n      <SegmentedControlButton data-testid=\"model-trace-explorer-render-default-button\" value>\n        <Tooltip\n          componentId=\"shared.model-trace-explorer.default-rendering-tooltip\"\n          content={\n            <FormattedMessage\n              defaultMessage=\"Default rendering\"\n              description=\"Tooltip content for a button that changes the render mode to default\"\n            />\n          }\n        >\n          <div css={{ display: 'flex', alignItems: 'center' }}>\n            <MIcon css={{ fontSize: theme.typography.fontSizeLg }} />\n          </div>\n        </Tooltip>\n      </SegmentedControlButton>\n    </SegmentedControlGroup>\n  );\n}\n","import { isNil } from 'lodash';\nimport { useMemo, useState } from 'react';\n\nimport { Tag, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { ModelTraceExplorerRetrieverDocument } from './ModelTraceExplorerRetrieverDocument';\nimport type { ModelTraceSpanNode, RetrieverDocument, SearchMatch } from '../ModelTrace.types';\nimport { createListFromObject } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerCodeSnippet } from '../ModelTraceExplorerCodeSnippet';\nimport { ModelTraceExplorerCollapsibleSection } from '../ModelTraceExplorerCollapsibleSection';\nimport { ModelTraceExplorerRenderModeToggle } from '../ModelTraceExplorerRenderModeToggle';\n\nexport function ModelTraceExplorerRetrieverSpanView({\n  activeSpan,\n  className,\n  searchFilter,\n  activeMatch,\n}: {\n  activeSpan: ModelTraceSpanNode;\n  className?: string;\n  searchFilter: string;\n  activeMatch: SearchMatch | null;\n}) {\n  const { theme } = useDesignSystemTheme();\n  const [shouldRenderMarkdown, setShouldRenderMarkdown] = useState(true);\n  const inputList = useMemo(() => createListFromObject(activeSpan.inputs), [activeSpan]);\n\n  const outputs = activeSpan.outputs as RetrieverDocument[];\n\n  const containsInputs = inputList.length > 0;\n\n  // search highlighting is not supported in markdown rendering, so\n  // if there is an active match in the documents, we have to render\n  // them as code snippets.\n  const isActiveMatchSpan = !isNil(activeMatch) && activeMatch.span.key === activeSpan.key;\n  const outputsContainsActiveMatch = isActiveMatchSpan && activeMatch.section === 'outputs';\n\n  return (\n    <div className={className} data-testid=\"model-trace-explorer-retriever-span-view\">\n      {containsInputs && (\n        <ModelTraceExplorerCollapsibleSection\n          sectionKey=\"input\"\n          css={{ marginBottom: theme.spacing.sm }}\n          title={\n            <FormattedMessage\n              defaultMessage=\"Inputs\"\n              description=\"Model trace explorer > selected span > inputs header\"\n            />\n          }\n        >\n          <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n            {inputList.map(({ key, value }, index) => (\n              <ModelTraceExplorerCodeSnippet\n                key={key || index}\n                title={key}\n                data={value}\n                searchFilter={searchFilter}\n                activeMatch={activeMatch}\n                containsActiveMatch={isActiveMatchSpan && activeMatch.section === 'inputs' && activeMatch.key === key}\n              />\n            ))}\n          </div>\n        </ModelTraceExplorerCollapsibleSection>\n      )}\n\n      <ModelTraceExplorerCollapsibleSection\n        sectionKey=\"output\"\n        title={\n          <div\n            css={{\n              display: 'flex',\n              flexDirection: 'row',\n              alignItems: 'center',\n              justifyContent: 'space-between',\n              width: '100%',\n            }}\n          >\n            <div css={{ display: 'flex', flexDirection: 'row', gap: theme.spacing.sm }}>\n              <FormattedMessage\n                defaultMessage=\"Documents\"\n                description=\"Model trace explorer > retriever span > documents header\"\n              />\n              <Tag componentId=\"shared.model-trace-explorer.document-count\">{outputs.length}</Tag>\n            </div>\n            {!outputsContainsActiveMatch && (\n              <ModelTraceExplorerRenderModeToggle\n                shouldRenderMarkdown={shouldRenderMarkdown}\n                setShouldRenderMarkdown={setShouldRenderMarkdown}\n              />\n            )}\n          </div>\n        }\n      >\n        {shouldRenderMarkdown && !outputsContainsActiveMatch ? (\n          <div\n            css={{\n              border: `1px solid ${theme.colors.border}`,\n              borderRadius: theme.legacyBorders.borderRadiusMd,\n            }}\n          >\n            {outputs.map((document, idx) => (\n              <div\n                key={idx}\n                css={{ borderBottom: idx !== outputs.length - 1 ? `1px solid ${theme.colors.border}` : '' }}\n              >\n                <ModelTraceExplorerRetrieverDocument\n                  key={idx}\n                  text={document.page_content}\n                  metadata={document.metadata}\n                />\n              </div>\n            ))}\n          </div>\n        ) : (\n          <div\n            css={{\n              border: `1px solid ${theme.colors.border}`,\n              borderRadius: theme.legacyBorders.borderRadiusMd,\n              padding: theme.spacing.md,\n            }}\n          >\n            <ModelTraceExplorerCodeSnippet\n              title=\"\"\n              data={JSON.stringify(outputs, null, 2)}\n              searchFilter={searchFilter}\n              activeMatch={activeMatch}\n              containsActiveMatch={isActiveMatchSpan && activeMatch.section === 'outputs'}\n            />\n          </div>\n        )}\n      </ModelTraceExplorerCollapsibleSection>\n    </div>\n  );\n}\n","import { isNil } from 'lodash';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nimport { ModelTraceExplorerDefaultSpanView } from './ModelTraceExplorerDefaultSpanView';\nimport { ModelTraceExplorerRetrieverSpanView } from './ModelTraceExplorerRetrieverSpanView';\nimport type { ModelTraceSpanNode, SearchMatch } from '../ModelTrace.types';\nimport { isRenderableRetrieverSpan } from '../ModelTraceExplorer.utils';\n\nexport function ModelTraceExplorerContentTab({\n  activeSpan,\n  className,\n  searchFilter,\n  activeMatch,\n}: {\n  activeSpan: ModelTraceSpanNode | undefined;\n  className?: string;\n  searchFilter: string;\n  activeMatch: SearchMatch | null;\n}) {\n  const { theme } = useDesignSystemTheme();\n\n  if (!isNil(activeSpan) && isRenderableRetrieverSpan(activeSpan)) {\n    return (\n      <div\n        css={{\n          overflowY: 'auto',\n          padding: theme.spacing.md,\n        }}\n        className={className}\n        data-testid=\"model-trace-explorer-content-tab\"\n      >\n        <ModelTraceExplorerRetrieverSpanView\n          activeSpan={activeSpan}\n          className={className}\n          searchFilter={searchFilter}\n          activeMatch={activeMatch}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      css={{\n        overflowY: 'auto',\n        padding: theme.spacing.md,\n      }}\n      className={className}\n      data-testid=\"model-trace-explorer-content-tab\"\n    >\n      <ModelTraceExplorerDefaultSpanView\n        activeSpan={activeSpan}\n        className={className}\n        searchFilter={searchFilter}\n        activeMatch={activeMatch}\n      />\n    </div>\n  );\n}\n","import { isNil } from 'lodash';\n\nimport { Empty, Typography, useDesignSystemTheme, XCircleIcon } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { CodeSnippetRenderMode, type ModelTraceSpanNode, type SearchMatch } from '../ModelTrace.types';\nimport { getEventAttributeKey } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerCodeSnippet } from '../ModelTraceExplorerCodeSnippet';\nimport { ModelTraceExplorerCollapsibleSection } from '../ModelTraceExplorerCollapsibleSection';\n\nexport function ModelTraceExplorerEventsTab({\n  activeSpan,\n  searchFilter,\n  activeMatch,\n}: {\n  activeSpan: ModelTraceSpanNode;\n  searchFilter: string;\n  activeMatch: SearchMatch | null;\n}) {\n  const { theme } = useDesignSystemTheme();\n  const { events } = activeSpan;\n  const isActiveMatchSpan = !isNil(activeMatch) && activeMatch.span.key === activeSpan.key;\n\n  if (!Array.isArray(events) || events.length === 0) {\n    return (\n      <div css={{ marginTop: theme.spacing.md }}>\n        <Empty\n          description={\n            <FormattedMessage\n              defaultMessage=\"No events found\"\n              description=\"Empty state for the events tab in the model trace explorer. Events are logs of arbitrary things (e.g. exceptions) that occur during the execution of a span, and can be user-defined.\"\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div css={{ padding: theme.spacing.md }}>\n      {events.map((event, index) => {\n        const attributes = event.attributes;\n        const title =\n          event.name === 'exception' ? (\n            <>\n              <XCircleIcon css={{ marginRight: theme.spacing.sm }} color=\"danger\" />\n              <Typography.Text color=\"error\" bold>\n                Exception\n              </Typography.Text>\n            </>\n          ) : (\n            event.name\n          );\n\n        if (!attributes) return null;\n\n        return (\n          <ModelTraceExplorerCollapsibleSection\n            key={`${event.name}-${index}`}\n            sectionKey={event.name}\n            title={title}\n            withBorder\n          >\n            <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n              {Object.keys(attributes).map((attribute) => {\n                const key = getEventAttributeKey(event.name, index, attribute);\n\n                return (\n                  <ModelTraceExplorerCodeSnippet\n                    key={key}\n                    title={attribute}\n                    data={JSON.stringify(attributes[attribute], null, 2)}\n                    searchFilter={searchFilter}\n                    activeMatch={activeMatch}\n                    containsActiveMatch={\n                      isActiveMatchSpan && activeMatch.section === 'events' && activeMatch.key === key\n                    }\n                    initialRenderMode={CodeSnippetRenderMode.TEXT}\n                  />\n                );\n              })}\n            </div>\n          </ModelTraceExplorerCollapsibleSection>\n        );\n      })}\n    </div>\n  );\n}\n","import { useDesignSystemTheme } from '@databricks/design-system';\n\nexport function ModelTraceExplorerBadge({ count }: { count: number }) {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        borderRadius: theme.typography.fontSizeBase,\n        height: theme.typography.fontSizeBase,\n        backgroundColor: theme.colors.actionDangerPrimaryBackgroundDefault,\n        padding: theme.spacing.xs,\n        marginLeft: theme.spacing.xs,\n        boxSizing: 'border-box',\n      }}\n    >\n      <span css={{ color: theme.colors.actionPrimaryTextDefault, fontSize: 11 }}>{count}</span>\n    </div>\n  );\n}\n","import type { Interpolation, Theme } from '@emotion/react';\nimport { isNil } from 'lodash';\nimport React, { useState } from 'react';\n\nimport { Empty, Tabs, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { ModelTraceExplorerAttributesTab } from './ModelTraceExplorerAttributesTab';\nimport { ModelTraceExplorerChatTab } from './ModelTraceExplorerChatTab';\nimport { ModelTraceExplorerContentTab } from './ModelTraceExplorerContentTab';\nimport { ModelTraceExplorerEventsTab } from './ModelTraceExplorerEventsTab';\nimport type { ModelTraceExplorerTab, ModelTraceSpanNode, SearchMatch } from '../ModelTrace.types';\nimport { getSpanExceptionCount } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerBadge } from '../ModelTraceExplorerBadge';\nimport ModelTraceExplorerResizablePane from '../ModelTraceExplorerResizablePane';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\nimport { AssessmentPaneToggle } from '../assessments-pane/AssessmentPaneToggle';\nimport { AssessmentsPane } from '../assessments-pane/AssessmentsPane';\nimport { ASSESSMENT_PANE_MIN_WIDTH } from '../assessments-pane/AssessmentsPane.utils';\n\nexport const CONTENT_PANE_MIN_WIDTH = 250;\n// used by the parent component to set min-width on the resizable box\nexport const RIGHT_PANE_MIN_WIDTH = CONTENT_PANE_MIN_WIDTH + ASSESSMENT_PANE_MIN_WIDTH;\nconst DEFAULT_SPLIT_RATIO = 0.7;\n\nfunction ModelTraceExplorerRightPaneTabsImpl({\n  activeSpan,\n  searchFilter,\n  activeMatch,\n  activeTab,\n  setActiveTab,\n}: {\n  activeSpan: ModelTraceSpanNode | undefined;\n  searchFilter: string;\n  activeMatch: SearchMatch | null;\n  activeTab: ModelTraceExplorerTab;\n  setActiveTab: (tab: ModelTraceExplorerTab) => void;\n}) {\n  const { theme } = useDesignSystemTheme();\n  const [paneWidth, setPaneWidth] = useState(500);\n  const contentStyle: Interpolation<Theme> = { flex: 1, marginTop: -theme.spacing.md, overflowY: 'auto' };\n  const { assessmentsPaneExpanded, assessmentsPaneEnabled } = useModelTraceExplorerViewState();\n\n  if (isNil(activeSpan)) {\n    return <Empty description=\"Please select a span to view more information\" />;\n  }\n\n  const exceptionCount = getSpanExceptionCount(activeSpan);\n  const hasException = exceptionCount > 0;\n  const tabContent = (\n    <Tabs.Root\n      componentId=\"shared.model-trace-explorer.right-pane-tabs\"\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        flex: 1,\n        borderLeft: `1px solid ${theme.colors.border}`,\n        minWidth: 200,\n        position: 'relative',\n      }}\n      value={activeTab}\n      onValueChange={(tab: string) => setActiveTab(tab as ModelTraceExplorerTab)}\n    >\n      <div\n        css={{\n          position: 'absolute',\n          right: assessmentsPaneExpanded ? theme.spacing.xs : theme.spacing.md,\n          top: theme.spacing.xs,\n        }}\n      >\n        <AssessmentPaneToggle />\n      </div>\n      <Tabs.List\n        css={{\n          padding: 0,\n          paddingLeft: theme.spacing.md,\n          paddingRight: theme.spacing.sm,\n          boxSizing: 'border-box',\n          width: '100%',\n        }}\n      >\n        {activeSpan.chatMessages && (\n          <Tabs.Trigger value=\"chat\">\n            <FormattedMessage defaultMessage=\"Chat\" description=\"Label for the chat tab of the model trace explorer.\" />\n          </Tabs.Trigger>\n        )}\n        <Tabs.Trigger value=\"content\">\n          <FormattedMessage\n            defaultMessage=\"Inputs / Outputs\"\n            description=\"Label for the inputs and outputs tab of the model trace explorer.\"\n          />\n        </Tabs.Trigger>\n        {/* no i18n for attributes and events as these are properties specified by code,\n            and it might be confusing for users to have different labels here */}\n        <Tabs.Trigger value=\"attributes\">Attributes</Tabs.Trigger>\n        <Tabs.Trigger value=\"events\">\n          Events {hasException && <ModelTraceExplorerBadge count={exceptionCount} />}\n        </Tabs.Trigger>\n      </Tabs.List>\n      {activeSpan.chatMessages && (\n        <Tabs.Content css={contentStyle} value=\"chat\">\n          <ModelTraceExplorerChatTab chatMessages={activeSpan.chatMessages} chatTools={activeSpan.chatTools} />\n        </Tabs.Content>\n      )}\n      <Tabs.Content css={contentStyle} value=\"content\">\n        <ModelTraceExplorerContentTab activeSpan={activeSpan} searchFilter={searchFilter} activeMatch={activeMatch} />\n      </Tabs.Content>\n      <Tabs.Content css={contentStyle} value=\"attributes\">\n        <ModelTraceExplorerAttributesTab\n          activeSpan={activeSpan}\n          searchFilter={searchFilter}\n          activeMatch={activeMatch}\n        />\n      </Tabs.Content>\n      <Tabs.Content css={contentStyle} value=\"events\">\n        <ModelTraceExplorerEventsTab activeSpan={activeSpan} searchFilter={searchFilter} activeMatch={activeMatch} />\n      </Tabs.Content>\n    </Tabs.Root>\n  );\n\n  return assessmentsPaneEnabled && assessmentsPaneExpanded ? (\n    <ModelTraceExplorerResizablePane\n      initialRatio={DEFAULT_SPLIT_RATIO}\n      paneWidth={paneWidth}\n      setPaneWidth={setPaneWidth}\n      leftChild={tabContent}\n      leftMinWidth={CONTENT_PANE_MIN_WIDTH}\n      rightChild={\n        <AssessmentsPane\n          assessments={activeSpan.assessments}\n          traceId={activeSpan.traceId}\n          activeSpanId={activeSpan.parentId ? String(activeSpan.key) : undefined}\n        />\n      }\n      rightMinWidth={ASSESSMENT_PANE_MIN_WIDTH}\n    />\n  ) : (\n    tabContent\n  );\n}\n\nexport const ModelTraceExplorerRightPaneTabs = React.memo(ModelTraceExplorerRightPaneTabsImpl);\n","import {\n  Button,\n  Checkbox,\n  FilterIcon,\n  InfoTooltip,\n  Popover,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport type { SpanFilterState } from '../ModelTrace.types';\nimport { getDisplayNameForSpanType, getIconTypeForSpan } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerIcon } from '../ModelTraceExplorerIcon';\n\nexport const TimelineTreeFilterButton = ({\n  spanFilterState,\n  setSpanFilterState,\n}: {\n  spanFilterState: SpanFilterState;\n  setSpanFilterState: (state: SpanFilterState) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <Popover.Root componentId=\"shared.model-trace-explorer.timeline-tree-filter-popover\">\n      <Popover.Trigger asChild>\n        <Button\n          componentId=\"shared.model-trace-explorer.timeline-tree-filter-button\"\n          icon={<FilterIcon />}\n          size=\"small\"\n        >\n          <FormattedMessage defaultMessage=\"Filter\" description=\"Label for the filter button in the trace explorer.\" />\n        </Button>\n      </Popover.Trigger>\n      <Popover.Content align=\"start\">\n        <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm, paddingBottom: theme.spacing.xs }}>\n          <Typography.Text bold>\n            <FormattedMessage\n              defaultMessage=\"Filter\"\n              description=\"Label for the span filters popover in the trace explorer.\"\n            />\n          </Typography.Text>\n          <Typography.Text color=\"secondary\">\n            <FormattedMessage\n              defaultMessage=\"Span type\"\n              description=\"Section label for span type filters in the trace explorer.\"\n            />\n          </Typography.Text>\n          {Object.entries(spanFilterState.spanTypeDisplayState).map(([spanType, shouldDisplay]) => {\n            const icon = <ModelTraceExplorerIcon type={getIconTypeForSpan(spanType)} />;\n            return (\n              <Checkbox\n                key={spanType}\n                componentId={`shared.model-trace-explorer.toggle-span-filter_${spanType}-${!shouldDisplay}`}\n                style={{ width: '100%' }}\n                isChecked={shouldDisplay}\n                onChange={() =>\n                  setSpanFilterState({\n                    ...spanFilterState,\n                    spanTypeDisplayState: {\n                      ...spanFilterState.spanTypeDisplayState,\n                      [spanType]: !shouldDisplay,\n                    },\n                  })\n                }\n              >\n                {icon}\n                <Typography.Text css={{ marginLeft: theme.spacing.xs }}>\n                  {getDisplayNameForSpanType(spanType)}\n                </Typography.Text>\n              </Checkbox>\n            );\n          })}\n          <Typography.Text color=\"secondary\">\n            <FormattedMessage\n              defaultMessage=\"Settings\"\n              description=\"Section label for filter settings in the trace explorer.\"\n            />\n          </Typography.Text>\n          <Checkbox\n            componentId={`shared.model-trace-explorer.toggle-show-parents_${!spanFilterState.showParents}`}\n            style={{ width: '100%' }}\n            isChecked={spanFilterState.showParents}\n            onChange={() =>\n              setSpanFilterState({\n                ...spanFilterState,\n                showParents: !spanFilterState.showParents,\n              })\n            }\n          >\n            <Typography.Text css={{ marginRight: theme.spacing.xs }}>\n              <FormattedMessage\n                defaultMessage=\"Show all parent spans\"\n                description=\"Checkbox label for a setting that enables showing all parent spans in the trace explorer regardless of filter conditions.\"\n              />\n            </Typography.Text>\n            <InfoTooltip\n              componentId=\"shared.model-trace-explorer.show-parents-tooltip\"\n              content={\n                <FormattedMessage\n                  defaultMessage=\"Always show parents of matched spans, regardless of filter conditions\"\n                  description=\"Tooltip for a span filter setting that enables showing parents of matched spans\"\n                />\n              }\n            />\n          </Checkbox>\n          <Checkbox\n            componentId={`shared.model-trace-explorer.toggle-show-parents_${!spanFilterState.showExceptions}`}\n            style={{ width: '100%' }}\n            isChecked={spanFilterState.showExceptions}\n            onChange={() =>\n              setSpanFilterState({\n                ...spanFilterState,\n                showExceptions: !spanFilterState.showExceptions,\n              })\n            }\n          >\n            <Typography.Text css={{ marginRight: theme.spacing.xs }}>\n              <FormattedMessage\n                defaultMessage=\"Show exceptions\"\n                description=\"Checkbox label for a setting that enables showing spans with exceptions in the trace explorer regardless of filter conditions.\"\n              />\n            </Typography.Text>\n            <InfoTooltip\n              componentId=\"shared.model-trace-explorer.show-exceptions-tooltip\"\n              content={\n                <FormattedMessage\n                  defaultMessage=\"Always show spans with exceptions, regardless of filter conditions\"\n                  description=\"Tooltip for a span filter setting that enables showing spans with exceptions\"\n                />\n              }\n            />\n          </Checkbox>\n        </div>\n      </Popover.Content>\n    </Popover.Root>\n  );\n};\n","import {\n  BarsAscendingVerticalIcon,\n  ListBorderIcon,\n  SegmentedControlButton,\n  SegmentedControlGroup,\n  Tooltip,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { TimelineTreeFilterButton } from './TimelineTreeFilterButton';\nimport type { SpanFilterState } from '../ModelTrace.types';\n\nexport const TimelineTreeHeader = ({\n  showTimelineInfo,\n  setShowTimelineInfo,\n  spanFilterState,\n  setSpanFilterState,\n}: {\n  showTimelineInfo: boolean;\n  setShowTimelineInfo: (showTimelineInfo: boolean) => void;\n  spanFilterState: SpanFilterState;\n  setSpanFilterState: (state: SpanFilterState) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <div\n      css={{\n        padding: `${theme.spacing.xs}px ${theme.spacing.sm}px`,\n        paddingBottom: 3,\n        borderBottom: `1px solid ${theme.colors.border}`,\n        boxSizing: 'border-box',\n        paddingLeft: theme.spacing.sm,\n        alignItems: 'center',\n        display: 'flex',\n        justifyContent: 'space-between',\n      }}\n    >\n      <Typography.Text bold>\n        <FormattedMessage\n          defaultMessage=\"Trace breakdown\"\n          description=\"Header for the span tree within the MLflow trace UI\"\n        />\n      </Typography.Text>\n      <div css={{ display: 'flex', flexDirection: 'row', gap: theme.spacing.sm }}>\n        <TimelineTreeFilterButton spanFilterState={spanFilterState} setSpanFilterState={setSpanFilterState} />\n        <SegmentedControlGroup\n          name=\"size-story\"\n          value={showTimelineInfo}\n          onChange={(event) => {\n            setShowTimelineInfo(event.target.value);\n          }}\n          size=\"small\"\n          componentId=\"shared.model-trace-explorer.toggle-show-timeline\"\n        >\n          <SegmentedControlButton\n            data-testid=\"hide-timeline-info-button\"\n            icon={\n              <Tooltip\n                componentId=\"shared.model-trace-explorer.hide-timeline-info-tooltip\"\n                content={\n                  <FormattedMessage\n                    defaultMessage=\"Show span tree\"\n                    description=\"Tooltip for a button that show the span tree view of the trace UI.\"\n                  />\n                }\n              >\n                <ListBorderIcon />\n              </Tooltip>\n            }\n            value={false}\n          />\n          <SegmentedControlButton\n            data-testid=\"show-timeline-info-button\"\n            icon={\n              <Tooltip\n                componentId=\"shared.model-trace-explorer.show-timeline-info-tooltip\"\n                content={\n                  <FormattedMessage\n                    defaultMessage=\"Show execution timeline\"\n                    description=\"Tooltip for a button that shows execution timeline info in the trace UI.\"\n                  />\n                }\n              >\n                <BarsAscendingVerticalIcon />\n              </Tooltip>\n            }\n            value\n          />\n        </SegmentedControlGroup>\n      </div>\n    </div>\n  );\n};\n","import { useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { HierarchyBar } from './TimelineTree.types';\nimport { SPAN_INDENT_WIDTH, SPAN_ROW_HEIGHT, TimelineTreeZIndex } from './TimelineTree.utils';\n\nconst IconBottomConnector = ({ active }: { active: boolean }) => {\n  const { theme } = useDesignSystemTheme();\n  const borderColor = active ? theme.colors.blue500 : theme.colors.border;\n\n  return (\n    <div\n      css={{\n        position: 'absolute',\n        left: '100%',\n        bottom: 0,\n        // not sure why the +1 is necessary but\n        // there is a 1 pixel misalignment with the\n        // left connector otherwise\n        width: SPAN_INDENT_WIDTH / 2 + 1,\n        height: theme.spacing.md,\n        boxSizing: 'border-box',\n        borderTopRightRadius: theme.borders.borderRadiusMd,\n        borderTop: `1px solid ${borderColor}`,\n        borderRight: `1px solid ${borderColor}`,\n        zIndex: TimelineTreeZIndex.LOW, // render behind the span's icon\n      }}\n    />\n  );\n};\n\nconst IconLeftConnector = ({ active }: { active: boolean }) => {\n  const { theme } = useDesignSystemTheme();\n  const borderColor = active ? theme.colors.blue500 : theme.colors.border;\n\n  return (\n    <div\n      css={{\n        position: 'absolute',\n        left: '50%',\n        top: 0,\n        width: SPAN_INDENT_WIDTH / 2,\n        height: theme.spacing.md,\n        boxSizing: 'border-box',\n        borderBottomLeftRadius: theme.borders.borderRadiusMd,\n        borderBottom: `1px solid ${borderColor}`,\n        borderLeft: `1px solid ${borderColor}`,\n        zIndex: active ? TimelineTreeZIndex.NORMAL : TimelineTreeZIndex.LOW,\n      }}\n    />\n  );\n};\n\nconst VerticalConnector = ({ active }: { active: boolean }) => {\n  const { theme } = useDesignSystemTheme();\n  const borderColor = active ? theme.colors.blue500 : theme.colors.border;\n\n  return (\n    <div\n      css={{\n        position: 'absolute',\n        width: SPAN_INDENT_WIDTH / 2,\n        left: '50%',\n        height: SPAN_ROW_HEIGHT,\n        borderLeft: `1px solid ${borderColor}`,\n        boxSizing: 'border-box',\n        zIndex: active ? TimelineTreeZIndex.NORMAL : TimelineTreeZIndex.LOW,\n      }}\n    />\n  );\n};\n\n/**\n * This component renders the bars that represent the hierarchical\n * connections in the span tree.\n */\nexport const TimelineTreeHierarchyBars = ({\n  isActiveSpan,\n  isInActiveChain,\n  linesToRender,\n  hasChildren,\n  isExpanded,\n}: {\n  // whether or not the current span is active\n  isActiveSpan: boolean;\n  // true if the span is either active or a parent of the active span\n  isInActiveChain: boolean;\n  // an array of bars to render to the left of the span icon / name\n  linesToRender: Array<HierarchyBar>;\n  hasChildren: boolean;\n  isExpanded: boolean;\n}) => {\n  if (linesToRender.length === 0) {\n    return (\n      <div\n        css={{\n          width: 0,\n          height: SPAN_ROW_HEIGHT,\n          boxSizing: 'border-box',\n          position: 'relative',\n        }}\n      >\n        {hasChildren && <IconBottomConnector active={isInActiveChain && !isActiveSpan} />}\n      </div>\n    );\n  }\n\n  return (\n    <>\n      {linesToRender.map(({ shouldRender, isActive }, idx) => (\n        // for each depth level, render a spacer. depending on the span's\n        // position within the tree, the spacer might be empty or contain\n        // a vertical bar\n        <div\n          key={idx}\n          css={{\n            width: SPAN_INDENT_WIDTH,\n            height: SPAN_ROW_HEIGHT,\n            boxSizing: 'border-box',\n            position: 'relative',\n          }}\n        >\n          {shouldRender && (\n            // render a vertical bar in the middle of the spacer\n            <VerticalConnector active={isActive} />\n          )}\n          {idx === linesToRender.length - 1 && (\n            // at the last spacer, render a curved\n            // line that connects up to the parent\n            <>\n              <IconLeftConnector active={isInActiveChain} />\n              {hasChildren && isExpanded && <IconBottomConnector active={isInActiveChain && !isActiveSpan} />}\n            </>\n          )}\n        </div>\n      ))}\n    </>\n  );\n};\n","import React from 'react';\n\nimport { Tooltip, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { spanTimeFormatter } from './TimelineTree.utils';\nimport type { ModelTraceSpanNode } from '../ModelTrace.types';\nimport { ModelSpanType } from '../ModelTrace.types';\nimport { getIconTypeForSpan } from '../ModelTraceExplorer.utils';\nimport { ModelTraceExplorerIcon } from '../ModelTraceExplorerIcon';\n\nexport const TimelineTreeSpanTooltip = ({\n  span,\n  children,\n}: {\n  span: ModelTraceSpanNode;\n  children: React.ReactNode;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const iconType = getIconTypeForSpan(span.type ?? ModelSpanType.UNKNOWN);\n  const primaryTextColor = theme.isDarkMode ? theme.colors.grey800 : theme.colors.grey100;\n  const secondaryTextColor = theme.isDarkMode ? theme.colors.grey500 : theme.colors.grey350;\n\n  return (\n    <Tooltip\n      componentId=\"shared.model-trace-explorer.timeline-tree-node-tooltip\"\n      hideWhenDetached={false}\n      content={\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n          }}\n        >\n          <div\n            css={{\n              display: 'flex',\n              flexDirection: 'row',\n              gap: theme.spacing.xs,\n              alignItems: 'center',\n              overflow: 'hidden',\n              wordBreak: 'break-all',\n            }}\n          >\n            <ModelTraceExplorerIcon type={iconType} isInTooltip />\n            <span css={{ color: primaryTextColor }}>{span.title}</span>\n            <span\n              css={{ marginLeft: theme.spacing.xs, color: secondaryTextColor, fontSize: theme.typography.fontSizeSm }}\n            >\n              {spanTimeFormatter(span.end - span.start)}\n            </span>\n          </div>\n          <div css={{ display: 'flex', flexDirection: 'row', color: primaryTextColor }}>\n            <FormattedMessage defaultMessage=\"Start:\" description=\"Label for the start time of a span\" />{' '}\n            {spanTimeFormatter(span.start)}\n            {' | '}\n            <FormattedMessage defaultMessage=\"End:\" description=\"Label for the end time of a span\" />{' '}\n            {spanTimeFormatter(span.end)}\n          </div>\n        </div>\n      }\n      side=\"right\"\n      maxWidth={700}\n    >\n      {children}\n    </Tooltip>\n  );\n};\n","import {\n  Button,\n  Typography,\n  useDesignSystemTheme,\n  ChevronDownIcon,\n  ChevronRightIcon,\n  Tag,\n  GavelIcon,\n} from '@databricks/design-system';\n\nimport type { HierarchyBar } from './TimelineTree.types';\nimport { getActiveChildIndex, TimelineTreeZIndex } from './TimelineTree.utils';\nimport { TimelineTreeHierarchyBars } from './TimelineTreeHierarchyBars';\nimport { TimelineTreeSpanTooltip } from './TimelineTreeSpanTooltip';\nimport { type ModelTraceSpanNode } from '../ModelTrace.types';\nimport { getSpanExceptionCount } from '../ModelTraceExplorer.utils';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\n\nexport const TimelineTreeNode = ({\n  node,\n  selectedKey,\n  expandedKeys,\n  setExpandedKeys,\n  traceStartTime,\n  traceEndTime,\n  onSelect,\n  linesToRender,\n}: {\n  node: ModelTraceSpanNode;\n  selectedKey: string | number;\n  expandedKeys: Set<string | number>;\n  setExpandedKeys: (keys: Set<string | number>) => void;\n  traceStartTime: number;\n  traceEndTime: number;\n  onSelect: ((node: ModelTraceSpanNode) => void) | undefined;\n  // a boolean array that signifies whether or not a vertical\n  // connecting line is supposed to in at the `i`th spacer. see\n  // TimelineTreeHierarchyBars for more details.\n  linesToRender: Array<HierarchyBar>;\n}) => {\n  const expanded = expandedKeys.has(node.key);\n  const { theme } = useDesignSystemTheme();\n  const hasChildren = (node.children ?? []).length > 0;\n  const { setAssessmentsPaneExpanded } = useModelTraceExplorerViewState();\n\n  const isActive = selectedKey === node.key;\n  const activeChildIndex = getActiveChildIndex(node, String(selectedKey));\n  // true if a span has active children OR is the active span\n  const isInActiveChain = activeChildIndex > -1;\n\n  const hasException = getSpanExceptionCount(node) > 0;\n\n  const backgroundColor = isActive ? theme.colors.actionDefaultBackgroundHover : 'transparent';\n\n  return (\n    <>\n      <TimelineTreeSpanTooltip span={node}>\n        <div\n          data-testid={`timeline-tree-node-${node.key}`}\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            width: '100%',\n            cursor: 'pointer',\n            boxSizing: 'border-box',\n            backgroundColor,\n            ':hover': {\n              backgroundColor: theme.colors.actionDefaultBackgroundHover,\n            },\n            ':active': {\n              backgroundColor: theme.colors.actionDefaultBackgroundPress,\n            },\n          }}\n          onClick={() => {\n            onSelect?.(node);\n          }}\n        >\n          <div\n            css={{\n              display: 'flex',\n              flexDirection: 'row',\n              alignItems: 'center',\n              // add padding to root nodes, because they have no connecting lines\n              padding: `0px ${theme.spacing.sm}px`,\n              justifyContent: 'space-between',\n              overflow: 'hidden',\n              flex: 1,\n            }}\n          >\n            <div css={{ display: 'flex', flexDirection: 'row', alignItems: 'center', overflow: 'hidden', flex: 1 }}>\n              {hasChildren ? (\n                <Button\n                  size=\"small\"\n                  data-testid={`toggle-span-expanded-${node.key}`}\n                  css={{ flexShrink: 0, marginRight: theme.spacing.xs }}\n                  icon={expanded ? <ChevronDownIcon /> : <ChevronRightIcon />}\n                  onClick={(event) => {\n                    // prevent the node from being selected when the expand button is clicked\n                    event.stopPropagation();\n                    const newExpandedKeys = new Set(expandedKeys);\n                    if (expanded) {\n                      newExpandedKeys.delete(node.key);\n                    } else {\n                      newExpandedKeys.add(node.key);\n                    }\n                    setExpandedKeys(newExpandedKeys);\n                  }}\n                  componentId=\"shared.model-trace-explorer.toggle-span\"\n                />\n              ) : (\n                <div css={{ width: 24, marginRight: theme.spacing.xs }} />\n              )}\n              <TimelineTreeHierarchyBars\n                isActiveSpan={isActive}\n                isInActiveChain={isInActiveChain}\n                linesToRender={linesToRender}\n                hasChildren={hasChildren}\n                isExpanded={expanded}\n              />\n              <span\n                css={{\n                  flexShrink: 0,\n                  marginRight: theme.spacing.xs,\n                  borderRadius: theme.borders.borderRadiusSm,\n                  border: `1px solid ${\n                    activeChildIndex > -1 ? theme.colors.blue500 : theme.colors.backgroundSecondary\n                  }`,\n                  zIndex: TimelineTreeZIndex.NORMAL,\n                }}\n              >\n                {node.icon}\n              </span>\n              <Typography.Text\n                color={hasException ? 'error' : 'primary'}\n                css={{\n                  overflow: 'hidden',\n                  whiteSpace: 'nowrap',\n                  textOverflow: 'ellipsis',\n                  flex: 1,\n                }}\n              >\n                {node.title}\n              </Typography.Text>\n              {node.assessments.length > 0 && (\n                <Tag\n                  color=\"indigo\"\n                  data-testid={`assessment-tag-${node.key}`}\n                  componentId=\"shared.model-trace-explorer.assessment-count\"\n                  css={{\n                    margin: 0,\n                    borderRadius: theme.borders.borderRadiusSm,\n                  }}\n                  onClick={() => setAssessmentsPaneExpanded?.(true)}\n                >\n                  <GavelIcon />\n                  <Typography.Text css={{ marginLeft: theme.spacing.xs }}>{node.assessments.length}</Typography.Text>\n                </Tag>\n              )}\n            </div>\n          </div>\n        </div>\n      </TimelineTreeSpanTooltip>\n      {expanded &&\n        node.children?.map((child, idx) => (\n          <TimelineTreeNode\n            key={child.key}\n            node={child}\n            expandedKeys={expandedKeys}\n            setExpandedKeys={setExpandedKeys}\n            selectedKey={selectedKey}\n            traceStartTime={traceStartTime}\n            traceEndTime={traceEndTime}\n            onSelect={onSelect}\n            linesToRender={linesToRender.concat({\n              // render the connecting line at this depth\n              // if there are more children to render\n              shouldRender: idx < (node.children?.length ?? 0) - 1,\n              // make the vertical line blue if the active span\n              // is below this child\n              isActive: idx < activeChildIndex,\n            })}\n          />\n        ))}\n    </>\n  );\n};\n","import { useLayoutEffect, useRef } from 'react';\n\nimport { useDesignSystemTheme, Typography, Button, ChevronDownIcon, ChevronRightIcon } from '@databricks/design-system';\n\nimport type { ModelTraceSpanNode } from '../../ModelTrace.types';\nimport { spanTimeFormatter, TimelineTreeZIndex } from '../TimelineTree.utils';\nimport { TimelineTreeSpanTooltip } from '../TimelineTreeSpanTooltip';\n\nexport const TimelineTreeGanttNode = ({\n  node,\n  selectedKey,\n  leftOffset,\n  width,\n  onSelect,\n  expandedKeys,\n  setExpandedKeys,\n}: {\n  node: ModelTraceSpanNode;\n  selectedKey: string | number;\n  leftOffset: number;\n  width: number;\n  onSelect: ((node: ModelTraceSpanNode) => void) | undefined;\n  expandedKeys: Set<string | number>;\n  setExpandedKeys: (keys: Set<string | number>) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const titleInBarRef = useRef<HTMLSpanElement>(null);\n  const titleBesideBarRef = useRef<HTMLSpanElement>(null);\n  const isActive = selectedKey === node.key;\n  const backgroundColor = isActive ? theme.colors.actionDefaultBackgroundHover : 'transparent';\n  const hasChildren = (node.children ?? []).length > 0;\n  const expanded = expandedKeys.has(node.key);\n\n  useLayoutEffect(() => {\n    if (!titleInBarRef.current || !titleBesideBarRef.current) {\n      return;\n    }\n\n    const spanWidth = Math.max(titleInBarRef.current.offsetWidth, titleBesideBarRef.current.offsetWidth);\n\n    if (spanWidth < width - theme.spacing.sm) {\n      titleInBarRef.current.style.display = 'inline';\n      titleBesideBarRef.current.style.display = 'none';\n    } else {\n      titleInBarRef.current.style.display = 'none';\n      titleBesideBarRef.current.style.display = 'inline';\n    }\n  }, [theme.spacing.sm, width]);\n\n  return (\n    <TimelineTreeSpanTooltip span={node}>\n      <div\n        key={node.key}\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          cursor: 'pointer',\n          boxSizing: 'border-box',\n          paddingLeft: theme.spacing.xs,\n          paddingRight: theme.spacing.sm,\n          paddingTop: theme.spacing.xs,\n          paddingBottom: theme.spacing.xs,\n          backgroundColor: backgroundColor,\n          alignItems: 'center',\n          ':hover': {\n            backgroundColor: theme.colors.actionDefaultBackgroundHover,\n          },\n          ':active': {\n            backgroundColor: theme.colors.actionDefaultBackgroundPress,\n          },\n          zIndex: TimelineTreeZIndex.NORMAL,\n        }}\n        onClick={() => onSelect?.(node)}\n      >\n        {hasChildren ? (\n          <Button\n            size=\"small\"\n            data-testid={`toggle-timeline-span-expanded-${node.key}`}\n            css={{ flexShrink: 0, marginRight: theme.spacing.xs }}\n            icon={expanded ? <ChevronDownIcon /> : <ChevronRightIcon />}\n            onClick={(event) => {\n              // prevent the node from being selected when the expand button is clicked\n              event.stopPropagation();\n              const newExpandedKeys = new Set(expandedKeys);\n              if (expanded) {\n                newExpandedKeys.delete(node.key);\n              } else {\n                newExpandedKeys.add(node.key);\n              }\n              setExpandedKeys(newExpandedKeys);\n            }}\n            componentId=\"shared.model-trace-explorer.toggle-timeline-span\"\n          />\n        ) : (\n          <div css={{ width: 24, marginRight: theme.spacing.xs }} />\n        )}\n        <div css={{ width: leftOffset, flexShrink: 0 }} />\n        <div\n          css={{\n            position: 'relative',\n            width,\n            height: theme.typography.lineHeightBase,\n            backgroundColor: theme.colors.blue600,\n            borderRadius: theme.borders.borderRadiusSm,\n            flexShrink: 0,\n          }}\n        >\n          <Typography.Text>\n            <span\n              ref={titleInBarRef}\n              css={{\n                marginLeft: theme.spacing.xs,\n                color: theme.colors.white,\n                display: 'none',\n              }}\n            >\n              {node.title}\n            </span>\n          </Typography.Text>\n        </div>\n        <div css={{ flex: 1, overflow: 'hidden', whiteSpace: 'nowrap', textOverflow: 'ellipsis' }}>\n          <Typography.Text>\n            <span\n              ref={titleBesideBarRef}\n              css={{\n                marginLeft: theme.spacing.xs,\n                color: theme.colors.textPrimary,\n              }}\n            >\n              {node.title}\n            </span>\n          </Typography.Text>\n          <Typography.Text css={{ marginLeft: theme.spacing.xs }} color=\"secondary\">\n            {spanTimeFormatter(node.end - node.start)}\n          </Typography.Text>\n        </div>\n      </div>\n    </TimelineTreeSpanTooltip>\n  );\n};\n","import { useMemo, useRef } from 'react';\n\nimport { Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { useResizeObserver } from '@databricks/web-shared/hooks';\n\nimport { TimelineTreeGanttNode } from './TimelineTreeGanttNode';\nimport type { ModelTraceSpanNode } from '../../ModelTrace.types';\nimport { spanTimeFormatter, TimelineTreeZIndex } from '../TimelineTree.utils';\n\n// the amount of space required to accomodate the collapse buttons\nconst TIMELINE_BAR_LEFT_OFFSET = 32;\n\n// this function generates an array of \"nice\" x-ticks (e.g. nearest 0.1, 0.2, 0.5 to the value)\nfunction getNiceXTicks(left: number, right: number, graphWidth: number, minPixelsBetweenTicks = 60): number[] {\n  const range = right - left;\n  if (range <= 0 || graphWidth <= 0) return [];\n\n  const maxTickCount = Math.floor(graphWidth / minPixelsBetweenTicks);\n  if (maxTickCount < 1) return [];\n\n  // Step 1: raw interval\n  const rawInterval = range / maxTickCount;\n\n  // Step 2: round to a \"nice\" interval\n  const magnitude = Math.pow(10, Math.floor(Math.log10(rawInterval)));\n  const residual = rawInterval / magnitude;\n\n  let niceFraction;\n  if (residual <= 1) niceFraction = 1;\n  else if (residual <= 2) niceFraction = 2;\n  else if (residual <= 5) niceFraction = 5;\n  else niceFraction = 10;\n\n  const niceInterval = niceFraction * magnitude;\n\n  // Step 3: extend right bound so we always overshoot it\n  // this guarantees that there will be enough space to\n  // render the span labels.\n  const extendedRight = right + 2 * niceInterval;\n\n  // Step 4: Generate tick positions\n  const firstTick = Math.ceil(left / niceInterval) * niceInterval;\n  const ticks: number[] = [];\n\n  for (let tick = firstTick; tick <= extendedRight; tick += niceInterval) {\n    ticks.push(Number(tick.toFixed(10))); // Avoid float errors\n  }\n\n  return ticks;\n}\n\n// converts timestamp numbers to real pixel values\nfunction scaleX(value: number, left: number, right: number, width: number) {\n  return ((value - left) / (right - left)) * width;\n}\n\nexport const TimelineTreeGanttBars = ({\n  nodes,\n  selectedKey,\n  onSelect,\n  traceStartTime,\n  traceEndTime,\n  expandedKeys,\n  setExpandedKeys,\n}: {\n  nodes: ModelTraceSpanNode[];\n  selectedKey: string | number;\n  onSelect: ((node: ModelTraceSpanNode) => void) | undefined;\n  traceStartTime: number;\n  traceEndTime: number;\n  expandedKeys: Set<string | number>;\n  setExpandedKeys: (keys: Set<string | number>) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const treeContainerRef = useRef<HTMLDivElement>(null);\n  const treeElementWidth = useResizeObserver({ ref: treeContainerRef })?.width ?? 0;\n  const initialXTicks = useMemo(\n    () => getNiceXTicks(traceStartTime, traceEndTime, treeElementWidth),\n    [traceEndTime, traceStartTime, treeElementWidth],\n  );\n  const left = Math.min(...initialXTicks);\n  // for the right limit of the graph, we take the average of the last\n  // two ticks so that the graph does not end directly on a line. if\n  // the graph ends on the line, the ticklabel at the top might render\n  // slightly off screen, which looks bad\n  const right = (initialXTicks[initialXTicks.length - 1] + initialXTicks[initialXTicks.length - 2]) / 2;\n  // pop the last tick since we will not render it (it's beyond the right limit)\n  const xTicks = initialXTicks.slice(0, -1);\n\n  const scaleDurationToTreeWidth = (value: number) => scaleX(value, left, right, treeElementWidth);\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        position: 'relative',\n        boxSizing: 'border-box',\n      }}\n    >\n      {/* gantt bar header with the tick labels */}\n      <div\n        ref={treeContainerRef}\n        css={{\n          display: 'flex',\n          width: '100%',\n          flexDirection: 'row',\n          height: theme.typography.lineHeightBase,\n          paddingLeft: TIMELINE_BAR_LEFT_OFFSET,\n          paddingRight: theme.spacing.lg,\n          boxSizing: 'border-box',\n          position: 'sticky',\n          top: 0,\n          backgroundColor: theme.colors.backgroundPrimary,\n          zIndex: TimelineTreeZIndex.HIGH,\n        }}\n      >\n        <div\n          data-testid=\"time-marker-area\"\n          css={{\n            position: 'relative',\n          }}\n        >\n          {xTicks.map((n) => (\n            <Typography.Text\n              css={{\n                position: 'absolute',\n                transform: `translateX(-50%)`,\n                left: scaleDurationToTreeWidth(n),\n                whiteSpace: 'nowrap',\n              }}\n              key={n}\n            >\n              {spanTimeFormatter(n)}\n            </Typography.Text>\n          ))}\n        </div>\n      </div>\n      {/* vertical gantt markers */}\n      <div\n        css={{\n          flex: 1,\n          pointerEvents: 'none',\n          zIndex: TimelineTreeZIndex.LOW,\n        }}\n      >\n        <div\n          css={{\n            position: 'absolute',\n            height: '100%',\n            width: '100%',\n          }}\n        >\n          {xTicks.map((n) => (\n            <div\n              key={n}\n              css={{\n                position: 'absolute',\n                left: scaleDurationToTreeWidth(n) + TIMELINE_BAR_LEFT_OFFSET,\n                borderRight: `1px solid ${theme.colors.border}`,\n                height: '100%',\n              }}\n            />\n          ))}\n        </div>\n      </div>\n      {/* colored horizontal gantt bars */}\n      {nodes.map((node) => {\n        const leftOffset = scaleDurationToTreeWidth(node.start);\n        const width = scaleDurationToTreeWidth(node.end) - leftOffset;\n        return (\n          <TimelineTreeGanttNode\n            key={node.key}\n            selectedKey={selectedKey}\n            onSelect={onSelect}\n            node={node}\n            leftOffset={leftOffset}\n            width={width}\n            expandedKeys={expandedKeys}\n            setExpandedKeys={setExpandedKeys}\n          />\n        );\n      })}\n    </div>\n  );\n};\n","import { useCallback, useMemo } from 'react';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { getTimelineTreeExpandedNodesList } from './TimelineTree.utils';\nimport { TimelineTreeHeader } from './TimelineTreeHeader';\nimport { TimelineTreeNode } from './TimelineTreeNode';\nimport { TimelineTreeGanttBars } from './gantt/TimelineTreeGanttBars';\nimport type { ModelTraceSpanNode, SpanFilterState } from '../ModelTrace.types';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\n\nexport const TimelineTree = <NodeType extends ModelTraceSpanNode & { children?: NodeType[] }>({\n  rootNodes,\n  selectedNode,\n  setSelectedNode,\n  traceStartTime,\n  traceEndTime,\n  expandedKeys,\n  setExpandedKeys,\n  spanFilterState,\n  setSpanFilterState,\n  className,\n}: {\n  selectedNode?: NodeType;\n  setSelectedNode: (node: ModelTraceSpanNode) => void;\n  traceStartTime: number;\n  traceEndTime: number;\n  rootNodes: NodeType[];\n  expandedKeys: Set<string | number>;\n  setExpandedKeys: (keys: Set<string | number>) => void;\n  spanFilterState: SpanFilterState;\n  setSpanFilterState: (state: SpanFilterState) => void;\n  className?: string;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const onSpanClick = useCallback(\n    (node) => {\n      setSelectedNode?.(node);\n    },\n    [\n      // comment to prevent prettier format after copybara\n      setSelectedNode,\n    ],\n  );\n\n  const { showTimelineTreeGantt: showTimelineInfo, setShowTimelineTreeGantt: setShowTimelineInfo } =\n    useModelTraceExplorerViewState();\n\n  const expandedNodesList = useMemo(\n    () => getTimelineTreeExpandedNodesList(rootNodes, expandedKeys),\n    [rootNodes, expandedKeys],\n  );\n\n  const treeElement = useMemo(\n    () => (\n      <div\n        css={{\n          flex: 1,\n          overflow: 'auto',\n          minHeight: '100%',\n          boxSizing: 'border-box',\n          display: 'flex',\n          flexDirection: 'column',\n        }}\n      >\n        {showTimelineInfo ? (\n          <TimelineTreeGanttBars\n            nodes={expandedNodesList}\n            selectedKey={selectedNode?.key ?? ''}\n            onSelect={onSpanClick}\n            traceStartTime={traceStartTime}\n            traceEndTime={traceEndTime}\n            expandedKeys={expandedKeys}\n            setExpandedKeys={setExpandedKeys}\n          />\n        ) : (\n          rootNodes.map((node) => (\n            <TimelineTreeNode\n              key={node.key}\n              node={node}\n              expandedKeys={expandedKeys}\n              setExpandedKeys={setExpandedKeys}\n              selectedKey={selectedNode?.key ?? ''}\n              traceStartTime={traceStartTime}\n              traceEndTime={traceEndTime}\n              onSelect={onSpanClick}\n              linesToRender={[]}\n            />\n          ))\n        )}\n      </div>\n    ),\n    [\n      showTimelineInfo,\n      expandedNodesList,\n      selectedNode?.key,\n      onSpanClick,\n      traceStartTime,\n      traceEndTime,\n      rootNodes,\n      expandedKeys,\n      setExpandedKeys,\n    ],\n  );\n\n  return (\n    <div\n      css={{\n        height: '100%',\n        borderRadius: theme.legacyBorders.borderRadiusMd,\n        overflow: 'hidden',\n        display: 'flex',\n      }}\n      className={className}\n    >\n      <div\n        css={{\n          overflow: 'hidden',\n          display: 'flex',\n          flexDirection: 'column',\n          flex: 1,\n        }}\n      >\n        <div css={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\n          <TimelineTreeHeader\n            showTimelineInfo={showTimelineInfo}\n            setShowTimelineInfo={setShowTimelineInfo}\n            spanFilterState={spanFilterState}\n            setSpanFilterState={setSpanFilterState}\n          />\n          {rootNodes.length > 0 ? (\n            <div css={{ flex: 1, overflowY: 'auto', display: 'flex' }}>{treeElement}</div>\n          ) : (\n            <div\n              css={{\n                flex: 1,\n                display: 'flex',\n                justifyContent: 'center',\n                padding: theme.spacing.md,\n                paddingTop: theme.spacing.lg,\n              }}\n            >\n              <FormattedMessage\n                defaultMessage=\"No results found. Try using a different search term.\"\n                description=\"Model trace explorer > no results found\"\n              />\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n","import { values, isString } from 'lodash';\nimport { useLayoutEffect, useMemo, useRef, useState } from 'react';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { ModelTrace, ModelTraceSpanNode } from './ModelTrace.types';\nimport type { ModelTraceExplorerResizablePaneRef } from './ModelTraceExplorerResizablePane';\nimport ModelTraceExplorerResizablePane from './ModelTraceExplorerResizablePane';\nimport ModelTraceExplorerSearchBox from './ModelTraceExplorerSearchBox';\nimport { useModelTraceExplorerViewState } from './ModelTraceExplorerViewStateContext';\nimport { useModelTraceSearch } from './hooks/useModelTraceSearch';\nimport { ModelTraceExplorerRightPaneTabs, RIGHT_PANE_MIN_WIDTH } from './right-pane/ModelTraceExplorerRightPaneTabs';\nimport { TimelineTree } from './timeline-tree';\nimport {\n  DEFAULT_EXPAND_DEPTH,\n  getModelTraceSpanNodeDepth,\n  getTimelineTreeNodesMap,\n  SPAN_INDENT_WIDTH,\n  useTimelineTreeExpandedNodes,\n} from './timeline-tree/TimelineTree.utils';\n\n// this is the number of large spacings we need in order to\n// properly calculate the min width for the left pane. it's:\n// - 1 for left and right padding\n// - 4 for the right collapse button + time marker\n// - 1 for span icon\n// - 1 for buffer (leave some space to render text)\nconst LEFT_PANE_MIN_WIDTH_LARGE_SPACINGS = 7;\nconst LEFT_PANE_HEADER_MIN_WIDTH_PX = 275;\n\nconst getDefaultSplitRatio = (): number => {\n  if (window.innerWidth <= 768) {\n    return 0.33;\n  }\n\n  return 0.25;\n};\n\nexport const ModelTraceExplorerDetailView = ({\n  modelTrace,\n  className,\n  selectedSpanId,\n  onSelectSpan,\n}: {\n  modelTrace: ModelTrace;\n  className?: string;\n  selectedSpanId?: string;\n  onSelectSpan?: (selectedSpanId?: string) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const initialRatio = getDefaultSplitRatio();\n  const paneRef = useRef<ModelTraceExplorerResizablePaneRef>(null);\n  const [paneWidth, setPaneWidth] = useState(500);\n\n  const {\n    rootNode: treeNode,\n    selectedNode,\n    setSelectedNode,\n    activeTab,\n    setActiveTab,\n  } = useModelTraceExplorerViewState();\n\n  const { expandedKeys, setExpandedKeys } = useTimelineTreeExpandedNodes({\n    rootNodes: treeNode ? [treeNode] : [],\n    // nodes beyond this depth will be collapsed\n    initialExpandDepth: DEFAULT_EXPAND_DEPTH,\n  });\n\n  const {\n    matchData,\n    searchFilter,\n    setSearchFilter,\n    spanFilterState,\n    setSpanFilterState,\n    filteredTreeNodes,\n    handleNextSearchMatch,\n    handlePreviousSearchMatch,\n  } = useModelTraceSearch({\n    treeNode,\n    selectedNode,\n    setSelectedNode,\n    setActiveTab,\n    setExpandedKeys,\n    modelTraceInfo: modelTrace?.info,\n  });\n\n  const onSelectNode = (node?: ModelTraceSpanNode) => {\n    setSelectedNode(node);\n    // Open left most tab when a span is clicked\n    setActiveTab(node?.chatMessages ? 'chat' : 'content');\n    if (isString(node?.key)) {\n      onSelectSpan?.(node?.key);\n    }\n  };\n\n  // initial render\n  useLayoutEffect(() => {\n    // expand all nodes up to the default depth when the tree changes\n    const list = values(getTimelineTreeNodesMap(filteredTreeNodes, DEFAULT_EXPAND_DEPTH)).map((node) => node.key);\n    setExpandedKeys(new Set(list));\n  }, [filteredTreeNodes, setExpandedKeys]);\n\n  const leftPaneMinWidth = useMemo(() => {\n    // min width necessary to render all the spans in the tree accounting for indentation\n    const minWidthForSpans =\n      Math.max(...filteredTreeNodes.map(getModelTraceSpanNodeDepth)) * SPAN_INDENT_WIDTH +\n      LEFT_PANE_MIN_WIDTH_LARGE_SPACINGS * theme.spacing.lg;\n    // min width necessary to render the header, given that it has a bunch of buttons\n    return Math.max(LEFT_PANE_HEADER_MIN_WIDTH_PX, minWidthForSpans);\n  }, [filteredTreeNodes, theme.spacing.lg]);\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        flex: 1,\n        minHeight: 0,\n      }}\n      className={className}\n    >\n      <div\n        css={{\n          padding: theme.spacing.xs,\n          borderBottom: `1px solid ${theme.colors.border}`,\n        }}\n      >\n        <ModelTraceExplorerSearchBox\n          searchFilter={searchFilter}\n          setSearchFilter={setSearchFilter}\n          matchData={matchData}\n          handleNextSearchMatch={handleNextSearchMatch}\n          handlePreviousSearchMatch={handlePreviousSearchMatch}\n        />\n      </div>\n      <ModelTraceExplorerResizablePane\n        ref={paneRef}\n        initialRatio={initialRatio}\n        paneWidth={paneWidth}\n        setPaneWidth={setPaneWidth}\n        leftChild={\n          <div\n            css={{\n              display: 'flex',\n              flexDirection: 'column',\n              flex: 1,\n              minWidth: leftPaneMinWidth,\n            }}\n          >\n            <TimelineTree\n              rootNodes={filteredTreeNodes}\n              selectedNode={selectedNode}\n              traceStartTime={treeNode?.start ?? 0}\n              traceEndTime={treeNode?.end ?? 0}\n              setSelectedNode={onSelectNode}\n              css={{ flex: 1 }}\n              expandedKeys={expandedKeys}\n              setExpandedKeys={setExpandedKeys}\n              spanFilterState={spanFilterState}\n              setSpanFilterState={setSpanFilterState}\n            />\n          </div>\n        }\n        leftMinWidth={leftPaneMinWidth}\n        rightChild={\n          <ModelTraceExplorerRightPaneTabs\n            activeSpan={selectedNode}\n            searchFilter={searchFilter}\n            activeMatch={matchData.match}\n            activeTab={activeTab}\n            setActiveTab={setActiveTab}\n          />\n        }\n        rightMinWidth={RIGHT_PANE_MIN_WIDTH}\n      />\n    </div>\n  );\n};\n","export const getUser = () => {\n  // return a dummy user as the OSS backend\n  // does not transmit user info to frontend\n  return 'User';\n};\n","import { matchPredefinedError } from '@databricks/web-shared/errors';\n\n// eslint-disable-next-line no-restricted-globals -- See go/spog-fetch\nconst fetchFn = fetch;\n\nfunction serializeRequestBody(payload: any | FormData | Blob) {\n  if (payload === undefined) {\n    return undefined;\n  }\n  return typeof payload === 'string' || payload instanceof FormData || payload instanceof Blob\n    ? payload\n    : JSON.stringify(payload);\n}\n\nexport const fetchAPI = async (url: string, method: 'POST' | 'GET' | 'PATCH' | 'DELETE' = 'GET', body?: any) => {\n  const response = await fetchFn(url, {\n    method,\n    body: serializeRequestBody(body),\n    headers: body ? { 'Content-Type': 'application/json' } : {},\n  });\n  if (!response.ok) {\n    const predefinedError = matchPredefinedError(response);\n    if (predefinedError) {\n      try {\n        // Attempt to use message from the response\n        const message = (await response.json()).message;\n        predefinedError.message = message ?? predefinedError.message;\n      } catch {\n        // If the message can't be parsed, use default one\n      }\n      throw predefinedError;\n    }\n  }\n  return response.json();\n};\n","import type { Assessment, Expectation, Feedback } from './ModelTrace.types';\nimport { fetchAPI } from './ModelTraceExplorer.request.utils';\n\nexport const deleteAssessment = ({ traceId, assessmentId }: { traceId: string; assessmentId: string }) =>\n  fetchAPI(`/ajax-api/3.0/mlflow/traces/${traceId}/assessments/${assessmentId}`, 'DELETE');\n\n// these fields are set by the server on create\nexport type CreateAssessmentPayload = {\n  assessment: Omit<Assessment, 'assessment_id' | 'create_time' | 'last_update_time'>;\n};\n\nexport const createAssessment = ({ payload }: { payload: CreateAssessmentPayload }) =>\n  fetchAPI(`/ajax-api/3.0/mlflow/traces/${payload.assessment.trace_id}/assessments`, 'POST', payload);\n\nexport const fetchTraceInfoV3 = ({ traceId }: { traceId: string }) =>\n  fetchAPI(`/ajax-api/3.0/mlflow/traces/${traceId}`);\n\nexport type UpdateAssessmentPayload = {\n  // we only support updating these fields\n  assessment: {\n    feedback?: Feedback;\n    expectation?: Expectation;\n    rationale?: string;\n    metadata?: Record<string, string>;\n  };\n  // comma-separated list of fields to update\n  update_mask: string;\n};\n\nexport const updateAssessment = ({\n  traceId,\n  assessmentId,\n  payload,\n}: {\n  traceId: string;\n  assessmentId: string;\n  payload: UpdateAssessmentPayload;\n}) => fetchAPI(`/ajax-api/3.0/mlflow/traces/${traceId}/assessments/${assessmentId}`, 'PATCH', payload);\n","import { Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport type { ModelTraceChatToolParamProperty } from '../ModelTrace.types';\n\nexport function ModelTraceExplorerChatToolParam({\n  paramName,\n  paramProperties,\n  isRequired,\n}: {\n  paramName: string;\n  paramProperties: ModelTraceChatToolParamProperty;\n  isRequired: boolean;\n}) {\n  const { theme } = useDesignSystemTheme();\n\n  const { type, description, enum: enumValues } = paramProperties;\n\n  const hasAdditionalInfo = type || description || enumValues;\n\n  const borderStyles = hasAdditionalInfo\n    ? {\n        borderTopLeftRadius: theme.borders.borderRadiusMd,\n        borderTopRightRadius: theme.borders.borderRadiusMd,\n        borderBottom: `1px solid ${theme.colors.border}`,\n      }\n    : {\n        borderRadius: theme.borders.borderRadiusMd,\n      };\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        width: '100%',\n        borderRadius: theme.borders.borderRadiusMd,\n        border: `1px solid ${theme.colors.border}`,\n      }}\n    >\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          alignItems: 'center',\n          backgroundColor: theme.colors.backgroundSecondary,\n          padding: `${theme.spacing.sm}px ${theme.spacing.md}px`,\n          gap: theme.spacing.sm,\n          ...borderStyles,\n        }}\n      >\n        <Typography.Title withoutMargins style={{ whiteSpace: 'nowrap', textOverflow: 'ellipsis', overflow: 'hidden' }}>\n          {paramName}\n        </Typography.Title>\n        {isRequired && (\n          <Typography.Text withoutMargins color=\"error\">\n            <FormattedMessage\n              defaultMessage=\"required\"\n              description=\"Text displayed next to a function parameter to indicate that it is required\"\n            />\n          </Typography.Text>\n        )}\n      </div>\n      {hasAdditionalInfo && (\n        <div\n          css={{\n            display: 'grid',\n            gridTemplateColumns: 'auto 1fr',\n            gridTemplateRows: 'auto',\n            gap: theme.spacing.md,\n            padding: `${theme.spacing.sm}px ${theme.spacing.md}px`,\n          }}\n        >\n          {type && (\n            <>\n              <Typography.Text withoutMargins bold>\n                <FormattedMessage\n                  defaultMessage=\"Type\"\n                  description=\"Row heading in a table that contains the type of a function parameter (e.g. string, boolean)\"\n                />\n              </Typography.Text>\n              <Typography.Text withoutMargins code>\n                {type}\n              </Typography.Text>\n            </>\n          )}\n          {description && (\n            <>\n              <Typography.Text withoutMargins bold>\n                <FormattedMessage\n                  defaultMessage=\"Description\"\n                  description=\"Row heading in a table that contains the description of a function parameter.\"\n                />\n              </Typography.Text>\n              <Typography.Text withoutMargins>{description}</Typography.Text>\n            </>\n          )}\n          {enumValues && (\n            <>\n              <Typography.Text withoutMargins bold>\n                <FormattedMessage\n                  defaultMessage=\"Enum Values\"\n                  description=\"Row heading in a table that contains the potential enum values that a function parameter can have.\"\n                />\n              </Typography.Text>\n              <div css={{ display: 'flex', flexDirection: 'row', gap: theme.spacing.sm, flexWrap: 'wrap' }}>\n                {enumValues.map((value) => (\n                  <Typography.Text withoutMargins code key={value}>\n                    {value}\n                  </Typography.Text>\n                ))}\n              </div>\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState } from 'react';\n\nimport { ChevronDownIcon, ChevronRightIcon, Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nimport { ModelTraceExplorerChatToolParam } from './ModelTraceExplorerChatToolParam';\nimport type { ModelTraceChatTool } from '../ModelTrace.types';\n\nexport function ModelTraceExplorerChatTool({ tool }: { tool: ModelTraceChatTool }) {\n  const { theme } = useDesignSystemTheme();\n  const [expanded, setExpanded] = useState(false);\n\n  const description = tool.function.description;\n  const paramProperties = tool.function.parameters?.properties;\n  const requiredParams = tool.function.parameters?.required ?? [];\n\n  // tools only need to have names, so it's\n  // possible that no additional info exists\n  const isExpandable = description || paramProperties;\n\n  const hoverStyles = isExpandable\n    ? { ':hover': { backgroundColor: theme.colors.actionIconBackgroundHover, cursor: 'pointer' } }\n    : {};\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        width: '100%',\n        borderRadius: theme.borders.borderRadiusMd,\n        border: `1px solid ${theme.colors.border}`,\n        backgroundColor: theme.colors.backgroundPrimary,\n      }}\n      data-testid=\"model-trace-explorer-chat-tool\"\n    >\n      <div\n        role=\"button\"\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          gap: theme.spacing.sm,\n          alignItems: 'center',\n          borderBottom: isExpandable && expanded ? `1px solid ${theme.colors.border}` : 'none',\n          padding: theme.spacing.sm,\n          ...hoverStyles,\n        }}\n        onClick={() => setExpanded(!expanded)}\n        data-testid=\"model-trace-explorer-chat-tool-toggle\"\n      >\n        {isExpandable && (expanded ? <ChevronDownIcon /> : <ChevronRightIcon />)}\n        <Typography.Text\n          bold\n          withoutMargins\n          style={{ whiteSpace: 'nowrap', textOverflow: 'ellipsis', overflow: 'hidden' }}\n        >\n          {tool.function.name}\n        </Typography.Text>\n      </div>\n      {isExpandable && expanded && (\n        <div css={{ padding: theme.spacing.sm }}>\n          {description && (\n            <Typography.Paragraph\n              style={{ whiteSpace: 'pre-wrap', marginBottom: theme.spacing.sm, padding: `0px ${theme.spacing.xs}px` }}\n            >\n              {tool.function.description}\n            </Typography.Paragraph>\n          )}\n          {paramProperties && (\n            <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm }}>\n              {Object.keys(paramProperties).map((key) => (\n                <ModelTraceExplorerChatToolParam\n                  key={key}\n                  paramName={key}\n                  paramProperties={paramProperties[key]}\n                  isRequired={requiredParams.includes(key)}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","import { createContext, useContext, useMemo, useState } from 'react';\n\nimport type { ModelTrace, ModelTraceExplorerTab, ModelTraceSpanNode } from './ModelTrace.types';\nimport { parseModelTraceToTree, searchTreeBySpanId } from './ModelTraceExplorer.utils';\nimport { getTimelineTreeNodesMap } from './timeline-tree/TimelineTree.utils';\n\nexport type ModelTraceExplorerViewState = {\n  rootNode: ModelTraceSpanNode | null;\n  nodeMap: Record<string, ModelTraceSpanNode>;\n  activeView: 'summary' | 'detail';\n  setActiveView: (view: 'summary' | 'detail') => void;\n  selectedNode: ModelTraceSpanNode | undefined;\n  setSelectedNode: (node: ModelTraceSpanNode | undefined) => void;\n  activeTab: ModelTraceExplorerTab;\n  setActiveTab: (tab: ModelTraceExplorerTab) => void;\n  showTimelineTreeGantt: boolean;\n  setShowTimelineTreeGantt: (show: boolean) => void;\n  assessmentsPaneExpanded: boolean;\n  setAssessmentsPaneExpanded: (expanded: boolean) => void;\n  assessmentsPaneEnabled: boolean;\n};\n\nexport const ModelTraceExplorerViewStateContext = createContext<ModelTraceExplorerViewState>({\n  rootNode: null,\n  nodeMap: {},\n  activeView: 'summary',\n  setActiveView: () => {},\n  selectedNode: undefined,\n  setSelectedNode: () => {},\n  activeTab: 'content',\n  setActiveTab: () => {},\n  showTimelineTreeGantt: false,\n  setShowTimelineTreeGantt: () => {},\n  assessmentsPaneExpanded: false,\n  setAssessmentsPaneExpanded: () => {},\n  assessmentsPaneEnabled: true,\n});\n\nexport const useModelTraceExplorerViewState = () => {\n  return useContext(ModelTraceExplorerViewStateContext);\n};\n\nexport const ModelTraceExplorerViewStateProvider = ({\n  modelTrace,\n  initialActiveView,\n  selectedSpanIdOnRender,\n  // assessments pane is disabled if\n  // the trace doesn't exist in the backend\n  // (i.e. if the traceinfo fetch fails)\n  assessmentsPaneEnabled,\n  children,\n}: {\n  modelTrace: ModelTrace;\n  initialActiveView: 'summary' | 'detail';\n  selectedSpanIdOnRender?: string;\n  children: React.ReactNode;\n  assessmentsPaneEnabled: boolean;\n}) => {\n  const rootNode = useMemo(() => parseModelTraceToTree(modelTrace), [modelTrace]);\n  const nodeMap = useMemo(() => (rootNode ? getTimelineTreeNodesMap([rootNode]) : {}), [rootNode]);\n  const selectedSpanOnRender = searchTreeBySpanId(rootNode, selectedSpanIdOnRender);\n  const defaultSelectedNode = selectedSpanOnRender ?? rootNode ?? undefined;\n  const hasAssessments = (defaultSelectedNode?.assessments?.length ?? 0) > 0;\n\n  const [activeView, setActiveView] = useState<'summary' | 'detail'>(initialActiveView);\n  const [selectedNode, setSelectedNode] = useState<ModelTraceSpanNode | undefined>(defaultSelectedNode);\n  const [activeTab, setActiveTab] = useState<ModelTraceExplorerTab>(selectedNode?.chatMessages ? 'chat' : 'content');\n  const [showTimelineTreeGantt, setShowTimelineTreeGantt] = useState(false);\n  const [assessmentsPaneExpanded, setAssessmentsPaneExpanded] = useState(hasAssessments);\n\n  const value = useMemo(\n    () => ({\n      rootNode,\n      nodeMap,\n      activeView,\n      setActiveView,\n      activeTab,\n      setActiveTab,\n      selectedNode,\n      setSelectedNode,\n      showTimelineTreeGantt,\n      setShowTimelineTreeGantt,\n      assessmentsPaneExpanded,\n      setAssessmentsPaneExpanded,\n      assessmentsPaneEnabled,\n    }),\n    [\n      activeView,\n      nodeMap,\n      activeTab,\n      rootNode,\n      selectedNode,\n      showTimelineTreeGantt,\n      setShowTimelineTreeGantt,\n      assessmentsPaneExpanded,\n      setAssessmentsPaneExpanded,\n      assessmentsPaneEnabled,\n    ],\n  );\n\n  return (\n    <ModelTraceExplorerViewStateContext.Provider value={value}>{children}</ModelTraceExplorerViewStateContext.Provider>\n  );\n};\n","import { Global } from '@emotion/react';\nimport { clamp } from 'lodash';\nimport React, { forwardRef, useCallback, useImperativeHandle, useLayoutEffect, useRef, useState } from 'react';\nimport { ResizableBox } from 'react-resizable';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nimport { useResizeObserver } from '../hooks';\n\ninterface ModelTraceExplorerResizablePaneProps {\n  initialRatio: number;\n  paneWidth: number;\n  setPaneWidth: (paneWidth: number) => void;\n  leftChild: React.ReactNode;\n  leftMinWidth: number;\n  rightChild: React.ReactNode;\n  rightMinWidth: number;\n}\n\nexport interface ModelTraceExplorerResizablePaneRef {\n  updateRatio: (newPaneWidth: number) => void;\n}\n\n/**\n * This component takes a left and right child, and adds\n * a draggable handle between them to resize. It handles\n * logic such as preserving the ratio of the pane width\n * when the container/window is resized, and also ensures\n * that the left and right panes conform to specified min\n * widths.\n */\nconst ModelTraceExplorerResizablePane = forwardRef<\n  ModelTraceExplorerResizablePaneRef,\n  ModelTraceExplorerResizablePaneProps\n>(({ initialRatio, paneWidth, setPaneWidth, leftChild, leftMinWidth, rightChild, rightMinWidth }, ref) => {\n  const [isResizing, setIsResizing] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const containerWidth = useResizeObserver({ ref: containerRef })?.width;\n  // if container width is not available, don't set a max width\n  const maxWidth = (containerWidth ?? Infinity) - rightMinWidth;\n\n  const ratio = useRef(initialRatio);\n  const { theme } = useDesignSystemTheme();\n\n  const updateRatio = useCallback(\n    // used by the parent component to update the ratio when\n    // the pane is resized via the show/hide gantt button\n    (newPaneWidth: number) => {\n      if (containerWidth) {\n        ratio.current = newPaneWidth / containerWidth;\n      }\n    },\n    [containerWidth],\n  );\n\n  useImperativeHandle(ref, () => ({\n    updateRatio,\n  }));\n\n  useLayoutEffect(() => {\n    // preserve the ratio of the pane width when the container is resized\n    if (containerWidth) {\n      setPaneWidth(clamp(containerWidth * ratio.current, leftMinWidth, maxWidth));\n    }\n  }, [containerWidth, maxWidth, leftMinWidth, rightMinWidth, setPaneWidth]);\n\n  return (\n    <div\n      ref={containerRef}\n      css={{\n        display: 'flex',\n        flex: 1,\n        overflow: 'hidden',\n        flexDirection: 'row',\n      }}\n    >\n      {isResizing && (\n        <Global\n          styles={{\n            'body, :host': {\n              userSelect: 'none',\n            },\n          }}\n        />\n      )}\n      <ResizableBox\n        axis=\"x\"\n        width={paneWidth}\n        css={{ display: 'flex', flex: `0 0 ${paneWidth}px` }}\n        handle={\n          <div css={{ width: 0, position: 'relative' }}>\n            <div\n              css={{\n                position: 'relative',\n                width: theme.spacing.sm,\n                marginLeft: -theme.spacing.xs,\n                minHeight: '100%',\n                cursor: 'ew-resize',\n                backgroundColor: `rgba(0,0,0,0)`,\n                zIndex: 1,\n                ':hover': {\n                  backgroundColor: `rgba(0,0,0,0.1)`,\n                },\n              }}\n            />\n          </div>\n        }\n        onResize={(e, { size }) => {\n          const clampedSize = clamp(size.width, leftMinWidth, maxWidth);\n          setPaneWidth(clampedSize);\n          if (containerWidth) {\n            ratio.current = clampedSize / containerWidth;\n          }\n        }}\n        onResizeStart={() => setIsResizing(true)}\n        onResizeStop={() => setIsResizing(false)}\n        minConstraints={[leftMinWidth, Infinity]}\n        maxConstraints={[maxWidth, Infinity]}\n      >\n        {leftChild}\n      </ResizableBox>\n      {rightChild}\n    </div>\n  );\n});\n\nexport default ModelTraceExplorerResizablePane;\n","import {\n  Overflow,\n  Tag,\n  TagColors,\n  Typography,\n  useDesignSystemTheme,\n  Tooltip,\n  ClockIcon,\n} from '@databricks/design-system';\nimport { Notification } from '@databricks/design-system';\nimport { useCallback, useMemo, useState } from 'react';\n\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport type { ModelTrace, ModelTraceInfoV3 } from './ModelTrace.types';\nimport { getModelTraceId } from './ModelTraceExplorer.utils';\nimport { spanTimeFormatter } from './timeline-tree/TimelineTree.utils';\nimport { useModelTraceExplorerViewState } from './ModelTraceExplorerViewStateContext';\nimport { isUserFacingTag, parseJSONSafe, truncateToFirstLineWithMaxLength } from './TagUtils';\n\nconst BASE_TAG_COMPONENT_ID = 'mlflow.model_trace_explorer.header_details';\nconst BASE_NOTIFICATION_COMPONENT_ID = 'mlflow.model_trace_explorer.header_details.notification';\n\nconst ModelTraceHeaderMetricSection = ({\n  label,\n  value,\n  icon,\n  tagKey,\n  color = 'teal',\n  getTruncatedLabel,\n  getComponentId,\n  onCopy,\n}: {\n  label: React.ReactNode;\n  value: string;\n  icon?: React.ReactNode;\n  tagKey: string;\n  color?: TagColors;\n  getTruncatedLabel: (label: string) => string;\n  getComponentId: (key: string) => string;\n  onCopy: () => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n\n  const handleClick = () => {\n    navigator.clipboard.writeText(value);\n    onCopy();\n  };\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        flexDirection: 'row',\n        gap: theme.spacing.sm,\n      }}\n    >\n      <Typography.Text size=\"md\" color=\"secondary\">\n        {label}\n      </Typography.Text>\n      <Tooltip componentId={getComponentId(tagKey)} content={value} maxWidth={400}>\n        <Tag componentId={getComponentId(tagKey)} color={color} onClick={handleClick} css={{ cursor: 'pointer' }}>\n          <span css={{ display: 'flex', flexDirection: 'row', alignItems: 'center', gap: theme.spacing.xs }}>\n            {icon && <span>{icon}</span>}\n            <span>{getTruncatedLabel(value)}</span>\n          </span>\n        </Tag>\n      </Tooltip>\n    </div>\n  );\n};\n\nexport const ModelTraceHeaderDetails = ({ modelTrace }: { modelTrace: ModelTrace }) => {\n  const intl = useIntl();\n  const { theme } = useDesignSystemTheme();\n  const [showNotification, setShowNotification] = useState(false);\n  const { rootNode } = useModelTraceExplorerViewState();\n\n  const tags = Object.entries(modelTrace.info.tags ?? {}).filter(([key]) => isUserFacingTag(key));\n\n  const modelTraceId = getModelTraceId(modelTrace);\n\n  const tokenUsage = useMemo(() => {\n    const tokenUsage = parseJSONSafe(\n      (modelTrace.info as ModelTraceInfoV3)?.trace_metadata?.['mlflow.trace.tokenUsage'] ?? '{}',\n    );\n\n    return tokenUsage;\n  }, [modelTrace.info]);\n\n  const totalTokens = useMemo(() => tokenUsage?.total_tokens, [tokenUsage]);\n\n  const latency = useMemo((): string | undefined => {\n    if (rootNode) {\n      return spanTimeFormatter(rootNode.end - rootNode.start);\n    }\n\n    return undefined;\n  }, [rootNode]);\n\n  const getComponentId = useCallback((key: string) => `${BASE_TAG_COMPONENT_ID}.tag-${key}`, []);\n\n  const handleTagClick = (text: string) => {\n    navigator.clipboard.writeText(text);\n  };\n\n  const getTruncatedLabel = (label: string) => truncateToFirstLineWithMaxLength(label, 40);\n\n  const handleCopy = useCallback(() => {\n    setShowNotification(true);\n    setTimeout(() => setShowNotification(false), 2000);\n  }, []);\n\n  return (\n    <>\n      <div css={{ display: 'flex', flexDirection: 'row', gap: theme.spacing.md, flexWrap: 'wrap' }}>\n        {modelTraceId && (\n          <ModelTraceHeaderMetricSection\n            label={<FormattedMessage defaultMessage=\"ID\" description=\"Label for the ID section\" />}\n            value={modelTraceId}\n            tagKey={modelTraceId}\n            color=\"pink\"\n            getTruncatedLabel={getTruncatedLabel}\n            getComponentId={getComponentId}\n            onCopy={handleCopy}\n          />\n        )}\n        {totalTokens && (\n          <ModelTraceHeaderMetricSection\n            label={<FormattedMessage defaultMessage=\"Token count\" description=\"Label for the token count section\" />}\n            value={totalTokens.toString()}\n            tagKey=\"token-count\"\n            color=\"default\"\n            getTruncatedLabel={getTruncatedLabel}\n            getComponentId={getComponentId}\n            onCopy={handleCopy}\n          />\n        )}\n        {latency && (\n          <ModelTraceHeaderMetricSection\n            label={<FormattedMessage defaultMessage=\"Latency\" description=\"Label for the latency section\" />}\n            icon={<ClockIcon css={{ fontSize: 12, display: 'flex', alignItems: 'center', justifyContent: 'center' }} />}\n            value={latency}\n            tagKey=\"latency\"\n            color=\"default\"\n            getTruncatedLabel={getTruncatedLabel}\n            getComponentId={getComponentId}\n            onCopy={handleCopy}\n          />\n        )}\n        <div\n          css={{\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            flexDirection: 'row',\n            gap: theme.spacing.sm,\n          }}\n        >\n          <Typography.Text size=\"md\" color=\"secondary\">\n            <FormattedMessage defaultMessage=\"Tags\" description=\"Label for the tags section\" />\n          </Typography.Text>\n          <Overflow noMargin>\n            {tags.map(([key, value]) => {\n              const tagKey = `${key}-${value}`;\n              const fullText = `${key}: ${value}`;\n\n              return (\n                <Tooltip key={key} componentId={getComponentId(tagKey)} content={fullText}>\n                  <Tag\n                    componentId={getComponentId(tagKey)}\n                    color=\"teal\"\n                    onClick={() => {\n                      handleTagClick(fullText);\n                      handleCopy();\n                    }}\n                    css={{ cursor: 'pointer' }}\n                  >\n                    {getTruncatedLabel(`${key}: ${value}`)}\n                  </Tag>\n                </Tooltip>\n              );\n            })}\n          </Overflow>\n        </div>\n      </div>\n\n      {showNotification && (\n        <Notification.Provider>\n          <Notification.Root severity=\"success\" componentId={BASE_NOTIFICATION_COMPONENT_ID}>\n            <Notification.Title>\n              <FormattedMessage\n                defaultMessage=\"Copied to clipboard\"\n                description=\"Success message for the notification\"\n              />\n            </Notification.Title>\n          </Notification.Root>\n          <Notification.Viewport />\n        </Notification.Provider>\n      )}\n    </>\n  );\n};\n","import _ from 'lodash';\n\nexport const MLFLOW_INTERNAL_PREFIX = 'mlflow.';\nconst MLFLOW_INTERNAL_PREFIX_UC = '_mlflow_';\n\nexport const isUserFacingTag = (tagKey: string) =>\n  !tagKey.startsWith(MLFLOW_INTERNAL_PREFIX) && !tagKey.startsWith(MLFLOW_INTERNAL_PREFIX_UC);\n\n// Safe JSON.parse that returns undefined instead of throwing an error\nexport const parseJSONSafe = (json: string) => {\n  try {\n    return JSON.parse(json);\n  } catch (e) {\n    return undefined;\n  }\n};\n\nexport const truncateToFirstLineWithMaxLength = (str: string, maxLength: number): string => {\n  const truncated = _.truncate(str, {\n    length: maxLength,\n  });\n  return _.takeWhile(truncated, (char) => char !== '\\n').join('');\n};\n","import { isNil } from 'lodash';\nimport { useCallback, useState } from 'react';\n\nimport {\n  Button,\n  FormUI,\n  Input,\n  SegmentedControlButton,\n  SegmentedControlGroup,\n  SimpleSelect,\n  SimpleSelectOption,\n  Typography,\n  useDesignSystemTheme,\n} from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\nimport { getUser } from '@databricks/web-shared/global-settings';\nimport { useMutation, useQueryClient } from '@databricks/web-shared/query-client';\n\nimport type { AssessmentFormInputDataType } from './AssessmentsPane.utils';\nimport { getCreateAssessmentPayloadValue } from './AssessmentsPane.utils';\nimport { displayErrorNotification, FETCH_TRACE_INFO_QUERY_KEY } from '../ModelTraceExplorer.utils';\nimport type { CreateAssessmentPayload } from '../api';\nimport { createAssessment } from '../api';\n\nexport const AssessmentCreateForm = ({\n  assessmentName,\n  spanId,\n  traceId,\n  // used to close the form\n  // after the assessment is created\n  setExpanded,\n}: {\n  assessmentName?: string;\n  spanId?: string;\n  traceId: string;\n  setExpanded: (expanded: boolean) => void;\n}) => {\n  const intl = useIntl();\n  const queryClient = useQueryClient();\n  const { theme } = useDesignSystemTheme();\n\n  const [name, setName] = useState('');\n  const [assessmentType, setAssessmentType] = useState<'feedback' | 'expectation'>('feedback');\n  const [dataType, setDataType] = useState<AssessmentFormInputDataType>('boolean');\n  const [value, setValue] = useState<string | boolean | number>(true);\n  const [rationale, setRationale] = useState('');\n  const [valueError, setValueError] = useState<React.ReactNode | null>(null);\n\n  const { mutate: createAssessmentMutation, isLoading } = useMutation({\n    mutationFn: (payload: CreateAssessmentPayload) => createAssessment({ payload }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [FETCH_TRACE_INFO_QUERY_KEY, traceId] });\n    },\n    onError: (error) => {\n      displayErrorNotification(\n        intl.formatMessage(\n          {\n            defaultMessage: 'Failed to create assessment. Error: {error}',\n            description: 'Error message when creating an assessment fails',\n          },\n          {\n            error: error instanceof Error ? error.message : String(error),\n          },\n        ),\n      );\n    },\n    onSettled: () => {\n      setExpanded(false);\n    },\n  });\n\n  const isNamePrefilled = !isNil(assessmentName);\n\n  const handleCreate = useCallback(async () => {\n    if (dataType === 'json') {\n      try {\n        // validate JSON\n        JSON.parse(value as string);\n      } catch (e) {\n        setValueError(\n          <FormattedMessage\n            defaultMessage=\"The provided value is not valid JSON\"\n            description=\"Error message for invalid JSON in an assessment creation form\"\n          />,\n        );\n        return;\n      }\n    }\n\n    const valueObj = getCreateAssessmentPayloadValue({\n      formValue: value,\n      dataType,\n      isFeedback: assessmentType === 'feedback',\n    });\n\n    const payload: CreateAssessmentPayload = {\n      assessment: {\n        assessment_name: isNamePrefilled ? assessmentName : name,\n        trace_id: traceId,\n        source: {\n          source_type: 'HUMAN',\n          source_id: getUser() ?? '',\n        },\n        span_id: spanId,\n        rationale,\n        ...valueObj,\n      },\n    };\n\n    createAssessmentMutation(payload);\n  }, [\n    dataType,\n    value,\n    assessmentType,\n    isNamePrefilled,\n    assessmentName,\n    name,\n    traceId,\n    spanId,\n    rationale,\n    createAssessmentMutation,\n  ]);\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.xs,\n        marginTop: theme.spacing.sm,\n        border: `1px solid ${theme.colors.border}`,\n        padding: theme.spacing.sm,\n        borderRadius: theme.borders.borderRadiusSm,\n      }}\n    >\n      <Typography.Text size=\"sm\" color=\"secondary\">\n        <FormattedMessage\n          defaultMessage=\"Assessment Type\"\n          description=\"Field label for assessment type in a creation form\"\n        />\n      </Typography.Text>\n      <SimpleSelect\n        id=\"shared.model-trace-explorer.assessment-type-select\"\n        componentId=\"shared.model-trace-explorer.assessment-type-select\"\n        value={assessmentType}\n        disabled={isLoading}\n        onChange={(e) => setAssessmentType(e.target.value as 'feedback' | 'expectation')}\n      >\n        <SimpleSelectOption value=\"feedback\">\n          <FormattedMessage defaultMessage=\"Feedback\" description=\"Feedback select menu option for assessment type\" />\n        </SimpleSelectOption>\n        <SimpleSelectOption value=\"expectation\">\n          <FormattedMessage\n            defaultMessage=\"Expectation\"\n            description=\"Expectation select menu option for assessment type\"\n          />\n        </SimpleSelectOption>\n      </SimpleSelect>\n      <Typography.Text css={{ marginTop: theme.spacing.xs }} size=\"sm\" color=\"secondary\">\n        <FormattedMessage\n          defaultMessage=\"Assessment Name\"\n          description=\"Field label for assessment name in a creation form\"\n        />\n      </Typography.Text>\n      {isNamePrefilled ? (\n        <Typography.Text>{assessmentName}</Typography.Text>\n      ) : (\n        <Input\n          componentId=\"shared.model-trace-explorer.assessment-name-input\"\n          value={name}\n          disabled={isLoading}\n          onKeyDown={(e) => e.stopPropagation()}\n          onChange={(e) => setName(e.target.value)}\n        />\n      )}\n      <Typography.Text css={{ marginTop: theme.spacing.xs }} size=\"sm\" color=\"secondary\">\n        <FormattedMessage\n          defaultMessage=\"Data Type\"\n          description=\"Field label for assessment data type in a creation form\"\n        />\n      </Typography.Text>\n      <SimpleSelect\n        id=\"shared.model-trace-explorer.assessment-data-type-select\"\n        componentId=\"shared.model-trace-explorer.assessment-data-type-select\"\n        value={dataType}\n        disabled={isLoading}\n        onChange={(e) => {\n          setDataType(e.target.value as AssessmentFormInputDataType);\n          setValueError(null);\n        }}\n      >\n        {assessmentType === 'expectation' && (\n          <SimpleSelectOption value=\"json\">\n            <FormattedMessage defaultMessage=\"JSON\" description=\"JSON select menu option for assessment data type\" />\n          </SimpleSelectOption>\n        )}\n        <SimpleSelectOption value=\"string\">\n          <FormattedMessage defaultMessage=\"String\" description=\"String select menu option for assessment data type\" />\n        </SimpleSelectOption>\n        <SimpleSelectOption value=\"boolean\">\n          <FormattedMessage\n            defaultMessage=\"Boolean\"\n            description=\"Boolean select menu option for assessment data type\"\n          />\n        </SimpleSelectOption>\n        <SimpleSelectOption value=\"number\">\n          <FormattedMessage defaultMessage=\"Number\" description=\"Numeric select menu option for assessment data type\" />\n        </SimpleSelectOption>\n      </SimpleSelect>\n      <Typography.Text css={{ marginTop: theme.spacing.xs }} size=\"sm\" color=\"secondary\">\n        <FormattedMessage defaultMessage=\"Value\" description=\"Field label for assessment value in a creation form\" />\n      </Typography.Text>\n      {dataType === 'json' && (\n        <>\n          <Input.TextArea\n            componentId=\"shared.model-trace-explorer.assessment-edit-value-string-input\"\n            value={String(value)}\n            autoSize={{ minRows: 1, maxRows: 5 }}\n            onKeyDown={(e) => e.stopPropagation()}\n            onChange={(e) => {\n              setValue(e.target.value);\n              setValueError(null);\n            }}\n            validationState={valueError ? 'error' : undefined}\n            disabled={isLoading}\n          />\n          {valueError && (\n            <FormUI.Message\n              id=\"shared.model-trace-explorer.assessment-edit-value-json-error\"\n              message={valueError}\n              type=\"error\"\n            />\n          )}\n        </>\n      )}\n      {dataType === 'string' && (\n        <Input\n          componentId=\"shared.model-trace-explorer.assessment-value-string-input\"\n          value={String(value)}\n          onKeyDown={(e) => e.stopPropagation()}\n          onChange={(e) => {\n            setValue(e.target.value);\n            setValueError(null);\n          }}\n          disabled={isLoading}\n          allowClear\n        />\n      )}\n      {dataType === 'boolean' && (\n        <SegmentedControlGroup\n          componentId=\"shared.model-trace-explorer.assessment-value-boolean-input\"\n          name=\"shared.model-trace-explorer.assessment-value-boolean-input\"\n          value={value}\n          disabled={isLoading}\n          onChange={(e) => {\n            setValue(e.target.value);\n            setValueError(null);\n          }}\n        >\n          <SegmentedControlButton value>True</SegmentedControlButton>\n          <SegmentedControlButton value={false}>False</SegmentedControlButton>\n        </SegmentedControlGroup>\n      )}\n      {dataType === 'number' && (\n        <Input\n          componentId=\"shared.model-trace-explorer.assessment-value-number-input\"\n          value={String(value)}\n          onKeyDown={(e) => e.stopPropagation()}\n          onChange={(e) => {\n            setValue(e.target.value ? Number(e.target.value) : '');\n            setValueError(null);\n          }}\n          type=\"number\"\n          disabled={isLoading}\n          allowClear\n        />\n      )}\n      <Typography.Text css={{ marginTop: theme.spacing.xs }} size=\"sm\" color=\"secondary\">\n        <FormattedMessage\n          defaultMessage=\"Rationale\"\n          description=\"Field label for assessment rationale in a creation form\"\n        />\n      </Typography.Text>\n      <Input.TextArea\n        componentId=\"shared.model-trace-explorer.assessment-rationale-input\"\n        value={rationale}\n        autoSize={{ minRows: 1, maxRows: 5 }}\n        disabled={isLoading}\n        onKeyDown={(e) => e.stopPropagation()}\n        onChange={(e) => setRationale(e.target.value)}\n      />\n      <div css={{ display: 'flex', justifyContent: 'flex-end', marginTop: theme.spacing.xs }}>\n        <Button\n          componentId=\"shared.model-trace-explorer.assessment-create-button\"\n          disabled={isLoading}\n          onClick={() => setExpanded(false)}\n        >\n          <FormattedMessage\n            defaultMessage=\"Cancel\"\n            description=\"Button label for cancelling the creation of an assessment\"\n          />\n        </Button>\n        <Button\n          css={{ marginLeft: theme.spacing.sm }}\n          type=\"primary\"\n          componentId=\"shared.model-trace-explorer.assessment-create-button\"\n          onClick={handleCreate}\n          loading={isLoading}\n        >\n          <FormattedMessage defaultMessage=\"Create\" description=\"Button label for creating an assessment\" />\n        </Button>\n      </div>\n    </div>\n  );\n};\n","import { useState } from 'react';\n\nimport { Button, PlusIcon } from '@databricks/design-system';\n\nimport { AssessmentCreateForm } from './AssessmentCreateForm';\n\nexport const AssessmentCreateButton = ({\n  title,\n  assessmentName,\n  spanId,\n  traceId,\n}: {\n  title: string;\n  assessmentName?: string;\n  spanId?: string;\n  traceId: string;\n}) => {\n  const [expanded, setExpanded] = useState(false);\n\n  return (\n    <div>\n      <Button\n        size=\"small\"\n        componentId=\"shared.model-trace-explorer.add-new-assessment\"\n        icon={<PlusIcon />}\n        onClick={() => setExpanded(true)}\n      >\n        {title}\n      </Button>\n      {expanded && (\n        <AssessmentCreateForm\n          assessmentName={assessmentName}\n          spanId={spanId}\n          traceId={traceId}\n          setExpanded={setExpanded}\n        />\n      )}\n    </div>\n  );\n};\n","import { PencilIcon, TrashIcon, OverflowIcon, Button, DropdownMenu } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport { getUser } from '@databricks/web-shared/global-settings';\n\nimport { shouldEnableAssessmentEditing } from '../FeatureUtils';\nimport type { Assessment } from '../ModelTrace.types';\n\nexport const AssessmentActionsOverflowMenu = ({\n  assessment,\n  setIsEditing,\n  setShowDeleteModal,\n}: {\n  assessment: Assessment;\n  setIsEditing?: (isEditing: boolean) => void;\n  setShowDeleteModal: (showDeleteModal: boolean) => void;\n}) => {\n  const isFeedback = 'feedback' in assessment;\n  const user = getUser() ?? '';\n  // humans are not allowed to edit other humans' assessments\n  const isEditEnabled = shouldEnableAssessmentEditing();\n  const doesUserHavePermissions =\n    user === assessment.source.source_id || (isFeedback && assessment.source.source_type !== 'HUMAN');\n  const showEditButton = isEditEnabled && doesUserHavePermissions && setIsEditing;\n\n  return (\n    <DropdownMenu.Root>\n      <DropdownMenu.Trigger asChild>\n        <Button componentId=\"shared.model-trace-explorer.assessment-more-button\" icon={<OverflowIcon />} size=\"small\" />\n      </DropdownMenu.Trigger>\n      <DropdownMenu.Content minWidth={100}>\n        {showEditButton && (\n          <DropdownMenu.Item\n            componentId=\"shared.model-trace-explorer.assessment-edit-button\"\n            onClick={() => setIsEditing?.(true)}\n          >\n            <DropdownMenu.IconWrapper>\n              <PencilIcon />\n            </DropdownMenu.IconWrapper>\n            <FormattedMessage defaultMessage=\"Edit\" description=\"Edit assessment menu item\" />\n          </DropdownMenu.Item>\n        )}\n        <DropdownMenu.Item\n          componentId=\"shared.model-trace-explorer.assessment-delete-button\"\n          onClick={() => setShowDeleteModal(true)}\n        >\n          <DropdownMenu.IconWrapper>\n            <TrashIcon />\n          </DropdownMenu.IconWrapper>\n          <FormattedMessage defaultMessage=\"Delete\" description=\"Delete assessment menu item\" />\n        </DropdownMenu.Item>\n      </DropdownMenu.Content>\n    </DropdownMenu.Root>\n  );\n};\n","import { useCallback } from 'react';\n\nimport { Modal } from '@databricks/design-system';\nimport { FormattedMessage, useIntl } from '@databricks/i18n';\nimport { useMutation, useQueryClient } from '@databricks/web-shared/query-client';\n\nimport type { Assessment } from '../ModelTrace.types';\nimport { displayErrorNotification, FETCH_TRACE_INFO_QUERY_KEY } from '../ModelTraceExplorer.utils';\nimport { deleteAssessment } from '../api';\n\nexport const AssessmentDeleteModal = ({\n  assessment,\n  isModalVisible,\n  setIsModalVisible,\n}: {\n  assessment: Assessment;\n  isModalVisible: boolean;\n  setIsModalVisible: (isModalVisible: boolean) => void;\n}) => {\n  const intl = useIntl();\n  const queryClient = useQueryClient();\n\n  const { mutate: deleteAssessmentMutation, isLoading } = useMutation({\n    mutationFn: () => deleteAssessment({ traceId: assessment.trace_id, assessmentId: assessment.assessment_id }),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [FETCH_TRACE_INFO_QUERY_KEY, assessment.trace_id] });\n    },\n    onError: (error) => {\n      displayErrorNotification(\n        intl.formatMessage(\n          {\n            defaultMessage: 'Failed to delete assessment. Error: {error}',\n            description: 'Error message when deleting an assessment fails.',\n          },\n          {\n            error: error instanceof Error ? error.message : String(error),\n          },\n        ),\n      );\n    },\n    onSettled: () => {\n      setIsModalVisible(false);\n    },\n  });\n\n  const handleDelete = useCallback(() => {\n    deleteAssessmentMutation();\n  }, [deleteAssessmentMutation]);\n\n  return (\n    <Modal\n      componentId=\"shared.model-trace-explorer.assessment-delete-modal\"\n      visible={isModalVisible}\n      onOk={handleDelete}\n      okButtonProps={{ danger: true, loading: isLoading }}\n      okText={<FormattedMessage defaultMessage=\"Delete\" description=\"Delete assessment modal button text\" />}\n      onCancel={() => {\n        setIsModalVisible(false);\n      }}\n      cancelText={<FormattedMessage defaultMessage=\"Cancel\" description=\"Delete assessment modal cancel button text\" />}\n      confirmLoading={isLoading}\n      title={<FormattedMessage defaultMessage=\"Delete assessment\" description=\"Delete assessments modal title\" />}\n    >\n      <FormattedMessage\n        defaultMessage=\"Are you sure you want to delete this assessment?\"\n        description=\"Delete assessments modal confirmation text\"\n      />\n    </Modal>\n  );\n};\n","import { useCallback, useState } from 'react';\n\nimport {\n  Typography,\n  useDesignSystemTheme,\n  SimpleSelect,\n  SimpleSelectOption,\n  SegmentedControlGroup,\n  SegmentedControlButton,\n  Input,\n  Button,\n  FormUI,\n} from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport { getUser } from '@databricks/web-shared/global-settings';\n\nimport type { AssessmentFormInputDataType } from './AssessmentsPane.utils';\nimport { getCreateAssessmentPayloadValue } from './AssessmentsPane.utils';\nimport type { Assessment } from '../ModelTrace.types';\nimport type { UpdateAssessmentPayload } from '../api';\nimport { useOverrideAssessment } from '../hooks/useOverrideAssessment';\nimport { useUpdateAssessment } from '../hooks/useUpdateAssessment';\n\n// default to the original type of the value if possible. however,\n// we only support editing simple types in the UI (i.e. not arrays / objects)\n// so if the value does not fit, we just default to boolean for simplicity\nconst getDefaultType = (value: any, isFeedback: boolean): AssessmentFormInputDataType => {\n  if (typeof value === 'string') {\n    // treat empty strings as null, default to boolean\n    if (value === '') {\n      return 'boolean';\n    }\n\n    if (isFeedback) {\n      return 'string';\n    }\n\n    try {\n      JSON.parse(value);\n      return 'json';\n    } catch (e) {\n      // not valid JSON, default to string\n      return 'string';\n    }\n  }\n\n  if (typeof value === 'boolean' || typeof value === 'number') {\n    return typeof value as 'boolean' | 'number';\n  }\n  return 'boolean';\n};\n\nconst getDefaultValue = (value: any): string | boolean | number | null => {\n  if (typeof value === 'string') {\n    // treat empty strings as null\n    return value || null;\n  }\n  if (typeof value === 'boolean' || typeof value === 'number') {\n    return value;\n  }\n  return null;\n};\n\nconst getAssessmentValue = (assessment: Assessment) => {\n  if ('feedback' in assessment) {\n    return assessment.feedback.value;\n  }\n\n  if ('value' in assessment.expectation) {\n    return assessment.expectation.value;\n  }\n\n  return assessment.expectation.serialized_value.value;\n};\n\nexport const AssessmentEditForm = ({\n  assessment,\n  onSuccess,\n  onSettled,\n  onCancel,\n}: {\n  assessment: Assessment;\n  onSuccess?: () => void;\n  onSettled?: () => void;\n  onCancel: () => void;\n}) => {\n  const isFeedback = 'feedback' in assessment;\n  const initialValue = getAssessmentValue(assessment);\n  const defaultType = getDefaultType(initialValue, isFeedback);\n  const defaultValue = getDefaultValue(initialValue);\n  const user = getUser() ?? '';\n\n  const { theme } = useDesignSystemTheme();\n  const [dataType, setDataType] = useState<AssessmentFormInputDataType>(defaultType);\n  const [value, setValue] = useState<string | boolean | number | null>(defaultValue);\n  const [rationale, setRationale] = useState(assessment.rationale);\n  const [valueError, setValueError] = useState<React.ReactNode | null>(null);\n\n  const { updateAssessmentMutation, isLoading: isUpdating } = useUpdateAssessment({\n    assessment,\n    onSuccess,\n    onSettled,\n  });\n\n  const { overrideAssessmentMutation, isLoading: isOverwriting } = useOverrideAssessment({\n    traceId: assessment.trace_id,\n    onSuccess,\n    onSettled,\n  });\n\n  const isLoading = isUpdating || isOverwriting;\n\n  const handleUpdate = useCallback(async () => {\n    if (dataType === 'json') {\n      try {\n        JSON.parse(value as string);\n      } catch (e) {\n        setValueError(\n          <FormattedMessage\n            defaultMessage=\"The provided value is not valid JSON\"\n            description=\"Error message for invalid JSON in an assessment edit form\"\n          />,\n        );\n        return;\n      }\n    }\n\n    const valueObj = getCreateAssessmentPayloadValue({\n      formValue: value,\n      dataType,\n      isFeedback,\n    });\n\n    // if a user edits their own assessment, we update it in\n    // place as they are likely just correcting a mistake.\n    // expectation edits should always call the update API\n    if (user === assessment.source.source_id || !isFeedback) {\n      const payload: UpdateAssessmentPayload = {\n        assessment: {\n          ...valueObj,\n          rationale,\n        },\n        update_mask: `${isFeedback ? 'feedback' : 'expectation'},rationale`,\n      };\n\n      updateAssessmentMutation(payload);\n    } else {\n      overrideAssessmentMutation({\n        oldAssessment: assessment,\n        value: valueObj,\n        ...(rationale ? { rationale } : {}),\n      });\n    }\n  }, [dataType, value, isFeedback, user, assessment, rationale, updateAssessmentMutation, overrideAssessmentMutation]);\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.xs,\n        marginTop: theme.spacing.sm,\n        border: `1px solid ${theme.colors.border}`,\n        padding: theme.spacing.sm,\n        borderRadius: theme.borders.borderRadiusSm,\n      }}\n    >\n      <Typography.Text css={{ marginTop: theme.spacing.xs }} size=\"sm\" color=\"secondary\">\n        <FormattedMessage\n          defaultMessage=\"Data Type\"\n          description=\"Field label for assessment data type in an edit form\"\n        />\n      </Typography.Text>\n      <SimpleSelect\n        id=\"shared.model-trace-explorer.assessment-edit-data-type-select\"\n        componentId=\"shared.model-trace-explorer.assessment-edit-data-type-select\"\n        value={dataType}\n        disabled={isLoading}\n        onChange={(e) => {\n          setDataType(e.target.value as AssessmentFormInputDataType);\n          setValueError(null);\n        }}\n      >\n        {!isFeedback && (\n          <SimpleSelectOption value=\"json\">\n            <FormattedMessage defaultMessage=\"JSON\" description=\"JSON select menu option for assessment data type\" />\n          </SimpleSelectOption>\n        )}\n        <SimpleSelectOption value=\"string\">\n          <FormattedMessage defaultMessage=\"String\" description=\"String select menu option for assessment data type\" />\n        </SimpleSelectOption>\n        <SimpleSelectOption value=\"boolean\">\n          <FormattedMessage\n            defaultMessage=\"Boolean\"\n            description=\"Boolean select menu option for assessment data type\"\n          />\n        </SimpleSelectOption>\n        <SimpleSelectOption value=\"number\">\n          <FormattedMessage defaultMessage=\"Number\" description=\"Numeric select menu option for assessment data type\" />\n        </SimpleSelectOption>\n      </SimpleSelect>\n      <Typography.Text css={{ marginTop: theme.spacing.xs }} size=\"sm\" color=\"secondary\">\n        <FormattedMessage defaultMessage=\"Value\" description=\"Field label for assessment value in an edit form\" />\n      </Typography.Text>\n      {dataType === 'json' && (\n        <>\n          <Input.TextArea\n            componentId=\"shared.model-trace-explorer.assessment-edit-value-string-input\"\n            value={String(value)}\n            rows={3}\n            onKeyDown={(e) => e.stopPropagation()}\n            onChange={(e) => {\n              setValue(e.target.value);\n              setValueError(null);\n            }}\n            validationState={valueError ? 'error' : undefined}\n            disabled={isLoading}\n          />\n          {valueError && (\n            <FormUI.Message\n              id=\"shared.model-trace-explorer.assessment-edit-value-json-error\"\n              message={valueError}\n              type=\"error\"\n            />\n          )}\n        </>\n      )}\n      {dataType === 'string' && (\n        <Input\n          componentId=\"shared.model-trace-explorer.assessment-edit-value-string-input\"\n          value={String(value)}\n          onKeyDown={(e) => e.stopPropagation()}\n          onChange={(e) => {\n            setValue(e.target.value);\n            setValueError(null);\n          }}\n          disabled={isLoading}\n          allowClear\n        />\n      )}\n      {dataType === 'boolean' && (\n        <SegmentedControlGroup\n          componentId=\"shared.model-trace-explorer.assessment-edit-value-boolean-input\"\n          name=\"shared.model-trace-explorer.assessment-edit-value-boolean-input\"\n          value={value}\n          disabled={isLoading}\n          onChange={(e) => {\n            setValue(e.target.value);\n            setValueError(null);\n          }}\n        >\n          <SegmentedControlButton value>True</SegmentedControlButton>\n          <SegmentedControlButton value={false}>False</SegmentedControlButton>\n        </SegmentedControlGroup>\n      )}\n      {dataType === 'number' && (\n        <Input\n          componentId=\"shared.model-trace-explorer.assessment-edit-value-number-input\"\n          value={String(value)}\n          onKeyDown={(e) => e.stopPropagation()}\n          onChange={(e) => {\n            setValue(e.target.value ? Number(e.target.value) : '');\n            setValueError(null);\n          }}\n          type=\"number\"\n          disabled={isLoading}\n          allowClear\n        />\n      )}\n      <Typography.Text css={{ marginTop: theme.spacing.xs }} size=\"sm\" color=\"secondary\">\n        <FormattedMessage\n          defaultMessage=\"Rationale\"\n          description=\"Field label for assessment rationale in an edit form\"\n        />\n      </Typography.Text>\n      <Input.TextArea\n        componentId=\"shared.model-trace-explorer.assessment-edit-rationale-input\"\n        value={rationale}\n        autoSize={{ minRows: 1, maxRows: 5 }}\n        disabled={isLoading}\n        onKeyDown={(e) => e.stopPropagation()}\n        onChange={(e) => setRationale(e.target.value)}\n      />\n      <div css={{ display: 'flex', justifyContent: 'flex-end', marginTop: theme.spacing.xs }}>\n        <Button\n          componentId=\"shared.model-trace-explorer.assessment-edit-cancel-button\"\n          disabled={isLoading}\n          onClick={onCancel}\n        >\n          <FormattedMessage\n            defaultMessage=\"Cancel\"\n            description=\"Button label for cancelling the edit of an assessment\"\n          />\n        </Button>\n        <Button\n          css={{ marginLeft: theme.spacing.sm }}\n          type=\"primary\"\n          componentId=\"shared.model-trace-explorer.assessment-edit-save-button\"\n          onClick={handleUpdate}\n          loading={isLoading}\n        >\n          <FormattedMessage defaultMessage=\"Save\" description=\"Button label for saving an edit to an assessment\" />\n        </Button>\n      </div>\n    </div>\n  );\n};\n","import { useIntl } from '@databricks/i18n';\nimport { useMutation, useQueryClient } from '@databricks/web-shared/query-client';\n\nimport type { Assessment } from '../ModelTrace.types';\nimport { displayErrorNotification, FETCH_TRACE_INFO_QUERY_KEY } from '../ModelTraceExplorer.utils';\nimport type { UpdateAssessmentPayload } from '../api';\nimport { updateAssessment } from '../api';\n\n// This API is used to update an assessment in place.\n// To override an assessment (preserving the original)\n// use `useOverrideAssessment` instead\nexport const useUpdateAssessment = ({\n  assessment,\n  onSuccess,\n  onError,\n  onSettled,\n}: {\n  assessment: Assessment;\n  onSuccess?: () => void;\n  onError?: (error: any) => void;\n  onSettled?: () => void;\n}) => {\n  const intl = useIntl();\n  const queryClient = useQueryClient();\n\n  const { mutate: updateAssessmentMutation, isLoading } = useMutation({\n    mutationFn: (payload: UpdateAssessmentPayload) =>\n      updateAssessment({ traceId: assessment.trace_id, assessmentId: assessment.assessment_id, payload }),\n    onError: (error) => {\n      displayErrorNotification(\n        intl.formatMessage(\n          {\n            defaultMessage: 'Failed to update assessment. Error: {error}',\n            description: 'Error message when updating an assessment fails',\n          },\n          {\n            error: error instanceof Error ? error.message : String(error),\n          },\n        ),\n      );\n      onError?.(error);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [FETCH_TRACE_INFO_QUERY_KEY, assessment.trace_id] });\n      onSuccess?.();\n    },\n    onSettled: () => {\n      onSettled?.();\n    },\n  });\n\n  return {\n    updateAssessmentMutation,\n    isLoading,\n  };\n};\n","import { omit } from 'lodash';\n\nimport { useIntl } from '@databricks/i18n';\nimport { getUser } from '@databricks/web-shared/global-settings';\nimport { useMutation, useQueryClient } from '@databricks/web-shared/query-client';\n\nimport type { Assessment, Expectation, Feedback } from '../ModelTrace.types';\nimport { displayErrorNotification, FETCH_TRACE_INFO_QUERY_KEY } from '../ModelTraceExplorer.utils';\nimport type { CreateAssessmentPayload } from '../api';\nimport { createAssessment } from '../api';\n\nexport const useOverrideAssessment = ({\n  traceId,\n  onSuccess,\n  onError,\n  onSettled,\n}: {\n  traceId: string;\n  onSuccess?: () => void;\n  onError?: (error: any) => void;\n  onSettled?: () => void;\n}) => {\n  const intl = useIntl();\n  const queryClient = useQueryClient();\n\n  const { mutate: overrideAssessmentMutation, isLoading } = useMutation({\n    mutationFn: ({\n      oldAssessment,\n      value,\n      rationale,\n    }: {\n      oldAssessment: Assessment;\n      value: { feedback: Feedback } | { expectation: Expectation };\n      rationale?: string;\n    }) => {\n      const newAssessment: Assessment = {\n        ...oldAssessment,\n        ...value,\n        rationale,\n        source: {\n          source_id: getUser() ?? '',\n          source_type: 'HUMAN',\n        },\n        overrides: oldAssessment.assessment_id,\n      };\n      const payload: CreateAssessmentPayload = {\n        assessment: omit(newAssessment, 'assessment_id', 'create_time', 'last_update_time', 'overriddenAssessments'),\n      };\n      return createAssessment({ payload });\n    },\n    onError: (error) => {\n      displayErrorNotification(\n        intl.formatMessage(\n          {\n            defaultMessage: 'Failed to override assessment. Error: {error}',\n            description: 'Error message when overriding an assessment fails',\n          },\n          {\n            error: error instanceof Error ? error.message : String(error),\n          },\n        ),\n      );\n      onError?.(error);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [FETCH_TRACE_INFO_QUERY_KEY, traceId] });\n      onSuccess?.();\n    },\n    onSettled: () => {\n      onSettled?.();\n    },\n  });\n\n  return {\n    overrideAssessmentMutation,\n    isLoading,\n  };\n};\n","import { isString } from 'lodash';\n\nimport { Tag, Tooltip, Typography, useDesignSystemTheme } from '@databricks/design-system';\n\nexport const ExpectationValuePreview = ({ objectKey, value }: { objectKey?: string; value: any }) => {\n  const { theme } = useDesignSystemTheme();\n  const displayValue = isString(value) ? value : JSON.stringify(value);\n\n  return (\n    <Tooltip content={displayValue} componentId=\"shared.model-trace-explorer.expectation-value-preview-tooltip\">\n      <Tag\n        color=\"indigo\"\n        componentId=\"shared.model-trace-explorer.expectation-array-item-tag\"\n        css={{ width: 'min-content', maxWidth: '100%' }}\n      >\n        <Typography.Text css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\n          {objectKey && (\n            <Typography.Text bold css={{ marginRight: theme.spacing.xs }}>\n              {objectKey}:\n            </Typography.Text>\n          )}\n          {displayValue}\n        </Typography.Text>\n      </Tag>\n    </Tooltip>\n  );\n};\n","import { isObject } from 'lodash';\nimport { useState } from 'react';\n\nimport { Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { AssessmentActionsOverflowMenu } from './AssessmentActionsOverflowMenu';\nimport { AssessmentDeleteModal } from './AssessmentDeleteModal';\nimport { AssessmentEditForm } from './AssessmentEditForm';\nimport { getParsedExpectationValue } from './AssessmentsPane.utils';\nimport { ExpectationValuePreview } from './ExpectationValuePreview';\nimport { SpanNameDetailViewLink } from './SpanNameDetailViewLink';\nimport type { ExpectationAssessment } from '../ModelTrace.types';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\n\nconst getValuePreview = (parsedValue: any) => {\n  if (Array.isArray(parsedValue)) {\n    return parsedValue.map((item, index) => <ExpectationValuePreview value={item} key={index} />);\n  }\n\n  if (isObject(parsedValue)) {\n    return Object.entries(parsedValue).map(([key, value]) => (\n      <ExpectationValuePreview key={key} objectKey={key} value={value} />\n    ));\n  }\n\n  return <ExpectationValuePreview value={parsedValue} />;\n};\n\nexport const ExpectationItem = ({ expectation }: { expectation: ExpectationAssessment }) => {\n  const { theme } = useDesignSystemTheme();\n  const [isEditing, setIsEditing] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const { nodeMap, activeView } = useModelTraceExplorerViewState();\n\n  const associatedSpan = expectation.span_id ? nodeMap[expectation.span_id] : null;\n  // the summary view displays all assessments regardless of span, so\n  // we need some way to indicate which span an assessment is associated with.\n  const showAssociatedSpan = activeView === 'summary' && associatedSpan;\n\n  const parsedValue = getParsedExpectationValue(expectation.expectation);\n\n  return (\n    <div\n      css={{\n        padding: theme.spacing.sm + theme.spacing.xs,\n        paddingTop: theme.spacing.sm,\n        border: `1px solid ${theme.colors.border}`,\n        borderRadius: theme.borders.borderRadiusMd,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.sm,\n      }}\n    >\n      <div css={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n        <Typography.Text bold css={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>\n          {expectation.assessment_name}\n        </Typography.Text>\n        <AssessmentActionsOverflowMenu\n          assessment={expectation}\n          setIsEditing={setIsEditing}\n          setShowDeleteModal={setShowDeleteModal}\n        />\n        <AssessmentDeleteModal\n          assessment={expectation}\n          isModalVisible={showDeleteModal}\n          setIsModalVisible={setShowDeleteModal}\n        />\n      </div>\n      {isEditing ? (\n        <AssessmentEditForm\n          assessment={expectation}\n          onSuccess={() => setIsEditing(false)}\n          onCancel={() => setIsEditing(false)}\n        />\n      ) : (\n        getValuePreview(parsedValue)\n      )}\n      {showAssociatedSpan && (\n        <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.xs }}>\n          <Typography.Text size=\"sm\" color=\"secondary\">\n            <FormattedMessage defaultMessage=\"Span\" description=\"Label for the associated span of an assessment\" />\n          </Typography.Text>\n          <SpanNameDetailViewLink node={associatedSpan} />\n        </div>\n      )}\n    </div>\n  );\n};\n","import React from 'react';\n\nimport type { TagColors } from '@databricks/design-system';\nimport {\n  CheckCircleIcon,\n  DangerIcon,\n  Tag,\n  Tooltip,\n  useDesignSystemTheme,\n  XCircleIcon,\n} from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\n// displays a single JSON-strigified assessment value as a tag\nexport const AssessmentDisplayValue = ({ jsonValue }: { jsonValue: string }) => {\n  const { theme } = useDesignSystemTheme();\n\n  // treat empty strings as null\n  if (!jsonValue || jsonValue === '\"\"') {\n    return null;\n  }\n\n  let parsedValue: any;\n  try {\n    parsedValue = JSON.parse(jsonValue);\n  } catch (e) {\n    // if the value is not valid JSON, just use the string value\n    parsedValue = jsonValue;\n  }\n\n  let color: TagColors = 'default';\n  let children: React.ReactNode = JSON.stringify(parsedValue, null, 2);\n  if (parsedValue === 'yes') {\n    color = 'lime';\n    children = (\n      <>\n        <CheckCircleIcon css={{ marginRight: theme.spacing.xs }} />\n        <FormattedMessage defaultMessage=\"Yes\" description=\"Label for an assessment with a 'yes' value\" />\n      </>\n    );\n  } else if (parsedValue === 'no') {\n    color = 'coral';\n    children = (\n      <>\n        <XCircleIcon css={{ marginRight: theme.spacing.xs }} />\n        <FormattedMessage defaultMessage=\"No\" description=\"Label for an assessment with a 'no' value\" />\n      </>\n    );\n  } else if (typeof parsedValue === 'string') {\n    children = parsedValue;\n  } else if (parsedValue === null) {\n    // feedback can only have null values if they are errors\n    color = 'coral';\n    children = (\n      <>\n        <DangerIcon css={{ marginRight: theme.spacing.xs }} />\n        <FormattedMessage defaultMessage=\"Error\" description=\"Label for an assessment with an error\" />\n      </>\n    );\n  } else if (parsedValue === true) {\n    color = 'lime';\n    children = (\n      <>\n        <CheckCircleIcon css={{ marginRight: theme.spacing.xs }} />\n        <FormattedMessage defaultMessage=\"True\" description=\"Label for an assessment with a 'true' boolean value\" />\n      </>\n    );\n  } else if (parsedValue === false) {\n    color = 'coral';\n    children = (\n      <>\n        <XCircleIcon css={{ marginRight: theme.spacing.xs }} />\n        <FormattedMessage defaultMessage=\"False\" description=\"Label for an assessment with a 'false' boolean value\" />\n      </>\n    );\n  }\n\n  return (\n    <Tooltip componentId=\"shared.model-trace-explorer.assesment-value-tooltip\" content={children}>\n      <Tag\n        css={{ display: 'inline-flex', maxWidth: '100%', minWidth: theme.spacing.md, marginRight: 0 }}\n        componentId=\"shared.model-trace-explorer.assesment-value-tag\"\n        color={color}\n      >\n        <span\n          css={{\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            textWrap: 'nowrap',\n          }}\n        >\n          {children}\n        </span>\n      </Tag>\n    </Tooltip>\n  );\n};\n","import { Tooltip, useDesignSystemTheme, Typography } from '@databricks/design-system';\n\nimport type { AssessmentSource } from '../ModelTrace.types';\n\nexport const AssessmentSourceName = ({ source }: { source: AssessmentSource }) => {\n  const { theme } = useDesignSystemTheme();\n\n  return (\n    <Tooltip componentId=\"shared.model-trace-explorer.assessment-source-name\" content={source.source_id}>\n      {/* wrap in span so the tooltip can show up */}\n      <span\n        css={{\n          flexShrink: 1,\n          overflow: 'hidden',\n          textOverflow: 'ellipsis',\n          textWrap: 'nowrap',\n          marginLeft: theme.spacing.sm,\n          minWidth: theme.spacing.md,\n        }}\n      >\n        <Typography.Text>\n          <span css={{ color: theme.colors.blue500 }}>{source.source_id}</span>\n        </Typography.Text>\n      </span>\n    </Tooltip>\n  );\n};\n","import { useState } from 'react';\n\nimport { useDesignSystemTheme, Typography, SparkleIcon, UserIcon, CodeIcon } from '@databricks/design-system';\n\nimport { AssessmentActionsOverflowMenu } from './AssessmentActionsOverflowMenu';\nimport { AssessmentDeleteModal } from './AssessmentDeleteModal';\nimport { AssessmentSourceName } from './AssessmentSourceName';\nimport { timeSinceStr } from './AssessmentsPane.utils';\nimport type { Assessment } from '../ModelTrace.types';\n\nconst getSourceIcon = (source: Assessment['source']) => {\n  switch (source.source_type) {\n    case 'HUMAN':\n      return UserIcon;\n    case 'LLM_JUDGE':\n      return SparkleIcon;\n    default:\n      return CodeIcon;\n  }\n};\n\nexport const AssessmentItemHeader = ({\n  // connector is not displayed in history items\n  renderConnector = true,\n  assessment,\n  setIsEditing,\n}: {\n  renderConnector?: boolean;\n  assessment: Assessment;\n  setIsEditing?: (isEditing: boolean) => void;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n\n  const SourceIcon = getSourceIcon(assessment.source);\n\n  return (\n    <div css={{ display: 'flex', flexDirection: 'row', alignItems: 'center' }}>\n      {renderConnector && (\n        <div\n          css={{\n            position: 'absolute',\n            left: -1,\n            top: 0,\n            width: 10,\n            height: theme.typography.lineHeightBase,\n            boxSizing: 'border-box',\n            borderBottomLeftRadius: theme.borders.borderRadiusMd,\n            borderBottom: `1px solid ${theme.colors.border}`,\n            borderLeft: `1px solid ${theme.colors.border}`,\n          }}\n        />\n      )}\n      <SourceIcon\n        size={theme.typography.fontSizeSm}\n        css={{\n          padding: 2,\n          backgroundColor: theme.colors.actionIconBackgroundHover,\n          borderRadius: theme.borders.borderRadiusFull,\n        }}\n      />\n      <AssessmentSourceName source={assessment.source} />\n      <div\n        css={{\n          marginLeft: 'auto',\n          display: 'flex',\n          flexDirection: 'row',\n          alignItems: 'center',\n          gap: theme.spacing.xs,\n        }}\n      >\n        {assessment.last_update_time && (\n          <Typography.Text\n            color=\"secondary\"\n            size=\"sm\"\n            css={{\n              marginLeft: theme.spacing.sm,\n              overflow: 'hidden',\n              textOverflow: 'ellipsis',\n              textWrap: 'nowrap',\n            }}\n          >\n            {timeSinceStr(new Date(assessment.last_update_time))}\n          </Typography.Text>\n        )}\n        <AssessmentActionsOverflowMenu\n          assessment={assessment}\n          setIsEditing={setIsEditing}\n          setShowDeleteModal={setShowDeleteModal}\n        />\n        <AssessmentDeleteModal\n          assessment={assessment}\n          isModalVisible={showDeleteModal}\n          setIsModalVisible={setShowDeleteModal}\n        />\n      </div>\n    </div>\n  );\n};\n","import { useState } from 'react';\n\nimport { Alert, Modal, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { CodeSnippetRenderMode, type AssessmentError } from '../ModelTrace.types';\nimport { ModelTraceExplorerCodeSnippet } from '../ModelTraceExplorerCodeSnippet';\n\nexport const FeedbackErrorItem = ({ error }: { error: AssessmentError }) => {\n  const { theme } = useDesignSystemTheme();\n  const [isModalVisible, setIsModalVisible] = useState(false);\n\n  return (\n    <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.xs }}>\n      <Alert\n        type=\"error\"\n        closable={false}\n        message={error.error_code}\n        componentId=\"shared.model-trace-explorer.feedback-error-item\"\n        description={\n          <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.xs }}>\n            <span>{error.error_message}</span>\n            {error.stack_trace && (\n              <Typography.Link\n                componentId=\"shared.model-trace-explorer.feedback-error-item-stack-trace-link\"\n                onClick={() => setIsModalVisible(true)}\n              >\n                <FormattedMessage\n                  defaultMessage=\"View stack trace\"\n                  description=\"Link to view the stack trace for an assessment error\"\n                />\n              </Typography.Link>\n            )}\n          </div>\n        }\n      />\n      {error.stack_trace && (\n        <Modal\n          title={\n            <FormattedMessage\n              defaultMessage=\"Error stack trace\"\n              description=\"Title of the assessment error stack trace modal\"\n            />\n          }\n          visible={isModalVisible}\n          componentId=\"shared.model-trace-explorer.feedback-error-stack-trace-modal\"\n          footer={null}\n          onCancel={() => setIsModalVisible(false)}\n        >\n          <ModelTraceExplorerCodeSnippet\n            data={JSON.stringify(error.stack_trace)}\n            title=\"\"\n            initialRenderMode={CodeSnippetRenderMode.TEXT}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n};\n","import { isNil } from 'lodash';\n\nimport { Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport { GenAIMarkdownRenderer } from '@databricks/web-shared/genai-markdown-renderer';\n\nimport { AssessmentDisplayValue } from './AssessmentDisplayValue';\nimport { AssessmentItemHeader } from './AssessmentItemHeader';\nimport { FeedbackErrorItem } from './FeedbackErrorItem';\nimport type { FeedbackAssessment } from '../ModelTrace.types';\n\n// this is mostly a copy of FeedbackItem, but with\n// different styling and no ability to edit.\nexport const FeedbackHistoryItem = ({ feedback }: { feedback: FeedbackAssessment }) => {\n  const { theme } = useDesignSystemTheme();\n  const value = feedback.feedback.value;\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        position: 'relative',\n      }}\n    >\n      <AssessmentItemHeader renderConnector={false} assessment={feedback} />\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'column',\n          gap: theme.spacing.xs,\n          marginLeft: 10,\n          paddingLeft: theme.spacing.md,\n          paddingTop: theme.spacing.sm,\n          paddingBottom: theme.spacing.md,\n          paddingRight: theme.spacing.lg,\n          borderLeft: `1px solid ${theme.colors.border}`,\n        }}\n      >\n        {!isNil(feedback.feedback.error) ? (\n          <FeedbackErrorItem error={feedback.feedback.error} />\n        ) : (\n          <>\n            <Typography.Text size=\"sm\" color=\"secondary\">\n              <FormattedMessage defaultMessage=\"Feedback\" description=\"Label for the value of an feedback assessment\" />\n            </Typography.Text>\n            <div>\n              <AssessmentDisplayValue jsonValue={JSON.stringify(value)} />\n            </div>\n          </>\n        )}\n        {feedback.rationale && (\n          <>\n            <Typography.Text size=\"sm\" color=\"secondary\" css={{ marginTop: theme.spacing.xs }}>\n              <FormattedMessage\n                defaultMessage=\"Rationale\"\n                description=\"Label for the rationale of an expectation assessment\"\n              />\n            </Typography.Text>\n            <GenAIMarkdownRenderer>{feedback.rationale}</GenAIMarkdownRenderer>\n          </>\n        )}\n      </div>\n    </div>\n  );\n};\n","import { useMemo } from 'react';\n\nimport { Modal } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { FeedbackHistoryItem } from './FeedbackHistoryItem';\nimport type { Assessment, FeedbackAssessment } from '../ModelTrace.types';\n\n// helper function to traverse the linked list of overridden\n// assessments. this function handles cycles by keeping track\n// of the assessments we've seen. the backend should prevent\n// such cases from existing, but we should be defensive.\nconst flattenOverrides = (assessment: Assessment) => {\n  const seen = new Set<string>();\n  const flattened = [];\n\n  let currentAssessment: Assessment | undefined = assessment;\n  while (currentAssessment && !seen.has(currentAssessment.assessment_id)) {\n    seen.add(currentAssessment.assessment_id);\n    flattened.push(currentAssessment);\n    currentAssessment = currentAssessment.overriddenAssessment;\n  }\n\n  return flattened;\n};\n\nexport const FeedbackHistoryModal = ({\n  isModalVisible,\n  setIsModalVisible,\n  feedback,\n}: {\n  isModalVisible: boolean;\n  setIsModalVisible: (isModalVisible: boolean) => void;\n  feedback: FeedbackAssessment;\n}) => {\n  const assessmentHistory = useMemo(() => flattenOverrides(feedback), [feedback]);\n\n  return (\n    <Modal\n      componentId=\"shared.model-trace-explorer.feedback-history-modal\"\n      visible={isModalVisible}\n      footer={null}\n      onCancel={() => {\n        setIsModalVisible(false);\n      }}\n      title={\n        <FormattedMessage\n          defaultMessage=\"Edit history\"\n          description=\"Title of a modal that shows the edit history of an assessment\"\n        />\n      }\n    >\n      {assessmentHistory.map((assessment) =>\n        'feedback' in assessment ? <FeedbackHistoryItem key={assessment.assessment_id} feedback={assessment} /> : null,\n      )}\n    </Modal>\n  );\n};\n","import { isNil } from 'lodash';\nimport { useState } from 'react';\n\nimport { Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\nimport { GenAIMarkdownRenderer } from '@databricks/web-shared/genai-markdown-renderer';\n\nimport { AssessmentDisplayValue } from './AssessmentDisplayValue';\nimport { FeedbackErrorItem } from './FeedbackErrorItem';\nimport { FeedbackHistoryModal } from './FeedbackHistoryModal';\nimport { SpanNameDetailViewLink } from './SpanNameDetailViewLink';\nimport type { FeedbackAssessment } from '../ModelTrace.types';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\n\nexport const FeedbackItemContent = ({ feedback }: { feedback: FeedbackAssessment }) => {\n  const [isHistoryModalVisible, setIsHistoryModalVisible] = useState(false);\n  const { theme } = useDesignSystemTheme();\n  const { nodeMap, activeView } = useModelTraceExplorerViewState();\n\n  const value = feedback.feedback.value;\n\n  const associatedSpan = feedback.span_id ? nodeMap[feedback.span_id] : null;\n  // the summary view displays all assessments regardless of span, so\n  // we need some way to indicate which span an assessment is associated with.\n  const showAssociatedSpan = activeView === 'summary' && associatedSpan;\n\n  return (\n    <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm, marginLeft: theme.spacing.lg }}>\n      {!isNil(feedback.feedback.error) && <FeedbackErrorItem error={feedback.feedback.error} />}\n      {showAssociatedSpan && (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: theme.spacing.xs,\n          }}\n        >\n          <Typography.Text size=\"sm\" color=\"secondary\">\n            <FormattedMessage defaultMessage=\"Span\" description=\"Label for the associated span of an assessment\" />\n          </Typography.Text>\n          <SpanNameDetailViewLink node={associatedSpan} />\n        </div>\n      )}\n      {isNil(feedback.feedback.error) && (\n        <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.xs }}>\n          <Typography.Text size=\"sm\" color=\"secondary\">\n            <FormattedMessage defaultMessage=\"Feedback\" description=\"Label for the value of an feedback assessment\" />\n          </Typography.Text>\n          <div css={{ display: 'flex', gap: theme.spacing.xs }}>\n            <AssessmentDisplayValue jsonValue={JSON.stringify(value)} />\n            {feedback.overriddenAssessment && (\n              <>\n                <span onClick={() => setIsHistoryModalVisible(true)}>\n                  <Typography.Text\n                    css={{\n                      '&:hover': {\n                        textDecoration: 'underline',\n                        cursor: 'pointer',\n                      },\n                    }}\n                    color=\"secondary\"\n                  >\n                    <FormattedMessage\n                      defaultMessage=\"(edited)\"\n                      description=\"Link text in an edited assessment that allows the user to click to see the previous value\"\n                    />\n                  </Typography.Text>\n                </span>\n                <FeedbackHistoryModal\n                  isModalVisible={isHistoryModalVisible}\n                  setIsModalVisible={setIsHistoryModalVisible}\n                  feedback={feedback}\n                />\n              </>\n            )}\n          </div>\n        </div>\n      )}\n      {feedback.rationale && (\n        <div css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.xs }}>\n          <Typography.Text size=\"sm\" color=\"secondary\">\n            <FormattedMessage\n              defaultMessage=\"Rationale\"\n              description=\"Label for the rationale of an expectation assessment\"\n            />\n          </Typography.Text>\n          <div css={{ '& > div:last-of-type': { marginBottom: 0 } }}>\n            <GenAIMarkdownRenderer>{feedback.rationale}</GenAIMarkdownRenderer>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import { useState } from 'react';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nimport { AssessmentEditForm } from './AssessmentEditForm';\nimport { AssessmentItemHeader } from './AssessmentItemHeader';\nimport { FeedbackItemContent } from './FeedbackItemContent';\nimport type { FeedbackAssessment } from '../ModelTrace.types';\n\nexport const FeedbackItem = ({ feedback }: { feedback: FeedbackAssessment }) => {\n  const { theme } = useDesignSystemTheme();\n  const [isEditing, setIsEditing] = useState(false);\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: theme.spacing.xs,\n        paddingLeft: theme.spacing.lg / 2,\n        marginLeft: theme.spacing.lg / 2,\n        paddingTop: theme.spacing.sm,\n        paddingBottom: theme.spacing.sm,\n        borderLeft: `1px solid ${theme.colors.border}`,\n        position: 'relative',\n      }}\n    >\n      <AssessmentItemHeader assessment={feedback} setIsEditing={setIsEditing} />\n      {isEditing ? (\n        <AssessmentEditForm\n          assessment={feedback}\n          onSuccess={() => setIsEditing(false)}\n          onCancel={() => setIsEditing(false)}\n        />\n      ) : (\n        <FeedbackItemContent feedback={feedback} />\n      )}\n    </div>\n  );\n};\n","import { countBy } from 'lodash';\n\nimport { CodeIcon, SparkleIcon, Tag, Typography, useDesignSystemTheme, UserIcon } from '@databricks/design-system';\n\nimport type { AssessmentSourceType, FeedbackAssessment } from '../ModelTrace.types';\n\nconst getSourceTypeIcon = (sourceType: AssessmentSourceType) => {\n  const smallIconStyles = {\n    '& > svg': {\n      width: 12,\n      height: 12,\n    },\n  };\n  switch (sourceType) {\n    case 'HUMAN':\n      return <UserIcon css={smallIconStyles} />;\n    case 'LLM_JUDGE':\n      return <SparkleIcon css={smallIconStyles} />;\n    case 'CODE':\n      return <CodeIcon css={smallIconStyles} />;\n    default:\n      return null;\n  }\n};\n\nexport const FeedbackValueGroupSourceCounts = ({ feedbacks }: { feedbacks: FeedbackAssessment[] }) => {\n  const { theme } = useDesignSystemTheme();\n\n  if (feedbacks.length < 2) {\n    return null;\n  }\n\n  const sourceCounts = countBy(feedbacks, (feedback) => feedback.source.source_type);\n  return (\n    <div css={{ display: 'flex', gap: theme.spacing.xs, alignItems: 'center', marginLeft: theme.spacing.xs }}>\n      {Object.entries(sourceCounts).map(([sourceType, count]) => (\n        <Tag\n          componentId={`shared.model-trace-explorer.feedback-source-count-${sourceType}`}\n          css={{\n            margin: 0,\n          }}\n          key={sourceType}\n        >\n          <div css={{ display: 'flex', alignItems: 'center', gap: theme.spacing.xs }}>\n            {getSourceTypeIcon(sourceType as AssessmentSourceType)}\n            <Typography.Text>{count}</Typography.Text>\n          </div>\n        </Tag>\n      ))}\n    </div>\n  );\n};\n","import { useState } from 'react';\n\nimport { Button, ChevronDownIcon, ChevronRightIcon, useDesignSystemTheme } from '@databricks/design-system';\n\nimport { AssessmentDisplayValue } from './AssessmentDisplayValue';\nimport { FeedbackItem } from './FeedbackItem';\nimport { FeedbackValueGroupSourceCounts } from './FeedbackValueGroupSourceCounts';\nimport type { FeedbackAssessment } from '../ModelTrace.types';\n\nexport const FeedbackValueGroup = ({\n  jsonValue,\n  feedbacks,\n}: {\n  jsonValue: string;\n  feedbacks: FeedbackAssessment[];\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const [expanded, setExpanded] = useState(false);\n\n  return (\n    <div css={{ display: 'flex', flexDirection: 'column' }}>\n      <div css={{ display: 'flex', gap: theme.spacing.xs, alignItems: 'center' }}>\n        <Button\n          componentId=\"shared.model-trace-explorer.toggle-assessment-expanded\"\n          css={{ flexShrink: 0 }}\n          size=\"small\"\n          icon={expanded ? <ChevronDownIcon /> : <ChevronRightIcon />}\n          onClick={() => setExpanded(!expanded)}\n        />\n        <AssessmentDisplayValue jsonValue={jsonValue} />\n        <FeedbackValueGroupSourceCounts feedbacks={feedbacks} />\n      </div>\n      {expanded && (\n        <div\n          css={{\n            display: 'flex',\n            flexDirection: 'column',\n          }}\n        >\n          {feedbacks.map((feedback) =>\n            // don't display assessments that have been overridden\n            feedback?.valid === false ? null : <FeedbackItem feedback={feedback} key={feedback.assessment_id} />,\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n","import { isNil } from 'lodash';\nimport { useState } from 'react';\n\nimport { useDesignSystemTheme, Typography, Button, PlusIcon, Tooltip, DangerIcon } from '@databricks/design-system';\n\nimport { AssessmentCreateForm } from './AssessmentCreateForm';\nimport { getAssessmentDisplayName } from './AssessmentsPane.utils';\nimport { FeedbackValueGroup } from './FeedbackValueGroup';\nimport type { FeedbackAssessment } from '../ModelTrace.types';\n\nexport const FeedbackGroup = ({\n  name,\n  valuesMap,\n  traceId,\n  activeSpanId,\n}: {\n  name: string;\n  valuesMap: { [value: string]: FeedbackAssessment[] };\n  traceId: string;\n  activeSpanId?: string;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const displayName = getAssessmentDisplayName(name);\n  const [showCreateForm, setShowCreateForm] = useState(false);\n  const hasError = Object.values(valuesMap)\n    .flat()\n    .some((feedback) => !isNil(feedback.feedback.error));\n\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        marginBottom: theme.spacing.sm,\n        border: `1px solid ${theme.colors.border}`,\n        borderRadius: theme.borders.borderRadiusMd,\n        padding: theme.spacing.sm + theme.spacing.xs,\n        paddingTop: theme.spacing.sm,\n        gap: theme.spacing.sm,\n      }}\n    >\n      <div\n        css={{\n          display: 'flex',\n          flexDirection: 'row',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          gap: theme.spacing.sm,\n        }}\n      >\n        <div css={{ display: 'flex', alignItems: 'center', gap: theme.spacing.sm, flex: 1, minWidth: 0 }}>\n          <Typography.Text bold css={{ overflow: 'hidden', textOverflow: 'ellipsis', textWrap: 'nowrap' }}>\n            {displayName}\n          </Typography.Text>\n          {hasError && <DangerIcon css={{ flexShrink: 0 }} color=\"danger\" />}\n        </div>\n        <Tooltip content=\"Add new feedback\" componentId=\"shared.model-trace-explorer.add-feedback-in-group-tooltip\">\n          <Button\n            componentId=\"shared.model-trace-explorer.add-feedback\"\n            css={{ flexShrink: 0, marginRight: -theme.spacing.xs }}\n            size=\"small\"\n            icon={<PlusIcon />}\n            onClick={() => setShowCreateForm(true)}\n          />\n        </Tooltip>\n      </div>\n      {Object.entries(valuesMap).map(([jsonValue, feedbacks]) => (\n        <FeedbackValueGroup jsonValue={jsonValue} feedbacks={feedbacks} key={jsonValue} />\n      ))}\n      {showCreateForm && (\n        <AssessmentCreateForm\n          assessmentName={name}\n          spanId={activeSpanId}\n          traceId={traceId}\n          setExpanded={setShowCreateForm}\n        />\n      )}\n    </div>\n  );\n};\n","import { isNil, partition } from 'lodash';\nimport { useMemo } from 'react';\n\nimport { Button, CloseIcon, Tooltip, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport { AssessmentCreateButton } from './AssessmentCreateButton';\nimport { ASSESSMENT_PANE_MIN_WIDTH } from './AssessmentsPane.utils';\nimport { ExpectationItem } from './ExpectationItem';\nimport { FeedbackGroup } from './FeedbackGroup';\nimport type { Assessment, FeedbackAssessment } from '../ModelTrace.types';\nimport { useModelTraceExplorerViewState } from '../ModelTraceExplorerViewStateContext';\n\ntype GroupedFeedbacksByValue = { [value: string]: FeedbackAssessment[] };\n\ntype GroupedFeedbacks = [assessmentName: string, feedbacks: GroupedFeedbacksByValue][];\n\nconst groupFeedbacks = (feedbacks: FeedbackAssessment[]): GroupedFeedbacks => {\n  const aggregated: Record<string, GroupedFeedbacksByValue> = {};\n  feedbacks.forEach((feedback) => {\n    if (feedback.valid === false) {\n      return;\n    }\n\n    let value = null;\n    if (feedback.feedback.value !== '') {\n      value = JSON.stringify(feedback.feedback.value);\n    }\n\n    const { assessment_name } = feedback;\n    if (!aggregated[assessment_name]) {\n      aggregated[assessment_name] = {};\n    }\n\n    const group = aggregated[assessment_name];\n    if (!isNil(value)) {\n      if (!group[value]) {\n        group[value] = [];\n      }\n      group[value].push(feedback);\n    }\n  });\n\n  return Object.entries(aggregated).toSorted(([leftName], [rightName]) => leftName.localeCompare(rightName));\n};\n\nexport const AssessmentsPane = ({\n  assessments,\n  traceId,\n  activeSpanId,\n}: {\n  assessments: Assessment[];\n  traceId: string;\n  activeSpanId?: string;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const { setAssessmentsPaneExpanded } = useModelTraceExplorerViewState();\n  const [feedbacks, expectations] = useMemo(\n    () => partition(assessments, (assessment) => 'feedback' in assessment),\n    [assessments],\n  );\n  const groupedFeedbacks = useMemo(() => groupFeedbacks(feedbacks), [feedbacks]);\n  const sortedExpectations = expectations.toSorted((left, right) =>\n    left.assessment_name.localeCompare(right.assessment_name),\n  );\n\n  return (\n    <div\n      data-testid=\"assessments-pane\"\n      css={{\n        display: 'flex',\n        flexDirection: 'column',\n        padding: theme.spacing.sm,\n        paddingTop: theme.spacing.xs,\n        height: '100%',\n        borderLeft: `1px solid ${theme.colors.border}`,\n        overflowY: 'scroll',\n        minWidth: ASSESSMENT_PANE_MIN_WIDTH,\n        width: '100%',\n        boxSizing: 'border-box',\n      }}\n    >\n      <div css={{ display: 'flex', flexDirection: 'row', justifyContent: 'space-between' }}>\n        <Typography.Text css={{ marginBottom: theme.spacing.sm }} bold>\n          <FormattedMessage defaultMessage=\"Assessments\" description=\"Label for the assessments pane\" />\n        </Typography.Text>\n        {setAssessmentsPaneExpanded && (\n          <Tooltip\n            componentId=\"shared.model-trace-explorer.close-assessments-pane-tooltip\"\n            content={\n              <FormattedMessage\n                defaultMessage=\"Hide assessments\"\n                description=\"Tooltip for a button that closes the assessments pane\"\n              />\n            }\n          >\n            <Button\n              data-testid=\"close-assessments-pane-button\"\n              componentId=\"shared.model-trace-explorer.close-assessments-pane\"\n              size=\"small\"\n              icon={<CloseIcon />}\n              onClick={() => setAssessmentsPaneExpanded(false)}\n            />\n          </Tooltip>\n        )}\n      </div>\n      {groupedFeedbacks.map(([name, valuesMap]) => (\n        <FeedbackGroup key={name} name={name} valuesMap={valuesMap} traceId={traceId} activeSpanId={activeSpanId} />\n      ))}\n      {sortedExpectations.length > 0 && (\n        <>\n          <Typography.Text color=\"secondary\" css={{ marginBottom: theme.spacing.sm }}>\n            <FormattedMessage\n              defaultMessage=\"Expectations\"\n              description=\"Label for the expectations section in the assessments pane\"\n            />\n          </Typography.Text>\n          <div\n            css={{ display: 'flex', flexDirection: 'column', gap: theme.spacing.sm, marginBottom: theme.spacing.sm }}\n          >\n            {sortedExpectations.map((expectation) => (\n              <ExpectationItem expectation={expectation} key={expectation.assessment_id} />\n            ))}\n          </div>\n        </>\n      )}\n      <AssessmentCreateButton title=\"Add new assessment\" spanId={activeSpanId} traceId={traceId} />\n    </div>\n  );\n};\n","export const shouldEnableAssessmentEditing = () => {\n  return true;\n};\nexport const shouldEnableSummaryView = () => {\n  return true;\n};\nexport const getIsMlflowTraceUIEnabled = () => {\n  return true;\n};\n","import React, { useCallback, useMemo } from 'react';\n\nimport { useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { SearchMatch } from './ModelTrace.types';\nimport { getHighlightedSpanComponents } from './ModelTraceExplorer.utils';\nimport { ACTIVE_HIGHLIGHT_COLOR, INACTIVE_HIGHLIGHT_COLOR } from './constants';\n\nexport const ModelTraceExplorerHighlightedCodeSnippet = ({\n  searchFilter,\n  data,\n  activeMatch,\n  containsActiveMatch,\n}: {\n  searchFilter: string;\n  data: string;\n  activeMatch: SearchMatch;\n  containsActiveMatch: boolean;\n}) => {\n  const { theme } = useDesignSystemTheme();\n  const scrollToActiveMatch = useCallback((node: HTMLElement | null) => {\n    node?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n  }, []);\n\n  const spans = useMemo(() => {\n    if (!searchFilter) {\n      return [];\n    }\n\n    return getHighlightedSpanComponents({\n      data,\n      searchFilter,\n      activeMatchBackgroundColor: theme.colors[ACTIVE_HIGHLIGHT_COLOR],\n      inactiveMatchBackgroundColor: theme.colors[INACTIVE_HIGHLIGHT_COLOR],\n      containsActiveMatch,\n      activeMatch,\n      scrollToActiveMatch,\n    });\n  }, [searchFilter, data, theme, containsActiveMatch, activeMatch, scrollToActiveMatch]);\n\n  return (\n    <pre\n      css={{\n        whiteSpace: 'pre-wrap',\n        backgroundColor: theme.colors.backgroundSecondary,\n        padding: theme.spacing.sm,\n        fontSize: theme.typography.fontSizeSm,\n      }}\n    >\n      {spans}\n    </pre>\n  );\n};\n","import { isNil, isString } from 'lodash';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport { Button, ChevronDownIcon, ChevronUpIcon, useDesignSystemTheme } from '@databricks/design-system';\nimport { FormattedMessage } from '@databricks/i18n';\n\nimport type { SearchMatch } from './ModelTrace.types';\nimport { CodeSnippetRenderMode } from './ModelTrace.types';\nimport { ModelTraceExplorerHighlightedCodeSnippet } from './ModelTraceExplorerHighlightedCodeSnippet';\nimport { GenAIMarkdownRenderer } from '../genai-markdown-renderer';\n// eslint-disable-next-line import/no-deprecated\nimport { CodeSnippet, SnippetCopyAction } from '../snippet';\n\nconst MAX_LINES_FOR_PREVIEW = 4;\n// the `isContentLong` check does not work for\n// markdown rendering, since the content is wrapped\nconst MAX_CHARS_FOR_PREVIEW = 300;\n\nexport function ModelTraceExplorerCodeSnippetBody({\n  data,\n  searchFilter = '',\n  activeMatch = null,\n  containsActiveMatch = false,\n  renderMode = CodeSnippetRenderMode.JSON,\n}: {\n  data: string;\n  searchFilter?: string;\n  activeMatch?: SearchMatch | null;\n  containsActiveMatch?: boolean;\n  renderMode?: CodeSnippetRenderMode;\n}) {\n  const containsMatches = Boolean(searchFilter) && !isNil(activeMatch) && data.toLowerCase().includes(searchFilter);\n  const { theme } = useDesignSystemTheme();\n  const [isContentLong, setIsContentLong] = useState(renderMode === 'json');\n  const [expanded, setExpanded] = useState(containsMatches);\n  const snippetRef = useRef<HTMLPreElement>(null);\n  // if the data is rendered in text / markdown mode, then\n  // we need to parse it so that the newlines are unescaped\n  const dataToTruncate: string = useMemo(() => {\n    if (renderMode === 'json') {\n      return data;\n    }\n\n    const parsedData = JSON.parse(data);\n    if (isString(parsedData)) {\n      return parsedData;\n    }\n\n    return data;\n  }, [data, renderMode]);\n\n  const expandable =\n    isContentLong ||\n    dataToTruncate.split('\\n').length > MAX_LINES_FOR_PREVIEW ||\n    dataToTruncate.length > MAX_CHARS_FOR_PREVIEW;\n\n  // Truncate after first 3 lines if not expanded\n  const displayedData = useMemo(() => {\n    if (expandable && !expanded) {\n      const split = dataToTruncate.split('\\n').slice(0, MAX_LINES_FOR_PREVIEW).join('\\n');\n      return split.length > MAX_CHARS_FOR_PREVIEW ? split.slice(0, MAX_CHARS_FOR_PREVIEW) : split;\n    }\n\n    return dataToTruncate;\n  }, [dataToTruncate, expandable, expanded]);\n\n  useEffect(() => {\n    if (snippetRef.current) {\n      setIsContentLong(snippetRef.current.scrollWidth > snippetRef.current.clientWidth);\n    }\n  }, [data]);\n\n  // add a ref to the <pre> component within <CodeSnippet>.\n  // we use the ref to check whether the <pre>'s content is overflowing\n  const PreWithRef = useCallback((preProps: any) => <pre {...preProps} ref={snippetRef} />, []);\n\n  if (containsMatches) {\n    return (\n      // if the snippet contains matches, render the search-highlighted version\n      <ModelTraceExplorerHighlightedCodeSnippet\n        data={data}\n        searchFilter={searchFilter}\n        activeMatch={activeMatch}\n        containsActiveMatch={!activeMatch.isKeyMatch && containsActiveMatch}\n      />\n    );\n  }\n\n  return (\n    <div css={{ position: 'relative' }}>\n      {renderMode === 'markdown' ? (\n        <div\n          css={{\n            padding: theme.spacing.md,\n            backgroundColor: theme.colors.backgroundSecondary,\n            marginBottom: -theme.spacing.md,\n          }}\n        >\n          <GenAIMarkdownRenderer>{displayedData}</GenAIMarkdownRenderer>\n        </div>\n      ) : (\n        <>\n          <SnippetCopyAction\n            key=\"copy-snippet\"\n            componentId=\"shared.model-trace-explorer.copy-snippet\"\n            copyText={data}\n            size=\"small\"\n            css={{ position: 'absolute', top: theme.spacing.xs, right: theme.spacing.xs, zIndex: 1 }}\n          />\n          {/* eslint-disable-next-line import/no-deprecated */}\n          <CodeSnippet\n            PreTag={PreWithRef}\n            showLineNumbers\n            language={renderMode}\n            lineProps={{ style: { wordBreak: 'break-word', whiteSpace: 'pre-wrap' } }}\n            wrapLines={expanded}\n            theme={theme.isDarkMode ? 'duotoneDark' : 'light'}\n            style={{\n              backgroundColor: theme.colors.backgroundSecondary,\n              padding: theme.spacing.sm,\n              paddingBottom: expandable ? 0 : theme.spacing.sm,\n              paddingRight: theme.spacing.md * 2,\n              overflow: expanded ? 'auto' : 'hidden',\n              textOverflow: 'ellipsis',\n              fontSize: theme.typography.fontSizeSm,\n              lineHeight: theme.typography.lineHeightBase,\n            }}\n          >\n            {displayedData}\n          </CodeSnippet>\n        </>\n      )}\n      {expandable && (\n        <div css={{ backgroundColor: theme.colors.backgroundSecondary }}>\n          <Button\n            css={{ width: '100%', padding: 0 }}\n            componentId={\n              expanded ? 'shared.model-trace-explorer.snippet-see-less' : 'shared.model-trace-explorer.snippet-see-more'\n            }\n            icon={expanded ? <ChevronUpIcon /> : <ChevronDownIcon />}\n            type=\"tertiary\"\n            onClick={() => setExpanded(!expanded)}\n          >\n            {expanded ? (\n              <FormattedMessage\n                defaultMessage=\"See less\"\n                description=\"Model trace explorer > selected span > code snippet > see less button\"\n              />\n            ) : (\n              <FormattedMessage\n                defaultMessage=\"See more\"\n                description=\"Model trace explorer > selected span > code snippet > see more button\"\n              />\n            )}\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n}\n","import React from 'react';\nimport { useVirtual } from 'react-virtual';\n\nimport { Table, TableCell, TableHeader, TableRow, useDesignSystemTheme } from '@databricks/design-system';\n\nimport type { ReactMarkdownProps } from './types';\n\nexport function useParsedTableComponents({ children }: ReactMarkdownProps<'table'>): {\n  header: React.ReactNode | undefined;\n  rows: React.ReactElement[];\n  isValid: boolean;\n} {\n  if (!children) {\n    return {\n      header: undefined,\n      rows: [],\n      isValid: false,\n    };\n  }\n\n  const childArray = React.Children.toArray(children);\n\n  const header = childArray[0] ?? undefined;\n\n  // Parse rows, expect all children after the header to be tbody element containing the rows\n  const rows: React.ReactElement[] = childArray.slice(1).flatMap((child) => {\n    if (React.isValidElement(child)) {\n      return React.Children.toArray(child.props.children).filter((c): c is React.ReactElement =>\n        React.isValidElement(c),\n      );\n    }\n    return [];\n  });\n\n  return {\n    header,\n    rows,\n    isValid: true,\n  };\n}\n\nconst BasicTable = ({ children }: ReactMarkdownProps<'table'>) => {\n  return (\n    // Tables with many columns were not scrollable but instead become squished rendering the content unreadable\n    // Fixed by wrapping the table in a div with overflow auto and setting the table to display inline-flex\n    <div data-testid=\"basic-table\" css={{ overflow: 'auto' }}>\n      {/* Table has a \"height: 100%\" style that causes layout issues in some cases */}\n      <Table\n        scrollable\n        css={{\n          height: 'auto',\n          minHeight: 'initial',\n          display: 'inline-flex',\n          // Tables in tool call responses were not taking up the full width of the container\n          minWidth: '100%',\n          zIndex: 0, // Ensure the raised header doesn't cover elements outside the table\n        }}\n        children={children}\n      />\n    </div>\n  );\n};\n\nexport const TableRenderer = ({ children, node }: ReactMarkdownProps<'table'>) => {\n  const { header, rows, isValid } = useParsedTableComponents({ children, node });\n\n  if (!isValid) {\n    // If for some reason the table is not valid, fall back to the basic table\n    return <BasicTable children={children} node={node} />;\n  }\n\n  return <VirtualizedTable header={header} rows={rows} />;\n};\n\nconst MAX_TABLE_HEIGHT = 420;\n\nconst OVERSCAN = 20;\n\nconst VirtualizedTable = ({ header, rows }: { header: React.ReactNode; rows: React.ReactNode[] }) => {\n  const { theme } = useDesignSystemTheme();\n\n  const parentRef = React.useRef<HTMLDivElement>(null);\n\n  const rowVirtualizer = useVirtual({\n    size: rows.length,\n    parentRef,\n    overscan: OVERSCAN,\n  });\n\n  const { virtualItems, totalSize } = rowVirtualizer;\n\n  return (\n    <div\n      data-testid=\"virtualized-table\"\n      ref={parentRef}\n      css={{\n        overflow: 'auto',\n        maxHeight: MAX_TABLE_HEIGHT,\n        border: '1px solid',\n        borderColor: theme.colors.border,\n        borderRadius: theme.borders.borderRadiusMd,\n        marginBottom: theme.spacing.md,\n        zIndex: 0, // Ensure the raised header doesn't cover elements outside the table\n      }}\n    >\n      <Table\n        css={{\n          height: 'auto',\n          minHeight: 'initial',\n          display: 'inline-flex',\n          minWidth: '100%',\n        }}\n      >\n        {header}\n        <div\n          css={{\n            position: 'relative',\n            height: `${totalSize}px`,\n            width: '100%',\n            // Remove bottom border from the last row\n            '& > div:last-child [role=\"cell\"]': { borderBottom: 'none' },\n          }}\n        >\n          {virtualItems.map((virtualRow) => {\n            const rowIndex = virtualRow.index;\n            const rowElement = rows[rowIndex];\n\n            return (\n              <div\n                ref={virtualRow.measureRef}\n                key={rowIndex}\n                css={{\n                  position: 'absolute',\n                  top: `${virtualRow.start}px`,\n                  width: '100%',\n                }}\n              >\n                {rowElement}\n              </div>\n            );\n          })}\n        </div>\n      </Table>\n    </div>\n  );\n};\n\nexport const VirtualizedTableRow = ({ children, node }: ReactMarkdownProps<'tr'>) => {\n  const isHeader = node?.children.some((child) => 'tagName' in child && child.tagName === 'th');\n  const { theme } = useDesignSystemTheme();\n  return (\n    <TableRow\n      style={\n        isHeader\n          ? { position: 'sticky', top: 0, zIndex: 1, backgroundColor: theme.colors.backgroundPrimary }\n          : undefined\n      }\n      children={children}\n      isHeader={isHeader}\n    />\n  );\n};\n\nexport const VirtualizedTableCell = ({ children, node }: ReactMarkdownProps<'td' | 'th'>) => {\n  const isHeader = node?.tagName === 'th';\n  const { theme } = useDesignSystemTheme();\n\n  if (isHeader) {\n    return (\n      <TableHeader\n        data-testid=\"virtualized-table-header\"\n        componentId=\"virtualized-table-header\"\n        css={{ paddingLeft: theme.spacing.sm, borderColor: theme.colors.border, color: theme.colors.textPrimary }}\n        children={children}\n      />\n    );\n  }\n\n  return <TableCell children={children} />;\n};\n","import React, { type ComponentType, useMemo } from 'react';\nimport type { Components, Options, UrlTransform } from 'react-markdown-10';\nimport ReactMarkdown, { defaultUrlTransform } from 'react-markdown-10';\nimport remarkGfm from 'remark-gfm-4';\n\nimport { TableCell, Typography, useDesignSystemTheme } from '@databricks/design-system';\nimport type { CodeSnippetLanguage } from '@databricks/web-shared/snippet';\nimport { CodeSnippet, SnippetCopyAction } from '@databricks/web-shared/snippet';\n\nimport { TableRenderer, VirtualizedTableCell, VirtualizedTableRow } from './TableRenderer';\nimport type { ReactMarkdownComponent, ReactMarkdownComponents, ReactMarkdownProps } from './types';\n\n/**\n * NOTE: react-markdown sanitizes urls by default, including `data:` urls, with the `urlTransform` prop, documented here: https://github.com/remarkjs/react-markdown?tab=readme-ov-file#defaulturltransformurl\n * It uses `micromark-util-sanitize-uri` package under the hood to escape urls and prevent injection: https://github.com/micromark/micromark/tree/main/packages/micromark-util-sanitize-uri#readme\n * We can allow jpeg and png data urls, and use the default transformer for everything else.\n */\nconst urlTransform: UrlTransform = (value) => {\n  if (value.startsWith('data:image/png') || value.startsWith('data:image/jpeg')) {\n    return value;\n  }\n  return defaultUrlTransform(value);\n};\n\nexport const GenAIMarkdownRenderer = (props: { children: string; components?: ExtendedComponents }) => {\n  const components: Components = useMemo(\n    () => getMarkdownComponents({ extensions: props.components }),\n    [props.components],\n  );\n  return (\n    <ReactMarkdown components={components} remarkPlugins={RemarkPlugins} urlTransform={urlTransform}>\n      {props.children}\n    </ReactMarkdown>\n  );\n};\n\nconst CodeMarkdownComponent = ({\n  codeBlock,\n  codeInline,\n  node,\n  ...codeProps\n}: Required<ExtededCodeRenderers> & ReactMarkdownProps<'code'>) => {\n  const language = React.useMemo(() => {\n    const match = /language-(\\w+)/.exec(codeProps.className ?? '');\n    return match && match[1] ? match[1] : undefined;\n  }, [codeProps.className]);\n\n  if (node?.position?.start.line === node?.position?.end.line) {\n    return React.createElement(codeInline, codeProps);\n  }\n\n  return React.createElement(codeBlock, { ...codeProps, language });\n};\n\nconst InlineCode = ({ children }: ReactMarkdownProps<'code'>) => <Typography.Text code>{children}</Typography.Text>;\n\n/**\n * Since this component is quite expensive to render we memoize it so if multiple\n * code blocks are being rendered, we only update the code blocks with changing props\n */\nconst CodeBlock = React.memo(({ children, language }: ReactMarkdownProps<'code'> & { language?: string }) => {\n  const { theme } = useDesignSystemTheme();\n  const code = String(children).replace(/\\n$/, '');\n  return (\n    <div css={{ position: 'relative' }}>\n      <CodeSnippet\n        actions={<SnippetCopyAction componentId=\"genai.util.markdown-copy-code-block\" copyText={code} />}\n        theme={theme.isDarkMode ? 'duotoneDark' : 'light'}\n        children={code}\n        language={language && isCodeSnippetLanguage(language) ? language : 'text'}\n        style={{\n          padding: '8px 0',\n          borderRadius: 8,\n          width: '100%',\n          boxSizing: 'border-box',\n          // Setting a reasonable max height to avoid long code blocks taking up the entire screen.\n          // Component handles scrolling inside it gracefully\n          maxHeight: 640,\n          // Using column-reverse flex layout so the scroll position will stick to the bottom\n          // as new content is streamed in.\n          display: 'flex',\n          flexDirection: 'column-reverse',\n        }}\n        showLineNumbers\n      />\n    </div>\n  );\n});\n\nconst RemarkPlugins: Options['remarkPlugins'] = [remarkGfm];\n\n// react-markdown handles both inline and block code rendering in the same component\n// however, we want to render them differently so we need to split them into two components.\n// This also allows callees to override the default renderers separately\ntype ExtededCodeRenderers = {\n  codeInline?: ReactMarkdownComponent<'code'>;\n  codeBlock?: ComponentType<Omit<ReactMarkdownProps<'code'>, 'ref'> & { language?: string }>;\n};\n\ntype ExtendedComponents = Omit<ReactMarkdownComponents, 'code'> & ExtededCodeRenderers;\n\nexport const getMarkdownComponents = (props: { extensions?: ExtendedComponents }) =>\n  ({\n    a: ({ href, children }) => (\n      <Typography.Link\n        componentId=\"codegen_webapp_js_genai_util_markdown.tsx_71\"\n        href={href}\n        // If the link is to the footnote (starts with #user-content-fn), set id so footnote can link back to it\n        id={\n          href?.startsWith('#user-content-fn-') ? href.replace('#user-content-fn-', 'user-content-fnref-') : undefined\n        }\n        disabled={href?.startsWith('.')}\n        // If the link is to the footnote, add brackets around the children to make it appear as a footnote reference\n        children={href?.startsWith('#user-content-fn-') ? <>[{children}]</> : children}\n        // If the link is an id link, don't open in new tab\n        openInNewTab={!(href && href.startsWith('#'))}\n      />\n    ),\n    code: (codeProps) => (\n      <CodeMarkdownComponent\n        {...codeProps}\n        codeBlock={props.extensions?.codeBlock ?? CodeBlock} // Optionally override the default code block renderer\n        codeInline={props.extensions?.codeInline ?? InlineCode} // Optionally override the default inline code renderer\n      />\n    ),\n    p: ({ children }) => <Typography.Paragraph children={children} />,\n    h1: ({ children }) => <Typography.Title level={1} children={children} />,\n    h2: ({ children }) => <Typography.Title level={2} children={children} />,\n    h3: ({ children }) => <Typography.Title level={3} children={children} />,\n    h4: ({ children }) => <Typography.Title level={4} children={children} />,\n    h5: ({ children }) => <Typography.Title level={5} children={children} />,\n    table: ({ children, node }) => <TableRenderer children={children} node={node} />,\n    tr: ({ children, node }) => <VirtualizedTableRow children={children} node={node} />,\n    th: ({ children, node }) => <VirtualizedTableCell children={children} node={node} />,\n    // Without the multiline prop, the table cell will add ellipsis to the text effictively hiding the content\n    // for long text. This is not the desired behavior for markdown tables.\n    td: ({ children }) => <TableCell children={children} multiline />,\n    // Design system's table does not use thead and tbody elements\n    thead: ({ children }) => <>{children}</>,\n    tbody: ({ children }) => <>{children}</>,\n    img: ({ src, alt }) => <img src={src} alt={alt} css={{ maxWidth: '100%' }} />,\n  } satisfies ReactMarkdownComponents);\n\nconst isCodeSnippetLanguage = (languageString: string): languageString is CodeSnippetLanguage => {\n  // Casting the string to string literal so we can exhaust the union\n  const typeCast = languageString as CodeSnippetLanguage;\n  switch (typeCast) {\n    case 'go':\n    case 'java':\n    case 'javascript':\n    case 'json':\n    case 'python':\n    case 'sql':\n    case 'text':\n    case 'yaml':\n      return true;\n    default:\n      return false;\n  }\n};\n"],"names":["DEFAULT_EXPAND_DEPTH","Infinity","SPAN_INDENT_WIDTH","SPAN_ROW_HEIGHT","TimelineTreeZIndex","HIGH","NORMAL","LOW","getTimelineTreeExpandedNodesList","nodes","expandedKeys","expandedNodesFlat","traverseExpanded","traversedNode","_traversedNode$childr","push","has","key","children","forEach","getTimelineTreeNodesList","_traversedNode$childr2","getTimelineTreeNodesMap","expandDepth","nodesMap","traverse","depth","_traversedNode$childr3","child","useTimelineTreeExpandedNodes","params","setExpandedKeys","useState","rootNodes","list","values","initialExpandDepth","map","node","Set","spanTimeFormatter","executionTimeUs","toFixed","getActiveChildIndex","activeNodeId","_node$children","findIndex","getModelTraceSpanNodeDepth","_node$children2","length","childDepths","Math","max","getSpanNodeParentIds","nodeMap","parents","currentNode","parentId","add","getRoleIcon","role","_jsx","ModelTraceExplorerIcon","type","ModelIconType","SYSTEM","USER","WRENCH","MODELS","getRoleDisplayText","message","FormattedMessage","id","defaultMessage","name","_ref","styles","_ref2","ModelTraceExplorerChatMessageHeader","isExpandable","expanded","setExpanded","theme","useDesignSystemTheme","hoverStyles","backgroundColor","colors","actionIconBackgroundHover","cursor","_jsxs","css","_css","display","flexDirection","alignItems","padding","spacing","sm","gap","onClick","ChevronDownIcon","ChevronRightIcon","tool_call_id","Typography","Text","color","toolName","marginRight","xs","bold","toolCallId","Tooltip","componentId","content","flexShrink","overflow","marginLeft","code","CONTENT_TRUNCATION_LIMIT","ModelTraceExplorerToolCallMessage","toolCall","functionName","Tag","margin","FunctionIcon","whiteSpace","function","ModelTraceExplorerCodeSnippetBody","data","arguments","tryGetJsonContent","JSON","stringify","parse","isJson","error","ModelTraceExplorerChatMessageContent","shouldDisplayCodeSnippet","searchFilter","activeMatch","containsActiveMatch","renderMode","CodeSnippetRenderMode","paddingTop","marginBottom","typography","fontSizeBase","GenAIMarkdownRenderer","ModelTraceExplorerChatMessage","className","_message$content","displayedContent","slice","width","borderRadius","borders","borderRadiusSm","border","backgroundPrimary","isNil","tool_calls","Button","icon","ChevronUpIcon","md","ModelTraceExplorerConversation","messages","index","AssessmentPaneToggle","assessmentsPaneExpanded","setAssessmentsPaneExpanded","assessmentsPaneEnabled","useModelTraceExplorerViewState","SegmentedControlGroup","value","size","SegmentedControlButton","disabled","GavelIcon","useGetModelTraceInfoV3","traceId","setModelTrace","setAssessmentsPaneEnabled","queryKey","FETCH_TRACE_INFO_QUERY_KEY","useQuery","queryFn","fetchTraceInfoV3","onSuccess","response","prevModelTrace","_response$trace$trace","_response$trace","info","trace","trace_info","onError","ModelTraceExplorerSkeleton","label","borderBottom","TitleSkeleton","legacyBorders","borderRadiusMd","flex","borderRight","TableSkeleton","lines","overflowY","ASSESSMENT_PANE_MIN_WIDTH","getAssessmentDisplayName","split","join","timeSinceStr","date","referenceDate","Date","seconds","floor","getTime","interval","timeSince","getParsedExpectationValue","expectation","serialized_value","e","getCreateAssessmentPayloadValue","formValue","dataType","isFeedback","feedback","String","serialization_format","ModelTraceExplorerChatToolsRenderer","title","tools","tool","ModelTraceExplorerChatTool","ModelTraceExplorerRetrieverFieldRenderer","documents","document","idx","ModelTraceExplorerRetrieverDocument","text","page_content","metadata","ModelTraceExplorerTextFieldRenderer","displayValue","justifyContent","paddingLeft","paddingRight","paddingBottom","Link","ModelTraceExplorerFieldRenderer","parsedData","useMemo","dataIsString","isString","chatMessages","normalizeConversation","isChatTools","Array","isArray","every","isModelTraceChatTool","isRetrieverDocuments","isRetrieverDocument","ModelTraceExplorerCodeSnippet","initialRenderMode","TEXT","ModelTraceExplorerSummaryViewExceptionsSection","_firstException$attri","exceptionEvents","getSpanExceptionEvents","isRoot","firstException","ModelTraceExplorerCollapsibleSection","withBorder","sectionKey","XCircleIcon","lg","Object","entries","attributes","attribute","_ref3","ModelTraceExplorerSummaryIntermediateNode","inputList","createListFromObject","inputs","outputList","outputs","hasException","containsInputs","containsOutputs","setSelectedNode","setActiveView","setShowTimelineTreeGantt","minHeight","height","position","boxSizing","borderLeft","left","top","borderBottomLeftRadius","spanName","SpanNameDetailViewLink","end","start","ModelTraceExplorerSummarySpans","rootNode","intermediateNodes","setRenderMode","rootInputs","rootOutputs","exceptions","hasIntermediateNodes","hasExceptions","minWidth","onChange","event","target","isNodeImportant","_node$type","ModelSpanType","AGENT","RETRIEVER","CHAT_MODEL","TOOL","LLM","includes","UNKNOWN","getSpanExceptionCount","ModelTraceExplorerSummaryView","modelTrace","paneWidth","setPaneWidth","allAssessments","flatMap","assessments","filter","ModelTraceExplorerResizablePane","initialRatio","leftChild","rightChild","AssessmentsPane","activeSpanId","undefined","leftMinWidth","rightMinWidth","marginTop","Empty","description","ACTIVE_HIGHLIGHT_COLOR","INACTIVE_HIGHLIGHT_COLOR","ModelTraceExplorerHighlightedSnippetTitle","isActiveMatch","scrollToActiveMatch","useCallback","scrollIntoView","block","inline","titleLower","toLowerCase","startIdx","indexOf","endIdx","ref","scrollMarginTop","getInitialRenderMode","MARKDOWN","getRenderModeDisplayText","_ref4","tokens","_activeMatch$isKeyMat","isTitleMatch","isKeyMatch","shouldShowRenderModeDropdown","useEffect","Title","level","withoutMargins","DropdownMenu","Root","Trigger","asChild","Content","RadioGroup","onValueChange","mode","RadioItem","ItemIndicator","Arrow","background","backgroundSecondary","borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderTop","isAnthropicContentBlockParam","obj","source","media_type","url","isObject","input","tool_use_id","isAnthropicMessageParam","hasRole","hasContent","normalizeAnthropicContentBlockParam","item","image_url","Error","processAnthropicMessage","chatMessage","prettyPrintChatMessage","toolMessages","textParts","toolCalls","processAnthropicMessageContent","isGeminiContentPart","isGeminiContent","parts","isGeminiCandidate","normalizeOpenAIChatInput","_obj$messages","isRawModelTraceChatMessage","compact","normalizeOpenAIChatResponse","isModelTraceChoices","choice","_choice$message$tool_","prettyPrintToolCall","isModelTraceChatResponse","choices","_choice$message$tool_2","isOpenAIResponsesInputMessage","isOpenAIResponsesOutputItem","get","outputFormat","normalizeOpenAIResponsesInputMessage","normalizeOpenAIResponsesInputItem","imageUrl","normalizeOpenAIResponsesOutputItem","call_id","output","output_format","result","isOpenAIAgentMessage","normalizeOpenAIAgentMessage","textContent","callId","arguments_","langchainMessageToModelTraceMessage","_message$additional_k","part","_part$image_url","Boolean","normalizedMessage","toolCallsFromKwargs","additional_kwargs","isLangchainToolCallMessage","normalizeLangchainToolCall","isModelTraceToolCall","args","isLangchainBaseMessage","isLangchainChatGeneration","getMessagesFromLangchainChatGenerations","generations","generation","some","normalizeLangchainChatResult","isLangchainChatGenerations","isLlamaIndexChatMessageBlock","isLlamaIndexChatMessage","blocks","prettyPrintMessage","normalizeLlamaIndexChatResponse","isLlamaIndexChatResponse","normalizeLlamaIndexChatInput","isLlamaIndexChatInput","isAutogenFunctionCall","isAutogenMessage","messageType","convertAssistantMessageToChatMessage","f","normalizeAutogenMessage","parseBedrockContent","json","image","bytes","format","Buffer","from","toString","convertBedrockMessageToChatMessage","contents","toolUse","toolUseId","toolResult","resultContent","parsedContent","contentString","isBedrockMessage","displayErrorNotification","errorMessage","getIconTypeForSpan","spanType","CHAIN","SEARCH","PARSER","CODE","EMBEDDING","NUMBERS","RERANKER","SORT","MEMORY","SAVE","FUNCTION","getDisplayNameForSpanType","tryDeserializeAttribute","getMatchesFromSpan","span","matches","sections","events","section","getMatchesFromEvent","keys","getEventAttributeKey","matchIndex","numValueMatches","i","searchTree","spanFilterState","_rootNode$children","searchFilterLowercased","trim","allSpanTypesSelected","spanTypeDisplayState","shouldDisplay","filteredTreeNodes","filteredChildren","childNodes","childMatches","spanMatches","nodeMatchesSearch","spanTypeIsDisplayed","nodePassesSpanFilters","hasMatchingChild","showParents","showExceptions","concat","searchTreeBySpanId","selectedSpanId","_rootNode$children2","matchedNode","normalizeNewSpanData","rootStartTime","rootEndTime","assessmentMap","_span$attributes","_span$attributes2","_span$attributes3","_assessmentMap$spanId","_span$attributes4","_span$attributes5","_span$attributes6","_getModelTraceSpanEnd","getModelTraceSpanParentId","spanId","getModelTraceSpanId","_assessmentMap$","messagesAttributeValue","messageFormat","getChatMessagesFromSpan","spanAttributes","_normalizeConversatio","_normalizeConversatio2","messagesFromInputs","messagesFromOutputs","chatTools","getChatToolsFromSpan","toolsAttributeValue","_inputs$tools","mapValues","omitBy","_","startsWith","Number","getModelTraceSpanStartTime","getModelTraceSpanEndTime","isRootSpan","decodeSpanId","isV3Span","base64","binaryString","atob","binaryLen","hex","charCodeAt","padStart","base64ToHex","isV3ModelTraceInfo","isV3ModelTraceSpan","_span$context$span_id","_span$context","span_id","context","_span$parent_span_id","_span$parent_id","parent_span_id","parent_id","start_time_unix_nano","start_time","end_time_unix_nano","end_time","getModelTraceId","_trace$info$request_i","trace_id","request_id","parseModelTraceToTree","_trace$trace_data$spa","_trace$trace_data","spans","trace_data","spanMap","relationMap","rootSpan","find","getSpanNodeFromData","_span$span_type","_span$end_time","_span$parent_id2","rootStart","rootEnd","getAssessmentMap","span_type","traceInfo","_traceInfo$assessment","getAssessmentsFromTags","tags","assessmentsById","keyBy","assessment","overrides","overriddenAssessment","reduce","acc","_assessment$span_id","sort","a","b","last_update_time","isNumber","isBoolean","getHighlightedSpanComponents","activeMatchBackgroundColor","inactiveMatchBackgroundColor","regex","RegExp","escapeRegExp","isRenderableRetrieverSpan","_span$events","isModelTraceChatToolParamProperty","enum","_obj$function","parameters","required","properties","_obj$function2","_obj$function3","isContentType","detail","input_audio","isContentPart","_normalizeLangchainCh","_normalizeLlamaIndexC","_normalizeOpenAIChatI","_normalizeDspyChatInp","_normalizeGeminiChatI","_normalizeAnthropicCh","_normalizeOpenAIAgent","_normalizeAutogenChat","_normalizeBedrockChat","_normalizeOpenAIChatI2","langchainMessages","normalizeLangchainChatInput","llamaIndexMessages","openAIMessages","chunk","normalizeOpenAIResponsesOutput","normalizeOpenAIResponsesInput","dspyMessages","msg","normalizeDspyChatInput","normalizeDspyChatOutput","geminiMessages","normalizeGeminiChatInput","candidates","anthropicMessages","normalizeAnthropicChatInput","normalizeAnthropicChatOutput","openAIAgentMessages","normalizeOpenAIAgentInput","normalizeOpenAIAgentOutput","autogenMessages","normalizeAutogenChatInput","normalizeAutogenChatOutput","bedrockMessages","normalizeBedrockChatInput","normalizeBedrockChatOutput","_toolCall$function","formatChatContent","_message$tool_calls","textDecoration","textDecorationColor","actionDangerDefaultTextDefault","actionDefaultTextDefault","textOverflow","CONNECT","isInTooltip","iconColor","iconMap","ModelsIcon","DOCUMENT","FileDocumentIcon","ConnectIcon","CodeIcon","NumbersIcon","SearchIcon","SortUnsortedIcon","QuestionMarkIcon","WrenchIcon","UserSparkleIcon","ChainIcon","UserIcon","GearIcon","SaveIcon","actionDefaultIconDefault","tooltipColor","actionPrimaryIcon","textValidationSuccess","green500","isDarkMode","green800","green100","blue500","turquoise","blue800","blue100","red500","red700","red800","red100","general","iconSize","tooltipBackgroundTooltip","svg","iconFontSize","right","actionDangerPrimaryBackgroundDefault","zIndex","getTruncatedStyles","shouldTruncate","KeyValueTag","itemKey","itemValue","charLimit","maxWidth","shouldTruncateKey","shouldTruncateValue","fullLength","isKeyLonger","shorterLength","getKeyAndValueComplexTruncation","ModelTraceExplorerRetrieverDocumentFull","metadataTags","logDocumentClick","lineHeightBase","ModelTraceExplorerRetrieverDocumentPreview","ellipsis","ModelTraceExplorerErrorState","DangerIcon","ModelTraceExplorerSearchBox","setSearchFilter","matchData","handleNextSearchMatch","handlePreviousSearchMatch","searchValue","setSearchValue","debouncedSetSearchFilter","useDebouncedCallback","Input","allowClear","placeholder","onClear","prefix","match","currentMatchIndex","totalMatches","getTabForMatch","useModelTraceSearch","treeNode","selectedNode","setActiveTab","modelTraceInfo","_matches$activeMatchI","setSpanFilterState","getDefaultSpanFilterState","activeMatchIndex","setActiveMatchIndex","selectMatch","newMatchIndex","useLayoutEffect","_selectedNode$key","selectedNodeKey","newSpan","ModelTraceExplorerAttributesTab","activeSpan","containsAttributes","isActiveMatchSpan","ModelTraceExplorerChatTab","ModelTraceExplorerDefaultSpanView","ModelTraceExplorerRenderModeToggle","shouldRenderMarkdown","setShouldRenderMarkdown","TextBoxIcon","fontSize","fontSizeLg","MIcon","ModelTraceExplorerRetrieverSpanView","outputsContainsActiveMatch","ModelTraceExplorerContentTab","ModelTraceExplorerEventsTab","_Fragment","ModelTraceExplorerBadge","count","actionPrimaryTextDefault","RIGHT_PANE_MIN_WIDTH","ModelTraceExplorerRightPaneTabsImpl","activeTab","contentStyle","exceptionCount","tabContent","Tabs","tab","List","ModelTraceExplorerRightPaneTabs","React","TimelineTreeFilterButton","Popover","FilterIcon","align","Checkbox","style","isChecked","InfoTooltip","TimelineTreeHeader","showTimelineInfo","setShowTimelineInfo","ListBorderIcon","BarsAscendingVerticalIcon","IconBottomConnector","active","borderColor","bottom","IconLeftConnector","VerticalConnector","TimelineTreeHierarchyBars","isActiveSpan","isInActiveChain","linesToRender","hasChildren","isExpanded","shouldRender","isActive","TimelineTreeSpanTooltip","_span$type","iconType","primaryTextColor","grey800","grey100","secondaryTextColor","grey500","grey350","hideWhenDetached","wordBreak","fontSizeSm","side","TimelineTreeNode","selectedKey","traceStartTime","traceEndTime","onSelect","activeChildIndex","actionDefaultBackgroundHover","actionDefaultBackgroundPress","stopPropagation","newExpandedKeys","delete","_node$children$length","_node$children3","TimelineTreeGanttNode","leftOffset","titleInBarRef","useRef","titleBesideBarRef","current","offsetWidth","blue600","white","textPrimary","TimelineTreeGanttBars","_useResizeObserver$wi","_useResizeObserver","treeContainerRef","treeElementWidth","useResizeObserver","initialXTicks","graphWidth","minPixelsBetweenTicks","range","maxTickCount","rawInterval","magnitude","pow","log10","residual","niceFraction","niceInterval","extendedRight","ticks","tick","ceil","getNiceXTicks","min","xTicks","scaleDurationToTreeWidth","scaleX","n","transform","pointerEvents","TimelineTree","onSpanClick","showTimelineTreeGantt","expandedNodesList","treeElement","_selectedNode$key2","ModelTraceExplorerDetailView","onSelectSpan","_treeNode$start","_treeNode$end","window","innerWidth","paneRef","leftPaneMinWidth","minWidthForSpans","getUser","fetchFn","fetch","serializeRequestBody","payload","FormData","Blob","fetchAPI","async","method","body","headers","ok","predefinedError","matchPredefinedError","deleteAssessment","assessmentId","createAssessment","updateAssessment","ModelTraceExplorerChatToolParam","paramName","paramProperties","isRequired","enumValues","hasAdditionalInfo","borderStyles","gridTemplateColumns","gridTemplateRows","flexWrap","_tool$function$parame","_tool$function$parame2","_tool$function$parame3","requiredParams","Paragraph","ModelTraceExplorerViewStateContext","createContext","activeView","useContext","ModelTraceExplorerViewStateProvider","initialActiveView","selectedSpanIdOnRender","_defaultSelectedNode$","_defaultSelectedNode$2","selectedSpanOnRender","defaultSelectedNode","hasAssessments","Provider","forwardRef","isResizing","setIsResizing","containerRef","containerWidth","ratio","updateRatio","newPaneWidth","useImperativeHandle","clamp","Global","ResizableBox","axis","handle","onResize","clampedSize","onResizeStart","onResizeStop","minConstraints","maxConstraints","ModelTraceHeaderMetricSection","tagKey","getTruncatedLabel","getComponentId","onCopy","handleClick","navigator","clipboard","writeText","ModelTraceHeaderDetails","_modelTrace$info$tags","useIntl","showNotification","setShowNotification","isUserFacingTag","modelTraceId","tokenUsage","_trace_metadata$mlflo","_modelTrace$info","_modelTrace$info$trac","parseJSONSafe","trace_metadata","totalTokens","total_tokens","latency","truncateToFirstLineWithMaxLength","str","maxLength","truncated","char","handleCopy","setTimeout","ClockIcon","Overflow","noMargin","fullText","Notification","severity","Viewport","AssessmentCreateForm","assessmentName","intl","queryClient","useQueryClient","setName","assessmentType","setAssessmentType","setDataType","setValue","rationale","setRationale","valueError","setValueError","mutate","createAssessmentMutation","isLoading","useMutation","mutationFn","invalidateQueries","formatMessage","onSettled","isNamePrefilled","handleCreate","_getUser","valueObj","assessment_name","source_type","source_id","SimpleSelect","SimpleSelectOption","onKeyDown","TextArea","autoSize","minRows","maxRows","validationState","FormUI","Message","loading","AssessmentCreateButton","PlusIcon","AssessmentActionsOverflowMenu","setIsEditing","setShowDeleteModal","user","isEditEnabled","shouldEnableAssessmentEditing","doesUserHavePermissions","showEditButton","OverflowIcon","Item","IconWrapper","PencilIcon","TrashIcon","AssessmentDeleteModal","isModalVisible","setIsModalVisible","deleteAssessmentMutation","assessment_id","handleDelete","Modal","visible","onOk","okButtonProps","danger","okText","onCancel","cancelText","confirmLoading","AssessmentEditForm","initialValue","getAssessmentValue","defaultType","getDefaultType","defaultValue","getDefaultValue","updateAssessmentMutation","isUpdating","useUpdateAssessment","overrideAssessmentMutation","isOverwriting","useOverrideAssessment","oldAssessment","newAssessment","omit","handleUpdate","update_mask","rows","ExpectationValuePreview","objectKey","getValuePreview","parsedValue","ExpectationItem","isEditing","showDeleteModal","associatedSpan","showAssociatedSpan","AssessmentDisplayValue","jsonValue","CheckCircleIcon","AssessmentSourceName","textWrap","AssessmentItemHeader","renderConnector","SourceIcon","SparkleIcon","getSourceIcon","borderRadiusFull","FeedbackErrorItem","Alert","closable","error_code","error_message","stack_trace","footer","FeedbackHistoryItem","FeedbackHistoryModal","assessmentHistory","seen","flattened","currentAssessment","flattenOverrides","FeedbackItemContent","isHistoryModalVisible","setIsHistoryModalVisible","FeedbackItem","getSourceTypeIcon","sourceType","smallIconStyles","FeedbackValueGroupSourceCounts","feedbacks","sourceCounts","countBy","FeedbackValueGroup","valid","FeedbackGroup","valuesMap","displayName","showCreateForm","setShowCreateForm","hasError","flat","expectations","partition","groupedFeedbacks","aggregated","group","toSorted","leftName","rightName","localeCompare","groupFeedbacks","sortedExpectations","CloseIcon","shouldEnableSummaryView","ModelTraceExplorerHighlightedCodeSnippet","MAX_LINES_FOR_PREVIEW","MAX_CHARS_FOR_PREVIEW","containsMatches","isContentLong","setIsContentLong","snippetRef","dataToTruncate","expandable","displayedData","scrollWidth","clientWidth","PreWithRef","preProps","SnippetCopyAction","copyText","CodeSnippet","PreTag","showLineNumbers","language","lineProps","wrapLines","lineHeight","BasicTable","Table","scrollable","TableRenderer","header","isValid","_childArray$","childArray","toArray","props","c","useParsedTableComponents","VirtualizedTable","parentRef","rowVirtualizer","useVirtual","overscan","virtualItems","totalSize","maxHeight","virtualRow","rowIndex","rowElement","measureRef","VirtualizedTableRow","isHeader","tagName","TableRow","VirtualizedTableCell","TableHeader","TableCell","urlTransform","defaultUrlTransform","components","getMarkdownComponents","extensions","ReactMarkdown","remarkPlugins","RemarkPlugins","CodeMarkdownComponent","codeBlock","codeInline","codeProps","_node$position","_node$position2","_codeProps$className","exec","line","InlineCode","CodeBlock","replace","actions","isCodeSnippetLanguage","remarkGfm","href","openInNewTab","_props$extensions$cod","_props$extensions","_props$extensions$cod2","_props$extensions2","p","h1","h2","h3","h4","h5","table","tr","th","td","multiline","thead","tbody","img","src","alt","languageString"],"ignoreList":[],"sourceRoot":""}