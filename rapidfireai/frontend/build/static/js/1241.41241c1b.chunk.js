"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1241],{793:function(e,t,n){n.d(t,{B$:function(){return p},De:function(){return o},EA:function(){return h},NP:function(){return f},QJ:function(){return a},VC:function(){return d},VD:function(){return g},X6:function(){return m},dM:function(){return u},os:function(){return c},u4:function(){return l},vf:function(){return i}});var s=n(45901),r=n(76998);const i=1/0,o=16,a=32,l={HIGH:5,NORMAL:3,LOW:1},c=(e,t)=>{const n=[],s=e=>{var r;e&&(n.push(e),t.has(e.key)&&(null===(r=e.children)||void 0===r||r.forEach(s)))};return e.forEach(s),n},d=e=>{const t=[],n=e=>{var s;e&&(t.push(e),null===(s=e.children)||void 0===s||s.forEach(n))};return e.forEach(n),t},u=(e,t=1/0)=>{const n={},s=(e,r)=>{var i;!e||r>t||(n[e.key]=e,null===(i=e.children)||void 0===i||i.forEach(e=>s(e,r+1)))};return e.forEach(s,0),n},p=(e={})=>{const[t,n]=(0,r.useState)(()=>{if(e.rootNodes){const t=(0,s.values)(u(e.rootNodes,e.initialExpandDepth)).map(e=>e.key);return new Set(t)}return new Set});return{expandedKeys:t,setExpandedKeys:n}},m=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},g=(e,t)=>{var n;return e.key===t?0:(null!==(n=e.children)&&void 0!==n?n:[]).findIndex(e=>g(e,t)>-1)},h=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const n=e.children.map(h);return Math.max(...n)+1},f=(e,t)=>{const n=new Set;let s=e;for(;s&&s.parentId;)n.add(s.parentId),s=t[s.parentId];return n}},11687:function(e,t,n){n.d(t,{J:function(){return M}});var s=n(64819),r=n(45901),i=n(37733),o=n(76998),a=n(32256),l=n(49818),c=n(99397),d=n(29332),u=n(2515),p=n(69822),m=n(51391);const g=e=>{switch(e){case"system":return(0,m.Y)(p.P,{type:u.Dy.SYSTEM});case"user":return(0,m.Y)(p.P,{type:u.Dy.USER});case"tool":case"function":return(0,m.Y)(p.P,{type:u.Dy.WRENCH});default:return(0,m.Y)(p.P,{type:u.Dy.MODELS})}},h=e=>{switch(e.role){case"system":return(0,m.Y)(l.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,m.Y)(l.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,m.Y)(l.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,m.Y)(l.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,m.Y)(l.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var f={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},v={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const y=({isExpandable:e,expanded:t,setExpanded:n,message:r})=>{const{theme:o}=(0,i.u)(),c=e?{":hover":{backgroundColor:o.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,m.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:o.spacing.sm,gap:o.spacing.sm,...c},""),onClick:()=>n(!t),children:[e&&(t?(0,m.Y)(a.ChevronDownIcon,{}):(0,m.Y)(i.o,{})),g(r.role),r.tool_call_id?(0,m.Y)(i.T.Text,{color:"secondary",css:f,children:(0,m.Y)(l.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,m.Y)(i.T.Text,{css:(0,s.AH)({marginRight:o.spacing.xs},""),bold:!0,children:h(r)}),toolCallId:(0,m.Y)(d.T,{componentId:"test",content:r.tool_call_id,children:(0,m.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:o.spacing.xs},""),children:(0,m.Y)(i.T.Text,{css:v,code:!0,children:r.tool_call_id})})})}})}):(0,m.Y)(i.T.Text,{bold:!0,children:h(r)})]})},x=300;var b=n(93806);var Y={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function S({toolCall:e}){const{theme:t}=(0,i.u)();return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,m.Y)(i.T.Text,{color:"secondary",css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,m.Y)(l.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,m.FD)(a.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,s.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,m.Y)(a.FunctionIcon,{}),(0,m.Y)(i.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,m.Y)(d.T,{componentId:"test",content:e.id,children:(0,m.Y)("div",{css:(0,s.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,m.Y)(i.T.Text,{css:Y,code:!0,color:"secondary",children:e.id})})})}})}),(0,m.Y)(b.w,{data:e.function.arguments})]},e.id)}const A=e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}};function w({content:e,shouldDisplayCodeSnippet:t}){const{theme:n}=(0,i.u)();return e?t?(0,m.Y)(b.w,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:u.cC.JSON}):(0,m.Y)("div",{css:(0,s.AH)({padding:n.spacing.sm,paddingTop:0,marginBottom:-n.typography.fontSizeBase},""),children:(0,m.Y)(c.V,{children:e})}):null}function T({message:e,className:t}){var n;const{theme:c}=(0,i.u)(),[d,u]=(0,o.useState)(!1),{content:p,isJson:g}=A(null!==(n=e.content)&&void 0!==n?n:""),h=g&&("tool"===e.role||"function"===e.role),f=!h&&p.length>x,v=f&&!d?`${p.slice(0,x)}...`:p;return(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:c.borders.borderRadiusSm,border:`1px solid ${c.colors.border}`,backgroundColor:c.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,m.Y)(y,{isExpandable:f,expanded:d,setExpanded:u,message:e}),(0,m.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm},""),children:[!(0,r.isNil)(e.tool_calls)&&e.tool_calls.map(e=>(0,m.Y)(S,{toolCall:e},e.id)),(0,m.Y)(w,{content:v,shouldDisplayCodeSnippet:h})]}),f&&(0,m.Y)(i.B,{componentId:d?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:d?(0,m.Y)(a.ChevronUpIcon,{}):(0,m.Y)(a.ChevronDownIcon,{}),type:"tertiary",onClick:()=>u(!d),css:(0,s.AH)({display:"flex",width:"100%",padding:c.spacing.md,borderRadius:"0px !important"},""),children:d?(0,m.Y)(l.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,m.Y)(l.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}function M({messages:e}){const{theme:t}=(0,i.u)();return(0,r.isNil)(e)?null:(0,m.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map((e,t)=>(0,m.Y)(T,{message:e},t))})}},16155:function(e,t,n){n.d(t,{N:function(){return c}});var s=n(32256),r=n(49818),i=n(84918),o=n(51391);var a={name:"4zleql",styles:"display:block"},l={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const c=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:n}=(0,i.nJ)();return(0,o.Y)(s.SegmentedControlGroup,{css:a,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,o.Y)(s.SegmentedControlButton,{value:!0,disabled:!n,icon:(0,o.Y)(s.GavelIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),css:l,children:!e&&(0,o.Y)(r.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})}},30553:function(e,t,n){n.d(t,{T:function(){return o}});var s=n(13843),r=n(61520),i=n(79855);const o=({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:n})=>{const o=[r.BS,e];return(0,s.I)({queryKey:o,queryFn:()=>(0,i.N5)({traceId:e}),onSuccess:e=>{t(t=>{var n,s;return{data:t.data,info:null!==(n=null===e||void 0===e||null===(s=e.trace)||void 0===s?void 0:s.trace_info)&&void 0!==n?n:{}}}),n(!0)},onError:()=>{n(!1)}})}},36420:function(e,t,n){n.d(t,{F:function(){return c}});var s=n(64819),r=n(32256),i=n(37733),o=n(51391);var a={name:"15currb",styles:"display:flex;height:100%"},l={name:"82a6rk",styles:"flex:1"};const c=({label:e})=>{const{theme:t}=(0,i.u)();return(0,o.FD)("div",{css:a,children:[(0,o.FD)("div",{css:l,children:[(0,o.Y)("div",{css:(0,s.AH)({padding:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,o.Y)(r.TitleSkeleton,{label:e})}),(0,o.FD)("div",{css:(0,s.AH)({borderRadius:t.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,o.Y)("div",{css:(0,s.AH)({flex:1,padding:t.spacing.sm,borderRight:`1px solid ${t.colors.border}`},""),children:(0,o.Y)(r.TableSkeleton,{lines:5})}),(0,o.Y)("div",{css:(0,s.AH)({flex:2,padding:t.spacing.sm},""),children:(0,o.Y)(r.TableSkeleton,{lines:5})})]})]}),(0,o.Y)("div",{css:(0,s.AH)({padding:t.spacing.md,overflowY:"auto",flex:1},""),children:(0,o.Y)(r.TableSkeleton,{lines:12})})]})}},38073:function(e,t,n){n.d(t,{KN:function(){return c},Pt:function(){return a},jf:function(){return l},se:function(){return o},uZ:function(){return i}});var s=n(49818),r=n(51391);const i=250,o=e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")},a=(e,t=new Date)=>{const n=Math.max(0,Math.floor((t.getTime()-e)/1e3));let i=Math.floor(n/31536e3);return i>=1?(0,r.Y)(s.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:i}}):(i=Math.floor(n/2592e3),i>=1?(0,r.Y)(s.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:i}}):(i=Math.floor(n/86400),i>=1?(0,r.Y)(s.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:i}}):(i=Math.floor(n/3600),i>=1?(0,r.Y)(s.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:i}}):(i=Math.floor(n/60),i>=1?(0,r.Y)(s.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:i}}):(0,r.Y)(s.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))},l=e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}},c=({formValue:e,dataType:t,isFeedback:n})=>n?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}}},40143:function(e,t,n){n.d(t,{b:function(){return E}});var s=n(64819),r=n(76998),i=n(37733),o=n(32256),a=n(49818),l=n(61520),c=n(56828),d=n(45901),u=n(83689),p=n(51391);const m=({title:e,tools:t})=>{const{theme:n}=(0,i.u)();return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,padding:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,p.Y)(i.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),bold:!0,children:e}),t.map(e=>(0,p.Y)(u.E,{tool:e},e.function.name))]})};var g=n(69910);const h=({title:e,documents:t})=>{const{theme:n}=(0,i.u)();return(0,p.FD)("div",{css:(0,s.AH)({backgroundColor:n.colors.backgroundPrimary,borderRadius:n.borders.borderRadiusSm,border:`1px solid ${n.colors.border}`},""),children:[e&&(0,p.Y)("div",{css:(0,s.AH)({padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderBottom:`1px solid ${n.colors.border}`},""),children:(0,p.Y)(i.T.Text,{bold:!0,children:e})}),t.map((e,r)=>(0,p.Y)("div",{css:(0,s.AH)({borderBottom:r!==t.length-1?`1px solid ${n.colors.border}`:""},""),children:(0,p.Y)(g.p,{text:e.page_content,metadata:e.metadata},r)},r))]})};var f=n(99397);const v=({title:e,value:t})=>{const{theme:n}=(0,i.u)(),[l,c]=(0,r.useState)(!1),d=t.length>400,u=!l&&t.length>400?t.slice(0,400)+"...":t,m=d?{":hover":{backgroundColor:n.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,p.FD)("div",{css:(0,s.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,p.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${n.spacing.sm}px ${n.spacing.sm+n.spacing.xs}px`,...m},""),onClick:()=>c(!l),children:[(0,p.Y)(i.T.Text,{bold:!0,children:e}),d&&(l?(0,p.Y)(o.ChevronDownIcon,{}):(0,p.Y)(i.o,{}))]}),(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.sm+n.spacing.xs,paddingRight:n.spacing.sm+n.spacing.xs,paddingTop:e?0:n.spacing.sm,paddingBottom:n.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,p.Y)(f.V,{children:u}),d&&(0,p.Y)(i.T.Link,{onClick:()=>c(!l),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:l?(0,p.Y)(a.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,p.Y)(a.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})};var y=n(2515),x=n(53319),b=n(11687);const Y=({title:e,data:t,renderMode:n})=>{const s=(0,r.useMemo)(()=>{try{return JSON.parse(t)}catch(e){return t}},[t]),i=(0,d.isString)(s),o=(0,l.Hq)(s),a=Array.isArray(s)&&s.length>0&&(0,d.every)(s,l.PC),c=Array.isArray(s)&&s.length>0&&(0,d.every)(s,l.W0);return"json"===n?(0,p.Y)(x.C,{title:e,data:t,initialRenderMode:y.cC.JSON}):"text"===n?(0,p.Y)(x.C,{title:e,data:t,initialRenderMode:y.cC.TEXT}):i?(0,p.Y)(v,{title:e,value:s}):o&&o.length>0?(0,p.Y)(b.J,{messages:o}):a?(0,p.Y)(m,{title:e,tools:s}):c?(0,p.Y)(h,{title:e,documents:s}):(0,p.Y)(x.C,{title:e,data:t})},S=({node:e})=>{var t;const{theme:n}=(0,i.u)(),r=(0,l.bn)(e),a=!e.parentId,d=r[0];return d?(0,p.Y)(c.p,{css:(0,s.AH)({marginBottom:a?n.spacing.sm:0},""),withBorder:a,sectionKey:d.name,title:(0,p.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:[(0,p.Y)(o.XCircleIcon,{color:"danger"}),(0,p.Y)(i.T.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.sm,paddingLeft:a?0:n.spacing.lg},""),children:Object.entries(null!==(t=d.attributes)&&void 0!==t?t:{}).map(([e,t])=>(0,p.Y)(Y,{title:e,data:JSON.stringify(t,null,2),renderMode:"text"},e))})},d.name):null};var A=n(84918),w=n(61938),T=n(793);var M={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},D={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},k={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const C=({node:e,renderMode:t})=>{const{theme:n}=(0,i.u)(),[d,u]=(0,r.useState)(!1),m=(0,r.useMemo)(()=>(0,l.g_)(e.inputs),[e]),g=(0,r.useMemo)(()=>(0,l.g_)(e.outputs),[e]),h=(0,l.bn)(e).length>0,f=m.length>0,v=g.length>0,{setSelectedNode:y,setActiveView:x,setShowTimelineTreeGantt:b}=(0,A.nJ)();return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,p.Y)("div",{css:(0,s.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,p.Y)(i.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:n.spacing.xs},""),icon:d?(0,p.Y)(o.ChevronDownIcon,{}):(0,p.Y)(i.o,{}),onClick:()=>u(!d),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,p.Y)("div",{css:(0,s.AH)({position:"relative",boxSizing:"border-box",height:"100%",borderLeft:`2px solid ${n.colors.border}`,width:12},""),children:(0,p.Y)("div",{css:(0,s.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:n.borders.borderRadiusMd,borderBottom:`2px solid ${n.colors.border}`,borderLeft:`2px solid ${n.colors.border}`},"")})}),(0,p.FD)("div",{css:M,children:[(0,p.FD)("div",{css:D,children:[(0,p.Y)(i.T.Text,{color:"secondary",css:(0,s.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,p.Y)(a.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,p.Y)(w.o,{node:e})}})}),(0,p.Y)("span",{onClick:()=>{y(e),x("detail"),b(!0)},children:(0,p.Y)(i.T.Text,{css:k,color:"secondary",children:(0,T.X6)(e.end-e.start)})})]}),d&&(0,p.FD)("div",{children:[h&&(0,p.Y)(S,{node:e}),f&&(0,p.Y)(c.p,{sectionKey:"input",title:(0,p.Y)(a.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:v?0:n.spacing.sm},""),children:m.map(({key:e,value:n},s)=>(0,p.Y)(Y,{title:e,data:n,renderMode:t},e||s))})}),v&&(0,p.Y)(c.p,{sectionKey:"output",title:(0,p.Y)(a.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:g.map(({key:e,value:n})=>(0,p.Y)(Y,{title:e,data:n,renderMode:t},e))})})]})]})]})};var I=n(16155);const N=({rootNode:e,intermediateNodes:t})=>{const{theme:n}=(0,i.u)(),[d,u]=(0,r.useState)("default"),m=e.inputs,g=e.outputs,h=(0,l.bn)(e),f=t.length>0,v=h.length>0,y=(0,l.g_)(m),x=(0,l.g_)(g);return(0,p.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:n.spacing.md,paddingTop:n.spacing.sm,overflow:"auto",minWidth:400},""),children:[(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:n.spacing.sm},""),children:(0,p.FD)("div",{css:(0,s.AH)({display:"flex",gap:n.spacing.sm},""),children:[(0,p.FD)(o.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:d,size:"small",onChange:e=>u(e.target.value),children:[(0,p.Y)(o.SegmentedControlButton,{value:"default",children:(0,p.Y)(a.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,p.Y)(o.SegmentedControlButton,{value:"json",children:(0,p.Y)(a.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,p.Y)(I.N,{})]})}),v&&(0,p.Y)(S,{node:e}),(0,p.Y)(c.p,{withBorder:!0,title:(0,p.Y)(a.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,s.AH)({marginBottom:f?0:n.spacing.md},""),sectionKey:"summary-inputs",children:(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:y.map(({key:e,value:t},n)=>(0,p.Y)(Y,{title:e,data:t,renderMode:d},e||n))})}),f&&t.map(e=>(0,p.Y)(C,{node:e,renderMode:d},e.key)),(0,p.Y)(c.p,{withBorder:!0,title:(0,p.Y)(a.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",children:(0,p.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:x.map(({key:e,value:t},n)=>(0,p.Y)(Y,{title:e,data:t,renderMode:d},e||n))})})]})};var F=n(86656),H=n(90662),_=n(38073);const R=e=>{var t;return!!e.parentId&&([y.UG.AGENT,y.UG.RETRIEVER,y.UG.CHAT_MODEL,y.UG.TOOL,y.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:y.UG.UNKNOWN)||(0,l.N7)(e)>0)},E=({modelTrace:e})=>{const{theme:t}=(0,i.u)(),[n,l]=(0,r.useState)(500),{rootNode:c,nodeMap:d,assessmentsPaneEnabled:u,assessmentsPaneExpanded:m}=(0,A.nJ)(),g=(0,r.useMemo)(()=>Object.values(d).flatMap(e=>e.assessments),[d]),h=(0,r.useMemo)(()=>{if(!c)return[];return(0,T.VC)([c]).filter(R)},[c]);return c?u&&m?(0,p.Y)(F.A,{initialRatio:.75,paneWidth:n,setPaneWidth:l,leftChild:(0,p.Y)(N,{rootNode:c,intermediateNodes:h}),rightChild:(0,p.Y)(H.i,{assessments:g,traceId:c.traceId,activeSpanId:void 0}),leftMinWidth:400,rightMinWidth:_.uZ}):(0,p.Y)(N,{rootNode:c,intermediateNodes:h}):(0,p.Y)("div",{css:(0,s.AH)({marginTop:t.spacing.lg},""),children:(0,p.Y)(o.Empty,{description:(0,p.Y)(a.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})})}},53242:function(e,t,n){n.d(t,{B:function(){return r},k:function(){return s}});const s="yellow500",r="yellow200"},53319:function(e,t,n){n.d(t,{C:function(){return x}});var s=n(64819),r=n(45901),i=n(76998),o=n(37733),a=n(32256),l=n(2515),c=n(93806),d=n(53242),u=n(51391);const p=({title:e,searchFilter:t,isActiveMatch:n})=>{const{theme:r}=(0,o.u)(),a=(0,i.useCallback)(e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})},[]),l=e.toLowerCase();if(!l.includes(t))return(0,u.Y)("div",{children:e});const c=l.indexOf(t),p=c+t.length,m=n?r.colors[d.k]:r.colors[d.B];return(0,u.FD)("div",{children:[e.slice(0,c),(0,u.Y)("span",{ref:n?a:null,css:(0,s.AH)({backgroundColor:m,scrollMarginTop:50},""),children:e.slice(c,p)}),e.slice(p)]})};function m(e,t){return t||(e?l.cC.MARKDOWN:l.cC.JSON)}function g(e){switch(e){case l.cC.JSON:return"JSON";case l.cC.TEXT:return"Text";case l.cC.MARKDOWN:return"Markdown"}}var h={name:"bjn8wh",styles:"position:relative"},f={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},v={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},y={name:"2fp7nl",styles:"height:min-content;margin:0"};function x({title:e,tokens:t,data:n,searchFilter:d="",activeMatch:x=null,containsActiveMatch:b=!1,initialRenderMode:Y}){var S;const A=(0,i.useMemo)(()=>JSON.parse(n),[n]),w=(0,r.isString)(A),{theme:T}=(0,o.u)(),[M,D]=(0,i.useState)(m(w,Y)),k=b&&null!==(S=null===x||void 0===x?void 0:x.isKeyMatch)&&void 0!==S&&S,C=w&&!d;return(0,i.useEffect)(()=>{D(m(w,Y))},[w,Y]),(0,u.Y)("div",{css:h,children:(0,u.FD)("div",{css:(0,s.AH)({borderRadius:T.borders.borderRadiusSm,border:`1px solid ${T.colors.border}`,overflow:"hidden"},""),children:[(e||C)&&(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:T.spacing.sm},""),children:[(0,u.Y)(o.T.Title,{css:f,level:4,color:"secondary",withoutMargins:!0,children:(0,u.Y)(p,{title:e,searchFilter:d,isActiveMatch:k})}),(0,u.Y)("div",{css:v,children:C&&(0,u.FD)(a.DropdownMenu.Root,{children:[(0,u.Y)(a.DropdownMenu.Trigger,{asChild:!0,children:(0,u.Y)(a.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:y,children:(0,u.FD)("div",{css:(0,s.AH)({paddingLeft:T.spacing.xs,marginRight:T.spacing.xs,cursor:"pointer"},""),children:[(0,u.Y)(o.T.Text,{size:"sm",color:"secondary",children:g(M)}),(0,u.Y)(a.ChevronDownIcon,{})]})})}),(0,u.FD)(a.DropdownMenu.Content,{children:[(0,u.Y)(a.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:M,onValueChange:e=>D(e),children:Object.values(l.cC).map(e=>(0,u.FD)(a.DropdownMenu.RadioItem,{value:e,children:[(0,u.Y)(a.DropdownMenu.ItemIndicator,{}),g(e)]},e))}),(0,u.Y)(a.DropdownMenu.Arrow,{})]})]})})]}),(0,u.Y)(c.w,{data:n,searchFilter:d,activeMatch:x,containsActiveMatch:b,renderMode:M})]})})}},56828:function(e,t,n){n.d(t,{p:function(){return c}});var s=n(64819),r=n(76998),i=n(32256),o=n(37733),a=n(51391);var l={name:"1d3w5wq",styles:"width:100%"};const c=({sectionKey:e,title:t,children:n,withBorder:c=!1,className:d})=>{const[u,p]=(0,r.useState)(!0),{theme:m}=(0,o.u)();return(0,a.FD)("div",{className:d,css:(0,s.AH)({display:"flex",flexDirection:"column",borderRadius:m.borders.borderRadiusMd},""),children:[(0,a.FD)("div",{css:(0,s.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:m.spacing.xs,padding:c?m.spacing.sm:0,background:c?m.colors.backgroundSecondary:void 0,borderTopLeftRadius:m.borders.borderRadiusMd,borderTopRightRadius:m.borders.borderRadiusMd,borderBottomLeftRadius:u?0:m.borders.borderRadiusMd,borderBottomRightRadius:u?0:m.borders.borderRadiusMd,border:c?`1px solid ${m.colors.border}`:void 0,marginBottom:c?0:m.spacing.sm},""),children:[(0,a.Y)(o.B,{size:"small",componentId:`shared.model-trace-explorer.expand-${e}`,type:"tertiary",icon:u?(0,a.Y)(i.ChevronDownIcon,{}):(0,a.Y)(o.o,{}),onClick:()=>p(!u)}),(0,a.Y)(o.T.Title,{withoutMargins:!0,level:4,css:l,children:t})]}),u&&(0,a.Y)("div",{css:(0,s.AH)({border:c?`1px solid ${m.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:c?m.borders.borderRadiusMd:void 0,borderBottomRightRadius:c?m.borders.borderRadiusMd:void 0,padding:c?m.spacing.sm:0},""),children:n})]})}},61520:function(e,t,n){n.d(t,{BS:function(){return K},g_:function(){return le},ij:function(){return $},LS:function(){return U},Q0:function(){return pe},OS:function(){return ce},tC:function(){return P},MF:function(){return re},N7:function(){return ge},bn:function(){return me},in:function(){return Ye},PC:function(){return fe},x0:function(){return be},h8:function(){return ve},I$:function(){return xe},vl:function(){return ue},W0:function(){return de},Hq:function(){return Se},jW:function(){return ie},ZI:function(){return Te},CL:function(){return Ae},vL:function(){return J},f7:function(){return G}});var s=n(64819),r=n(45901),i=n(2515),o=n(69822);const a=e=>{if((0,r.isNil)(e))return!1;if((0,r.has)(e,"type")){if("text"===e.type&&(0,r.has)(e,"text")&&(0,r.isString)(e.text))return!0;if("image"===e.type&&(0,r.has)(e,"source")&&(0,r.has)(e.source,"type")){if("base64"===e.source.type&&(0,r.has)(e.source,"media_type")&&(0,r.isString)(e.source.media_type)&&["image/jpeg","image/png","image/gif","image/webp"].includes(e.source.media_type)&&(0,r.has)(e.source,"data")&&(0,r.isString)(e.source.data))return!0;if("url"===e.source.type&&(0,r.has)(e.source,"url")&&(0,r.isString)(e.source.url))return!0}if("tool_use"===e.type&&(0,r.has)(e,"id")&&(0,r.has)(e,"name")&&(0,r.has)(e,"input"))return(0,r.isString)(e.id)&&(0,r.isString)(e.name)&&(0,r.isObject)(e.input);if("tool_result"===e.type&&(0,r.has)(e,"tool_use_id")&&(0,r.has)(e,"content"))return(0,r.isString)(e.tool_use_id)&&(0,r.isString)(e.content)}return!1},l=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.has)(e,"role")&&(0,r.isString)(e.role)&&["user","assistant"].includes(e.role),n="content"in e&&((0,r.isString)(e.content)||(0,r.isArray)(e.content)&&e.content.every(a));return t&&n},c=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":switch(e.source.type){case"base64":return{type:"image_url",image_url:{url:`data:${e.source.media_type};base64,${e.source.data}`}};case"url":return{type:"image_url",image_url:{url:e.source.url}}}}throw new Error(`Unsupported content block type: ${e.type}`)},d=e=>{const t=[];if("string"===typeof e.content){const n=Te({type:"message",content:e.content,role:e.role});n&&t.push(n)}else{const{messages:n,textParts:s,toolCalls:r}=(e=>{const t=[],n=[],s=[];for(const r of e)"text"===r.type||"image"===r.type?n.push(c(r)):"tool_use"===r.type?s.push({id:r.id,function:{name:r.name,arguments:JSON.stringify(r.input)}}):"tool_result"===r.type&&t.push({role:"tool",tool_call_id:r.tool_use_id,content:r.content});return{messages:t,textParts:n,toolCalls:s}})(e.content);if(t.push(...n),s.length>0||r.length>0){const n=Te({type:"message",content:s.length>0?s:void 0,role:e.role,...r.length>0&&{tool_calls:r}});n&&t.push(n)}}return t},u=e=>(0,r.isObject)(e)&&"text"in e&&(0,r.isString)(e.text),p=e=>(0,r.isObject)(e)&&"role"in e&&(0,r.isString)(e.role)&&["user","model"].includes(e.role)&&(0,r.has)(e,"parts")&&Array.isArray(e.parts)&&e.parts.every(u),m=e=>(0,r.isObject)(e)&&"content"in e&&p(e.content),g=e=>{var t;if(!e)return null;const n=null!==(t=e.messages)&&void 0!==t?t:e.input;return Array.isArray(n)&&0!==n.length&&n.every(xe)?(0,r.compact)(n.map(Te)):null},h=e=>be(e)?e.map(e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(Ae)}}):Ye(e)?e.choices.map(e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(Ae)}}):null,f=e=>!!((0,r.has)(e,"role")&&(0,r.has)(e,"content")&&["user","assistant","system","developer"].includes(e.role))&&((0,r.isString)(e.content)||(0,r.isArray)(e.content)&&e.content.every(e=>(0,r.has)(e,"type")&&["input_text","input_image","input_file"].includes(e.type))),v=e=>{if(!(0,r.isObject)(e))return!1;if("message"===(0,r.get)(e,"type"))return xe(e);if("function_call"===(0,r.get)(e,"type"))return(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments"));if("function_call_output"===(0,r.get)(e,"type"))return(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"output"));if("image_generation_call"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"output_format");return(0,r.isString)((0,r.get)(e,"result"))&&(0,r.isString)(t)&&["png","jpeg","webp"].includes(t)}return"reasoning"===(0,r.get)(e,"type")&&((0,r.has)(e,"id")&&(0,r.isArray)((0,r.get)(e,"summary")))},y=e=>{if((0,r.isString)(e.content)){const t=Te({type:"message",content:e.content,role:e.role});return t&&[t]}return e.content.map(t=>((e,t)=>{const n=(0,r.get)(e,"text");if("input_text"===(0,r.get)(e,"type")&&(0,r.isString)(n))return Te({type:"message",content:[{type:"text",text:n}],role:t});const s=(0,r.get)(e,"image_url");return"input_image"===(0,r.get)(e,"type")&&(0,r.isString)(s)?Te({type:"message",content:[{type:"image_url",image_url:{url:s}}],role:t}):null})(t,e.role)).filter(e=>null!==e)},x=e=>"message"===e.type?Te(e):"function_call"===e.type?{role:"assistant",tool_calls:[Ae({id:e.call_id,function:{arguments:e.arguments,name:e.name}})]}:"function_call_output"===e.type?{role:"tool",tool_call_id:e.call_id,content:e.output}:"image_generation_call"===e.type?Te({type:"message",content:[{type:"image_url",image_url:{url:`data:image/${e.output_format};base64,${e.result}`}}],role:"tool"}):(e.type,null),b=e=>!!(0,r.isObject)(e)&&(!!((0,r.has)(e,"role")&&(0,r.has)(e,"content")&&["user","assistant","system","tool"].includes(e.role))||("function_call"===(0,r.get)(e,"type")?(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments")):"function_call_output"===(0,r.get)(e,"type")&&((0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"output"))))),Y=e=>{if((0,r.has)(e,"role")&&(0,r.has)(e,"content")){if((0,r.isArray)(e.content)){const t=e.content.filter(e=>"output_text"===e.type&&(0,r.isString)(e.text)).map(e=>e.text).join(" ");if(t)return Te({...e,content:t})}return Te(e)}if("function_call"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"call_id"),n=(0,r.get)(e,"arguments"),s=(0,r.get)(e,"name");if((0,r.isString)(t)&&(0,r.isString)(n)&&(0,r.isString)(s))return{role:"assistant",tool_calls:[Ae({id:t,function:{arguments:n,name:s}})]}}if("function_call_output"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"call_id"),n=(0,r.get)(e,"output");if((0,r.isString)(t)&&(0,r.isString)(n))return{role:"tool",tool_call_id:t,content:n}}return null},S=e=>{var t;let n,s;switch(e.type){case"user":case"human":n="user";break;case"assistant":case"ai":n="assistant";break;case"system":n="system";break;case"tool":n="tool";break;case"function":n="function";break;default:return null}if((0,r.isString)(e.content))s=e.content;else if(Array.isArray(e.content)){s=e.content.map(e=>{var t;return(0,r.isString)(e)?e:"text"===e.type&&e.text?e.text:"image_url"===e.type&&null!==(t=e.image_url)&&void 0!==t&&t.url?`![](${e.image_url.url})`:""}).filter(Boolean).join("\n\n")}else s=void 0;const i={content:s,role:n},o=e.tool_calls,a=null===(t=e.additional_kwargs)||void 0===t?void 0:t.tool_calls;return!(0,r.isNil)(o)&&Array.isArray(o)&&o.length>0&&o.every(T)?i.tool_calls=(0,r.compact)(o.map(A)):!(0,r.isNil)(a)&&Array.isArray(a)&&a.length>0&&a.every(ve)&&(i.tool_calls=a.map(Ae)),(0,r.isNil)(e.tool_call_id)||(i.tool_call_id=e.tool_call_id),i},A=e=>({id:e.id,function:{arguments:JSON.stringify(e.args,null,2),name:e.name}}),w=e=>!!e&&(!!((0,r.isNil)(e.content)||(0,r.isString)(e.content)||Array.isArray(e.content))&&["human","user","assistant","ai","system","tool","function"].includes(e.type)),T=e=>e&&(0,r.isString)(e.name)&&(0,r.has)(e,"args")&&(0,r.isString)(e.id),M=e=>e&&w(e.message),D=e=>{const t=e.map(e=>S(e.message));return t.some(e=>null===e)?null:t},k=e=>(e=>!(!Array.isArray(e)||e.length<1)&&!(!Array.isArray(e[0])||e[0].length<1)&&e[0].every(M))(e)?D(e[0]):Array.isArray(null===e||void 0===e?void 0:e.generations)&&e.generations.length>0&&e.generations[0].every(M)?D(e.generations[0]):null,C=e=>{const t=(0,r.get)(e,"text");return"text"===(0,r.get)(e,"block_type")&&(0,r.isString)(t)},I=e=>{const t=(0,r.get)(e,"blocks"),n=(0,r.get)(e,"role");return(0,r.isString)(n)&&["assistant","system","user"].includes(n)&&(0,r.isArray)(t)&&t.every(C)},N=e=>Te({role:e.role,content:e.blocks.map(e=>({type:"text",text:e.text}))}),F=e=>{if(!(e=>I((0,r.get)(e,"message")))(e))return null;const t=N(e.message);return t&&[t]},H=e=>(e=>{const t=(0,r.get)(e,"messages");return(0,r.isArray)(t)&&t.every(I)})(e)?(0,r.compact)(e.messages.map(N)):null,_=e=>(0,r.isObject)(e)&&(0,r.isString)((0,r.get)(e,"id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments")),R=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.get)(e,"type");if(t){if("SystemMessage"===t)return(0,r.isString)((0,r.get)(e,"content"));if("UserMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source");if("AssistantMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source");if("FunctionMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source")}return!(!(0,r.has)(e,"source")||!["system","user","assistant","function"].includes((0,r.get)(e,"source")))&&(0,r.has)(e,"content")},E=e=>(0,r.isString)(e)?Te({type:"message",content:e,role:"assistant"}):(0,r.isArray)(e)&&e.every(_)?{role:"assistant",tool_calls:e.map(e=>Ae({id:e.id,function:{name:e.name,arguments:e.arguments}}))}:null,O=e=>{if("SystemMessage"===e.type)return Te({type:"message",content:e.content,role:"system"});if("UserMessage"===e.type){if((0,r.isString)(e.content))return Te({type:"message",content:e.content,role:"user"});if((0,r.isArray)(e.content)){const t=e.content.filter(e=>(0,r.isString)(e)||(0,r.isObject)(e)&&"text"===e.type).map(e=>(0,r.isString)(e)?{type:"text",text:e}:e);if(t.length>0)return Te({type:"message",content:t,role:"user"})}}if("AssistantMessage"===e.type)return E(e.content);if("FunctionMessage"===e.type)return Te({type:"message",content:JSON.stringify(e.content),role:"user"});if("system"===e.source)return Te({type:"message",content:e.content,role:"system"});if("user"===e.source){if((0,r.isString)(e.content))return Te({type:"message",content:e.content,role:"user"});if((0,r.isArray)(e.content)){const t=e.content.filter(e=>(0,r.isString)(e)).map(e=>({type:"text",text:e}));if(t.length>0)return Te({type:"message",content:t,role:"user"})}}return"assistant"===e.source?E(e.content):"function"===e.source?Te({type:"message",content:JSON.stringify(e.content),role:"user"}):null},B=e=>{if(e.text)return{type:"text",text:e.text};if(e.json)return{type:"text",text:JSON.stringify(e.json)};if(e.image){const t=e.image.source.bytes,n=e.image.format;let s;if("string"===typeof t)s=t;else{s=Buffer.from(t).toString("base64")}return{type:"image_url",image_url:{url:`data:${`image/${n}`};base64,${s}`}}}return null},j=e=>{let t=e.role;const n=[],s=[];let r;for(const a of e.content)if(a.toolUse){const e=a.toolUse,t="string"===typeof e.input?e.input:JSON.stringify(e.input);s.push(Ae({id:e.toolUseId,function:{name:e.name,arguments:t}}))}else if(a.toolResult){r=a.toolResult.toolUseId,t="tool";for(const e of a.toolResult.content){const t=B(e);t&&n.push(t)}}else{const e=B(a);e&&n.push(e)}let i="";n.length>0&&(i=n.map(e=>"text"===e.type?e.text:"image_url"===e.type?`[Image: ${e.image_url.url}]`:"").filter(e=>e.length>0).join(" "));const o={role:t,content:i};return s.length>0&&(o.tool_calls=s),r&&(o.tool_call_id=r),o},z=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.has)(e,"role")&&(0,r.isString)(e.role)&&["user","assistant","system"].includes(e.role),n=(0,r.has)(e,"content")&&(0,r.isArray)(e.content);return t&&n};var L=n(51391);const K="model-trace-info-v3",$=e=>{};function P(e){switch(e){case i.UG.LLM:return i.Dy.MODELS;case i.UG.CHAIN:return i.Dy.CHAIN;case i.UG.AGENT:return i.Dy.AGENT;case i.UG.TOOL:return i.Dy.WRENCH;case i.UG.CHAT_MODEL:return i.Dy.MODELS;case i.UG.RETRIEVER:return i.Dy.SEARCH;case i.UG.PARSER:return i.Dy.CODE;case i.UG.EMBEDDING:return i.Dy.NUMBERS;case i.UG.RERANKER:return i.Dy.SORT;case i.UG.MEMORY:return i.Dy.SAVE;case i.UG.FUNCTION:return i.Dy.FUNCTION;case i.UG.UNKNOWN:return i.Dy.UNKNOWN;default:return i.Dy.FUNCTION}}function U(e){switch(e){case i.UG.LLM:return"LLM";case i.UG.CHAIN:return"Chain";case i.UG.AGENT:return"Agent";case i.UG.TOOL:return"Tool";case i.UG.CHAT_MODEL:return"Chat model";case i.UG.RETRIEVER:return"Retriever";case i.UG.PARSER:return"Parser";case i.UG.EMBEDDING:return"Embedding";case i.UG.RERANKER:return"Reranker";case i.UG.MEMORY:return"Memory";case i.UG.FUNCTION:return"Function";case i.UG.UNKNOWN:return"Unknown";default:return e}}function V(e){try{return JSON.parse(e)}catch(t){return e}}const W=(e,t)=>{if(!t)return[];const n=[],s={inputs:null===e||void 0===e?void 0:e.inputs,outputs:null===e||void 0===e?void 0:e.outputs,attributes:null===e||void 0===e?void 0:e.attributes,events:null===e||void 0===e?void 0:e.events};return(0,r.map)(s,(s,r)=>{if("events"===r)return void n.push(...((e,t)=>{const n=e.events;if(!n)return[];const s=[];return n.forEach((n,r)=>{const i=n.attributes;i&&Object.keys(i).forEach(o=>{const a=o.toLowerCase().includes(t),l=pe(n.name,r,o);a&&s.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});const c=JSON.stringify(i[o]).toLowerCase().split(t).length-1;for(let t=0;t<c;t++)s.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})})}),s})(e,t));le(s).forEach(s=>{s.key.toLowerCase().includes(t)&&n.push({span:e,section:r,key:s.key,isKeyMatch:!0,matchIndex:0});const i=s.value.toLowerCase().split(t).length-1;for(let t=0;t<i;t++)n.push({span:e,section:r,key:s.key,isKeyMatch:!1,matchIndex:t})})}),n};function J(e,t,n){var s,r;const i=t.toLowerCase().trim(),o=Object.values(n.spanTypeDisplayState).every(e=>e);if(""===i&&o)return{filteredTreeNodes:[e],matches:[]};const a=null!==(s=e.children)&&void 0!==s?s:[],l=[],c=[];a.forEach(e=>{const{filteredTreeNodes:t,matches:s}=J(e,i,n);l.push(...t),c.push(...s)});const d=(null!==(r=e.title)&&void 0!==r?r:"").toLowerCase(),u=W(e,i),p=u.length>0||d.includes(i),m=!e.type||n.spanTypeDisplayState[e.type],g=p&&m,h=l.length>0,f=ge(e)>0;return g||n.showParents&&h||n.showExceptions&&f?{filteredTreeNodes:[{...e,children:l}],matches:u.concat(c)}:{filteredTreeNodes:l,matches:c}}function G(e,t){var n;if((0,r.isNil)(t)||(0,r.isNil)(e))return;if(e.key===t)return e;const s=null!==(n=e.children)&&void 0!==n?n:[];for(const r of s){const e=G(r,t);if(e)return e}}const q=(e,t,n,s,i,a)=>{var l,c,d,u,p,m,g,h;const f=V(null===(l=e.attributes)||void 0===l?void 0:l["mlflow.spanType"]),v=V(null===(c=e.attributes)||void 0===c?void 0:c["mlflow.spanInputs"]),y=V(null===(d=e.attributes)||void 0===d?void 0:d["mlflow.spanOutputs"]),x=te(e),b=ee(e),Y=null!==(u=i[b])&&void 0!==u?u:[];var S;x||Y.push(...null!==(S=i[""])&&void 0!==S?S:[]);const A=V(null===(p=e.attributes)||void 0===p?void 0:p["mlflow.chat.messages"]),w=V(null===(m=e.attributes)||void 0===m?void 0:m["mlflow.message.format"]),T=((e,t,n,s)=>{var i,o;if(Array.isArray(e)&&e.every(xe))return(0,r.compact)(e.map(Te));const a=null!==(i=Se(t,null===s||void 0===s?void 0:s["mlflow.message.format"]))&&void 0!==i?i:[],l=null!==(o=Se(n,null===s||void 0===s?void 0:s["mlflow.message.format"]))&&void 0!==o?o:[];return 0!==a.length&&0!==l.length?a.concat(l):void 0})(A,v,y,w?{"mlflow.message.format":w}:void 0),M=((e,t)=>{var n;return Array.isArray(e)&&e.every(fe)?e:Array.isArray(null===t||void 0===t?void 0:t.tools)&&null!==t&&void 0!==t&&null!==(n=t.tools)&&void 0!==n&&n.every(fe)?t.tools:void 0})(V(null===(g=e.attributes)||void 0===g?void 0:g["mlflow.chat.tools"]),v),D=(0,r.mapValues)((0,r.omitBy)(e.attributes,(e,t)=>t.startsWith("mlflow.")),e=>V(e)),k=e.events,C=(Number(ne(e))-t)/1e3,I=(Number(null!==(h=se(e))&&void 0!==h?h:n)-t)/1e3;return{title:e.name,icon:(0,L.Y)(o.P,{type:P(f),hasException:ge(e)>0,isRootSpan:!x}),type:f,key:b,start:C,end:I,children:s,inputs:v,outputs:y,attributes:D,events:k,chatMessages:T,chatTools:M,parentId:x,assessments:Y,traceId:a}},X=(e,t)=>{if(t)try{return(e=>{const t=atob(e),n=t.length;let s="";for(let r=0;r<n;r++)s+=t.charCodeAt(r).toString(16).padStart(2,"0");return s})(e)}catch(n){return e}return e.startsWith("0x")?e.slice(2):e};function Q(e){return"trace_metadata"in e}function Z(e){return"start_time_unix_nano"in e}function ee(e){var t,n;return Z(e)?X(e.span_id,!0):X(null!==(t=null===(n=e.context)||void 0===n?void 0:n.span_id)&&void 0!==t?t:"",!1)}function te(e){var t,n;return Z(e)?X(null!==(t=e.parent_span_id)&&void 0!==t?t:"",!0):X(null!==(n=e.parent_id)&&void 0!==n?n:"",!1)}function ne(e){return Z(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function se(e){return Z(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function re(e){var t;return Q(e.info)?e.info.trace_id:null!==(t=e.info.request_id)&&void 0!==t?t:""}function ie(e){var t,n;const s=re(e),a=null!==(t=null===(n=e.trace_data)||void 0===n?void 0:n.spans)&&void 0!==t?t:e.data.spans,l={},c={};a.forEach(e=>{const t=ee(e);l[t]=e,c[t]=[]}),a.forEach(e=>{const t=ee(e),n=te(e);if(n){if(!c[n])throw new Error("Tree structure is malformed!");c[n].push(t)}});const d=a.find(e=>!te(e));if((0,r.isNil)(d))return null;return function t(n){var r,a,u;const p=l[n],m=Number(ne(d)),g=Number(se(d)),h=c[n].map(t),f=oe(e.info);if(Z(p)||"parent_id"in p)return q(p,m,g,h,f,s);const v=null!==(r=p.span_type)&&void 0!==r?r:i.UG.UNKNOWN;return{title:p.name,icon:(0,L.Y)(o.P,{type:P(v)}),type:v,key:p.context.span_id,start:Number(p.start_time)-m,end:Number(null!==(a=p.end_time)&&void 0!==a?a:g)-m,children:h,inputs:p.inputs,outputs:p.outputs,attributes:p.attributes,events:p.events,parentId:null!==(u=p.parent_id)&&void 0!==u?u:p.parent_span_id,assessments:[],traceId:s}}(ee(d))}const oe=e=>{let t=[];var n;Q(e)?t=null!==(n=e.assessments)&&void 0!==n?n:[]:t=ae(e.tags);const s=(0,r.keyBy)(t,"assessment_id");Object.values(s).forEach(e=>{if(e.overrides){const t=s[e.overrides];e.overriddenAssessment=t}}),t=Object.values(s);const i=t.reduce((e,t)=>{var n;const s=null!==(n=t.span_id)&&void 0!==n?n:"";return e[s]||(e[s]=[]),e[s].push(t),e},{});return Object.keys(i).forEach(e=>{i[e].sort((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime())}),i},ae=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map(([e,t])=>({key:e,value:t}))).filter(({key:e})=>e.startsWith("mlflow.assessment.")).map(({value:e})=>JSON.parse(e))};const le=e=>(0,r.isNil)(e)?[]:Array.isArray(e)||(0,r.isString)(e)||(0,r.isNumber)(e)||(0,r.isBoolean)(e)?[{key:"",value:JSON.stringify(e,null,2)}]:Object.entries(e).map(([e,t])=>({key:e,value:JSON.stringify(t,null,2)})),ce=({searchFilter:e,data:t,activeMatchBackgroundColor:n,inactiveMatchBackgroundColor:i,containsActiveMatch:o,activeMatch:a,scrollToActiveMatch:l})=>{const c=new RegExp(`(${(0,r.escapeRegExp)(e.trim())})`,"gi"),d=t.split(c),u=[];let p=0;for(let r=0;r<d.length;r++)if(d[r].toLowerCase().includes(e.toLowerCase().trim())){const e=o&&a.matchIndex===p,t=e?n:i,c=(0,L.Y)("span",{ref:e?l:null,css:(0,s.AH)({backgroundColor:t,scrollMarginTop:50},""),children:d[r]},r);p++,u.push(c)}else u.push(d[r]);return u},de=e=>(0,r.has)(e,"page_content"),ue=e=>e.type===i.UG.RETRIEVER&&Array.isArray(e.outputs)&&e.outputs.length>0&&(0,r.every)(e.outputs,de),pe=(e,t,n)=>`${e}-${t}-${n}`,me=e=>{var t;return(null!==(t=e.events)&&void 0!==t?t:[]).filter(e=>"exception"===e.name)},ge=e=>me(e).length,he=e=>!(0,r.isNil)(e)&&(!(!(0,r.isNil)(e.type)&&!(0,r.isString)(e.type))&&(!(!(0,r.isNil)(e.description)&&!(0,r.isString)(e.description))&&!(!(0,r.isNil)(e.enum)&&!Array.isArray(e.enum)))),fe=e=>{var t;if((0,r.isNil)(e)||"function"!==e.type||!(0,r.has)(e,"function.name"))return!1;const n=null===(t=e.function)||void 0===t?void 0:t.parameters;if(!(0,r.isNil)(n)){const e=n.required;if(!(0,r.isNil)(e)&&(!Array.isArray(e)||!e.every(r.isString)))return!1;const t=n.properties;if(!(0,r.isNil)(t)&&!Object.values(t).every(he))return!1}return!0},ve=e=>{var t,n;return e&&(0,r.isString)(e.id)&&(0,r.isString)(null===(t=e.function)||void 0===t?void 0:t.arguments)&&(0,r.isString)(null===(n=e.function)||void 0===n?void 0:n.name)},ye=e=>!(!(0,r.isNil)(e)&&!(0,r.isString)(e))||!!(0,r.isArray)(e)&&e.every(e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,r.isString)(e.text);case"image_url":const{image_url:t}=e;return!(0,r.isNil)(t)&&(0,r.isString)(t.url)&&((0,r.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":const{input_audio:n}=e;return!(0,r.isNil)(n)&&(0,r.isString)(n.data)&&((0,r.isNil)(n.format)||["wav","mp3"].includes(n.format));default:return!1}})(e)),xe=e=>{if(!e)return!1;if(e.tool_calls){if(!Array.isArray(e.tool_calls))return!1;if(!e.tool_calls.every(ve))return!1}return"reasoning"===e.type||!!ye(e.content)&&("user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role)},be=e=>Array.isArray(e)&&e.length>0&&e.every(e=>{return(0,r.has)(e,"message")&&(t=e.message,!!xe(t)&&((0,r.isNil)(t.content)||(0,r.isString)(t.content)));var t}),Ye=e=>e&&be(e.choices),Se=(e,t)=>{var n,s,i,o,a,c,u,A,T,M,D,C,I;try{if(Array.isArray(e)&&e.length>0&&e.every(xe))return(0,r.compact)(e.map(Te));switch(t){case"langchain":const t=null!==(n=(e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&e[0].length>0&&e[0].every(w)){const t=e[0].map(S);return t.some(e=>null===e)?null:t}if(Array.isArray(null===e||void 0===e?void 0:e.messages)&&e.messages.length>0&&e.messages.every(w)){const t=e.messages.map(S);return t.some(e=>null===e)?null:t}if(Array.isArray(e)&&e.length>0&&e.every(w)){const t=e.map(S);return t.some(e=>null===e)?null:t}return null})(e))&&void 0!==n?n:k(e);if(t)return t;break;case"llamaindex":const N=null!==(s=H(e))&&void 0!==s?s:F(e);if(N)return N;break;case"openai":const _=null!==(i=null!==(o=null!==(a=g(e))&&void 0!==a?a:h(e))&&void 0!==o?o:(e=>{if((0,r.isNil)(e))return null;const t=(0,r.get)(e,"output");return(0,r.isArray)(t)&&t.length>0&&t.every(v)?(0,r.compact)(t.map(x).filter(Boolean)):(0,r.isArray)(t)&&t.length>0&&t.every(e=>"response.output_item.done"===e.type&&v(e.item))?(0,r.compact)(t.map(e=>x(e.item))):null})(e))&&void 0!==i?i:(e=>{const t=(0,r.get)(e,"input");if((0,r.isString)(t)){const e=Te({type:"message",content:t,role:"user"});return e&&[e]}return(0,r.isArray)(t)&&t.every(f)?(0,r.compact)(t.flatMap(y)):null})(e);if(_)return _;break;case"dspy":const E=null!==(c=(e=>{if((0,r.has)(e,"messages")&&(0,r.isArray)(e.messages))return e.messages.map(e=>Te({type:"message",content:e.content,role:e.role})).filter(Boolean);return null})(e))&&void 0!==c?c:(e=>{if((0,r.isArray)(e)&&e.length>0&&e.every(r.isString)){const t=e.join("\n"),n=Te({type:"message",content:t,role:"assistant"});return n&&[n]}return null})(e);if(E)return E;break;case"gemini":const B=null!==(u=(e=>{if(!(0,r.isObject)(e))return null;if("contents"in e){if((0,r.isString)(e.contents)){const t=Te({type:"message",content:e.contents,role:"user"});return t&&[t]}if((0,r.isArray)(e.contents)&&e.contents.every(p))return(0,r.compact)(e.contents.map(e=>{const t="model"===e.role?"assistant":e.role;return Te({type:"message",content:e.parts.map(e=>({type:"text",text:e.text})),role:t})}))}return null})(e))&&void 0!==u?u:(I=e,(0,r.isObject)(I)&&"candidates"in I&&(0,r.isArray)(I.candidates)&&I.candidates.every(m)?(0,r.compact)(I.candidates.flatMap(e=>e.content).map(e=>{const t="model"===e.role?"assistant":e.role;return Te({type:"message",content:e.parts.map(e=>({type:"text",text:e.text})),role:t})})):null);if(B)return B;break;case"anthropic":const L=null!==(A=(e=>{if(!(0,r.isObject)(e))return null;if("messages"in e&&(0,r.isArray)(e.messages)&&e.messages.every(l)){const t=[];for(const n of e.messages)t.push(...d(n));return t}return null})(e))&&void 0!==A?A:(e=>(0,r.isObject)(e)&&(0,r.has)(e,"type")&&"message"===e.type&&l(e)?d(e):null)(e);if(L)return L;break;case"openai-agent":const K=null!==(T=(e=>(0,r.isNil)(e)?null:(0,r.isArray)(e)&&e.length>0&&e.every(b)?(0,r.compact)(e.map(Y)):null)(e))&&void 0!==T?T:(e=>(0,r.isNil)(e)?null:(0,r.isArray)(e)&&e.length>0&&e.every(b)?(0,r.compact)(e.map(Y)):null)(e);if(K)return K;break;case"autogen":const $=null!==(M=(e=>{if((0,r.isNil)(e))return null;if((0,r.isArray)(e)&&e.length>0&&e.every(R))return(0,r.compact)(e.map(O));if((0,r.isObject)(e)&&"messages"in e){const t=e.messages;if((0,r.isArray)(t)&&t.length>0&&t.every(R))return(0,r.compact)(t.map(O))}return null})(e))&&void 0!==M?M:(e=>{if((0,r.isNil)(e))return null;if((0,r.isArray)(e)&&e.length>0&&e.every(R))return(0,r.compact)(e.map(O));if((0,r.isObject)(e)&&"content"in e){const t=Te({role:"assistant",content:e.content,type:"message"});return t?[t]:null}return null})(e);if($)return $;break;case"bedrock":const P=null!==(D=(e=>{if((0,r.isNil)(e))return null;if((0,r.isObject)(e)&&"messages"in e){const t=e.messages;if((0,r.isArray)(t)&&t.length>0&&t.every(z))return(0,r.compact)(t.map(j))}return null})(e))&&void 0!==D?D:(e=>{if((0,r.isNil)(e))return null;if((0,r.isObject)(e)&&"output"in e){const t=e.output;if((0,r.isObject)(t)&&"message"in t){const e=t.message;if(z(e))return[j(e)]}}return null})(e);if(P)return P;break;default:const U=null!==(C=g(e))&&void 0!==C?C:h(e);if(U)return U}return null}catch(N){return null}},Ae=e=>{var t;let n=null===(t=e.function)||void 0===t?void 0:t.arguments;try{n=JSON.stringify(JSON.parse(n),null,2)}catch(s){}return{id:e.id,function:{arguments:n,name:e.function.name}}},we=e=>{if((0,r.isNil)(e)||(0,r.isString)(e))return e;return e.map(e=>{var t;switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":const n=null===e||void 0===e||null===(t=e.image_url)||void 0===t?void 0:t.url;return n?`![](${n})`:"[image]";case"input_audio":return"[audio]"}}).filter(e=>void 0!==e).join("\n\n")},Te=e=>{var t;return"reasoning"===e.type?null:{...e,content:we(e.content),tool_calls:null===(t=e.tool_calls)||void 0===t?void 0:t.map(Ae)}}},61938:function(e,t,n){n.d(t,{o:function(){return d}});var s=n(64819),r=n(37733),i=n(2515),o=n(61520),a=n(69822),l=n(84918),c=n(51391);const d=({node:e})=>{var t;const{theme:n}=(0,r.u)(),{setSelectedNode:d,setActiveView:u,setShowTimelineTreeGantt:p}=(0,l.nJ)(),m=(0,o.N7)(e)>0;return(0,c.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",marginRight:n.spacing.xs,gap:n.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:m?n.colors.actionDangerDefaultTextDefault:n.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{d(e),u("detail"),p(!1)},children:[(0,c.Y)(a.P,{hasException:m,type:(0,o.tC)(null!==(t=e.type)&&void 0!==t?t:i.UG.UNKNOWN)}),(0,c.Y)(r.T.Text,{color:m?"error":"primary",css:(0,s.AH)({marginLeft:n.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})}},69822:function(e,t,n){n.d(t,{P:function(){return c}});var s=n(64819),r=n(32256),i=n(37733),o=n(26737),a=n(2515),l=n(51391);const c=({type:e=a.Dy.CONNECT,isInTooltip:t=!1,hasException:n=!1,isRootSpan:c=!1})=>{const{theme:d}=(0,i.u)();let u;c?u="ai":n&&(u="danger");const p={[a.Dy.MODELS]:(0,l.Y)(r.ModelsIcon,{color:u}),[a.Dy.DOCUMENT]:(0,l.Y)(r.FileDocumentIcon,{color:u}),[a.Dy.CONNECT]:(0,l.Y)(r.ConnectIcon,{color:u}),[a.Dy.CODE]:(0,l.Y)(r.CodeIcon,{color:u}),[a.Dy.FUNCTION]:(0,l.Y)(r.FunctionIcon,{color:u}),[a.Dy.NUMBERS]:(0,l.Y)(r.NumbersIcon,{color:u}),[a.Dy.SEARCH]:(0,l.Y)(o.S,{color:u}),[a.Dy.SORT]:(0,l.Y)(r.SortUnsortedIcon,{color:u}),[a.Dy.UNKNOWN]:(0,l.Y)(r.QuestionMarkIcon,{color:u}),[a.Dy.WRENCH]:(0,l.Y)(r.WrenchIcon,{color:u}),[a.Dy.AGENT]:(0,l.Y)(r.UserSparkleIcon,{color:u}),[a.Dy.CHAIN]:(0,l.Y)(r.ChainIcon,{color:u}),[a.Dy.USER]:(0,l.Y)(r.UserIcon,{color:u}),[a.Dy.SYSTEM]:(0,l.Y)(r.GearIcon,{color:u}),[a.Dy.SAVE]:(0,l.Y)(r.SaveIcon,{color:u})};let m=d.colors.actionDefaultIconDefault,g=d.colors.actionPrimaryIcon,h=d.colors.backgroundSecondary;switch(e){case a.Dy.SEARCH:m=d.colors.textValidationSuccess,g=d.colors.green500,h=d.isDarkMode?d.colors.green800:d.colors.green100;break;case a.Dy.MODELS:m=d.isDarkMode?d.colors.blue500:d.colors.turquoise,g=d.isDarkMode?d.colors.turquoise:d.colors.blue500,h=d.isDarkMode?d.colors.blue800:d.colors.blue100;break;case a.Dy.WRENCH:m=d.isDarkMode?d.colors.red500:d.colors.red700,g=d.isDarkMode?d.colors.red700:d.colors.red500,h=d.isDarkMode?d.colors.red800:d.colors.red100}return(0,l.FD)("div",{css:(0,s.AH)({position:"relative",width:d.general.iconSize,height:d.general.iconSize,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:d.borders.borderRadiusSm,background:t?d.colors.tooltipBackgroundTooltip:h,color:t?g:m,svg:{width:d.general.iconFontSize,height:d.general.iconFontSize},flexShrink:0},""),children:[n&&(0,l.Y)("div",{css:(0,s.AH)({position:"absolute",top:-d.spacing.xs,right:-d.spacing.xs,height:d.spacing.sm,width:d.spacing.sm,borderRadius:d.borders.borderRadiusSm,backgroundColor:d.colors.actionDangerPrimaryBackgroundDefault,zIndex:5},"")}),p[e]]})}},69910:function(e,t,n){n.d(t,{p:function(){return b}});var s=n(76998),r=n(64819),i=n(37733),o=n(32256),a=n(49818),l=n(99397),c=n(29332),d=n(51391);const u=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},p=({itemKey:e,itemValue:t,charLimit:n=18,maxWidth:s=150,className:a})=>{const{shouldTruncateKey:l,shouldTruncateValue:p}=function(e,t,n){const s=e.length+t.length,r=e.length>t.length,i=r?t.length:e.length;return s<=n?{shouldTruncateKey:!1,shouldTruncateValue:!1}:i>n/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:r,shouldTruncateValue:!r}}(e,t,n);return(0,d.Y)(c.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${t}`,children:(0,d.Y)(o.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:a,children:(0,d.FD)("span",{css:(0,r.AH)({maxWidth:s,display:"inline-flex"},""),children:[(0,d.Y)(i.T.Text,{bold:!0,css:u(l),size:"sm",children:e}),":\xa0",(0,d.Y)(i.T.Text,{css:u(p),size:"sm",children:t})]})})})};var m={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function g({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:c}=(0,i.u)();return(0,d.FD)("div",{css:m,children:[(0,d.Y)("div",{role:"button",onClick:()=>{n(!1),null===s||void 0===s||s("collapse")},css:(0,r.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${c.spacing.sm}px ${c.spacing.md}px`,height:c.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:c.colors.backgroundSecondary}},""),children:(0,d.Y)(o.FileDocumentIcon,{})}),(0,d.Y)("div",{css:(0,r.AH)({padding:c.spacing.md,paddingBottom:0},""),children:(0,d.Y)(l.V,{children:e})}),(0,d.Y)("div",{css:(0,r.AH)({padding:c.spacing.md,paddingTop:0},""),children:t.map(({key:e,value:t})=>(0,d.Y)(p,{itemKey:e,itemValue:t},e))}),(0,d.Y)(i.B,{css:(0,r.AH)({width:"100%",padding:c.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,d.Y)(o.ChevronUpIcon,{}),type:"tertiary",onClick:()=>n(!1),children:(0,d.Y)(a.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var h={name:"ti75j2",styles:"margin:0"},f={name:"1r5gb7q",styles:"display:inline-block"},v={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function y({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:a}=(0,i.u)();return(0,d.FD)("div",{role:"button",onClick:()=>{n(!0),null===s||void 0===s||s("expand")},css:(0,r.AH)({display:"flex",flexDirection:"row",padding:`${a.spacing.sm}px ${a.spacing.md}px`,gap:a.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:a.colors.backgroundSecondary}},""),children:[(0,d.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,d.Y)(o.FileDocumentIcon,{}),(0,d.Y)(i.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,d.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm},""),children:[t.length>0?(0,d.Y)(p,{css:h,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,d.Y)(c.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map(({key:e,value:t})=>(0,d.Y)("span",{css:f,children:`${e}: ${t}`},e)),children:(0,d.FD)(o.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:v,children:["+",t.length-1]})}):null]})]})}var x=n(61520);function b({text:e,metadata:t}){const[n,r]=(0,s.useState)(!1),i=(0,x.g_)(t);return n?(0,d.Y)(g,{text:e,metadataTags:i,setExpanded:r}):(0,d.Y)(y,{text:e,metadataTags:i,setExpanded:r})}},74260:function(e,t,n){n.d(t,{T:function(){return a}});var s=n(32256),r=n(37733),i=n(49818),o=n(51391);const a=()=>(0,o.Y)(s.Empty,{title:(0,o.Y)(i.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,o.Y)(i.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,o.Y)(r.k,{})})},76117:function(e,t,n){n.d(t,{_:function(){return ye}});var s=n(64819),r=n(45901),i=n(76998),o=n(37733),a=n(86656),l=n(201),c=n(26737),d=n(32256),u=n(51391);var p={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};var m=({searchFilter:e,setSearchFilter:t,matchData:n,handleNextSearchMatch:r,handlePreviousSearchMatch:a})=>{const[m,g]=(0,i.useState)(e),h=(0,l.YQ)(t,350),{theme:f}=(0,o.u)();return(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:f.spacing.sm},""),children:[(0,u.Y)(c.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:m,onClear:()=>{t(""),g("")},onChange:e=>{g(e.target.value),h(e.target.value.toLowerCase())},prefix:(0,u.Y)(c.S,{}),css:p}),n.match&&(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",marginLeft:f.spacing.xs,marginRight:f.spacing.sm,alignItems:"center"},""),children:[(0,u.FD)(o.T.Text,{css:(0,s.AH)({whiteSpace:"nowrap",marginRight:f.spacing.sm},""),children:[n.currentMatchIndex+1," / ",n.totalMatches]}),(0,u.Y)(o.B,{"data-testid":"prev-search-match",icon:(0,u.Y)(d.ChevronUpIcon,{}),onClick:a,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,u.Y)(o.B,{"data-testid":"next-search-match",icon:(0,u.Y)(d.ChevronDownIcon,{}),onClick:r,componentId:"shared.model-trace-explorer.next-search-match"})]})]})},g=n(84918),h=n(61520),f=n(793);const v=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},y=({treeNode:e,selectedNode:t,setSelectedNode:n,setActiveTab:s,setExpandedKeys:o,modelTraceInfo:a})=>{var l;const[c,d]=(0,i.useState)(""),[u,p]=(0,i.useState)(()=>(e=>{const t={};e&&(0,r.compact)((0,f.VC)([e]).map(e=>e.type)).forEach(e=>{t[e]=!0});return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e)),[m,g]=(0,i.useState)(0),{filteredTreeNodes:y,matches:x}=(0,i.useMemo)(()=>(0,r.isNil)(e)?{filteredTreeNodes:[],matches:[]}:(0,h.vL)(e,c,u),[null===e||void 0===e?void 0:e.key,c,u,a]),b=(0,i.useMemo)(()=>(0,f.dM)(y),[y]),Y=(0,i.useCallback)(e=>{if(e>=x.length||e<0)return;g(e);const t=x[e];n(t.span),s(v(t));const r=(0,f.NP)(t.span,b);o(e=>new Set([...e,...r]))},[x,n,s,b,o]),S=(0,i.useCallback)(()=>{Y(m+1)},[m,Y]),A=(0,i.useCallback)(()=>{Y(m-1)},[m,Y]);return(0,i.useLayoutEffect)(()=>{if(0!==y.length){if(0===x.length){var e;const r=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(r in b)n(b[r]);else{const e=y[0];n(e),s(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}return}g(0),n(x[0].span),s(v(x[0]))}},[y,x,n]),{matchData:{match:null!==(l=x[m])&&void 0!==l?l:null,totalMatches:x.length,currentMatchIndex:m},searchFilter:c.toLowerCase().trim(),setSearchFilter:d,spanFilterState:u,setSpanFilterState:p,filteredTreeNodes:y,handleNextSearchMatch:S,handlePreviousSearchMatch:A}};var x=n(49818),b=n(53319);function Y({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:i}=(0,o.u)(),{attributes:a}=e,l=(0,r.keys)(a).length>0,c=!(0,r.isNil)(n)&&n.span.key===e.key;return!l||(0,r.isNil)(a)?(0,u.Y)("div",{css:(0,s.AH)({marginTop:i.spacing.md},""),children:(0,u.Y)(d.Empty,{description:(0,u.Y)(x.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,u.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm,padding:i.spacing.md},""),children:Object.entries(a).map(([e,s])=>(0,u.Y)(b.C,{title:e,data:JSON.stringify(s,null,2),searchFilter:t,activeMatch:n,containsActiveMatch:c&&"attributes"===n.section&&n.key===e},e))})}var S=n(83689),A=n(11687),w=n(56828);function T({chatMessages:e,chatTools:t}){const{theme:n}=(0,o.u)();return(0,u.FD)("div",{css:(0,s.AH)({overflowY:"auto",padding:n.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,u.Y)(w.p,{css:(0,s.AH)({marginBottom:n.spacing.sm},""),title:(0,u.Y)(x.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,u.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:t.map(e=>(0,u.Y)(S.E,{tool:e},e.function.name))})}),(0,u.Y)(w.p,{title:(0,u.Y)(x.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,u.Y)(A.J,{messages:e})})]})}var M={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},D={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function k({activeSpan:e,className:t,searchFilter:n,activeMatch:a}){const{theme:l}=(0,o.u)(),c=(0,i.useMemo)(()=>(0,h.g_)(null===e||void 0===e?void 0:e.inputs),[e]),d=(0,i.useMemo)(()=>(0,h.g_)(null===e||void 0===e?void 0:e.outputs),[e]);if((0,r.isNil)(e))return null;const p=c.length>0,m=d.length>0,g=!(0,r.isNil)(a)&&a.span.key===e.key;return(0,u.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[p&&(0,u.Y)(w.p,{withBorder:!0,css:(0,s.AH)({marginBottom:l.spacing.sm},""),sectionKey:"input",title:(0,u.Y)("div",{css:M,children:(0,u.Y)(x.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,u.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:c.map(({key:e,value:t},s)=>(0,u.Y)(b.C,{title:e,data:t,searchFilter:n,activeMatch:a,containsActiveMatch:g&&"inputs"===a.section&&a.key===e},e||s))})}),m&&(0,u.Y)(w.p,{withBorder:!0,sectionKey:"output",title:(0,u.Y)("div",{css:D,children:(0,u.Y)(x.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,u.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:d.map(({key:e,value:t})=>(0,u.Y)(b.C,{title:e,data:t,searchFilter:n,activeMatch:a,containsActiveMatch:g&&"outputs"===a.section&&a.key===e},e))})})]})}var C=n(69910),I=n(29332);var N={name:"s5xdrg",styles:"display:flex;align-items:center"},F={name:"s5xdrg",styles:"display:flex;align-items:center"};function H({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:n}=(0,o.u)();return(0,u.FD)(d.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!e}`,value:e,onChange:e=>{t(e.target.value)},children:[(0,u.Y)(d.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,u.Y)(I.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,u.Y)(x.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,u.Y)("div",{css:N,children:(0,u.Y)(d.TextBoxIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})}),(0,u.Y)(d.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,u.Y)(I.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,u.Y)(x.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,u.Y)("div",{css:F,children:(0,u.Y)(d.MIcon,{css:(0,s.AH)({fontSize:n.typography.fontSizeLg},"")})})})})]})}var _={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function R({activeSpan:e,className:t,searchFilter:n,activeMatch:a}){const{theme:l}=(0,o.u)(),[c,p]=(0,i.useState)(!0),m=(0,i.useMemo)(()=>(0,h.g_)(e.inputs),[e]),g=e.outputs,f=m.length>0,v=!(0,r.isNil)(a)&&a.span.key===e.key,y=v&&"outputs"===a.section;return(0,u.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[f&&(0,u.Y)(w.p,{sectionKey:"input",css:(0,s.AH)({marginBottom:l.spacing.sm},""),title:(0,u.Y)(x.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,u.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:l.spacing.sm},""),children:m.map(({key:e,value:t},s)=>(0,u.Y)(b.C,{title:e,data:t,searchFilter:n,activeMatch:a,containsActiveMatch:v&&"inputs"===a.section&&a.key===e},e||s))})}),(0,u.Y)(w.p,{sectionKey:"output",title:(0,u.FD)("div",{css:_,children:[(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:l.spacing.sm},""),children:[(0,u.Y)(x.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,u.Y)(d.Tag,{componentId:"shared.model-trace-explorer.document-count",children:g.length})]}),!y&&(0,u.Y)(H,{shouldRenderMarkdown:c,setShouldRenderMarkdown:p})]}),children:c&&!y?(0,u.Y)("div",{css:(0,s.AH)({border:`1px solid ${l.colors.border}`,borderRadius:l.legacyBorders.borderRadiusMd},""),children:g.map((e,t)=>(0,u.Y)("div",{css:(0,s.AH)({borderBottom:t!==g.length-1?`1px solid ${l.colors.border}`:""},""),children:(0,u.Y)(C.p,{text:e.page_content,metadata:e.metadata},t)},t))}):(0,u.Y)("div",{css:(0,s.AH)({border:`1px solid ${l.colors.border}`,borderRadius:l.legacyBorders.borderRadiusMd,padding:l.spacing.md},""),children:(0,u.Y)(b.C,{title:"",data:JSON.stringify(g,null,2),searchFilter:n,activeMatch:a,containsActiveMatch:v&&"outputs"===a.section})})})]})}function E({activeSpan:e,className:t,searchFilter:n,activeMatch:i}){const{theme:a}=(0,o.u)();return!(0,r.isNil)(e)&&(0,h.vl)(e)?(0,u.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:a.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,u.Y)(R,{activeSpan:e,className:t,searchFilter:n,activeMatch:i})}):(0,u.Y)("div",{css:(0,s.AH)({overflowY:"auto",padding:a.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,u.Y)(k,{activeSpan:e,className:t,searchFilter:n,activeMatch:i})})}var O=n(2515);function B({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:i}=(0,o.u)(),{events:a}=e,l=!(0,r.isNil)(n)&&n.span.key===e.key;return Array.isArray(a)&&0!==a.length?(0,u.Y)("div",{css:(0,s.AH)({padding:i.spacing.md},""),children:a.map((e,r)=>{const a=e.attributes,c="exception"===e.name?(0,u.FD)(u.FK,{children:[(0,u.Y)(d.XCircleIcon,{css:(0,s.AH)({marginRight:i.spacing.sm},""),color:"danger"}),(0,u.Y)(o.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return a?(0,u.Y)(w.p,{sectionKey:e.name,title:c,withBorder:!0,children:(0,u.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm},""),children:Object.keys(a).map(s=>{const i=(0,h.Q0)(e.name,r,s);return(0,u.Y)(b.C,{title:s,data:JSON.stringify(a[s],null,2),searchFilter:t,activeMatch:n,containsActiveMatch:l&&"events"===n.section&&n.key===i,initialRenderMode:O.cC.TEXT},i)})})},`${e.name}-${r}`):null})}):(0,u.Y)("div",{css:(0,s.AH)({marginTop:i.spacing.md},""),children:(0,u.Y)(d.Empty,{description:(0,u.Y)(x.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}function j({count:e}){const{theme:t}=(0,o.u)();return(0,u.Y)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.typography.fontSizeBase,height:t.typography.fontSizeBase,backgroundColor:t.colors.actionDangerPrimaryBackgroundDefault,padding:t.spacing.xs,marginLeft:t.spacing.xs,boxSizing:"border-box"},""),children:(0,u.Y)("span",{css:(0,s.AH)({color:t.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}var z=n(16155),L=n(90662),K=n(38073);const $=250+K.uZ;function P({activeSpan:e,searchFilter:t,activeMatch:n,activeTab:l,setActiveTab:c}){const{theme:p}=(0,o.u)(),[m,f]=(0,i.useState)(500),v={flex:1,marginTop:-p.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:y,assessmentsPaneEnabled:b}=(0,g.nJ)();if((0,r.isNil)(e))return(0,u.Y)(d.Empty,{description:"Please select a span to view more information"});const S=(0,h.N7)(e),A=S>0,w=(0,u.FD)(d.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${p.colors.border}`,minWidth:200,position:"relative"},""),value:l,onValueChange:e=>c(e),children:[(0,u.Y)("div",{css:(0,s.AH)({position:"absolute",right:y?p.spacing.xs:p.spacing.md,top:p.spacing.xs},""),children:(0,u.Y)(z.N,{})}),(0,u.FD)(d.Tabs.List,{css:(0,s.AH)({padding:0,paddingLeft:p.spacing.md,paddingRight:p.spacing.sm,boxSizing:"border-box",width:"100%"},""),children:[e.chatMessages&&(0,u.Y)(d.Tabs.Trigger,{value:"chat",children:(0,u.Y)(x.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),(0,u.Y)(d.Tabs.Trigger,{value:"content",children:(0,u.Y)(x.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,u.Y)(d.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,u.FD)(d.Tabs.Trigger,{value:"events",children:["Events ",A&&(0,u.Y)(j,{count:S})]})]}),e.chatMessages&&(0,u.Y)(d.Tabs.Content,{css:v,value:"chat",children:(0,u.Y)(T,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,u.Y)(d.Tabs.Content,{css:v,value:"content",children:(0,u.Y)(E,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,u.Y)(d.Tabs.Content,{css:v,value:"attributes",children:(0,u.Y)(Y,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,u.Y)(d.Tabs.Content,{css:v,value:"events",children:(0,u.Y)(B,{activeSpan:e,searchFilter:t,activeMatch:n})})]});return b&&y?(0,u.Y)(a.A,{initialRatio:.7,paneWidth:m,setPaneWidth:f,leftChild:w,leftMinWidth:250,rightChild:(0,u.Y)(L.i,{assessments:e.assessments,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0}),rightMinWidth:K.uZ}):w}const U=i.memo(P);var V=n(69822);const W=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:n}=(0,o.u)();return(0,u.FD)(o.aw.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,u.Y)(o.aw.Trigger,{asChild:!0,children:(0,u.Y)(o.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,u.Y)(d.FilterIcon,{}),size:"small",children:(0,u.Y)(x.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,u.Y)(o.aw.Content,{align:"start",children:(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.xs},""),children:[(0,u.Y)(o.T.Text,{bold:!0,children:(0,u.Y)(x.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,u.Y)(o.T.Text,{color:"secondary",children:(0,u.Y)(x.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map(([r,i])=>{const a=(0,u.Y)(V.P,{type:(0,h.tC)(r)});return(0,u.FD)(d.Checkbox,{componentId:`shared.model-trace-explorer.toggle-span-filter_${r}-${!i}`,style:{width:"100%"},isChecked:i,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[r]:!i}}),children:[a,(0,u.Y)(o.T.Text,{css:(0,s.AH)({marginLeft:n.spacing.xs},""),children:(0,h.LS)(r)})]},r)}),(0,u.Y)(o.T.Text,{color:"secondary",children:(0,u.Y)(x.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,u.FD)(d.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showParents}`,style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,u.Y)(o.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,u.Y)(x.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,u.Y)(d.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,u.Y)(x.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,u.FD)(d.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showExceptions}`,style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,u.Y)(o.T.Text,{css:(0,s.AH)({marginRight:n.spacing.xs},""),children:(0,u.Y)(x.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,u.Y)(d.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,u.Y)(x.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},J=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:n,setSpanFilterState:r})=>{const{theme:i}=(0,o.u)();return(0,u.FD)("div",{css:(0,s.AH)({padding:`${i.spacing.xs}px ${i.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${i.colors.border}`,boxSizing:"border-box",paddingLeft:i.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,u.Y)(o.T.Text,{bold:!0,children:(0,u.Y)(x.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:i.spacing.sm},""),children:[(0,u.Y)(W,{spanFilterState:n,setSpanFilterState:r}),(0,u.FD)(d.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,u.Y)(d.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,u.Y)(I.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,u.Y)(x.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,u.Y)(d.ListBorderIcon,{})}),value:!1}),(0,u.Y)(d.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,u.Y)(I.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,u.Y)(x.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,u.Y)(d.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},G=({active:e})=>{const{theme:t}=(0,o.u)(),n=e?t.colors.blue500:t.colors.border;return(0,u.Y)("div",{css:(0,s.AH)({position:"absolute",left:"100%",bottom:0,width:f.De/2+1,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${n}`,borderRight:`1px solid ${n}`,zIndex:f.u4.LOW},"")})},q=({active:e})=>{const{theme:t}=(0,o.u)(),n=e?t.colors.blue500:t.colors.border;return(0,u.Y)("div",{css:(0,s.AH)({position:"absolute",left:"50%",top:0,width:f.De/2,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${n}`,borderLeft:`1px solid ${n}`,zIndex:e?f.u4.NORMAL:f.u4.LOW},"")})},X=({active:e})=>{const{theme:t}=(0,o.u)(),n=e?t.colors.blue500:t.colors.border;return(0,u.Y)("div",{css:(0,s.AH)({position:"absolute",width:f.De/2,left:"50%",height:f.QJ,borderLeft:`1px solid ${n}`,boxSizing:"border-box",zIndex:e?f.u4.NORMAL:f.u4.LOW},"")})},Q=({isActiveSpan:e,isInActiveChain:t,linesToRender:n,hasChildren:r,isExpanded:i})=>0===n.length?(0,u.Y)("div",{css:(0,s.AH)({width:0,height:f.QJ,boxSizing:"border-box",position:"relative"},""),children:r&&(0,u.Y)(G,{active:t&&!e})}):(0,u.Y)(u.FK,{children:n.map(({shouldRender:o,isActive:a},l)=>(0,u.FD)("div",{css:(0,s.AH)({width:f.De,height:f.QJ,boxSizing:"border-box",position:"relative"},""),children:[o&&(0,u.Y)(X,{active:a}),l===n.length-1&&(0,u.FD)(u.FK,{children:[(0,u.Y)(q,{active:t}),r&&i&&(0,u.Y)(G,{active:t&&!e})]})]},l))});var Z={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const ee=({span:e,children:t})=>{var n;const{theme:r}=(0,o.u)(),i=(0,h.tC)(null!==(n=e.type)&&void 0!==n?n:O.UG.UNKNOWN),a=r.isDarkMode?r.colors.grey800:r.colors.grey100,l=r.isDarkMode?r.colors.grey500:r.colors.grey350;return(0,u.Y)(I.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,u.FD)("div",{css:Z,children:[(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,u.Y)(V.P,{type:i,isInTooltip:!0}),(0,u.Y)("span",{css:(0,s.AH)({color:a},""),children:e.title}),(0,u.Y)("span",{css:(0,s.AH)({marginLeft:r.spacing.xs,color:l,fontSize:r.typography.fontSizeSm},""),children:(0,f.X6)(e.end-e.start)})]}),(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",color:a},""),children:[(0,u.Y)(x.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",(0,f.X6)(e.start)," | ",(0,u.Y)(x.sA,{id:"q90jVU",defaultMessage:"End:"})," ",(0,f.X6)(e.end)]})]}),side:"right",maxWidth:700,children:t})};var te={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},ne={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const se=({node:e,selectedKey:t,expandedKeys:n,setExpandedKeys:r,traceStartTime:i,traceEndTime:a,onSelect:l,linesToRender:c})=>{var p,m;const v=n.has(e.key),{theme:y}=(0,o.u)(),x=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,{setAssessmentsPaneExpanded:b}=(0,g.nJ)(),Y=t===e.key,S=(0,f.VD)(e,String(t)),A=S>-1,w=(0,h.N7)(e)>0,T=Y?y.colors.actionDefaultBackgroundHover:"transparent";return(0,u.FD)(u.FK,{children:[(0,u.Y)(ee,{span:e,children:(0,u.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:T,":hover":{backgroundColor:y.colors.actionDefaultBackgroundHover},":active":{backgroundColor:y.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===l||void 0===l||l(e)},children:(0,u.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${y.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,u.FD)("div",{css:te,children:[x?(0,u.Y)(o.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:y.spacing.xs},""),icon:v?(0,u.Y)(d.ChevronDownIcon,{}):(0,u.Y)(o.o,{}),onClick:t=>{t.stopPropagation();const s=new Set(n);v?s.delete(e.key):s.add(e.key),r(s)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,u.Y)("div",{css:(0,s.AH)({width:24,marginRight:y.spacing.xs},"")}),(0,u.Y)(Q,{isActiveSpan:Y,isInActiveChain:A,linesToRender:c,hasChildren:x,isExpanded:v}),(0,u.Y)("span",{css:(0,s.AH)({flexShrink:0,marginRight:y.spacing.xs,borderRadius:y.borders.borderRadiusSm,border:`1px solid ${S>-1?y.colors.blue500:y.colors.backgroundSecondary}`,zIndex:f.u4.NORMAL},""),children:e.icon}),(0,u.Y)(o.T.Text,{color:w?"error":"primary",css:ne,children:e.title}),e.assessments.length>0&&(0,u.FD)(d.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,s.AH)({margin:0,borderRadius:y.borders.borderRadiusSm},""),onClick:()=>null===b||void 0===b?void 0:b(!0),children:[(0,u.Y)(d.GavelIcon,{}),(0,u.Y)(o.T.Text,{css:(0,s.AH)({marginLeft:y.spacing.xs},""),children:e.assessments.length})]})]})})})}),v&&(null===(m=e.children)||void 0===m?void 0:m.map((s,o)=>{var d,p;return(0,u.Y)(se,{node:s,expandedKeys:n,setExpandedKeys:r,selectedKey:t,traceStartTime:i,traceEndTime:a,onSelect:l,linesToRender:c.concat({shouldRender:o<(null!==(d=null===(p=e.children)||void 0===p?void 0:p.length)&&void 0!==d?d:0)-1,isActive:o<S})},s.key)}))]})};var re=n(33112);var ie={name:"1j2qjqs",styles:"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const oe=({node:e,selectedKey:t,leftOffset:n,width:r,onSelect:a,expandedKeys:l,setExpandedKeys:c})=>{var p;const{theme:m}=(0,o.u)(),g=(0,i.useRef)(null),h=(0,i.useRef)(null),v=t===e.key?m.colors.actionDefaultBackgroundHover:"transparent",y=(null!==(p=e.children)&&void 0!==p?p:[]).length>0,x=l.has(e.key);return(0,i.useLayoutEffect)(()=>{if(!g.current||!h.current)return;Math.max(g.current.offsetWidth,h.current.offsetWidth)<r-m.spacing.sm?(g.current.style.display="inline",h.current.style.display="none"):(g.current.style.display="none",h.current.style.display="inline")},[m.spacing.sm,r]),(0,u.Y)(ee,{span:e,children:(0,u.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:m.spacing.xs,paddingRight:m.spacing.sm,paddingTop:m.spacing.xs,paddingBottom:m.spacing.xs,backgroundColor:v,alignItems:"center",":hover":{backgroundColor:m.colors.actionDefaultBackgroundHover},":active":{backgroundColor:m.colors.actionDefaultBackgroundPress},zIndex:f.u4.NORMAL},""),onClick:()=>null===a||void 0===a?void 0:a(e),children:[y?(0,u.Y)(o.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,s.AH)({flexShrink:0,marginRight:m.spacing.xs},""),icon:x?(0,u.Y)(d.ChevronDownIcon,{}):(0,u.Y)(o.o,{}),onClick:t=>{t.stopPropagation();const n=new Set(l);x?n.delete(e.key):n.add(e.key),c(n)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,u.Y)("div",{css:(0,s.AH)({width:24,marginRight:m.spacing.xs},"")}),(0,u.Y)("div",{css:(0,s.AH)({width:n,flexShrink:0},"")}),(0,u.Y)("div",{css:(0,s.AH)({position:"relative",width:r,height:m.typography.lineHeightBase,backgroundColor:m.colors.blue600,borderRadius:m.borders.borderRadiusSm,flexShrink:0},""),children:(0,u.Y)(o.T.Text,{children:(0,u.Y)("span",{ref:g,css:(0,s.AH)({marginLeft:m.spacing.xs,color:m.colors.white,display:"none"},""),children:e.title})})}),(0,u.FD)("div",{css:ie,children:[(0,u.Y)(o.T.Text,{children:(0,u.Y)("span",{ref:h,css:(0,s.AH)({marginLeft:m.spacing.xs,color:m.colors.textPrimary},""),children:e.title})}),(0,u.Y)(o.T.Text,{css:(0,s.AH)({marginLeft:m.spacing.xs},""),color:"secondary",children:(0,f.X6)(e.end-e.start)})]})]},e.key)})};var ae={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},le={name:"bjn8wh",styles:"position:relative"},ce={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const de=({nodes:e,selectedKey:t,onSelect:n,traceStartTime:r,traceEndTime:a,expandedKeys:l,setExpandedKeys:c})=>{var d,p;const{theme:m}=(0,o.u)(),g=(0,i.useRef)(null),h=null!==(d=null===(p=(0,re.wY)({ref:g}))||void 0===p?void 0:p.width)&&void 0!==d?d:0,v=(0,i.useMemo)(()=>function(e,t,n,s=60){const r=t-e;if(r<=0||n<=0)return[];const i=Math.floor(n/s);if(i<1)return[];const o=r/i,a=Math.pow(10,Math.floor(Math.log10(o))),l=o/a;let c;c=l<=1?1:l<=2?2:l<=5?5:10;const d=c*a,u=t+2*d,p=[];for(let m=Math.ceil(e/d)*d;m<=u;m+=d)p.push(Number(m.toFixed(10)));return p}(r,a,h),[a,r,h]),y=Math.min(...v),x=(v[v.length-1]+v[v.length-2])/2,b=v.slice(0,-1),Y=e=>function(e,t,n,s){return(e-t)/(n-t)*s}(e,y,x,h);return(0,u.FD)("div",{css:ae,children:[(0,u.Y)("div",{ref:g,css:(0,s.AH)({display:"flex",width:"100%",flexDirection:"row",height:m.typography.lineHeightBase,paddingLeft:32,paddingRight:m.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:m.colors.backgroundPrimary,zIndex:f.u4.HIGH},""),children:(0,u.Y)("div",{"data-testid":"time-marker-area",css:le,children:b.map(e=>(0,u.Y)(o.T.Text,{css:(0,s.AH)({position:"absolute",transform:"translateX(-50%)",left:Y(e),whiteSpace:"nowrap"},""),children:(0,f.X6)(e)},e))})}),(0,u.Y)("div",{css:(0,s.AH)({flex:1,pointerEvents:"none",zIndex:f.u4.LOW},""),children:(0,u.Y)("div",{css:ce,children:b.map(e=>(0,u.Y)("div",{css:(0,s.AH)({position:"absolute",left:Y(e)+32,borderRight:`1px solid ${m.colors.border}`,height:"100%"},"")},e))})}),e.map(e=>{const s=Y(e.start),r=Y(e.end)-s;return(0,u.Y)(oe,{selectedKey:t,onSelect:n,node:e,leftOffset:s,width:r,expandedKeys:l,setExpandedKeys:c},e.key)})]})};var ue={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},pe={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},me={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},ge={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const he=({rootNodes:e,selectedNode:t,setSelectedNode:n,traceStartTime:r,traceEndTime:a,expandedKeys:l,setExpandedKeys:c,spanFilterState:d,setSpanFilterState:p,className:m})=>{const{theme:h}=(0,o.u)(),v=(0,i.useCallback)(e=>{null===n||void 0===n||n(e)},[n]),{showTimelineTreeGantt:y,setShowTimelineTreeGantt:b}=(0,g.nJ)(),Y=(0,i.useMemo)(()=>(0,f.os)(e,l),[e,l]),S=(0,i.useMemo)(()=>{var n;return(0,u.Y)("div",{css:ue,children:y?(0,u.Y)(de,{nodes:Y,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",onSelect:v,traceStartTime:r,traceEndTime:a,expandedKeys:l,setExpandedKeys:c}):e.map(e=>{var n;return(0,u.Y)(se,{node:e,expandedKeys:l,setExpandedKeys:c,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",traceStartTime:r,traceEndTime:a,onSelect:v,linesToRender:[]},e.key)})})},[y,Y,null===t||void 0===t?void 0:t.key,v,r,a,e,l,c]);return(0,u.Y)("div",{css:(0,s.AH)({height:"100%",borderRadius:h.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:m,children:(0,u.Y)("div",{css:pe,children:(0,u.FD)("div",{css:me,children:[(0,u.Y)(J,{showTimelineInfo:y,setShowTimelineInfo:b,spanFilterState:d,setSpanFilterState:p}),e.length>0?(0,u.Y)("div",{css:ge,children:S}):(0,u.Y)("div",{css:(0,s.AH)({flex:1,display:"flex",justifyContent:"center",padding:h.spacing.md,paddingTop:h.spacing.lg},""),children:(0,u.Y)(x.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})};var fe={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},ve={name:"82a6rk",styles:"flex:1"};const ye=({modelTrace:e,className:t,selectedSpanId:n,onSelectSpan:l})=>{var c,d;const{theme:p}=(0,o.u)(),h=window.innerWidth<=768?.33:.25,v=(0,i.useRef)(null),[x,b]=(0,i.useState)(500),{rootNode:Y,selectedNode:S,setSelectedNode:A,activeTab:w,setActiveTab:T}=(0,g.nJ)(),{expandedKeys:M,setExpandedKeys:D}=(0,f.B$)({rootNodes:Y?[Y]:[],initialExpandDepth:f.vf}),{matchData:k,searchFilter:C,setSearchFilter:I,spanFilterState:N,setSpanFilterState:F,filteredTreeNodes:H,handleNextSearchMatch:_,handlePreviousSearchMatch:R}=y({treeNode:Y,selectedNode:S,setSelectedNode:A,setActiveTab:T,setExpandedKeys:D,modelTraceInfo:null===e||void 0===e?void 0:e.info});(0,i.useLayoutEffect)(()=>{const e=(0,r.values)((0,f.dM)(H,f.vf)).map(e=>e.key);D(new Set(e))},[H,D]);const E=(0,i.useMemo)(()=>{const e=Math.max(...H.map(f.EA))*f.De+7*p.spacing.lg;return Math.max(275,e)},[H,p.spacing.lg]);return(0,u.FD)("div",{css:fe,className:t,children:[(0,u.Y)("div",{css:(0,s.AH)({padding:p.spacing.xs,borderBottom:`1px solid ${p.colors.border}`},""),children:(0,u.Y)(m,{searchFilter:C,setSearchFilter:I,matchData:k,handleNextSearchMatch:_,handlePreviousSearchMatch:R})}),(0,u.Y)(a.A,{ref:v,initialRatio:h,paneWidth:x,setPaneWidth:b,leftChild:(0,u.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:E},""),children:(0,u.Y)(he,{rootNodes:H,selectedNode:S,traceStartTime:null!==(c=null===Y||void 0===Y?void 0:Y.start)&&void 0!==c?c:0,traceEndTime:null!==(d=null===Y||void 0===Y?void 0:Y.end)&&void 0!==d?d:0,setSelectedNode:e=>{A(e),T(null!==e&&void 0!==e&&e.chatMessages?"chat":"content"),(0,r.isString)(null===e||void 0===e?void 0:e.key)&&(null===l||void 0===l||l(null===e||void 0===e?void 0:e.key))},css:ve,expandedKeys:M,setExpandedKeys:D,spanFilterState:N,setSpanFilterState:F})}),leftMinWidth:E,rightChild:(0,u.Y)(U,{activeSpan:S,searchFilter:C,activeMatch:k.match,activeTab:w,setActiveTab:T}),rightMinWidth:$})]})}},78859:function(e,t,n){n.d(t,{w:function(){return s}});const s=()=>"User"},79855:function(e,t,n){n.d(t,{bU:function(){return l},aG:function(){return a},N5:function(){return c},G3:function(){return d}});var s=n(48523);const r=fetch;function i(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}const o=async(e,t="GET",n)=>{const o=await r(e,{method:t,body:i(n),headers:n?{"Content-Type":"application/json"}:{}});if(!o.ok){const e=(0,s.a$)(o);if(e){try{const t=(await o.json()).message;e.message=null!==t&&void 0!==t?t:e.message}catch{}throw e}}return o.json()},a=({traceId:e,assessmentId:t})=>o(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`,"DELETE"),l=({payload:e})=>o(`/ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`,"POST",e),c=({traceId:e})=>o(`/ajax-api/3.0/mlflow/traces/${e}`),d=({traceId:e,assessmentId:t,payload:n})=>o(`/ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`,"PATCH",n)},83689:function(e,t,n){n.d(t,{E:function(){return d}});var s=n(64819),r=n(76998),i=n(37733),o=n(32256),a=n(49818),l=n(51391);function c({paramName:e,paramProperties:t,isRequired:n}){const{theme:r}=(0,i.u)(),{type:o,description:c,enum:d}=t,u=o||c||d,p=u?{borderTopLeftRadius:r.borders.borderRadiusMd,borderTopRightRadius:r.borders.borderRadiusMd,borderBottom:`1px solid ${r.colors.border}`}:{borderRadius:r.borders.borderRadiusMd};return(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:r.borders.borderRadiusMd,border:`1px solid ${r.colors.border}`},""),children:[(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:r.colors.backgroundSecondary,padding:`${r.spacing.sm}px ${r.spacing.md}px`,gap:r.spacing.sm,...p},""),children:[(0,l.Y)(i.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),n&&(0,l.Y)(i.T.Text,{withoutMargins:!0,color:"error",children:(0,l.Y)(a.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),u&&(0,l.FD)("div",{css:(0,s.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:r.spacing.md,padding:`${r.spacing.sm}px ${r.spacing.md}px`},""),children:[o&&(0,l.FD)(l.FK,{children:[(0,l.Y)(i.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(a.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,l.Y)(i.T.Text,{withoutMargins:!0,code:!0,children:o})]}),c&&(0,l.FD)(l.FK,{children:[(0,l.Y)(i.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(a.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,l.Y)(i.T.Text,{withoutMargins:!0,children:c})]}),d&&(0,l.FD)(l.FK,{children:[(0,l.Y)(i.T.Text,{withoutMargins:!0,bold:!0,children:(0,l.Y)(a.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm,flexWrap:"wrap"},""),children:d.map(e=>(0,l.Y)(i.T.Text,{withoutMargins:!0,code:!0,children:e},e))})]})]})]})}function d({tool:e}){var t,n,a;const{theme:d}=(0,i.u)(),[u,p]=(0,r.useState)(!1),m=e.function.description,g=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,h=null!==(n=null===(a=e.function.parameters)||void 0===a?void 0:a.required)&&void 0!==n?n:[],f=m||g,v=f?{":hover":{backgroundColor:d.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,l.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:d.borders.borderRadiusMd,border:`1px solid ${d.colors.border}`,backgroundColor:d.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,l.FD)("div",{role:"button",css:(0,s.AH)({display:"flex",flexDirection:"row",gap:d.spacing.sm,alignItems:"center",borderBottom:f&&u?`1px solid ${d.colors.border}`:"none",padding:d.spacing.sm,...v},""),onClick:()=>p(!u),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[f&&(u?(0,l.Y)(o.ChevronDownIcon,{}):(0,l.Y)(i.o,{})),(0,l.Y)(i.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),f&&u&&(0,l.FD)("div",{css:(0,s.AH)({padding:d.spacing.sm},""),children:[m&&(0,l.Y)(i.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:d.spacing.sm,padding:`0px ${d.spacing.xs}px`},children:e.function.description}),g&&(0,l.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:d.spacing.sm},""),children:Object.keys(g).map(e=>(0,l.Y)(c,{paramName:e,paramProperties:g[e],isRequired:h.includes(e)},e))})]})]})}},84918:function(e,t,n){n.d(t,{DK:function(){return c},nJ:function(){return l}});var s=n(76998),r=n(61520),i=n(793),o=n(51391);const a=(0,s.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},assessmentsPaneEnabled:!0}),l=()=>(0,s.useContext)(a),c=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:n,assessmentsPaneEnabled:l,children:c})=>{var d,u,p;const m=(0,s.useMemo)(()=>(0,r.jW)(e),[e]),g=(0,s.useMemo)(()=>m?(0,i.dM)([m]):{},[m]),h=(0,r.f7)(m,n),f=null!==(d=null!==h&&void 0!==h?h:m)&&void 0!==d?d:void 0,v=(null!==(u=null===f||void 0===f||null===(p=f.assessments)||void 0===p?void 0:p.length)&&void 0!==u?u:0)>0,[y,x]=(0,s.useState)(t),[b,Y]=(0,s.useState)(f),[S,A]=(0,s.useState)(null!==b&&void 0!==b&&b.chatMessages?"chat":"content"),[w,T]=(0,s.useState)(!1),[M,D]=(0,s.useState)(v),k=(0,s.useMemo)(()=>({rootNode:m,nodeMap:g,activeView:y,setActiveView:x,activeTab:S,setActiveTab:A,selectedNode:b,setSelectedNode:Y,showTimelineTreeGantt:w,setShowTimelineTreeGantt:T,assessmentsPaneExpanded:M,setAssessmentsPaneExpanded:D,assessmentsPaneEnabled:l}),[y,g,S,m,b,w,T,M,D,l]);return(0,o.Y)(a.Provider,{value:k,children:c})}},86656:function(e,t,n){var s=n(64819),r=n(45901),i=n(76998),o=n(91838),a=n(37733),l=n(33112),c=n(51391);var d={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},u={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},p={name:"kjqqaz",styles:"width:0;position:relative"};const m=(0,i.forwardRef)(({initialRatio:e,paneWidth:t,setPaneWidth:n,leftChild:m,leftMinWidth:g,rightChild:h,rightMinWidth:f},v)=>{var y;const[x,b]=(0,i.useState)(!1),Y=(0,i.useRef)(null),S=null===(y=(0,l.wY)({ref:Y}))||void 0===y?void 0:y.width,A=(null!==S&&void 0!==S?S:1/0)-f,w=(0,i.useRef)(e),{theme:T}=(0,a.u)(),M=(0,i.useCallback)(e=>{S&&(w.current=e/S)},[S]);return(0,i.useImperativeHandle)(v,()=>({updateRatio:M})),(0,i.useLayoutEffect)(()=>{S&&n((0,r.clamp)(S*w.current,g,A))},[S,A,g,f,n]),(0,c.FD)("div",{ref:Y,css:u,children:[x&&(0,c.Y)(s.mL,{styles:d}),(0,c.Y)(o.ResizableBox,{axis:"x",width:t,css:(0,s.AH)({display:"flex",flex:`0 0 ${t}px`},""),handle:(0,c.Y)("div",{css:p,children:(0,c.Y)("div",{css:(0,s.AH)({position:"relative",width:T.spacing.sm,marginLeft:-T.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const s=(0,r.clamp)(t.width,g,A);n(s),S&&(w.current=s/S)},onResizeStart:()=>b(!0),onResizeStop:()=>b(!1),minConstraints:[g,1/0],maxConstraints:[A,1/0],children:m}),h]})});t.A=m},90367:function(e,t,n){n.d(t,{i:function(){return Y}});var s=n(64819),r=n(37733),i=n(29332),o=n(32256),a=n(26737),l=n(76998),c=n(86288),d=n(34139),u=n(61520),p=n(793),m=n(84918),g=n(45901),h=n.n(g);var f=n(51391);var v={name:"e0dnmk",styles:"cursor:pointer"};const y=({label:e,value:t,icon:n,tagKey:a,color:l="teal",getTruncatedLabel:c,getComponentId:d,onCopy:u})=>{const{theme:p}=(0,r.u)();return(0,f.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:p.spacing.sm},""),children:[(0,f.Y)(r.T.Text,{size:"md",color:"secondary",children:e}),(0,f.Y)(i.T,{componentId:d(a),content:t,maxWidth:400,children:(0,f.Y)(o.Tag,{componentId:d(a),color:l,onClick:()=>{navigator.clipboard.writeText(t),u()},css:v,children:(0,f.FD)("span",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:p.spacing.xs},""),children:[n&&(0,f.Y)("span",{children:n}),(0,f.Y)("span",{children:c(t)})]})})})]})};var x={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},b={name:"e0dnmk",styles:"cursor:pointer"};const Y=({modelTrace:e})=>{var t;(0,c.A)();const{theme:n}=(0,r.u)(),[g,v]=(0,l.useState)(!1),{rootNode:Y}=(0,m.nJ)(),S=Object.entries(null!==(t=e.info.tags)&&void 0!==t?t:{}).filter(([e])=>{return!(t=e).startsWith("mlflow.")&&!t.startsWith("_mlflow_");var t}),A=(0,u.MF)(e),w=(0,l.useMemo)(()=>{var t,n,s;return(e=>{try{return JSON.parse(e)}catch(t){return}})(null!==(t=null===(n=e.info)||void 0===n||null===(s=n.trace_metadata)||void 0===s?void 0:s["mlflow.trace.tokenUsage"])&&void 0!==t?t:"{}")},[e.info]),T=(0,l.useMemo)(()=>null===w||void 0===w?void 0:w.total_tokens,[w]),M=(0,l.useMemo)(()=>{if(Y)return(0,p.X6)(Y.end-Y.start)},[Y]),D=(0,l.useCallback)(e=>`mlflow.model_trace_explorer.header_details.tag-${e}`,[]),k=e=>((e,t)=>{const n=h().truncate(e,{length:t});return h().takeWhile(n,e=>"\n"!==e).join("")})(e,40),C=(0,l.useCallback)(()=>{v(!0),setTimeout(()=>v(!1),2e3)},[]);return(0,f.FD)(f.FK,{children:[(0,f.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",gap:n.spacing.md,flexWrap:"wrap"},""),children:[A&&(0,f.Y)(y,{label:(0,f.Y)(d.A,{id:"imKpxw",defaultMessage:"ID"}),value:A,tagKey:A,color:"pink",getTruncatedLabel:k,getComponentId:D,onCopy:C}),T&&(0,f.Y)(y,{label:(0,f.Y)(d.A,{id:"zp4MBw",defaultMessage:"Token count"}),value:T.toString(),tagKey:"token-count",color:"default",getTruncatedLabel:k,getComponentId:D,onCopy:C}),M&&(0,f.Y)(y,{label:(0,f.Y)(d.A,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,f.Y)(a.C,{css:x}),value:M,tagKey:"latency",color:"default",getTruncatedLabel:k,getComponentId:D,onCopy:C}),(0,f.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,f.Y)(r.T.Text,{size:"md",color:"secondary",children:(0,f.Y)(d.A,{id:"7KPJii",defaultMessage:"Tags"})}),(0,f.Y)(o.Overflow,{noMargin:!0,children:S.map(([e,t])=>{const n=`${e}-${t}`,s=`${e}: ${t}`;return(0,f.Y)(i.T,{componentId:D(n),content:s,children:(0,f.Y)(o.Tag,{componentId:D(n),color:"teal",onClick:()=>{var e;e=s,navigator.clipboard.writeText(e),C()},css:b,children:k(`${e}: ${t}`)})},e)})})]})]}),g&&(0,f.FD)(o.Notification.Provider,{children:[(0,f.Y)(o.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,f.Y)(o.Notification.Title,{children:(0,f.Y)(d.A,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,f.Y)(o.Notification.Viewport,{})]})]})}},90662:function(e,t,n){n.d(t,{i:function(){return oe}});var s=n(64819),r=n(45901),i=n(76998),o=n(37733),a=n(29332),l=n(49818),c=n(32256),d=n(26737),u=n(78859),p=n(1646),m=n(69608),g=n(38073),h=n(61520),f=n(79855),v=n(51391);const y=({assessmentName:e,spanId:t,traceId:n,setExpanded:a})=>{const y=(0,l.tz)(),x=(0,p.jE)(),{theme:b}=(0,o.u)(),[Y,S]=(0,i.useState)(""),[A,w]=(0,i.useState)("feedback"),[T,M]=(0,i.useState)("boolean"),[D,k]=(0,i.useState)(!0),[C,I]=(0,i.useState)(""),[N,F]=(0,i.useState)(null),{mutate:H,isLoading:_}=(0,m.n)({mutationFn:e=>(0,f.bU)({payload:e}),onSuccess:()=>{x.invalidateQueries({queryKey:[h.BS,n]})},onError:e=>{(0,h.ij)(y.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{a(!1)}}),R=!(0,r.isNil)(e),E=(0,i.useCallback)(async()=>{var s;if("json"===T)try{JSON.parse(D)}catch(o){return void F((0,v.Y)(l.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}const r=(0,g.KN)({formValue:D,dataType:T,isFeedback:"feedback"===A}),i={assessment:{assessment_name:R?e:Y,trace_id:n,source:{source_type:"HUMAN",source_id:null!==(s=(0,u.w)())&&void 0!==s?s:""},span_id:t,rationale:C,...r}};H(i)},[T,D,A,R,e,Y,n,t,C,H]);return(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:b.spacing.xs,marginTop:b.spacing.sm,border:`1px solid ${b.colors.border}`,padding:b.spacing.sm,borderRadius:b.borders.borderRadiusSm},""),children:[(0,v.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,v.FD)(c.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",value:A,disabled:_,onChange:e=>w(e.target.value),children:[(0,v.Y)(c.SimpleSelectOption,{value:"feedback",children:(0,v.Y)(l.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,v.Y)(c.SimpleSelectOption,{value:"expectation",children:(0,v.Y)(l.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,v.Y)(o.T.Text,{css:(0,s.AH)({marginTop:b.spacing.xs},""),size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),R?(0,v.Y)(o.T.Text,{children:e}):(0,v.Y)(d.I,{componentId:"shared.model-trace-explorer.assessment-name-input",value:Y,disabled:_,onKeyDown:e=>e.stopPropagation(),onChange:e=>S(e.target.value)}),(0,v.Y)(o.T.Text,{css:(0,s.AH)({marginTop:b.spacing.xs},""),size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,v.FD)(c.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",value:T,disabled:_,onChange:e=>{M(e.target.value),F(null)},children:["expectation"===A&&(0,v.Y)(c.SimpleSelectOption,{value:"json",children:(0,v.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,v.Y)(c.SimpleSelectOption,{value:"string",children:(0,v.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,v.Y)(c.SimpleSelectOption,{value:"boolean",children:(0,v.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,v.Y)(c.SimpleSelectOption,{value:"number",children:(0,v.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,v.Y)(o.T.Text,{css:(0,s.AH)({marginTop:b.spacing.xs},""),size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),"json"===T&&(0,v.FD)(v.FK,{children:[(0,v.Y)(d.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(D),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value),F(null)},validationState:N?"error":void 0,disabled:_}),N&&(0,v.Y)(c.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:N,type:"error"})]}),"string"===T&&(0,v.Y)(d.I,{componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(D),onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value),F(null)},disabled:_,allowClear:!0}),"boolean"===T&&(0,v.FD)(c.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:D,disabled:_,onChange:e=>{k(e.target.value),F(null)},children:[(0,v.Y)(c.SegmentedControlButton,{value:!0,children:"True"}),(0,v.Y)(c.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===T&&(0,v.Y)(d.I,{componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(D),onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value?Number(e.target.value):""),F(null)},type:"number",disabled:_,allowClear:!0}),(0,v.Y)(o.T.Text,{css:(0,s.AH)({marginTop:b.spacing.xs},""),size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,v.Y)(d.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:C,autoSize:{minRows:1,maxRows:5},disabled:_,onKeyDown:e=>e.stopPropagation(),onChange:e=>I(e.target.value)}),(0,v.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:b.spacing.xs},""),children:[(0,v.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:_,onClick:()=>a(!1),children:(0,v.Y)(l.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,v.Y)(o.B,{css:(0,s.AH)({marginLeft:b.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:E,loading:_,children:(0,v.Y)(l.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})},x=({title:e,assessmentName:t,spanId:n,traceId:s})=>{const[r,a]=(0,i.useState)(!1);return(0,v.FD)("div",{children:[(0,v.Y)(o.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,v.Y)(c.PlusIcon,{}),onClick:()=>a(!0),children:e}),r&&(0,v.Y)(y,{assessmentName:t,spanId:n,traceId:s,setExpanded:a})]})};var b=n(93745);const Y=({assessment:e,setIsEditing:t,setShowDeleteModal:n})=>{var s;const r="feedback"in e,i=null!==(s=(0,u.w)())&&void 0!==s?s:"",a=(0,b.nX)(),d=i===e.source.source_id||r&&"HUMAN"!==e.source.source_type,p=a&&d&&t;return(0,v.FD)(c.DropdownMenu.Root,{children:[(0,v.Y)(c.DropdownMenu.Trigger,{asChild:!0,children:(0,v.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,v.Y)(c.OverflowIcon,{}),size:"small"})}),(0,v.FD)(c.DropdownMenu.Content,{minWidth:100,children:[p&&(0,v.FD)(c.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,v.Y)(c.DropdownMenu.IconWrapper,{children:(0,v.Y)(c.PencilIcon,{})}),(0,v.Y)(l.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,v.FD)(c.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>n(!0),children:[(0,v.Y)(c.DropdownMenu.IconWrapper,{children:(0,v.Y)(c.TrashIcon,{})}),(0,v.Y)(l.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},S=({assessment:e,isModalVisible:t,setIsModalVisible:n})=>{const s=(0,l.tz)(),r=(0,p.jE)(),{mutate:o,isLoading:c}=(0,m.n)({mutationFn:()=>(0,f.aG)({traceId:e.trace_id,assessmentId:e.assessment_id}),onSuccess:()=>{r.invalidateQueries({queryKey:[h.BS,e.trace_id]})},onError:e=>{(0,h.ij)(s.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)}))},onSettled:()=>{n(!1)}}),d=(0,i.useCallback)(()=>{o()},[o]);return(0,v.Y)(a.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:d,okButtonProps:{danger:!0,loading:c},okText:(0,v.Y)(l.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{n(!1)},cancelText:(0,v.Y)(l.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:c,title:(0,v.Y)(l.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,v.Y)(l.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})},A=({assessment:e,onSuccess:t,onSettled:n,onCancel:a})=>{var y;const x="feedback"in e,b=(e=>"feedback"in e?e.feedback.value:"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value)(e),Y=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(n){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(b,x),S=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(b),A=null!==(y=(0,u.w)())&&void 0!==y?y:"",{theme:w}=(0,o.u)(),[T,M]=(0,i.useState)(Y),[D,k]=(0,i.useState)(S),[C,I]=(0,i.useState)(e.rationale),[N,F]=(0,i.useState)(null),{updateAssessmentMutation:H,isLoading:_}=(({assessment:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,l.tz)(),i=(0,p.jE)(),{mutate:o,isLoading:a}=(0,m.n)({mutationFn:t=>(0,f.G3)({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,h.ij)(r.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:()=>{i.invalidateQueries({queryKey:[h.BS,e.trace_id]}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{updateAssessmentMutation:o,isLoading:a}})({assessment:e,onSuccess:t,onSettled:n}),{overrideAssessmentMutation:R,isLoading:E}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const i=(0,l.tz)(),o=(0,p.jE)(),{mutate:a,isLoading:c}=(0,m.n)({mutationFn:({oldAssessment:e,value:t,rationale:n})=>{var s;const i={...e,...t,rationale:n,source:{source_id:null!==(s=(0,u.w)())&&void 0!==s?s:"",source_type:"HUMAN"},overrides:e.assessment_id},o={assessment:(0,r.omit)(i,"assessment_id","create_time","last_update_time","overriddenAssessments")};return(0,f.bU)({payload:o})},onError:e=>{(0,h.ij)(i.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:()=>{o.invalidateQueries({queryKey:[h.BS,e]}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{overrideAssessmentMutation:a,isLoading:c}})({traceId:e.trace_id,onSuccess:t,onSettled:n}),O=_||E,B=(0,i.useCallback)(async()=>{if("json"===T)try{JSON.parse(D)}catch(n){return void F((0,v.Y)(l.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=(0,g.KN)({formValue:D,dataType:T,isFeedback:x});if(A!==e.source.source_id&&x)R({oldAssessment:e,value:t,...C?{rationale:C}:{}});else{const e={assessment:{...t,rationale:C},update_mask:(x?"feedback":"expectation")+",rationale"};H(e)}},[T,D,x,A,e,C,H,R]);return(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:w.spacing.xs,marginTop:w.spacing.sm,border:`1px solid ${w.colors.border}`,padding:w.spacing.sm,borderRadius:w.borders.borderRadiusSm},""),children:[(0,v.Y)(o.T.Text,{css:(0,s.AH)({marginTop:w.spacing.xs},""),size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,v.FD)(c.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:T,disabled:O,onChange:e=>{M(e.target.value),F(null)},children:[!x&&(0,v.Y)(c.SimpleSelectOption,{value:"json",children:(0,v.Y)(l.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,v.Y)(c.SimpleSelectOption,{value:"string",children:(0,v.Y)(l.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,v.Y)(c.SimpleSelectOption,{value:"boolean",children:(0,v.Y)(l.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,v.Y)(c.SimpleSelectOption,{value:"number",children:(0,v.Y)(l.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,v.Y)(o.T.Text,{css:(0,s.AH)({marginTop:w.spacing.xs},""),size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===T&&(0,v.FD)(v.FK,{children:[(0,v.Y)(d.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(D),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value),F(null)},validationState:N?"error":void 0,disabled:O}),N&&(0,v.Y)(c.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:N,type:"error"})]}),"string"===T&&(0,v.Y)(d.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(D),onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value),F(null)},disabled:O,allowClear:!0}),"boolean"===T&&(0,v.FD)(c.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:D,disabled:O,onChange:e=>{k(e.target.value),F(null)},children:[(0,v.Y)(c.SegmentedControlButton,{value:!0,children:"True"}),(0,v.Y)(c.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===T&&(0,v.Y)(d.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(D),onKeyDown:e=>e.stopPropagation(),onChange:e=>{k(e.target.value?Number(e.target.value):""),F(null)},type:"number",disabled:O,allowClear:!0}),(0,v.Y)(o.T.Text,{css:(0,s.AH)({marginTop:w.spacing.xs},""),size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,v.Y)(d.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:C,autoSize:{minRows:1,maxRows:5},disabled:O,onKeyDown:e=>e.stopPropagation(),onChange:e=>I(e.target.value)}),(0,v.FD)("div",{css:(0,s.AH)({display:"flex",justifyContent:"flex-end",marginTop:w.spacing.xs},""),children:[(0,v.Y)(o.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:O,onClick:a,children:(0,v.Y)(l.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,v.Y)(o.B,{css:(0,s.AH)({marginLeft:w.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:B,loading:O,children:(0,v.Y)(l.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var w={name:"1gyqtrv",styles:"width:min-content;max-width:100%"},T={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const M=({objectKey:e,value:t})=>{const{theme:n}=(0,o.u)(),i=(0,r.isString)(t)?t:JSON.stringify(t);return(0,v.Y)(a.T,{content:i,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,v.Y)(c.Tag,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:w,children:(0,v.FD)(o.T.Text,{css:T,children:[e&&(0,v.FD)(o.T.Text,{bold:!0,css:(0,s.AH)({marginRight:n.spacing.xs},""),children:[e,":"]}),i]})})})};var D=n(61938),k=n(84918);const C=e=>Array.isArray(e)?e.map((e,t)=>(0,v.Y)(M,{value:e},t)):(0,r.isObject)(e)?Object.entries(e).map(([e,t])=>(0,v.Y)(M,{objectKey:e,value:t},e)):(0,v.Y)(M,{value:e});var I={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},N={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const F=({expectation:e})=>{const{theme:t}=(0,o.u)(),[n,r]=(0,i.useState)(!1),[a,c]=(0,i.useState)(!1),{nodeMap:d,activeView:u}=(0,k.nJ)(),p=e.span_id?d[e.span_id]:null,m="summary"===u&&p,h=(0,g.jf)(e.expectation);return(0,v.FD)("div",{css:(0,s.AH)({padding:t.spacing.sm+t.spacing.xs,paddingTop:t.spacing.sm,border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,v.FD)("div",{css:I,children:[(0,v.Y)(o.T.Text,{bold:!0,css:N,children:e.assessment_name}),(0,v.Y)(Y,{assessment:e,setIsEditing:r,setShowDeleteModal:c}),(0,v.Y)(S,{assessment:e,isModalVisible:a,setIsModalVisible:c})]}),n?(0,v.Y)(A,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):C(h),m&&(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,v.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,v.Y)(D.o,{node:p})]})]})};var H={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const _=({jsonValue:e})=>{const{theme:t}=(0,o.u)();if(!e||'""'===e)return null;let n;try{n=JSON.parse(e)}catch(d){n=e}let r="default",i=JSON.stringify(n,null,2);return"yes"===n?(r="lime",i=(0,v.FD)(v.FK,{children:[(0,v.Y)(c.CheckCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,v.Y)(l.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===n?(r="coral",i=(0,v.FD)(v.FK,{children:[(0,v.Y)(c.XCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,v.Y)(l.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof n?i=n:null===n?(r="coral",i=(0,v.FD)(v.FK,{children:[(0,v.Y)(o.k,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,v.Y)(l.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===n?(r="lime",i=(0,v.FD)(v.FK,{children:[(0,v.Y)(c.CheckCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,v.Y)(l.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===n&&(r="coral",i=(0,v.FD)(v.FK,{children:[(0,v.Y)(c.XCircleIcon,{css:(0,s.AH)({marginRight:t.spacing.xs},"")}),(0,v.Y)(l.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,v.Y)(a.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:i,children:(0,v.Y)(c.Tag,{css:(0,s.AH)({display:"inline-flex",maxWidth:"100%",minWidth:t.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:r,children:(0,v.Y)("span",{css:H,children:i})})})},R=({source:e})=>{const{theme:t}=(0,o.u)();return(0,v.Y)(a.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,v.Y)("span",{css:(0,s.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:t.spacing.sm,minWidth:t.spacing.md},""),children:(0,v.Y)(o.T.Text,{children:(0,v.Y)("span",{css:(0,s.AH)({color:t.colors.blue500},""),children:e.source_id})})})})};var E={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const O=({renderConnector:e=!0,assessment:t,setIsEditing:n})=>{const{theme:r}=(0,o.u)(),[a,l]=(0,i.useState)(!1),d=(e=>{switch(e.source_type){case"HUMAN":return c.UserIcon;case"LLM_JUDGE":return c.SparkleIcon;default:return c.CodeIcon}})(t.source);return(0,v.FD)("div",{css:E,children:[e&&(0,v.Y)("div",{css:(0,s.AH)({position:"absolute",left:-1,top:0,width:10,height:r.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:r.borders.borderRadiusMd,borderBottom:`1px solid ${r.colors.border}`,borderLeft:`1px solid ${r.colors.border}`},"")}),(0,v.Y)(d,{size:r.typography.fontSizeSm,css:(0,s.AH)({padding:2,backgroundColor:r.colors.actionIconBackgroundHover,borderRadius:r.borders.borderRadiusFull},"")}),(0,v.Y)(R,{source:t.source}),(0,v.FD)("div",{css:(0,s.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:r.spacing.xs},""),children:[t.last_update_time&&(0,v.Y)(o.T.Text,{color:"secondary",size:"sm",css:(0,s.AH)({marginLeft:r.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:(0,g.Pt)(new Date(t.last_update_time))}),(0,v.Y)(Y,{assessment:t,setIsEditing:n,setShowDeleteModal:l}),(0,v.Y)(S,{assessment:t,isModalVisible:a,setIsModalVisible:l})]})]})};var B=n(99397),j=n(2515),z=n(53319);const L=({error:e})=>{const{theme:t}=(0,o.u)(),[n,r]=(0,i.useState)(!1);return(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,v.Y)(c.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,v.Y)("span",{children:e.error_message}),e.stack_trace&&(0,v.Y)(o.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>r(!0),children:(0,v.Y)(l.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,v.Y)(a.d,{title:(0,v.Y)(l.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:n,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>r(!1),children:(0,v.Y)(z.C,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:j.cC.TEXT})})]})};var K={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const $=({feedback:e})=>{const{theme:t}=(0,o.u)(),n=e.feedback.value;return(0,v.FD)("div",{css:K,children:[(0,v.Y)(O,{renderConnector:!1,assessment:e}),(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,r.isNil)(e.feedback.error)?(0,v.FD)(v.FK,{children:[(0,v.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,v.Y)("div",{children:(0,v.Y)(_,{jsonValue:JSON.stringify(n)})})]}):(0,v.Y)(L,{error:e.feedback.error}),e.rationale&&(0,v.FD)(v.FK,{children:[(0,v.Y)(o.T.Text,{size:"sm",color:"secondary",css:(0,s.AH)({marginTop:t.spacing.xs},""),children:(0,v.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,v.Y)(B.V,{children:e.rationale})]})]})]})},P=({isModalVisible:e,setIsModalVisible:t,feedback:n})=>{const s=(0,i.useMemo)(()=>(e=>{const t=new Set,n=[];let s=e;for(;s&&!t.has(s.assessment_id);)t.add(s.assessment_id),n.push(s),s=s.overriddenAssessment;return n})(n),[n]);return(0,v.Y)(a.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,v.Y)(l.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:s.map(e=>"feedback"in e?(0,v.Y)($,{feedback:e},e.assessment_id):null)})};var U={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},V={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"};const W=({feedback:e})=>{const[t,n]=(0,i.useState)(!1),{theme:a}=(0,o.u)(),{nodeMap:c,activeView:d}=(0,k.nJ)(),u=e.feedback.value,p=e.span_id?c[e.span_id]:null,m="summary"===d&&p;return(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,marginLeft:a.spacing.lg},""),children:[!(0,r.isNil)(e.feedback.error)&&(0,v.Y)(L,{error:e.feedback.error}),m&&(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.xs},""),children:[(0,v.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,v.Y)(D.o,{node:p})]}),(0,r.isNil)(e.feedback.error)&&(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.xs},""),children:[(0,v.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,v.FD)("div",{css:(0,s.AH)({display:"flex",gap:a.spacing.xs},""),children:[(0,v.Y)(_,{jsonValue:JSON.stringify(u)}),e.overriddenAssessment&&(0,v.FD)(v.FK,{children:[(0,v.Y)("span",{onClick:()=>n(!0),children:(0,v.Y)(o.T.Text,{css:U,color:"secondary",children:(0,v.Y)(l.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,v.Y)(P,{isModalVisible:t,setIsModalVisible:n,feedback:e})]})]})]}),e.rationale&&(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:a.spacing.xs},""),children:[(0,v.Y)(o.T.Text,{size:"sm",color:"secondary",children:(0,v.Y)(l.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,v.Y)("div",{css:V,children:(0,v.Y)(B.V,{children:e.rationale})})]})]})},J=({feedback:e})=>{const{theme:t}=(0,o.u)(),[n,r]=(0,i.useState)(!1);return(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,v.Y)(O,{assessment:e,setIsEditing:r}),n?(0,v.Y)(A,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,v.Y)(W,{feedback:e})]})};const G=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,v.Y)(c.UserIcon,{css:t});case"LLM_JUDGE":return(0,v.Y)(c.SparkleIcon,{css:t});case"CODE":return(0,v.Y)(c.CodeIcon,{css:t});default:return null}};var q={name:"ti75j2",styles:"margin:0"};const X=({feedbacks:e})=>{const{theme:t}=(0,o.u)();if(e.length<2)return null;const n=(0,r.countBy)(e,e=>e.source.source_type);return(0,v.Y)("div",{css:(0,s.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(n).map(([e,n])=>(0,v.Y)(c.Tag,{componentId:`shared.model-trace-explorer.feedback-source-count-${e}`,css:q,children:(0,v.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[G(e),(0,v.Y)(o.T.Text,{children:n})]})},e))})};var Q={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Z={name:"ozd7xs",styles:"flex-shrink:0"},ee={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const te=({jsonValue:e,feedbacks:t})=>{const{theme:n}=(0,o.u)(),[r,a]=(0,i.useState)(!1);return(0,v.FD)("div",{css:Q,children:[(0,v.FD)("div",{css:(0,s.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[(0,v.Y)(o.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:Z,size:"small",icon:r?(0,v.Y)(c.ChevronDownIcon,{}):(0,v.Y)(o.o,{}),onClick:()=>a(!r)}),(0,v.Y)(_,{jsonValue:e}),(0,v.Y)(X,{feedbacks:t})]}),r&&(0,v.Y)("div",{css:ee,children:t.map(e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,v.Y)(J,{feedback:e},e.assessment_id))})]})};var ne={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},se={name:"ozd7xs",styles:"flex-shrink:0"};const re=({name:e,valuesMap:t,traceId:n,activeSpanId:l})=>{const{theme:d}=(0,o.u)(),u=(0,g.se)(e),[p,m]=(0,i.useState)(!1),h=Object.values(t).flat().some(e=>!(0,r.isNil)(e.feedback.error));return(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",marginBottom:d.spacing.sm,border:`1px solid ${d.colors.border}`,borderRadius:d.borders.borderRadiusMd,padding:d.spacing.sm+d.spacing.xs,paddingTop:d.spacing.sm,gap:d.spacing.sm},""),children:[(0,v.FD)("div",{css:(0,s.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:d.spacing.sm},""),children:[(0,v.FD)("div",{css:(0,s.AH)({display:"flex",alignItems:"center",gap:d.spacing.sm,flex:1,minWidth:0},""),children:[(0,v.Y)(o.T.Text,{bold:!0,css:ne,children:u}),h&&(0,v.Y)(o.k,{css:se,color:"danger"})]}),(0,v.Y)(a.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,v.Y)(o.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,s.AH)({flexShrink:0,marginRight:-d.spacing.xs},""),size:"small",icon:(0,v.Y)(c.PlusIcon,{}),onClick:()=>m(!0)})})]}),Object.entries(t).map(([e,t])=>(0,v.Y)(te,{jsonValue:e,feedbacks:t},e)),p&&(0,v.Y)(y,{assessmentName:e,spanId:l,traceId:n,setExpanded:m})]})};var ie={name:"4c6dm7",styles:"display:flex;flex-direction:row;justify-content:space-between"};const oe=({assessments:e,traceId:t,activeSpanId:n})=>{const{theme:c}=(0,o.u)(),{setAssessmentsPaneExpanded:d}=(0,k.nJ)(),[u,p]=(0,i.useMemo)(()=>(0,r.partition)(e,e=>"feedback"in e),[e]),m=(0,i.useMemo)(()=>(e=>{const t={};return e.forEach(e=>{if(!1===e.valid)return;let n=null;""!==e.feedback.value&&(n=JSON.stringify(e.feedback.value));const{assessment_name:s}=e;t[s]||(t[s]={});const i=t[s];(0,r.isNil)(n)||(i[n]||(i[n]=[]),i[n].push(e))}),Object.entries(t).toSorted(([e],[t])=>e.localeCompare(t))})(u),[u]),h=p.toSorted((e,t)=>e.assessment_name.localeCompare(t.assessment_name));return(0,v.FD)("div",{"data-testid":"assessments-pane",css:(0,s.AH)({display:"flex",flexDirection:"column",padding:c.spacing.sm,paddingTop:c.spacing.xs,height:"100%",borderLeft:`1px solid ${c.colors.border}`,overflowY:"scroll",minWidth:g.uZ,width:"100%",boxSizing:"border-box"},""),children:[(0,v.FD)("div",{css:ie,children:[(0,v.Y)(o.T.Text,{css:(0,s.AH)({marginBottom:c.spacing.sm},""),bold:!0,children:(0,v.Y)(l.sA,{id:"++Ydlz",defaultMessage:"Assessments"})}),d&&(0,v.Y)(a.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,v.Y)(l.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,v.Y)(o.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,v.Y)(o.C,{}),onClick:()=>d(!1)})})]}),m.map(([e,s])=>(0,v.Y)(re,{name:e,valuesMap:s,traceId:t,activeSpanId:n},e)),h.length>0&&(0,v.FD)(v.FK,{children:[(0,v.Y)(o.T.Text,{color:"secondary",css:(0,s.AH)({marginBottom:c.spacing.sm},""),children:(0,v.Y)(l.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,v.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:c.spacing.sm,marginBottom:c.spacing.sm},""),children:h.map(e=>(0,v.Y)(F,{expectation:e},e.assessment_id))})]}),(0,v.Y)(x,{title:"Add new assessment",spanId:n,traceId:t})]})}},93745:function(e,t,n){n.d(t,{nX:function(){return s},wO:function(){return r}});const s=()=>!0,r=()=>!0},93806:function(e,t,n){n.d(t,{w:function(){return b}});var s=n(64819),r=n(45901),i=n(76998),o=n(37733),a=n(32256),l=n(49818),c=n(2515),d=n(61520),u=n(53242),p=n(51391);const m=({searchFilter:e,data:t,activeMatch:n,containsActiveMatch:r})=>{const{theme:a}=(0,o.u)(),l=(0,i.useCallback)(e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})},[]),c=(0,i.useMemo)(()=>e?(0,d.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:a.colors[u.k],inactiveMatchBackgroundColor:a.colors[u.B],containsActiveMatch:r,activeMatch:n,scrollToActiveMatch:l}):[],[e,t,a,r,n,l]);return(0,p.Y)("pre",{css:(0,s.AH)({whiteSpace:"pre-wrap",backgroundColor:a.colors.backgroundSecondary,padding:a.spacing.sm,fontSize:a.typography.fontSizeSm},""),children:c})};var g=n(99397),h=n(77177);const f=4,v=300;var y={name:"bjn8wh",styles:"position:relative"},x={name:"n31mhe",styles:"width:100%;padding:0"};function b({data:e,searchFilter:t="",activeMatch:n=null,containsActiveMatch:d=!1,renderMode:u=c.cC.JSON}){const b=Boolean(t)&&!(0,r.isNil)(n)&&e.toLowerCase().includes(t),{theme:Y}=(0,o.u)(),[S,A]=(0,i.useState)("json"===u),[w,T]=(0,i.useState)(b),M=(0,i.useRef)(null),D=(0,i.useMemo)(()=>{if("json"===u)return e;const t=JSON.parse(e);return(0,r.isString)(t)?t:e},[e,u]),k=S||D.split("\n").length>f||D.length>v,C=(0,i.useMemo)(()=>{if(k&&!w){const e=D.split("\n").slice(0,f).join("\n");return e.length>v?e.slice(0,v):e}return D},[D,k,w]);(0,i.useEffect)(()=>{M.current&&A(M.current.scrollWidth>M.current.clientWidth)},[e]);const I=(0,i.useCallback)(e=>(0,p.Y)("pre",{...e,ref:M}),[]);return b?(0,p.Y)(m,{data:e,searchFilter:t,activeMatch:n,containsActiveMatch:!n.isKeyMatch&&d}):(0,p.FD)("div",{css:y,children:["markdown"===u?(0,p.Y)("div",{css:(0,s.AH)({padding:Y.spacing.md,backgroundColor:Y.colors.backgroundSecondary,marginBottom:-Y.spacing.md},""),children:(0,p.Y)(g.V,{children:C})}):(0,p.FD)(p.FK,{children:[(0,p.Y)(h.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,s.AH)({position:"absolute",top:Y.spacing.xs,right:Y.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,p.Y)(h.z7,{PreTag:I,showLineNumbers:!0,language:u,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:w,theme:Y.isDarkMode?"duotoneDark":"light",style:{backgroundColor:Y.colors.backgroundSecondary,padding:Y.spacing.sm,paddingBottom:k?0:Y.spacing.sm,paddingRight:2*Y.spacing.md,overflow:w?"auto":"hidden",textOverflow:"ellipsis",fontSize:Y.typography.fontSizeSm,lineHeight:Y.typography.lineHeightBase},children:C})]}),k&&(0,p.Y)("div",{css:(0,s.AH)({backgroundColor:Y.colors.backgroundSecondary},""),children:(0,p.Y)(o.B,{css:x,componentId:w?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:w?(0,p.Y)(a.ChevronUpIcon,{}):(0,p.Y)(a.ChevronDownIcon,{}),type:"tertiary",onClick:()=>T(!w),children:w?(0,p.Y)(l.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,p.Y)(l.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}},99397:function(e,t,n){n.d(t,{V:function(){return Y}});var s=n(76998),r=n(84248),i=n(60976),o=n(37733),a=n(32256),l=n(77177),c=n(64819),d=n(25204),u=n(51391);var p={name:"1qmr6ab",styles:"overflow:auto"},m={name:"uufhp1",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%;z-index:0"};const g=({children:e})=>(0,u.Y)("div",{"data-testid":"basic-table",css:p,children:(0,u.Y)(a.Table,{scrollable:!0,css:m,children:e})}),h=({children:e,node:t})=>{const{header:n,rows:r,isValid:i}=function({children:e}){var t;if(!e)return{header:void 0,rows:[],isValid:!1};const n=s.Children.toArray(e);return{header:null!==(t=n[0])&&void 0!==t?t:void 0,rows:n.slice(1).flatMap(e=>s.isValidElement(e)?s.Children.toArray(e.props.children).filter(e=>s.isValidElement(e)):[]),isValid:!0}}({children:e,node:t});return i?(0,u.Y)(v,{header:n,rows:r}):(0,u.Y)(g,{children:e,node:t})};var f={name:"qneu98",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%"};const v=({header:e,rows:t})=>{const{theme:n}=(0,o.u)(),r=s.useRef(null),i=(0,d.z)({size:t.length,parentRef:r,overscan:20}),{virtualItems:l,totalSize:p}=i;return(0,u.Y)("div",{"data-testid":"virtualized-table",ref:r,css:(0,c.AH)({overflow:"auto",maxHeight:420,border:"1px solid",borderColor:n.colors.border,borderRadius:n.borders.borderRadiusMd,marginBottom:n.spacing.md,zIndex:0},""),children:(0,u.FD)(a.Table,{css:f,children:[e,(0,u.Y)("div",{css:(0,c.AH)({position:"relative",height:`${p}px`,width:"100%",'& > div:last-child [role="cell"]':{borderBottom:"none"}},""),children:l.map(e=>{const n=e.index,s=t[n];return(0,u.Y)("div",{ref:e.measureRef,css:(0,c.AH)({position:"absolute",top:`${e.start}px`,width:"100%"},""),children:s},n)})})]})})},y=({children:e,node:t})=>{const n=null===t||void 0===t?void 0:t.children.some(e=>"tagName"in e&&"th"===e.tagName),{theme:s}=(0,o.u)();return(0,u.Y)(a.TableRow,{style:n?{position:"sticky",top:0,zIndex:1,backgroundColor:s.colors.backgroundPrimary}:void 0,children:e,isHeader:n})},x=({children:e,node:t})=>{const n="th"===(null===t||void 0===t?void 0:t.tagName),{theme:s}=(0,o.u)();return n?(0,u.Y)(a.TableHeader,{"data-testid":"virtualized-table-header",componentId:"virtualized-table-header",css:(0,c.AH)({paddingLeft:s.spacing.sm,borderColor:s.colors.border,color:s.colors.textPrimary},""),children:e}):(0,u.Y)(a.TableCell,{children:e})};const b=e=>e.startsWith("data:image/png")||e.startsWith("data:image/jpeg")?e:(0,r.Lv)(e),Y=e=>{const t=(0,s.useMemo)(()=>k({extensions:e.components}),[e.components]);return(0,u.Y)(r.oz,{components:t,remarkPlugins:M,urlTransform:b,children:e.children})},S=({codeBlock:e,codeInline:t,node:n,...r})=>{var i,o;const a=s.useMemo(()=>{var e;const t=/language-(\w+)/.exec(null!==(e=r.className)&&void 0!==e?e:"");return t&&t[1]?t[1]:void 0},[r.className]);return(null===n||void 0===n||null===(i=n.position)||void 0===i?void 0:i.start.line)===(null===n||void 0===n||null===(o=n.position)||void 0===o?void 0:o.end.line)?s.createElement(t,r):s.createElement(e,{...r,language:a})},A=({children:e})=>(0,u.Y)(o.T.Text,{code:!0,children:e});var w={name:"bjn8wh",styles:"position:relative"};const T=s.memo(({children:e,language:t})=>{const{theme:n}=(0,o.u)(),s=String(e).replace(/\n$/,"");return(0,u.Y)("div",{css:w,children:(0,u.Y)(l.z7,{actions:(0,u.Y)(l.VE,{componentId:"genai.util.markdown-copy-code-block",copyText:s}),theme:n.isDarkMode?"duotoneDark":"light",children:s,language:t&&C(t)?t:"text",style:{padding:"8px 0",borderRadius:8,width:"100%",boxSizing:"border-box",maxHeight:640,display:"flex",flexDirection:"column-reverse"},showLineNumbers:!0})})}),M=[i.A];var D={name:"qhxz92",styles:"max-width:100%"};const k=e=>({a:({href:e,children:t})=>(0,u.Y)(o.T.Link,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_71",href:e,id:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?e.replace("#user-content-fn-","user-content-fnref-"):void 0,disabled:null===e||void 0===e?void 0:e.startsWith("."),children:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?(0,u.FD)(u.FK,{children:["[",t,"]"]}):t,openInNewTab:!(e&&e.startsWith("#"))}),code:t=>{var n,s,r,i;return(0,u.Y)(S,{...t,codeBlock:null!==(n=null===(s=e.extensions)||void 0===s?void 0:s.codeBlock)&&void 0!==n?n:T,codeInline:null!==(r=null===(i=e.extensions)||void 0===i?void 0:i.codeInline)&&void 0!==r?r:A})},p:({children:e})=>(0,u.Y)(o.T.Paragraph,{children:e}),h1:({children:e})=>(0,u.Y)(o.T.Title,{level:1,children:e}),h2:({children:e})=>(0,u.Y)(o.T.Title,{level:2,children:e}),h3:({children:e})=>(0,u.Y)(o.T.Title,{level:3,children:e}),h4:({children:e})=>(0,u.Y)(o.T.Title,{level:4,children:e}),h5:({children:e})=>(0,u.Y)(o.T.Title,{level:5,children:e}),table:({children:e,node:t})=>(0,u.Y)(h,{children:e,node:t}),tr:({children:e,node:t})=>(0,u.Y)(y,{children:e,node:t}),th:({children:e,node:t})=>(0,u.Y)(x,{children:e,node:t}),td:({children:e})=>(0,u.Y)(a.TableCell,{children:e,multiline:!0}),thead:({children:e})=>(0,u.Y)(u.FK,{children:e}),tbody:({children:e})=>(0,u.Y)(u.FK,{children:e}),img:({src:e,alt:t})=>(0,u.Y)("img",{src:e,alt:t,css:D})}),C=e=>{switch(e){case"go":case"java":case"javascript":case"json":case"python":case"sql":case"text":case"yaml":return!0;default:return!1}}}}]);
//# sourceMappingURL=1241.41241c1b.chunk.js.map